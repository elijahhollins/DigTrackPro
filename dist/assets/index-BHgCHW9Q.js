var UI=Object.defineProperty;var NA=i=>{throw TypeError(i)};var FI=(i,e,t)=>e in i?UI(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var qe=(i,e,t)=>FI(i,typeof e!="symbol"?e+"":e,t),Gy=(i,e,t)=>e.has(i)||NA("Cannot "+t);var g=(i,e,t)=>(Gy(i,e,"read from private field"),t?t.call(i):e.get(i)),L=(i,e,t)=>e.has(i)?NA("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(i):e.set(i,t),N=(i,e,t,n)=>(Gy(i,e,"write to private field"),n?n.call(i,t):e.set(i,t),t),D=(i,e,t)=>(Gy(i,e,"access private method"),t);var _i=(i,e,t,n)=>({set _(s){N(i,e,s,t)},get _(){return g(i,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))n(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const l of o.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(s){if(s.ep)return;s.ep=!0;const o=t(s);fetch(s.href,o)}})();function v1(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Vy={exports:{}},Wd={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kA;function HI(){if(kA)return Wd;kA=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,s,o){var l=null;if(o!==void 0&&(l=""+o),s.key!==void 0&&(l=""+s.key),"key"in s){o={};for(var c in s)c!=="key"&&(o[c]=s[c])}else o=s;return s=o.ref,{$$typeof:i,type:n,key:l,ref:s!==void 0?s:null,props:o}}return Wd.Fragment=e,Wd.jsx=t,Wd.jsxs=t,Wd}var IA;function BI(){return IA||(IA=1,Vy.exports=HI()),Vy.exports}var w=BI(),zy={exports:{}},Be={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MA;function jI(){if(MA)return Be;MA=1;var i=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),s=Symbol.for("react.profiler"),o=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),y=Symbol.for("react.activity"),b=Symbol.iterator;function S(F){return F===null||typeof F!="object"?null:(F=b&&F[b]||F["@@iterator"],typeof F=="function"?F:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},R=Object.assign,A={};function C(F,V,se){this.props=F,this.context=V,this.refs=A,this.updater=se||E}C.prototype.isReactComponent={},C.prototype.setState=function(F,V){if(typeof F!="object"&&typeof F!="function"&&F!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,F,V,"setState")},C.prototype.forceUpdate=function(F){this.updater.enqueueForceUpdate(this,F,"forceUpdate")};function k(){}k.prototype=C.prototype;function I(F,V,se){this.props=F,this.context=V,this.refs=A,this.updater=se||E}var O=I.prototype=new k;O.constructor=I,R(O,C.prototype),O.isPureReactComponent=!0;var U=Array.isArray;function P(){}var B={H:null,A:null,T:null,S:null},Q=Object.prototype.hasOwnProperty;function K(F,V,se){var he=se.ref;return{$$typeof:i,type:F,key:V,ref:he!==void 0?he:null,props:se}}function le(F,V){return K(F.type,V,F.props)}function de(F){return typeof F=="object"&&F!==null&&F.$$typeof===i}function G(F){var V={"=":"=0",":":"=2"};return"$"+F.replace(/[=:]/g,function(se){return V[se]})}var fe=/\/+/g;function ce(F,V){return typeof F=="object"&&F!==null&&F.key!=null?G(""+F.key):V.toString(36)}function pe(F){switch(F.status){case"fulfilled":return F.value;case"rejected":throw F.reason;default:switch(typeof F.status=="string"?F.then(P,P):(F.status="pending",F.then(function(V){F.status==="pending"&&(F.status="fulfilled",F.value=V)},function(V){F.status==="pending"&&(F.status="rejected",F.reason=V)})),F.status){case"fulfilled":return F.value;case"rejected":throw F.reason}}throw F}function z(F,V,se,he,Te){var ke=typeof F;(ke==="undefined"||ke==="boolean")&&(F=null);var xe=!1;if(F===null)xe=!0;else switch(ke){case"bigint":case"string":case"number":xe=!0;break;case"object":switch(F.$$typeof){case i:case e:xe=!0;break;case p:return xe=F._init,z(xe(F._payload),V,se,he,Te)}}if(xe)return Te=Te(F),xe=he===""?"."+ce(F,0):he,U(Te)?(se="",xe!=null&&(se=xe.replace(fe,"$&/")+"/"),z(Te,V,se,"",function(As){return As})):Te!=null&&(de(Te)&&(Te=le(Te,se+(Te.key==null||F&&F.key===Te.key?"":(""+Te.key).replace(fe,"$&/")+"/")+xe)),V.push(Te)),1;xe=0;var ft=he===""?".":he+":";if(U(F))for(var Ye=0;Ye<F.length;Ye++)he=F[Ye],ke=ft+ce(he,Ye),xe+=z(he,V,se,ke,Te);else if(Ye=S(F),typeof Ye=="function")for(F=Ye.call(F),Ye=0;!(he=F.next()).done;)he=he.value,ke=ft+ce(he,Ye++),xe+=z(he,V,se,ke,Te);else if(ke==="object"){if(typeof F.then=="function")return z(pe(F),V,se,he,Te);throw V=String(F),Error("Objects are not valid as a React child (found: "+(V==="[object Object]"?"object with keys {"+Object.keys(F).join(", ")+"}":V)+"). If you meant to render a collection of children, use an array instead.")}return xe}function X(F,V,se){if(F==null)return F;var he=[],Te=0;return z(F,he,"","",function(ke){return V.call(se,ke,Te++)}),he}function te(F){if(F._status===-1){var V=F._result;V=V(),V.then(function(se){(F._status===0||F._status===-1)&&(F._status=1,F._result=se)},function(se){(F._status===0||F._status===-1)&&(F._status=2,F._result=se)}),F._status===-1&&(F._status=0,F._result=V)}if(F._status===1)return F._result.default;throw F._result}var ne=typeof reportError=="function"?reportError:function(F){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var V=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof F=="object"&&F!==null&&typeof F.message=="string"?String(F.message):String(F),error:F});if(!window.dispatchEvent(V))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",F);return}console.error(F)},ue={map:X,forEach:function(F,V,se){X(F,function(){V.apply(this,arguments)},se)},count:function(F){var V=0;return X(F,function(){V++}),V},toArray:function(F){return X(F,function(V){return V})||[]},only:function(F){if(!de(F))throw Error("React.Children.only expected to receive a single React element child.");return F}};return Be.Activity=y,Be.Children=ue,Be.Component=C,Be.Fragment=t,Be.Profiler=s,Be.PureComponent=I,Be.StrictMode=n,Be.Suspense=d,Be.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=B,Be.__COMPILER_RUNTIME={__proto__:null,c:function(F){return B.H.useMemoCache(F)}},Be.cache=function(F){return function(){return F.apply(null,arguments)}},Be.cacheSignal=function(){return null},Be.cloneElement=function(F,V,se){if(F==null)throw Error("The argument must be a React element, but you passed "+F+".");var he=R({},F.props),Te=F.key;if(V!=null)for(ke in V.key!==void 0&&(Te=""+V.key),V)!Q.call(V,ke)||ke==="key"||ke==="__self"||ke==="__source"||ke==="ref"&&V.ref===void 0||(he[ke]=V[ke]);var ke=arguments.length-2;if(ke===1)he.children=se;else if(1<ke){for(var xe=Array(ke),ft=0;ft<ke;ft++)xe[ft]=arguments[ft+2];he.children=xe}return K(F.type,Te,he)},Be.createContext=function(F){return F={$$typeof:l,_currentValue:F,_currentValue2:F,_threadCount:0,Provider:null,Consumer:null},F.Provider=F,F.Consumer={$$typeof:o,_context:F},F},Be.createElement=function(F,V,se){var he,Te={},ke=null;if(V!=null)for(he in V.key!==void 0&&(ke=""+V.key),V)Q.call(V,he)&&he!=="key"&&he!=="__self"&&he!=="__source"&&(Te[he]=V[he]);var xe=arguments.length-2;if(xe===1)Te.children=se;else if(1<xe){for(var ft=Array(xe),Ye=0;Ye<xe;Ye++)ft[Ye]=arguments[Ye+2];Te.children=ft}if(F&&F.defaultProps)for(he in xe=F.defaultProps,xe)Te[he]===void 0&&(Te[he]=xe[he]);return K(F,ke,Te)},Be.createRef=function(){return{current:null}},Be.forwardRef=function(F){return{$$typeof:c,render:F}},Be.isValidElement=de,Be.lazy=function(F){return{$$typeof:p,_payload:{_status:-1,_result:F},_init:te}},Be.memo=function(F,V){return{$$typeof:h,type:F,compare:V===void 0?null:V}},Be.startTransition=function(F){var V=B.T,se={};B.T=se;try{var he=F(),Te=B.S;Te!==null&&Te(se,he),typeof he=="object"&&he!==null&&typeof he.then=="function"&&he.then(P,ne)}catch(ke){ne(ke)}finally{V!==null&&se.types!==null&&(V.types=se.types),B.T=V}},Be.unstable_useCacheRefresh=function(){return B.H.useCacheRefresh()},Be.use=function(F){return B.H.use(F)},Be.useActionState=function(F,V,se){return B.H.useActionState(F,V,se)},Be.useCallback=function(F,V){return B.H.useCallback(F,V)},Be.useContext=function(F){return B.H.useContext(F)},Be.useDebugValue=function(){},Be.useDeferredValue=function(F,V){return B.H.useDeferredValue(F,V)},Be.useEffect=function(F,V){return B.H.useEffect(F,V)},Be.useEffectEvent=function(F){return B.H.useEffectEvent(F)},Be.useId=function(){return B.H.useId()},Be.useImperativeHandle=function(F,V,se){return B.H.useImperativeHandle(F,V,se)},Be.useInsertionEffect=function(F,V){return B.H.useInsertionEffect(F,V)},Be.useLayoutEffect=function(F,V){return B.H.useLayoutEffect(F,V)},Be.useMemo=function(F,V){return B.H.useMemo(F,V)},Be.useOptimistic=function(F,V){return B.H.useOptimistic(F,V)},Be.useReducer=function(F,V,se){return B.H.useReducer(F,V,se)},Be.useRef=function(F){return B.H.useRef(F)},Be.useState=function(F){return B.H.useState(F)},Be.useSyncExternalStore=function(F,V,se){return B.H.useSyncExternalStore(F,V,se)},Be.useTransition=function(){return B.H.useTransition()},Be.version="19.2.4",Be}var DA;function rw(){return DA||(DA=1,zy.exports=jI()),zy.exports}var ee=rw();const ow=v1(ee);var $y={exports:{}},Xd={},Yy={exports:{}},Jy={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var LA;function qI(){return LA||(LA=1,(function(i){function e(z,X){var te=z.length;z.push(X);e:for(;0<te;){var ne=te-1>>>1,ue=z[ne];if(0<s(ue,X))z[ne]=X,z[te]=ue,te=ne;else break e}}function t(z){return z.length===0?null:z[0]}function n(z){if(z.length===0)return null;var X=z[0],te=z.pop();if(te!==X){z[0]=te;e:for(var ne=0,ue=z.length,F=ue>>>1;ne<F;){var V=2*(ne+1)-1,se=z[V],he=V+1,Te=z[he];if(0>s(se,te))he<ue&&0>s(Te,se)?(z[ne]=Te,z[he]=te,ne=he):(z[ne]=se,z[V]=te,ne=V);else if(he<ue&&0>s(Te,te))z[ne]=Te,z[he]=te,ne=he;else break e}}return X}function s(z,X){var te=z.sortIndex-X.sortIndex;return te!==0?te:z.id-X.id}if(i.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var o=performance;i.unstable_now=function(){return o.now()}}else{var l=Date,c=l.now();i.unstable_now=function(){return l.now()-c}}var d=[],h=[],p=1,y=null,b=3,S=!1,E=!1,R=!1,A=!1,C=typeof setTimeout=="function"?setTimeout:null,k=typeof clearTimeout=="function"?clearTimeout:null,I=typeof setImmediate<"u"?setImmediate:null;function O(z){for(var X=t(h);X!==null;){if(X.callback===null)n(h);else if(X.startTime<=z)n(h),X.sortIndex=X.expirationTime,e(d,X);else break;X=t(h)}}function U(z){if(R=!1,O(z),!E)if(t(d)!==null)E=!0,P||(P=!0,G());else{var X=t(h);X!==null&&pe(U,X.startTime-z)}}var P=!1,B=-1,Q=5,K=-1;function le(){return A?!0:!(i.unstable_now()-K<Q)}function de(){if(A=!1,P){var z=i.unstable_now();K=z;var X=!0;try{e:{E=!1,R&&(R=!1,k(B),B=-1),S=!0;var te=b;try{t:{for(O(z),y=t(d);y!==null&&!(y.expirationTime>z&&le());){var ne=y.callback;if(typeof ne=="function"){y.callback=null,b=y.priorityLevel;var ue=ne(y.expirationTime<=z);if(z=i.unstable_now(),typeof ue=="function"){y.callback=ue,O(z),X=!0;break t}y===t(d)&&n(d),O(z)}else n(d);y=t(d)}if(y!==null)X=!0;else{var F=t(h);F!==null&&pe(U,F.startTime-z),X=!1}}break e}finally{y=null,b=te,S=!1}X=void 0}}finally{X?G():P=!1}}}var G;if(typeof I=="function")G=function(){I(de)};else if(typeof MessageChannel<"u"){var fe=new MessageChannel,ce=fe.port2;fe.port1.onmessage=de,G=function(){ce.postMessage(null)}}else G=function(){C(de,0)};function pe(z,X){B=C(function(){z(i.unstable_now())},X)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(z){z.callback=null},i.unstable_forceFrameRate=function(z){0>z||125<z?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Q=0<z?Math.floor(1e3/z):5},i.unstable_getCurrentPriorityLevel=function(){return b},i.unstable_next=function(z){switch(b){case 1:case 2:case 3:var X=3;break;default:X=b}var te=b;b=X;try{return z()}finally{b=te}},i.unstable_requestPaint=function(){A=!0},i.unstable_runWithPriority=function(z,X){switch(z){case 1:case 2:case 3:case 4:case 5:break;default:z=3}var te=b;b=z;try{return X()}finally{b=te}},i.unstable_scheduleCallback=function(z,X,te){var ne=i.unstable_now();switch(typeof te=="object"&&te!==null?(te=te.delay,te=typeof te=="number"&&0<te?ne+te:ne):te=ne,z){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=te+ue,z={id:p++,callback:X,priorityLevel:z,startTime:te,expirationTime:ue,sortIndex:-1},te>ne?(z.sortIndex=te,e(h,z),t(d)===null&&z===t(h)&&(R?(k(B),B=-1):R=!0,pe(U,te-ne))):(z.sortIndex=ue,e(d,z),E||S||(E=!0,P||(P=!0,G()))),z},i.unstable_shouldYield=le,i.unstable_wrapCallback=function(z){var X=b;return function(){var te=b;b=X;try{return z.apply(this,arguments)}finally{b=te}}}})(Jy)),Jy}var PA;function GI(){return PA||(PA=1,Yy.exports=qI()),Yy.exports}var Ky={exports:{}},Dn={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var OA;function VI(){if(OA)return Dn;OA=1;var i=rw();function e(d){var h="https://react.dev/errors/"+d;if(1<arguments.length){h+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)h+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+d+"; visit "+h+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},s=Symbol.for("react.portal");function o(d,h,p){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:s,key:y==null?null:""+y,children:d,containerInfo:h,implementation:p}}var l=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(d,h){if(d==="font")return"";if(typeof h=="string")return h==="use-credentials"?h:""}return Dn.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Dn.createPortal=function(d,h){var p=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!h||h.nodeType!==1&&h.nodeType!==9&&h.nodeType!==11)throw Error(e(299));return o(d,h,null,p)},Dn.flushSync=function(d){var h=l.T,p=n.p;try{if(l.T=null,n.p=2,d)return d()}finally{l.T=h,n.p=p,n.d.f()}},Dn.preconnect=function(d,h){typeof d=="string"&&(h?(h=h.crossOrigin,h=typeof h=="string"?h==="use-credentials"?h:"":void 0):h=null,n.d.C(d,h))},Dn.prefetchDNS=function(d){typeof d=="string"&&n.d.D(d)},Dn.preinit=function(d,h){if(typeof d=="string"&&h&&typeof h.as=="string"){var p=h.as,y=c(p,h.crossOrigin),b=typeof h.integrity=="string"?h.integrity:void 0,S=typeof h.fetchPriority=="string"?h.fetchPriority:void 0;p==="style"?n.d.S(d,typeof h.precedence=="string"?h.precedence:void 0,{crossOrigin:y,integrity:b,fetchPriority:S}):p==="script"&&n.d.X(d,{crossOrigin:y,integrity:b,fetchPriority:S,nonce:typeof h.nonce=="string"?h.nonce:void 0})}},Dn.preinitModule=function(d,h){if(typeof d=="string")if(typeof h=="object"&&h!==null){if(h.as==null||h.as==="script"){var p=c(h.as,h.crossOrigin);n.d.M(d,{crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0})}}else h==null&&n.d.M(d)},Dn.preload=function(d,h){if(typeof d=="string"&&typeof h=="object"&&h!==null&&typeof h.as=="string"){var p=h.as,y=c(p,h.crossOrigin);n.d.L(d,p,{crossOrigin:y,integrity:typeof h.integrity=="string"?h.integrity:void 0,nonce:typeof h.nonce=="string"?h.nonce:void 0,type:typeof h.type=="string"?h.type:void 0,fetchPriority:typeof h.fetchPriority=="string"?h.fetchPriority:void 0,referrerPolicy:typeof h.referrerPolicy=="string"?h.referrerPolicy:void 0,imageSrcSet:typeof h.imageSrcSet=="string"?h.imageSrcSet:void 0,imageSizes:typeof h.imageSizes=="string"?h.imageSizes:void 0,media:typeof h.media=="string"?h.media:void 0})}},Dn.preloadModule=function(d,h){if(typeof d=="string")if(h){var p=c(h.as,h.crossOrigin);n.d.m(d,{as:typeof h.as=="string"&&h.as!=="script"?h.as:void 0,crossOrigin:p,integrity:typeof h.integrity=="string"?h.integrity:void 0})}else n.d.m(d)},Dn.requestFormReset=function(d){n.d.r(d)},Dn.unstable_batchedUpdates=function(d,h){return d(h)},Dn.useFormState=function(d,h,p){return l.H.useFormState(d,h,p)},Dn.useFormStatus=function(){return l.H.useHostTransitionStatus()},Dn.version="19.2.4",Dn}var UA;function zI(){if(UA)return Ky.exports;UA=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Ky.exports=VI(),Ky.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var FA;function $I(){if(FA)return Xd;FA=1;var i=GI(),e=rw(),t=zI();function n(r){var a="https://react.dev/errors/"+r;if(1<arguments.length){a+="?args[]="+encodeURIComponent(arguments[1]);for(var u=2;u<arguments.length;u++)a+="&args[]="+encodeURIComponent(arguments[u])}return"Minified React error #"+r+"; visit "+a+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(r){return!(!r||r.nodeType!==1&&r.nodeType!==9&&r.nodeType!==11)}function o(r){var a=r,u=r;if(r.alternate)for(;a.return;)a=a.return;else{r=a;do a=r,(a.flags&4098)!==0&&(u=a.return),r=a.return;while(r)}return a.tag===3?u:null}function l(r){if(r.tag===13){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function c(r){if(r.tag===31){var a=r.memoizedState;if(a===null&&(r=r.alternate,r!==null&&(a=r.memoizedState)),a!==null)return a.dehydrated}return null}function d(r){if(o(r)!==r)throw Error(n(188))}function h(r){var a=r.alternate;if(!a){if(a=o(r),a===null)throw Error(n(188));return a!==r?null:r}for(var u=r,f=a;;){var _=u.return;if(_===null)break;var x=_.alternate;if(x===null){if(f=_.return,f!==null){u=f;continue}break}if(_.child===x.child){for(x=_.child;x;){if(x===u)return d(_),r;if(x===f)return d(_),a;x=x.sibling}throw Error(n(188))}if(u.return!==f.return)u=_,f=x;else{for(var T=!1,M=_.child;M;){if(M===u){T=!0,u=_,f=x;break}if(M===f){T=!0,f=_,u=x;break}M=M.sibling}if(!T){for(M=x.child;M;){if(M===u){T=!0,u=x,f=_;break}if(M===f){T=!0,f=x,u=_;break}M=M.sibling}if(!T)throw Error(n(189))}}if(u.alternate!==f)throw Error(n(190))}if(u.tag!==3)throw Error(n(188));return u.stateNode.current===u?r:a}function p(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r;for(r=r.child;r!==null;){if(a=p(r),a!==null)return a;r=r.sibling}return null}var y=Object.assign,b=Symbol.for("react.element"),S=Symbol.for("react.transitional.element"),E=Symbol.for("react.portal"),R=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),k=Symbol.for("react.consumer"),I=Symbol.for("react.context"),O=Symbol.for("react.forward_ref"),U=Symbol.for("react.suspense"),P=Symbol.for("react.suspense_list"),B=Symbol.for("react.memo"),Q=Symbol.for("react.lazy"),K=Symbol.for("react.activity"),le=Symbol.for("react.memo_cache_sentinel"),de=Symbol.iterator;function G(r){return r===null||typeof r!="object"?null:(r=de&&r[de]||r["@@iterator"],typeof r=="function"?r:null)}var fe=Symbol.for("react.client.reference");function ce(r){if(r==null)return null;if(typeof r=="function")return r.$$typeof===fe?null:r.displayName||r.name||null;if(typeof r=="string")return r;switch(r){case R:return"Fragment";case C:return"Profiler";case A:return"StrictMode";case U:return"Suspense";case P:return"SuspenseList";case K:return"Activity"}if(typeof r=="object")switch(r.$$typeof){case E:return"Portal";case I:return r.displayName||"Context";case k:return(r._context.displayName||"Context")+".Consumer";case O:var a=r.render;return r=r.displayName,r||(r=a.displayName||a.name||"",r=r!==""?"ForwardRef("+r+")":"ForwardRef"),r;case B:return a=r.displayName||null,a!==null?a:ce(r.type)||"Memo";case Q:a=r._payload,r=r._init;try{return ce(r(a))}catch{}}return null}var pe=Array.isArray,z=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,X=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,te={pending:!1,data:null,method:null,action:null},ne=[],ue=-1;function F(r){return{current:r}}function V(r){0>ue||(r.current=ne[ue],ne[ue]=null,ue--)}function se(r,a){ue++,ne[ue]=r.current,r.current=a}var he=F(null),Te=F(null),ke=F(null),xe=F(null);function ft(r,a){switch(se(ke,a),se(Te,r),se(he,null),a.nodeType){case 9:case 11:r=(r=a.documentElement)&&(r=r.namespaceURI)?QE(r):0;break;default:if(r=a.tagName,a=a.namespaceURI)a=QE(a),r=ZE(a,r);else switch(r){case"svg":r=1;break;case"math":r=2;break;default:r=0}}V(he),se(he,r)}function Ye(){V(he),V(Te),V(ke)}function As(r){r.memoizedState!==null&&se(xe,r);var a=he.current,u=ZE(a,r.type);a!==u&&(se(Te,r),se(he,u))}function gn(r){Te.current===r&&(V(he),V(Te)),xe.current===r&&(V(xe),$d._currentValue=te)}var ao,Yl;function Mn(r){if(ao===void 0)try{throw Error()}catch(u){var a=u.stack.trim().match(/\n( *(at )?)/);ao=a&&a[1]||"",Yl=-1<u.stack.indexOf(`
    at`)?" (<anonymous>)":-1<u.stack.indexOf("@")?"@unknown:0:0":""}return`
`+ao+r+Yl}var Zs=!1;function Ts(r,a){if(!r||Zs)return"";Zs=!0;var u=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var f={DetermineComponentFrameRoot:function(){try{if(a){var re=function(){throw Error()};if(Object.defineProperty(re.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(re,[])}catch(W){var J=W}Reflect.construct(r,[],re)}else{try{re.call()}catch(W){J=W}r.call(re.prototype)}}else{try{throw Error()}catch(W){J=W}(re=r())&&typeof re.catch=="function"&&re.catch(function(){})}}catch(W){if(W&&J&&typeof W.stack=="string")return[W.stack,J.stack]}return[null,null]}};f.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var _=Object.getOwnPropertyDescriptor(f.DetermineComponentFrameRoot,"name");_&&_.configurable&&Object.defineProperty(f.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var x=f.DetermineComponentFrameRoot(),T=x[0],M=x[1];if(T&&M){var H=T.split(`
`),Y=M.split(`
`);for(_=f=0;f<H.length&&!H[f].includes("DetermineComponentFrameRoot");)f++;for(;_<Y.length&&!Y[_].includes("DetermineComponentFrameRoot");)_++;if(f===H.length||_===Y.length)for(f=H.length-1,_=Y.length-1;1<=f&&0<=_&&H[f]!==Y[_];)_--;for(;1<=f&&0<=_;f--,_--)if(H[f]!==Y[_]){if(f!==1||_!==1)do if(f--,_--,0>_||H[f]!==Y[_]){var Z=`
`+H[f].replace(" at new "," at ");return r.displayName&&Z.includes("<anonymous>")&&(Z=Z.replace("<anonymous>",r.displayName)),Z}while(1<=f&&0<=_);break}}}finally{Zs=!1,Error.prepareStackTrace=u}return(u=r?r.displayName||r.name:"")?Mn(u):""}function Bn(r,a){switch(r.tag){case 26:case 27:case 5:return Mn(r.type);case 16:return Mn("Lazy");case 13:return r.child!==a&&a!==null?Mn("Suspense Fallback"):Mn("Suspense");case 19:return Mn("SuspenseList");case 0:case 15:return Ts(r.type,!1);case 11:return Ts(r.type.render,!1);case 1:return Ts(r.type,!0);case 31:return Mn("Activity");default:return""}}function Jl(r){try{var a="",u=null;do a+=Bn(r,u),u=r,r=r.return;while(r);return a}catch(f){return`
Error generating stack: `+f.message+`
`+f.stack}}var da=Object.prototype.hasOwnProperty,ha=i.unstable_scheduleCallback,ae=i.unstable_cancelCallback,He=i.unstable_shouldYield,ut=i.unstable_requestPaint,Ie=i.unstable_now,zt=i.unstable_getCurrentPriorityLevel,Mt=i.unstable_ImmediatePriority,Cs=i.unstable_UserBlockingPriority,hi=i.unstable_NormalPriority,jn=i.unstable_LowPriority,qn=i.unstable_IdlePriority,er=i.log,oe=i.unstable_setDisableYieldValue,ye=null,Ae=null;function je(r){if(typeof er=="function"&&oe(r),Ae&&typeof Ae.setStrictMode=="function")try{Ae.setStrictMode(ye,r)}catch{}}var Ce=Math.clz32?Math.clz32:$t,Bt=Math.log,Oe=Math.LN2;function $t(r){return r>>>=0,r===0?32:31-(Bt(r)/Oe|0)|0}var en=256,xp=262144,Sp=4194304;function fa(r){var a=r&42;if(a!==0)return a;switch(r&-r){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return r&261888;case 262144:case 524288:case 1048576:case 2097152:return r&3932160;case 4194304:case 8388608:case 16777216:case 33554432:return r&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return r}}function Ep(r,a,u){var f=r.pendingLanes;if(f===0)return 0;var _=0,x=r.suspendedLanes,T=r.pingedLanes;r=r.warmLanes;var M=f&134217727;return M!==0?(f=M&~x,f!==0?_=fa(f):(T&=M,T!==0?_=fa(T):u||(u=M&~r,u!==0&&(_=fa(u))))):(M=f&~x,M!==0?_=fa(M):T!==0?_=fa(T):u||(u=f&~r,u!==0&&(_=fa(u)))),_===0?0:a!==0&&a!==_&&(a&x)===0&&(x=_&-_,u=a&-a,x>=u||x===32&&(u&4194048)!==0)?a:_}function rd(r,a){return(r.pendingLanes&~(r.suspendedLanes&~r.pingedLanes)&a)===0}function Ek(r,a){switch(r){case 1:case 2:case 4:case 8:case 64:return a+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return a+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Dw(){var r=Sp;return Sp<<=1,(Sp&62914560)===0&&(Sp=4194304),r}function I0(r){for(var a=[],u=0;31>u;u++)a.push(r);return a}function od(r,a){r.pendingLanes|=a,a!==268435456&&(r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0)}function Ak(r,a,u,f,_,x){var T=r.pendingLanes;r.pendingLanes=u,r.suspendedLanes=0,r.pingedLanes=0,r.warmLanes=0,r.expiredLanes&=u,r.entangledLanes&=u,r.errorRecoveryDisabledLanes&=u,r.shellSuspendCounter=0;var M=r.entanglements,H=r.expirationTimes,Y=r.hiddenUpdates;for(u=T&~u;0<u;){var Z=31-Ce(u),re=1<<Z;M[Z]=0,H[Z]=-1;var J=Y[Z];if(J!==null)for(Y[Z]=null,Z=0;Z<J.length;Z++){var W=J[Z];W!==null&&(W.lane&=-536870913)}u&=~re}f!==0&&Lw(r,f,0),x!==0&&_===0&&r.tag!==0&&(r.suspendedLanes|=x&~(T&~a))}function Lw(r,a,u){r.pendingLanes|=a,r.suspendedLanes&=~a;var f=31-Ce(a);r.entangledLanes|=a,r.entanglements[f]=r.entanglements[f]|1073741824|u&261930}function Pw(r,a){var u=r.entangledLanes|=a;for(r=r.entanglements;u;){var f=31-Ce(u),_=1<<f;_&a|r[f]&a&&(r[f]|=a),u&=~_}}function Ow(r,a){var u=a&-a;return u=(u&42)!==0?1:M0(u),(u&(r.suspendedLanes|a))!==0?0:u}function M0(r){switch(r){case 2:r=1;break;case 8:r=4;break;case 32:r=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:r=128;break;case 268435456:r=134217728;break;default:r=0}return r}function D0(r){return r&=-r,2<r?8<r?(r&134217727)!==0?32:268435456:8:2}function Uw(){var r=X.p;return r!==0?r:(r=window.event,r===void 0?32:xA(r.type))}function Fw(r,a){var u=X.p;try{return X.p=r,a()}finally{X.p=u}}var lo=Math.random().toString(36).slice(2),vn="__reactFiber$"+lo,Qn="__reactProps$"+lo,Kl="__reactContainer$"+lo,L0="__reactEvents$"+lo,Tk="__reactListeners$"+lo,Ck="__reactHandles$"+lo,Hw="__reactResources$"+lo,ad="__reactMarker$"+lo;function P0(r){delete r[vn],delete r[Qn],delete r[L0],delete r[Tk],delete r[Ck]}function Wl(r){var a=r[vn];if(a)return a;for(var u=r.parentNode;u;){if(a=u[Kl]||u[vn]){if(u=a.alternate,a.child!==null||u!==null&&u.child!==null)for(r=oA(r);r!==null;){if(u=r[vn])return u;r=oA(r)}return a}r=u,u=r.parentNode}return null}function Xl(r){if(r=r[vn]||r[Kl]){var a=r.tag;if(a===5||a===6||a===13||a===31||a===26||a===27||a===3)return r}return null}function ld(r){var a=r.tag;if(a===5||a===26||a===27||a===6)return r.stateNode;throw Error(n(33))}function Ql(r){var a=r[Hw];return a||(a=r[Hw]={hoistableStyles:new Map,hoistableScripts:new Map}),a}function un(r){r[ad]=!0}var Bw=new Set,jw={};function pa(r,a){Zl(r,a),Zl(r+"Capture",a)}function Zl(r,a){for(jw[r]=a,r=0;r<a.length;r++)Bw.add(a[r])}var Rk=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),qw={},Gw={};function Nk(r){return da.call(Gw,r)?!0:da.call(qw,r)?!1:Rk.test(r)?Gw[r]=!0:(qw[r]=!0,!1)}function Ap(r,a,u){if(Nk(a))if(u===null)r.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":r.removeAttribute(a);return;case"boolean":var f=a.toLowerCase().slice(0,5);if(f!=="data-"&&f!=="aria-"){r.removeAttribute(a);return}}r.setAttribute(a,""+u)}}function Tp(r,a,u){if(u===null)r.removeAttribute(a);else{switch(typeof u){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(a);return}r.setAttribute(a,""+u)}}function tr(r,a,u,f){if(f===null)r.removeAttribute(u);else{switch(typeof f){case"undefined":case"function":case"symbol":case"boolean":r.removeAttribute(u);return}r.setAttributeNS(a,u,""+f)}}function Oi(r){switch(typeof r){case"bigint":case"boolean":case"number":case"string":case"undefined":return r;case"object":return r;default:return""}}function Vw(r){var a=r.type;return(r=r.nodeName)&&r.toLowerCase()==="input"&&(a==="checkbox"||a==="radio")}function kk(r,a,u){var f=Object.getOwnPropertyDescriptor(r.constructor.prototype,a);if(!r.hasOwnProperty(a)&&typeof f<"u"&&typeof f.get=="function"&&typeof f.set=="function"){var _=f.get,x=f.set;return Object.defineProperty(r,a,{configurable:!0,get:function(){return _.call(this)},set:function(T){u=""+T,x.call(this,T)}}),Object.defineProperty(r,a,{enumerable:f.enumerable}),{getValue:function(){return u},setValue:function(T){u=""+T},stopTracking:function(){r._valueTracker=null,delete r[a]}}}}function O0(r){if(!r._valueTracker){var a=Vw(r)?"checked":"value";r._valueTracker=kk(r,a,""+r[a])}}function zw(r){if(!r)return!1;var a=r._valueTracker;if(!a)return!0;var u=a.getValue(),f="";return r&&(f=Vw(r)?r.checked?"true":"false":r.value),r=f,r!==u?(a.setValue(r),!0):!1}function Cp(r){if(r=r||(typeof document<"u"?document:void 0),typeof r>"u")return null;try{return r.activeElement||r.body}catch{return r.body}}var Ik=/[\n"\\]/g;function Ui(r){return r.replace(Ik,function(a){return"\\"+a.charCodeAt(0).toString(16)+" "})}function U0(r,a,u,f,_,x,T,M){r.name="",T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"?r.type=T:r.removeAttribute("type"),a!=null?T==="number"?(a===0&&r.value===""||r.value!=a)&&(r.value=""+Oi(a)):r.value!==""+Oi(a)&&(r.value=""+Oi(a)):T!=="submit"&&T!=="reset"||r.removeAttribute("value"),a!=null?F0(r,T,Oi(a)):u!=null?F0(r,T,Oi(u)):f!=null&&r.removeAttribute("value"),_==null&&x!=null&&(r.defaultChecked=!!x),_!=null&&(r.checked=_&&typeof _!="function"&&typeof _!="symbol"),M!=null&&typeof M!="function"&&typeof M!="symbol"&&typeof M!="boolean"?r.name=""+Oi(M):r.removeAttribute("name")}function $w(r,a,u,f,_,x,T,M){if(x!=null&&typeof x!="function"&&typeof x!="symbol"&&typeof x!="boolean"&&(r.type=x),a!=null||u!=null){if(!(x!=="submit"&&x!=="reset"||a!=null)){O0(r);return}u=u!=null?""+Oi(u):"",a=a!=null?""+Oi(a):u,M||a===r.value||(r.value=a),r.defaultValue=a}f=f??_,f=typeof f!="function"&&typeof f!="symbol"&&!!f,r.checked=M?r.checked:!!f,r.defaultChecked=!!f,T!=null&&typeof T!="function"&&typeof T!="symbol"&&typeof T!="boolean"&&(r.name=T),O0(r)}function F0(r,a,u){a==="number"&&Cp(r.ownerDocument)===r||r.defaultValue===""+u||(r.defaultValue=""+u)}function ec(r,a,u,f){if(r=r.options,a){a={};for(var _=0;_<u.length;_++)a["$"+u[_]]=!0;for(u=0;u<r.length;u++)_=a.hasOwnProperty("$"+r[u].value),r[u].selected!==_&&(r[u].selected=_),_&&f&&(r[u].defaultSelected=!0)}else{for(u=""+Oi(u),a=null,_=0;_<r.length;_++){if(r[_].value===u){r[_].selected=!0,f&&(r[_].defaultSelected=!0);return}a!==null||r[_].disabled||(a=r[_])}a!==null&&(a.selected=!0)}}function Yw(r,a,u){if(a!=null&&(a=""+Oi(a),a!==r.value&&(r.value=a),u==null)){r.defaultValue!==a&&(r.defaultValue=a);return}r.defaultValue=u!=null?""+Oi(u):""}function Jw(r,a,u,f){if(a==null){if(f!=null){if(u!=null)throw Error(n(92));if(pe(f)){if(1<f.length)throw Error(n(93));f=f[0]}u=f}u==null&&(u=""),a=u}u=Oi(a),r.defaultValue=u,f=r.textContent,f===u&&f!==""&&f!==null&&(r.value=f),O0(r)}function tc(r,a){if(a){var u=r.firstChild;if(u&&u===r.lastChild&&u.nodeType===3){u.nodeValue=a;return}}r.textContent=a}var Mk=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Kw(r,a,u){var f=a.indexOf("--")===0;u==null||typeof u=="boolean"||u===""?f?r.setProperty(a,""):a==="float"?r.cssFloat="":r[a]="":f?r.setProperty(a,u):typeof u!="number"||u===0||Mk.has(a)?a==="float"?r.cssFloat=u:r[a]=(""+u).trim():r[a]=u+"px"}function Ww(r,a,u){if(a!=null&&typeof a!="object")throw Error(n(62));if(r=r.style,u!=null){for(var f in u)!u.hasOwnProperty(f)||a!=null&&a.hasOwnProperty(f)||(f.indexOf("--")===0?r.setProperty(f,""):f==="float"?r.cssFloat="":r[f]="");for(var _ in a)f=a[_],a.hasOwnProperty(_)&&u[_]!==f&&Kw(r,_,f)}else for(var x in a)a.hasOwnProperty(x)&&Kw(r,x,a[x])}function H0(r){if(r.indexOf("-")===-1)return!1;switch(r){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Dk=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Lk=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Rp(r){return Lk.test(""+r)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":r}function nr(){}var B0=null;function j0(r){return r=r.target||r.srcElement||window,r.correspondingUseElement&&(r=r.correspondingUseElement),r.nodeType===3?r.parentNode:r}var nc=null,ic=null;function Xw(r){var a=Xl(r);if(a&&(r=a.stateNode)){var u=r[Qn]||null;e:switch(r=a.stateNode,a.type){case"input":if(U0(r,u.value,u.defaultValue,u.defaultValue,u.checked,u.defaultChecked,u.type,u.name),a=u.name,u.type==="radio"&&a!=null){for(u=r;u.parentNode;)u=u.parentNode;for(u=u.querySelectorAll('input[name="'+Ui(""+a)+'"][type="radio"]'),a=0;a<u.length;a++){var f=u[a];if(f!==r&&f.form===r.form){var _=f[Qn]||null;if(!_)throw Error(n(90));U0(f,_.value,_.defaultValue,_.defaultValue,_.checked,_.defaultChecked,_.type,_.name)}}for(a=0;a<u.length;a++)f=u[a],f.form===r.form&&zw(f)}break e;case"textarea":Yw(r,u.value,u.defaultValue);break e;case"select":a=u.value,a!=null&&ec(r,!!u.multiple,a,!1)}}}var q0=!1;function Qw(r,a,u){if(q0)return r(a,u);q0=!0;try{var f=r(a);return f}finally{if(q0=!1,(nc!==null||ic!==null)&&(mm(),nc&&(a=nc,r=ic,ic=nc=null,Xw(a),r)))for(a=0;a<r.length;a++)Xw(r[a])}}function cd(r,a){var u=r.stateNode;if(u===null)return null;var f=u[Qn]||null;if(f===null)return null;u=f[a];e:switch(a){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(r=r.type,f=!(r==="button"||r==="input"||r==="select"||r==="textarea")),r=!f;break e;default:r=!1}if(r)return null;if(u&&typeof u!="function")throw Error(n(231,a,typeof u));return u}var ir=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),G0=!1;if(ir)try{var ud={};Object.defineProperty(ud,"passive",{get:function(){G0=!0}}),window.addEventListener("test",ud,ud),window.removeEventListener("test",ud,ud)}catch{G0=!1}var co=null,V0=null,Np=null;function Zw(){if(Np)return Np;var r,a=V0,u=a.length,f,_="value"in co?co.value:co.textContent,x=_.length;for(r=0;r<u&&a[r]===_[r];r++);var T=u-r;for(f=1;f<=T&&a[u-f]===_[x-f];f++);return Np=_.slice(r,1<f?1-f:void 0)}function kp(r){var a=r.keyCode;return"charCode"in r?(r=r.charCode,r===0&&a===13&&(r=13)):r=a,r===10&&(r=13),32<=r||r===13?r:0}function Ip(){return!0}function ex(){return!1}function Zn(r){function a(u,f,_,x,T){this._reactName=u,this._targetInst=_,this.type=f,this.nativeEvent=x,this.target=T,this.currentTarget=null;for(var M in r)r.hasOwnProperty(M)&&(u=r[M],this[M]=u?u(x):x[M]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?Ip:ex,this.isPropagationStopped=ex,this}return y(a.prototype,{preventDefault:function(){this.defaultPrevented=!0;var u=this.nativeEvent;u&&(u.preventDefault?u.preventDefault():typeof u.returnValue!="unknown"&&(u.returnValue=!1),this.isDefaultPrevented=Ip)},stopPropagation:function(){var u=this.nativeEvent;u&&(u.stopPropagation?u.stopPropagation():typeof u.cancelBubble!="unknown"&&(u.cancelBubble=!0),this.isPropagationStopped=Ip)},persist:function(){},isPersistent:Ip}),a}var ma={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(r){return r.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Mp=Zn(ma),dd=y({},ma,{view:0,detail:0}),Pk=Zn(dd),z0,$0,hd,Dp=y({},dd,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:J0,button:0,buttons:0,relatedTarget:function(r){return r.relatedTarget===void 0?r.fromElement===r.srcElement?r.toElement:r.fromElement:r.relatedTarget},movementX:function(r){return"movementX"in r?r.movementX:(r!==hd&&(hd&&r.type==="mousemove"?(z0=r.screenX-hd.screenX,$0=r.screenY-hd.screenY):$0=z0=0,hd=r),z0)},movementY:function(r){return"movementY"in r?r.movementY:$0}}),tx=Zn(Dp),Ok=y({},Dp,{dataTransfer:0}),Uk=Zn(Ok),Fk=y({},dd,{relatedTarget:0}),Y0=Zn(Fk),Hk=y({},ma,{animationName:0,elapsedTime:0,pseudoElement:0}),Bk=Zn(Hk),jk=y({},ma,{clipboardData:function(r){return"clipboardData"in r?r.clipboardData:window.clipboardData}}),qk=Zn(jk),Gk=y({},ma,{data:0}),nx=Zn(Gk),Vk={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},zk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},$k={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Yk(r){var a=this.nativeEvent;return a.getModifierState?a.getModifierState(r):(r=$k[r])?!!a[r]:!1}function J0(){return Yk}var Jk=y({},dd,{key:function(r){if(r.key){var a=Vk[r.key]||r.key;if(a!=="Unidentified")return a}return r.type==="keypress"?(r=kp(r),r===13?"Enter":String.fromCharCode(r)):r.type==="keydown"||r.type==="keyup"?zk[r.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:J0,charCode:function(r){return r.type==="keypress"?kp(r):0},keyCode:function(r){return r.type==="keydown"||r.type==="keyup"?r.keyCode:0},which:function(r){return r.type==="keypress"?kp(r):r.type==="keydown"||r.type==="keyup"?r.keyCode:0}}),Kk=Zn(Jk),Wk=y({},Dp,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ix=Zn(Wk),Xk=y({},dd,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:J0}),Qk=Zn(Xk),Zk=y({},ma,{propertyName:0,elapsedTime:0,pseudoElement:0}),e2=Zn(Zk),t2=y({},Dp,{deltaX:function(r){return"deltaX"in r?r.deltaX:"wheelDeltaX"in r?-r.wheelDeltaX:0},deltaY:function(r){return"deltaY"in r?r.deltaY:"wheelDeltaY"in r?-r.wheelDeltaY:"wheelDelta"in r?-r.wheelDelta:0},deltaZ:0,deltaMode:0}),n2=Zn(t2),i2=y({},ma,{newState:0,oldState:0}),s2=Zn(i2),r2=[9,13,27,32],K0=ir&&"CompositionEvent"in window,fd=null;ir&&"documentMode"in document&&(fd=document.documentMode);var o2=ir&&"TextEvent"in window&&!fd,sx=ir&&(!K0||fd&&8<fd&&11>=fd),rx=" ",ox=!1;function ax(r,a){switch(r){case"keyup":return r2.indexOf(a.keyCode)!==-1;case"keydown":return a.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lx(r){return r=r.detail,typeof r=="object"&&"data"in r?r.data:null}var sc=!1;function a2(r,a){switch(r){case"compositionend":return lx(a);case"keypress":return a.which!==32?null:(ox=!0,rx);case"textInput":return r=a.data,r===rx&&ox?null:r;default:return null}}function l2(r,a){if(sc)return r==="compositionend"||!K0&&ax(r,a)?(r=Zw(),Np=V0=co=null,sc=!1,r):null;switch(r){case"paste":return null;case"keypress":if(!(a.ctrlKey||a.altKey||a.metaKey)||a.ctrlKey&&a.altKey){if(a.char&&1<a.char.length)return a.char;if(a.which)return String.fromCharCode(a.which)}return null;case"compositionend":return sx&&a.locale!=="ko"?null:a.data;default:return null}}var c2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function cx(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a==="input"?!!c2[r.type]:a==="textarea"}function ux(r,a,u,f){nc?ic?ic.push(f):ic=[f]:nc=f,a=xm(a,"onChange"),0<a.length&&(u=new Mp("onChange","change",null,u,f),r.push({event:u,listeners:a}))}var pd=null,md=null;function u2(r){$E(r,0)}function Lp(r){var a=ld(r);if(zw(a))return r}function dx(r,a){if(r==="change")return a}var hx=!1;if(ir){var W0;if(ir){var X0="oninput"in document;if(!X0){var fx=document.createElement("div");fx.setAttribute("oninput","return;"),X0=typeof fx.oninput=="function"}W0=X0}else W0=!1;hx=W0&&(!document.documentMode||9<document.documentMode)}function px(){pd&&(pd.detachEvent("onpropertychange",mx),md=pd=null)}function mx(r){if(r.propertyName==="value"&&Lp(md)){var a=[];ux(a,md,r,j0(r)),Qw(u2,a)}}function d2(r,a,u){r==="focusin"?(px(),pd=a,md=u,pd.attachEvent("onpropertychange",mx)):r==="focusout"&&px()}function h2(r){if(r==="selectionchange"||r==="keyup"||r==="keydown")return Lp(md)}function f2(r,a){if(r==="click")return Lp(a)}function p2(r,a){if(r==="input"||r==="change")return Lp(a)}function m2(r,a){return r===a&&(r!==0||1/r===1/a)||r!==r&&a!==a}var fi=typeof Object.is=="function"?Object.is:m2;function gd(r,a){if(fi(r,a))return!0;if(typeof r!="object"||r===null||typeof a!="object"||a===null)return!1;var u=Object.keys(r),f=Object.keys(a);if(u.length!==f.length)return!1;for(f=0;f<u.length;f++){var _=u[f];if(!da.call(a,_)||!fi(r[_],a[_]))return!1}return!0}function gx(r){for(;r&&r.firstChild;)r=r.firstChild;return r}function vx(r,a){var u=gx(r);r=0;for(var f;u;){if(u.nodeType===3){if(f=r+u.textContent.length,r<=a&&f>=a)return{node:u,offset:a-r};r=f}e:{for(;u;){if(u.nextSibling){u=u.nextSibling;break e}u=u.parentNode}u=void 0}u=gx(u)}}function yx(r,a){return r&&a?r===a?!0:r&&r.nodeType===3?!1:a&&a.nodeType===3?yx(r,a.parentNode):"contains"in r?r.contains(a):r.compareDocumentPosition?!!(r.compareDocumentPosition(a)&16):!1:!1}function bx(r){r=r!=null&&r.ownerDocument!=null&&r.ownerDocument.defaultView!=null?r.ownerDocument.defaultView:window;for(var a=Cp(r.document);a instanceof r.HTMLIFrameElement;){try{var u=typeof a.contentWindow.location.href=="string"}catch{u=!1}if(u)r=a.contentWindow;else break;a=Cp(r.document)}return a}function Q0(r){var a=r&&r.nodeName&&r.nodeName.toLowerCase();return a&&(a==="input"&&(r.type==="text"||r.type==="search"||r.type==="tel"||r.type==="url"||r.type==="password")||a==="textarea"||r.contentEditable==="true")}var g2=ir&&"documentMode"in document&&11>=document.documentMode,rc=null,Z0=null,vd=null,ev=!1;function _x(r,a,u){var f=u.window===u?u.document:u.nodeType===9?u:u.ownerDocument;ev||rc==null||rc!==Cp(f)||(f=rc,"selectionStart"in f&&Q0(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),vd&&gd(vd,f)||(vd=f,f=xm(Z0,"onSelect"),0<f.length&&(a=new Mp("onSelect","select",null,a,u),r.push({event:a,listeners:f}),a.target=rc)))}function ga(r,a){var u={};return u[r.toLowerCase()]=a.toLowerCase(),u["Webkit"+r]="webkit"+a,u["Moz"+r]="moz"+a,u}var oc={animationend:ga("Animation","AnimationEnd"),animationiteration:ga("Animation","AnimationIteration"),animationstart:ga("Animation","AnimationStart"),transitionrun:ga("Transition","TransitionRun"),transitionstart:ga("Transition","TransitionStart"),transitioncancel:ga("Transition","TransitionCancel"),transitionend:ga("Transition","TransitionEnd")},tv={},wx={};ir&&(wx=document.createElement("div").style,"AnimationEvent"in window||(delete oc.animationend.animation,delete oc.animationiteration.animation,delete oc.animationstart.animation),"TransitionEvent"in window||delete oc.transitionend.transition);function va(r){if(tv[r])return tv[r];if(!oc[r])return r;var a=oc[r],u;for(u in a)if(a.hasOwnProperty(u)&&u in wx)return tv[r]=a[u];return r}var xx=va("animationend"),Sx=va("animationiteration"),Ex=va("animationstart"),v2=va("transitionrun"),y2=va("transitionstart"),b2=va("transitioncancel"),Ax=va("transitionend"),Tx=new Map,nv="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");nv.push("scrollEnd");function ts(r,a){Tx.set(r,a),pa(a,[r])}var Pp=typeof reportError=="function"?reportError:function(r){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var a=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof r=="object"&&r!==null&&typeof r.message=="string"?String(r.message):String(r),error:r});if(!window.dispatchEvent(a))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",r);return}console.error(r)},Fi=[],ac=0,iv=0;function Op(){for(var r=ac,a=iv=ac=0;a<r;){var u=Fi[a];Fi[a++]=null;var f=Fi[a];Fi[a++]=null;var _=Fi[a];Fi[a++]=null;var x=Fi[a];if(Fi[a++]=null,f!==null&&_!==null){var T=f.pending;T===null?_.next=_:(_.next=T.next,T.next=_),f.pending=_}x!==0&&Cx(u,_,x)}}function Up(r,a,u,f){Fi[ac++]=r,Fi[ac++]=a,Fi[ac++]=u,Fi[ac++]=f,iv|=f,r.lanes|=f,r=r.alternate,r!==null&&(r.lanes|=f)}function sv(r,a,u,f){return Up(r,a,u,f),Fp(r)}function ya(r,a){return Up(r,null,null,a),Fp(r)}function Cx(r,a,u){r.lanes|=u;var f=r.alternate;f!==null&&(f.lanes|=u);for(var _=!1,x=r.return;x!==null;)x.childLanes|=u,f=x.alternate,f!==null&&(f.childLanes|=u),x.tag===22&&(r=x.stateNode,r===null||r._visibility&1||(_=!0)),r=x,x=x.return;return r.tag===3?(x=r.stateNode,_&&a!==null&&(_=31-Ce(u),r=x.hiddenUpdates,f=r[_],f===null?r[_]=[a]:f.push(a),a.lane=u|536870912),x):null}function Fp(r){if(50<Hd)throw Hd=0,fy=null,Error(n(185));for(var a=r.return;a!==null;)r=a,a=r.return;return r.tag===3?r.stateNode:null}var lc={};function _2(r,a,u,f){this.tag=r,this.key=u,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=a,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function pi(r,a,u,f){return new _2(r,a,u,f)}function rv(r){return r=r.prototype,!(!r||!r.isReactComponent)}function sr(r,a){var u=r.alternate;return u===null?(u=pi(r.tag,a,r.key,r.mode),u.elementType=r.elementType,u.type=r.type,u.stateNode=r.stateNode,u.alternate=r,r.alternate=u):(u.pendingProps=a,u.type=r.type,u.flags=0,u.subtreeFlags=0,u.deletions=null),u.flags=r.flags&65011712,u.childLanes=r.childLanes,u.lanes=r.lanes,u.child=r.child,u.memoizedProps=r.memoizedProps,u.memoizedState=r.memoizedState,u.updateQueue=r.updateQueue,a=r.dependencies,u.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext},u.sibling=r.sibling,u.index=r.index,u.ref=r.ref,u.refCleanup=r.refCleanup,u}function Rx(r,a){r.flags&=65011714;var u=r.alternate;return u===null?(r.childLanes=0,r.lanes=a,r.child=null,r.subtreeFlags=0,r.memoizedProps=null,r.memoizedState=null,r.updateQueue=null,r.dependencies=null,r.stateNode=null):(r.childLanes=u.childLanes,r.lanes=u.lanes,r.child=u.child,r.subtreeFlags=0,r.deletions=null,r.memoizedProps=u.memoizedProps,r.memoizedState=u.memoizedState,r.updateQueue=u.updateQueue,r.type=u.type,a=u.dependencies,r.dependencies=a===null?null:{lanes:a.lanes,firstContext:a.firstContext}),r}function Hp(r,a,u,f,_,x){var T=0;if(f=r,typeof r=="function")rv(r)&&(T=1);else if(typeof r=="string")T=AI(r,u,he.current)?26:r==="html"||r==="head"||r==="body"?27:5;else e:switch(r){case K:return r=pi(31,u,a,_),r.elementType=K,r.lanes=x,r;case R:return ba(u.children,_,x,a);case A:T=8,_|=24;break;case C:return r=pi(12,u,a,_|2),r.elementType=C,r.lanes=x,r;case U:return r=pi(13,u,a,_),r.elementType=U,r.lanes=x,r;case P:return r=pi(19,u,a,_),r.elementType=P,r.lanes=x,r;default:if(typeof r=="object"&&r!==null)switch(r.$$typeof){case I:T=10;break e;case k:T=9;break e;case O:T=11;break e;case B:T=14;break e;case Q:T=16,f=null;break e}T=29,u=Error(n(130,r===null?"null":typeof r,"")),f=null}return a=pi(T,u,a,_),a.elementType=r,a.type=f,a.lanes=x,a}function ba(r,a,u,f){return r=pi(7,r,f,a),r.lanes=u,r}function ov(r,a,u){return r=pi(6,r,null,a),r.lanes=u,r}function Nx(r){var a=pi(18,null,null,0);return a.stateNode=r,a}function av(r,a,u){return a=pi(4,r.children!==null?r.children:[],r.key,a),a.lanes=u,a.stateNode={containerInfo:r.containerInfo,pendingChildren:null,implementation:r.implementation},a}var kx=new WeakMap;function Hi(r,a){if(typeof r=="object"&&r!==null){var u=kx.get(r);return u!==void 0?u:(a={value:r,source:a,stack:Jl(a)},kx.set(r,a),a)}return{value:r,source:a,stack:Jl(a)}}var cc=[],uc=0,Bp=null,yd=0,Bi=[],ji=0,uo=null,Rs=1,Ns="";function rr(r,a){cc[uc++]=yd,cc[uc++]=Bp,Bp=r,yd=a}function Ix(r,a,u){Bi[ji++]=Rs,Bi[ji++]=Ns,Bi[ji++]=uo,uo=r;var f=Rs;r=Ns;var _=32-Ce(f)-1;f&=~(1<<_),u+=1;var x=32-Ce(a)+_;if(30<x){var T=_-_%5;x=(f&(1<<T)-1).toString(32),f>>=T,_-=T,Rs=1<<32-Ce(a)+_|u<<_|f,Ns=x+r}else Rs=1<<x|u<<_|f,Ns=r}function lv(r){r.return!==null&&(rr(r,1),Ix(r,1,0))}function cv(r){for(;r===Bp;)Bp=cc[--uc],cc[uc]=null,yd=cc[--uc],cc[uc]=null;for(;r===uo;)uo=Bi[--ji],Bi[ji]=null,Ns=Bi[--ji],Bi[ji]=null,Rs=Bi[--ji],Bi[ji]=null}function Mx(r,a){Bi[ji++]=Rs,Bi[ji++]=Ns,Bi[ji++]=uo,Rs=a.id,Ns=a.overflow,uo=r}var yn=null,Nt=null,tt=!1,ho=null,qi=!1,uv=Error(n(519));function fo(r){var a=Error(n(418,1<arguments.length&&arguments[1]!==void 0&&arguments[1]?"text":"HTML",""));throw bd(Hi(a,r)),uv}function Dx(r){var a=r.stateNode,u=r.type,f=r.memoizedProps;switch(a[vn]=r,a[Qn]=f,u){case"dialog":We("cancel",a),We("close",a);break;case"iframe":case"object":case"embed":We("load",a);break;case"video":case"audio":for(u=0;u<jd.length;u++)We(jd[u],a);break;case"source":We("error",a);break;case"img":case"image":case"link":We("error",a),We("load",a);break;case"details":We("toggle",a);break;case"input":We("invalid",a),$w(a,f.value,f.defaultValue,f.checked,f.defaultChecked,f.type,f.name,!0);break;case"select":We("invalid",a);break;case"textarea":We("invalid",a),Jw(a,f.value,f.defaultValue,f.children)}u=f.children,typeof u!="string"&&typeof u!="number"&&typeof u!="bigint"||a.textContent===""+u||f.suppressHydrationWarning===!0||WE(a.textContent,u)?(f.popover!=null&&(We("beforetoggle",a),We("toggle",a)),f.onScroll!=null&&We("scroll",a),f.onScrollEnd!=null&&We("scrollend",a),f.onClick!=null&&(a.onclick=nr),a=!0):a=!1,a||fo(r,!0)}function Lx(r){for(yn=r.return;yn;)switch(yn.tag){case 5:case 31:case 13:qi=!1;return;case 27:case 3:qi=!0;return;default:yn=yn.return}}function dc(r){if(r!==yn)return!1;if(!tt)return Lx(r),tt=!0,!1;var a=r.tag,u;if((u=a!==3&&a!==27)&&((u=a===5)&&(u=r.type,u=!(u!=="form"&&u!=="button")||Ry(r.type,r.memoizedProps)),u=!u),u&&Nt&&fo(r),Lx(r),a===13){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));Nt=rA(r)}else if(a===31){if(r=r.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(317));Nt=rA(r)}else a===27?(a=Nt,Co(r.type)?(r=Dy,Dy=null,Nt=r):Nt=a):Nt=yn?Vi(r.stateNode.nextSibling):null;return!0}function _a(){Nt=yn=null,tt=!1}function dv(){var r=ho;return r!==null&&(ii===null?ii=r:ii.push.apply(ii,r),ho=null),r}function bd(r){ho===null?ho=[r]:ho.push(r)}var hv=F(null),wa=null,or=null;function po(r,a,u){se(hv,a._currentValue),a._currentValue=u}function ar(r){r._currentValue=hv.current,V(hv)}function fv(r,a,u){for(;r!==null;){var f=r.alternate;if((r.childLanes&a)!==a?(r.childLanes|=a,f!==null&&(f.childLanes|=a)):f!==null&&(f.childLanes&a)!==a&&(f.childLanes|=a),r===u)break;r=r.return}}function pv(r,a,u,f){var _=r.child;for(_!==null&&(_.return=r);_!==null;){var x=_.dependencies;if(x!==null){var T=_.child;x=x.firstContext;e:for(;x!==null;){var M=x;x=_;for(var H=0;H<a.length;H++)if(M.context===a[H]){x.lanes|=u,M=x.alternate,M!==null&&(M.lanes|=u),fv(x.return,u,r),f||(T=null);break e}x=M.next}}else if(_.tag===18){if(T=_.return,T===null)throw Error(n(341));T.lanes|=u,x=T.alternate,x!==null&&(x.lanes|=u),fv(T,u,r),T=null}else T=_.child;if(T!==null)T.return=_;else for(T=_;T!==null;){if(T===r){T=null;break}if(_=T.sibling,_!==null){_.return=T.return,T=_;break}T=T.return}_=T}}function hc(r,a,u,f){r=null;for(var _=a,x=!1;_!==null;){if(!x){if((_.flags&524288)!==0)x=!0;else if((_.flags&262144)!==0)break}if(_.tag===10){var T=_.alternate;if(T===null)throw Error(n(387));if(T=T.memoizedProps,T!==null){var M=_.type;fi(_.pendingProps.value,T.value)||(r!==null?r.push(M):r=[M])}}else if(_===xe.current){if(T=_.alternate,T===null)throw Error(n(387));T.memoizedState.memoizedState!==_.memoizedState.memoizedState&&(r!==null?r.push($d):r=[$d])}_=_.return}r!==null&&pv(a,r,u,f),a.flags|=262144}function jp(r){for(r=r.firstContext;r!==null;){if(!fi(r.context._currentValue,r.memoizedValue))return!0;r=r.next}return!1}function xa(r){wa=r,or=null,r=r.dependencies,r!==null&&(r.firstContext=null)}function bn(r){return Px(wa,r)}function qp(r,a){return wa===null&&xa(r),Px(r,a)}function Px(r,a){var u=a._currentValue;if(a={context:a,memoizedValue:u,next:null},or===null){if(r===null)throw Error(n(308));or=a,r.dependencies={lanes:0,firstContext:a},r.flags|=524288}else or=or.next=a;return u}var w2=typeof AbortController<"u"?AbortController:function(){var r=[],a=this.signal={aborted:!1,addEventListener:function(u,f){r.push(f)}};this.abort=function(){a.aborted=!0,r.forEach(function(u){return u()})}},x2=i.unstable_scheduleCallback,S2=i.unstable_NormalPriority,Yt={$$typeof:I,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function mv(){return{controller:new w2,data:new Map,refCount:0}}function _d(r){r.refCount--,r.refCount===0&&x2(S2,function(){r.controller.abort()})}var wd=null,gv=0,fc=0,pc=null;function E2(r,a){if(wd===null){var u=wd=[];gv=0,fc=by(),pc={status:"pending",value:void 0,then:function(f){u.push(f)}}}return gv++,a.then(Ox,Ox),a}function Ox(){if(--gv===0&&wd!==null){pc!==null&&(pc.status="fulfilled");var r=wd;wd=null,fc=0,pc=null;for(var a=0;a<r.length;a++)(0,r[a])()}}function A2(r,a){var u=[],f={status:"pending",value:null,reason:null,then:function(_){u.push(_)}};return r.then(function(){f.status="fulfilled",f.value=a;for(var _=0;_<u.length;_++)(0,u[_])(a)},function(_){for(f.status="rejected",f.reason=_,_=0;_<u.length;_++)(0,u[_])(void 0)}),f}var Ux=z.S;z.S=function(r,a){_E=Ie(),typeof a=="object"&&a!==null&&typeof a.then=="function"&&E2(r,a),Ux!==null&&Ux(r,a)};var Sa=F(null);function vv(){var r=Sa.current;return r!==null?r:Et.pooledCache}function Gp(r,a){a===null?se(Sa,Sa.current):se(Sa,a.pool)}function Fx(){var r=vv();return r===null?null:{parent:Yt._currentValue,pool:r}}var mc=Error(n(460)),yv=Error(n(474)),Vp=Error(n(542)),zp={then:function(){}};function Hx(r){return r=r.status,r==="fulfilled"||r==="rejected"}function Bx(r,a,u){switch(u=r[u],u===void 0?r.push(a):u!==a&&(a.then(nr,nr),a=u),a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,qx(r),r;default:if(typeof a.status=="string")a.then(nr,nr);else{if(r=Et,r!==null&&100<r.shellSuspendCounter)throw Error(n(482));r=a,r.status="pending",r.then(function(f){if(a.status==="pending"){var _=a;_.status="fulfilled",_.value=f}},function(f){if(a.status==="pending"){var _=a;_.status="rejected",_.reason=f}})}switch(a.status){case"fulfilled":return a.value;case"rejected":throw r=a.reason,qx(r),r}throw Aa=a,mc}}function Ea(r){try{var a=r._init;return a(r._payload)}catch(u){throw u!==null&&typeof u=="object"&&typeof u.then=="function"?(Aa=u,mc):u}}var Aa=null;function jx(){if(Aa===null)throw Error(n(459));var r=Aa;return Aa=null,r}function qx(r){if(r===mc||r===Vp)throw Error(n(483))}var gc=null,xd=0;function $p(r){var a=xd;return xd+=1,gc===null&&(gc=[]),Bx(gc,r,a)}function Sd(r,a){a=a.props.ref,r.ref=a!==void 0?a:null}function Yp(r,a){throw a.$$typeof===b?Error(n(525)):(r=Object.prototype.toString.call(a),Error(n(31,r==="[object Object]"?"object with keys {"+Object.keys(a).join(", ")+"}":r)))}function Gx(r){function a(q,j){if(r){var $=q.deletions;$===null?(q.deletions=[j],q.flags|=16):$.push(j)}}function u(q,j){if(!r)return null;for(;j!==null;)a(q,j),j=j.sibling;return null}function f(q){for(var j=new Map;q!==null;)q.key!==null?j.set(q.key,q):j.set(q.index,q),q=q.sibling;return j}function _(q,j){return q=sr(q,j),q.index=0,q.sibling=null,q}function x(q,j,$){return q.index=$,r?($=q.alternate,$!==null?($=$.index,$<j?(q.flags|=67108866,j):$):(q.flags|=67108866,j)):(q.flags|=1048576,j)}function T(q){return r&&q.alternate===null&&(q.flags|=67108866),q}function M(q,j,$,ie){return j===null||j.tag!==6?(j=ov($,q.mode,ie),j.return=q,j):(j=_(j,$),j.return=q,j)}function H(q,j,$,ie){var Re=$.type;return Re===R?Z(q,j,$.props.children,ie,$.key):j!==null&&(j.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===Q&&Ea(Re)===j.type)?(j=_(j,$.props),Sd(j,$),j.return=q,j):(j=Hp($.type,$.key,$.props,null,q.mode,ie),Sd(j,$),j.return=q,j)}function Y(q,j,$,ie){return j===null||j.tag!==4||j.stateNode.containerInfo!==$.containerInfo||j.stateNode.implementation!==$.implementation?(j=av($,q.mode,ie),j.return=q,j):(j=_(j,$.children||[]),j.return=q,j)}function Z(q,j,$,ie,Re){return j===null||j.tag!==7?(j=ba($,q.mode,ie,Re),j.return=q,j):(j=_(j,$),j.return=q,j)}function re(q,j,$){if(typeof j=="string"&&j!==""||typeof j=="number"||typeof j=="bigint")return j=ov(""+j,q.mode,$),j.return=q,j;if(typeof j=="object"&&j!==null){switch(j.$$typeof){case S:return $=Hp(j.type,j.key,j.props,null,q.mode,$),Sd($,j),$.return=q,$;case E:return j=av(j,q.mode,$),j.return=q,j;case Q:return j=Ea(j),re(q,j,$)}if(pe(j)||G(j))return j=ba(j,q.mode,$,null),j.return=q,j;if(typeof j.then=="function")return re(q,$p(j),$);if(j.$$typeof===I)return re(q,qp(q,j),$);Yp(q,j)}return null}function J(q,j,$,ie){var Re=j!==null?j.key:null;if(typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint")return Re!==null?null:M(q,j,""+$,ie);if(typeof $=="object"&&$!==null){switch($.$$typeof){case S:return $.key===Re?H(q,j,$,ie):null;case E:return $.key===Re?Y(q,j,$,ie):null;case Q:return $=Ea($),J(q,j,$,ie)}if(pe($)||G($))return Re!==null?null:Z(q,j,$,ie,null);if(typeof $.then=="function")return J(q,j,$p($),ie);if($.$$typeof===I)return J(q,j,qp(q,$),ie);Yp(q,$)}return null}function W(q,j,$,ie,Re){if(typeof ie=="string"&&ie!==""||typeof ie=="number"||typeof ie=="bigint")return q=q.get($)||null,M(j,q,""+ie,Re);if(typeof ie=="object"&&ie!==null){switch(ie.$$typeof){case S:return q=q.get(ie.key===null?$:ie.key)||null,H(j,q,ie,Re);case E:return q=q.get(ie.key===null?$:ie.key)||null,Y(j,q,ie,Re);case Q:return ie=Ea(ie),W(q,j,$,ie,Re)}if(pe(ie)||G(ie))return q=q.get($)||null,Z(j,q,ie,Re,null);if(typeof ie.then=="function")return W(q,j,$,$p(ie),Re);if(ie.$$typeof===I)return W(q,j,$,qp(j,ie),Re);Yp(j,ie)}return null}function be(q,j,$,ie){for(var Re=null,rt=null,we=j,ze=j=0,et=null;we!==null&&ze<$.length;ze++){we.index>ze?(et=we,we=null):et=we.sibling;var ot=J(q,we,$[ze],ie);if(ot===null){we===null&&(we=et);break}r&&we&&ot.alternate===null&&a(q,we),j=x(ot,j,ze),rt===null?Re=ot:rt.sibling=ot,rt=ot,we=et}if(ze===$.length)return u(q,we),tt&&rr(q,ze),Re;if(we===null){for(;ze<$.length;ze++)we=re(q,$[ze],ie),we!==null&&(j=x(we,j,ze),rt===null?Re=we:rt.sibling=we,rt=we);return tt&&rr(q,ze),Re}for(we=f(we);ze<$.length;ze++)et=W(we,q,ze,$[ze],ie),et!==null&&(r&&et.alternate!==null&&we.delete(et.key===null?ze:et.key),j=x(et,j,ze),rt===null?Re=et:rt.sibling=et,rt=et);return r&&we.forEach(function(Mo){return a(q,Mo)}),tt&&rr(q,ze),Re}function Me(q,j,$,ie){if($==null)throw Error(n(151));for(var Re=null,rt=null,we=j,ze=j=0,et=null,ot=$.next();we!==null&&!ot.done;ze++,ot=$.next()){we.index>ze?(et=we,we=null):et=we.sibling;var Mo=J(q,we,ot.value,ie);if(Mo===null){we===null&&(we=et);break}r&&we&&Mo.alternate===null&&a(q,we),j=x(Mo,j,ze),rt===null?Re=Mo:rt.sibling=Mo,rt=Mo,we=et}if(ot.done)return u(q,we),tt&&rr(q,ze),Re;if(we===null){for(;!ot.done;ze++,ot=$.next())ot=re(q,ot.value,ie),ot!==null&&(j=x(ot,j,ze),rt===null?Re=ot:rt.sibling=ot,rt=ot);return tt&&rr(q,ze),Re}for(we=f(we);!ot.done;ze++,ot=$.next())ot=W(we,q,ze,ot.value,ie),ot!==null&&(r&&ot.alternate!==null&&we.delete(ot.key===null?ze:ot.key),j=x(ot,j,ze),rt===null?Re=ot:rt.sibling=ot,rt=ot);return r&&we.forEach(function(OI){return a(q,OI)}),tt&&rr(q,ze),Re}function _t(q,j,$,ie){if(typeof $=="object"&&$!==null&&$.type===R&&$.key===null&&($=$.props.children),typeof $=="object"&&$!==null){switch($.$$typeof){case S:e:{for(var Re=$.key;j!==null;){if(j.key===Re){if(Re=$.type,Re===R){if(j.tag===7){u(q,j.sibling),ie=_(j,$.props.children),ie.return=q,q=ie;break e}}else if(j.elementType===Re||typeof Re=="object"&&Re!==null&&Re.$$typeof===Q&&Ea(Re)===j.type){u(q,j.sibling),ie=_(j,$.props),Sd(ie,$),ie.return=q,q=ie;break e}u(q,j);break}else a(q,j);j=j.sibling}$.type===R?(ie=ba($.props.children,q.mode,ie,$.key),ie.return=q,q=ie):(ie=Hp($.type,$.key,$.props,null,q.mode,ie),Sd(ie,$),ie.return=q,q=ie)}return T(q);case E:e:{for(Re=$.key;j!==null;){if(j.key===Re)if(j.tag===4&&j.stateNode.containerInfo===$.containerInfo&&j.stateNode.implementation===$.implementation){u(q,j.sibling),ie=_(j,$.children||[]),ie.return=q,q=ie;break e}else{u(q,j);break}else a(q,j);j=j.sibling}ie=av($,q.mode,ie),ie.return=q,q=ie}return T(q);case Q:return $=Ea($),_t(q,j,$,ie)}if(pe($))return be(q,j,$,ie);if(G($)){if(Re=G($),typeof Re!="function")throw Error(n(150));return $=Re.call($),Me(q,j,$,ie)}if(typeof $.then=="function")return _t(q,j,$p($),ie);if($.$$typeof===I)return _t(q,j,qp(q,$),ie);Yp(q,$)}return typeof $=="string"&&$!==""||typeof $=="number"||typeof $=="bigint"?($=""+$,j!==null&&j.tag===6?(u(q,j.sibling),ie=_(j,$),ie.return=q,q=ie):(u(q,j),ie=ov($,q.mode,ie),ie.return=q,q=ie),T(q)):u(q,j)}return function(q,j,$,ie){try{xd=0;var Re=_t(q,j,$,ie);return gc=null,Re}catch(we){if(we===mc||we===Vp)throw we;var rt=pi(29,we,null,q.mode);return rt.lanes=ie,rt.return=q,rt}finally{}}}var Ta=Gx(!0),Vx=Gx(!1),mo=!1;function bv(r){r.updateQueue={baseState:r.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function _v(r,a){r=r.updateQueue,a.updateQueue===r&&(a.updateQueue={baseState:r.baseState,firstBaseUpdate:r.firstBaseUpdate,lastBaseUpdate:r.lastBaseUpdate,shared:r.shared,callbacks:null})}function go(r){return{lane:r,tag:0,payload:null,callback:null,next:null}}function vo(r,a,u){var f=r.updateQueue;if(f===null)return null;if(f=f.shared,(dt&2)!==0){var _=f.pending;return _===null?a.next=a:(a.next=_.next,_.next=a),f.pending=a,a=Fp(r),Cx(r,null,u),a}return Up(r,f,a,u),Fp(r)}function Ed(r,a,u){if(a=a.updateQueue,a!==null&&(a=a.shared,(u&4194048)!==0)){var f=a.lanes;f&=r.pendingLanes,u|=f,a.lanes=u,Pw(r,u)}}function wv(r,a){var u=r.updateQueue,f=r.alternate;if(f!==null&&(f=f.updateQueue,u===f)){var _=null,x=null;if(u=u.firstBaseUpdate,u!==null){do{var T={lane:u.lane,tag:u.tag,payload:u.payload,callback:null,next:null};x===null?_=x=T:x=x.next=T,u=u.next}while(u!==null);x===null?_=x=a:x=x.next=a}else _=x=a;u={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:x,shared:f.shared,callbacks:f.callbacks},r.updateQueue=u;return}r=u.lastBaseUpdate,r===null?u.firstBaseUpdate=a:r.next=a,u.lastBaseUpdate=a}var xv=!1;function Ad(){if(xv){var r=pc;if(r!==null)throw r}}function Td(r,a,u,f){xv=!1;var _=r.updateQueue;mo=!1;var x=_.firstBaseUpdate,T=_.lastBaseUpdate,M=_.shared.pending;if(M!==null){_.shared.pending=null;var H=M,Y=H.next;H.next=null,T===null?x=Y:T.next=Y,T=H;var Z=r.alternate;Z!==null&&(Z=Z.updateQueue,M=Z.lastBaseUpdate,M!==T&&(M===null?Z.firstBaseUpdate=Y:M.next=Y,Z.lastBaseUpdate=H))}if(x!==null){var re=_.baseState;T=0,Z=Y=H=null,M=x;do{var J=M.lane&-536870913,W=J!==M.lane;if(W?(Ze&J)===J:(f&J)===J){J!==0&&J===fc&&(xv=!0),Z!==null&&(Z=Z.next={lane:0,tag:M.tag,payload:M.payload,callback:null,next:null});e:{var be=r,Me=M;J=a;var _t=u;switch(Me.tag){case 1:if(be=Me.payload,typeof be=="function"){re=be.call(_t,re,J);break e}re=be;break e;case 3:be.flags=be.flags&-65537|128;case 0:if(be=Me.payload,J=typeof be=="function"?be.call(_t,re,J):be,J==null)break e;re=y({},re,J);break e;case 2:mo=!0}}J=M.callback,J!==null&&(r.flags|=64,W&&(r.flags|=8192),W=_.callbacks,W===null?_.callbacks=[J]:W.push(J))}else W={lane:J,tag:M.tag,payload:M.payload,callback:M.callback,next:null},Z===null?(Y=Z=W,H=re):Z=Z.next=W,T|=J;if(M=M.next,M===null){if(M=_.shared.pending,M===null)break;W=M,M=W.next,W.next=null,_.lastBaseUpdate=W,_.shared.pending=null}}while(!0);Z===null&&(H=re),_.baseState=H,_.firstBaseUpdate=Y,_.lastBaseUpdate=Z,x===null&&(_.shared.lanes=0),xo|=T,r.lanes=T,r.memoizedState=re}}function zx(r,a){if(typeof r!="function")throw Error(n(191,r));r.call(a)}function $x(r,a){var u=r.callbacks;if(u!==null)for(r.callbacks=null,r=0;r<u.length;r++)zx(u[r],a)}var vc=F(null),Jp=F(0);function Yx(r,a){r=gr,se(Jp,r),se(vc,a),gr=r|a.baseLanes}function Sv(){se(Jp,gr),se(vc,vc.current)}function Ev(){gr=Jp.current,V(vc),V(Jp)}var mi=F(null),Gi=null;function yo(r){var a=r.alternate;se(jt,jt.current&1),se(mi,r),Gi===null&&(a===null||vc.current!==null||a.memoizedState!==null)&&(Gi=r)}function Av(r){se(jt,jt.current),se(mi,r),Gi===null&&(Gi=r)}function Jx(r){r.tag===22?(se(jt,jt.current),se(mi,r),Gi===null&&(Gi=r)):bo()}function bo(){se(jt,jt.current),se(mi,mi.current)}function gi(r){V(mi),Gi===r&&(Gi=null),V(jt)}var jt=F(0);function Kp(r){for(var a=r;a!==null;){if(a.tag===13){var u=a.memoizedState;if(u!==null&&(u=u.dehydrated,u===null||Iy(u)||My(u)))return a}else if(a.tag===19&&(a.memoizedProps.revealOrder==="forwards"||a.memoizedProps.revealOrder==="backwards"||a.memoizedProps.revealOrder==="unstable_legacy-backwards"||a.memoizedProps.revealOrder==="together")){if((a.flags&128)!==0)return a}else if(a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return null;a=a.return}a.sibling.return=a.return,a=a.sibling}return null}var lr=0,Ge=null,yt=null,Jt=null,Wp=!1,yc=!1,Ca=!1,Xp=0,Cd=0,bc=null,T2=0;function Pt(){throw Error(n(321))}function Tv(r,a){if(a===null)return!1;for(var u=0;u<a.length&&u<r.length;u++)if(!fi(r[u],a[u]))return!1;return!0}function Cv(r,a,u,f,_,x){return lr=x,Ge=a,a.memoizedState=null,a.updateQueue=null,a.lanes=0,z.H=r===null||r.memoizedState===null?IS:qv,Ca=!1,x=u(f,_),Ca=!1,yc&&(x=Wx(a,u,f,_)),Kx(r),x}function Kx(r){z.H=kd;var a=yt!==null&&yt.next!==null;if(lr=0,Jt=yt=Ge=null,Wp=!1,Cd=0,bc=null,a)throw Error(n(300));r===null||Kt||(r=r.dependencies,r!==null&&jp(r)&&(Kt=!0))}function Wx(r,a,u,f){Ge=r;var _=0;do{if(yc&&(bc=null),Cd=0,yc=!1,25<=_)throw Error(n(301));if(_+=1,Jt=yt=null,r.updateQueue!=null){var x=r.updateQueue;x.lastEffect=null,x.events=null,x.stores=null,x.memoCache!=null&&(x.memoCache.index=0)}z.H=MS,x=a(u,f)}while(yc);return x}function C2(){var r=z.H,a=r.useState()[0];return a=typeof a.then=="function"?Rd(a):a,r=r.useState()[0],(yt!==null?yt.memoizedState:null)!==r&&(Ge.flags|=1024),a}function Rv(){var r=Xp!==0;return Xp=0,r}function Nv(r,a,u){a.updateQueue=r.updateQueue,a.flags&=-2053,r.lanes&=~u}function kv(r){if(Wp){for(r=r.memoizedState;r!==null;){var a=r.queue;a!==null&&(a.pending=null),r=r.next}Wp=!1}lr=0,Jt=yt=Ge=null,yc=!1,Cd=Xp=0,bc=null}function Gn(){var r={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Jt===null?Ge.memoizedState=Jt=r:Jt=Jt.next=r,Jt}function qt(){if(yt===null){var r=Ge.alternate;r=r!==null?r.memoizedState:null}else r=yt.next;var a=Jt===null?Ge.memoizedState:Jt.next;if(a!==null)Jt=a,yt=r;else{if(r===null)throw Ge.alternate===null?Error(n(467)):Error(n(310));yt=r,r={memoizedState:yt.memoizedState,baseState:yt.baseState,baseQueue:yt.baseQueue,queue:yt.queue,next:null},Jt===null?Ge.memoizedState=Jt=r:Jt=Jt.next=r}return Jt}function Qp(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Rd(r){var a=Cd;return Cd+=1,bc===null&&(bc=[]),r=Bx(bc,r,a),a=Ge,(Jt===null?a.memoizedState:Jt.next)===null&&(a=a.alternate,z.H=a===null||a.memoizedState===null?IS:qv),r}function Zp(r){if(r!==null&&typeof r=="object"){if(typeof r.then=="function")return Rd(r);if(r.$$typeof===I)return bn(r)}throw Error(n(438,String(r)))}function Iv(r){var a=null,u=Ge.updateQueue;if(u!==null&&(a=u.memoCache),a==null){var f=Ge.alternate;f!==null&&(f=f.updateQueue,f!==null&&(f=f.memoCache,f!=null&&(a={data:f.data.map(function(_){return _.slice()}),index:0})))}if(a==null&&(a={data:[],index:0}),u===null&&(u=Qp(),Ge.updateQueue=u),u.memoCache=a,u=a.data[a.index],u===void 0)for(u=a.data[a.index]=Array(r),f=0;f<r;f++)u[f]=le;return a.index++,u}function cr(r,a){return typeof a=="function"?a(r):a}function em(r){var a=qt();return Mv(a,yt,r)}function Mv(r,a,u){var f=r.queue;if(f===null)throw Error(n(311));f.lastRenderedReducer=u;var _=r.baseQueue,x=f.pending;if(x!==null){if(_!==null){var T=_.next;_.next=x.next,x.next=T}a.baseQueue=_=x,f.pending=null}if(x=r.baseState,_===null)r.memoizedState=x;else{a=_.next;var M=T=null,H=null,Y=a,Z=!1;do{var re=Y.lane&-536870913;if(re!==Y.lane?(Ze&re)===re:(lr&re)===re){var J=Y.revertLane;if(J===0)H!==null&&(H=H.next={lane:0,revertLane:0,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null}),re===fc&&(Z=!0);else if((lr&J)===J){Y=Y.next,J===fc&&(Z=!0);continue}else re={lane:0,revertLane:Y.revertLane,gesture:null,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},H===null?(M=H=re,T=x):H=H.next=re,Ge.lanes|=J,xo|=J;re=Y.action,Ca&&u(x,re),x=Y.hasEagerState?Y.eagerState:u(x,re)}else J={lane:re,revertLane:Y.revertLane,gesture:Y.gesture,action:Y.action,hasEagerState:Y.hasEagerState,eagerState:Y.eagerState,next:null},H===null?(M=H=J,T=x):H=H.next=J,Ge.lanes|=re,xo|=re;Y=Y.next}while(Y!==null&&Y!==a);if(H===null?T=x:H.next=M,!fi(x,r.memoizedState)&&(Kt=!0,Z&&(u=pc,u!==null)))throw u;r.memoizedState=x,r.baseState=T,r.baseQueue=H,f.lastRenderedState=x}return _===null&&(f.lanes=0),[r.memoizedState,f.dispatch]}function Dv(r){var a=qt(),u=a.queue;if(u===null)throw Error(n(311));u.lastRenderedReducer=r;var f=u.dispatch,_=u.pending,x=a.memoizedState;if(_!==null){u.pending=null;var T=_=_.next;do x=r(x,T.action),T=T.next;while(T!==_);fi(x,a.memoizedState)||(Kt=!0),a.memoizedState=x,a.baseQueue===null&&(a.baseState=x),u.lastRenderedState=x}return[x,f]}function Xx(r,a,u){var f=Ge,_=qt(),x=tt;if(x){if(u===void 0)throw Error(n(407));u=u()}else u=a();var T=!fi((yt||_).memoizedState,u);if(T&&(_.memoizedState=u,Kt=!0),_=_.queue,Ov(eS.bind(null,f,_,r),[r]),_.getSnapshot!==a||T||Jt!==null&&Jt.memoizedState.tag&1){if(f.flags|=2048,_c(9,{destroy:void 0},Zx.bind(null,f,_,u,a),null),Et===null)throw Error(n(349));x||(lr&127)!==0||Qx(f,a,u)}return u}function Qx(r,a,u){r.flags|=16384,r={getSnapshot:a,value:u},a=Ge.updateQueue,a===null?(a=Qp(),Ge.updateQueue=a,a.stores=[r]):(u=a.stores,u===null?a.stores=[r]:u.push(r))}function Zx(r,a,u,f){a.value=u,a.getSnapshot=f,tS(a)&&nS(r)}function eS(r,a,u){return u(function(){tS(a)&&nS(r)})}function tS(r){var a=r.getSnapshot;r=r.value;try{var u=a();return!fi(r,u)}catch{return!0}}function nS(r){var a=ya(r,2);a!==null&&si(a,r,2)}function Lv(r){var a=Gn();if(typeof r=="function"){var u=r;if(r=u(),Ca){je(!0);try{u()}finally{je(!1)}}}return a.memoizedState=a.baseState=r,a.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:cr,lastRenderedState:r},a}function iS(r,a,u,f){return r.baseState=u,Mv(r,yt,typeof f=="function"?f:cr)}function R2(r,a,u,f,_){if(im(r))throw Error(n(485));if(r=a.action,r!==null){var x={payload:_,action:r,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(T){x.listeners.push(T)}};z.T!==null?u(!0):x.isTransition=!1,f(x),u=a.pending,u===null?(x.next=a.pending=x,sS(a,x)):(x.next=u.next,a.pending=u.next=x)}}function sS(r,a){var u=a.action,f=a.payload,_=r.state;if(a.isTransition){var x=z.T,T={};z.T=T;try{var M=u(_,f),H=z.S;H!==null&&H(T,M),rS(r,a,M)}catch(Y){Pv(r,a,Y)}finally{x!==null&&T.types!==null&&(x.types=T.types),z.T=x}}else try{x=u(_,f),rS(r,a,x)}catch(Y){Pv(r,a,Y)}}function rS(r,a,u){u!==null&&typeof u=="object"&&typeof u.then=="function"?u.then(function(f){oS(r,a,f)},function(f){return Pv(r,a,f)}):oS(r,a,u)}function oS(r,a,u){a.status="fulfilled",a.value=u,aS(a),r.state=u,a=r.pending,a!==null&&(u=a.next,u===a?r.pending=null:(u=u.next,a.next=u,sS(r,u)))}function Pv(r,a,u){var f=r.pending;if(r.pending=null,f!==null){f=f.next;do a.status="rejected",a.reason=u,aS(a),a=a.next;while(a!==f)}r.action=null}function aS(r){r=r.listeners;for(var a=0;a<r.length;a++)(0,r[a])()}function lS(r,a){return a}function cS(r,a){if(tt){var u=Et.formState;if(u!==null){e:{var f=Ge;if(tt){if(Nt){t:{for(var _=Nt,x=qi;_.nodeType!==8;){if(!x){_=null;break t}if(_=Vi(_.nextSibling),_===null){_=null;break t}}x=_.data,_=x==="F!"||x==="F"?_:null}if(_){Nt=Vi(_.nextSibling),f=_.data==="F!";break e}}fo(f)}f=!1}f&&(a=u[0])}}return u=Gn(),u.memoizedState=u.baseState=a,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:lS,lastRenderedState:a},u.queue=f,u=RS.bind(null,Ge,f),f.dispatch=u,f=Lv(!1),x=jv.bind(null,Ge,!1,f.queue),f=Gn(),_={state:a,dispatch:null,action:r,pending:null},f.queue=_,u=R2.bind(null,Ge,_,x,u),_.dispatch=u,f.memoizedState=r,[a,u,!1]}function uS(r){var a=qt();return dS(a,yt,r)}function dS(r,a,u){if(a=Mv(r,a,lS)[0],r=em(cr)[0],typeof a=="object"&&a!==null&&typeof a.then=="function")try{var f=Rd(a)}catch(T){throw T===mc?Vp:T}else f=a;a=qt();var _=a.queue,x=_.dispatch;return u!==a.memoizedState&&(Ge.flags|=2048,_c(9,{destroy:void 0},N2.bind(null,_,u),null)),[f,x,r]}function N2(r,a){r.action=a}function hS(r){var a=qt(),u=yt;if(u!==null)return dS(a,u,r);qt(),a=a.memoizedState,u=qt();var f=u.queue.dispatch;return u.memoizedState=r,[a,f,!1]}function _c(r,a,u,f){return r={tag:r,create:u,deps:f,inst:a,next:null},a=Ge.updateQueue,a===null&&(a=Qp(),Ge.updateQueue=a),u=a.lastEffect,u===null?a.lastEffect=r.next=r:(f=u.next,u.next=r,r.next=f,a.lastEffect=r),r}function fS(){return qt().memoizedState}function tm(r,a,u,f){var _=Gn();Ge.flags|=r,_.memoizedState=_c(1|a,{destroy:void 0},u,f===void 0?null:f)}function nm(r,a,u,f){var _=qt();f=f===void 0?null:f;var x=_.memoizedState.inst;yt!==null&&f!==null&&Tv(f,yt.memoizedState.deps)?_.memoizedState=_c(a,x,u,f):(Ge.flags|=r,_.memoizedState=_c(1|a,x,u,f))}function pS(r,a){tm(8390656,8,r,a)}function Ov(r,a){nm(2048,8,r,a)}function k2(r){Ge.flags|=4;var a=Ge.updateQueue;if(a===null)a=Qp(),Ge.updateQueue=a,a.events=[r];else{var u=a.events;u===null?a.events=[r]:u.push(r)}}function mS(r){var a=qt().memoizedState;return k2({ref:a,nextImpl:r}),function(){if((dt&2)!==0)throw Error(n(440));return a.impl.apply(void 0,arguments)}}function gS(r,a){return nm(4,2,r,a)}function vS(r,a){return nm(4,4,r,a)}function yS(r,a){if(typeof a=="function"){r=r();var u=a(r);return function(){typeof u=="function"?u():a(null)}}if(a!=null)return r=r(),a.current=r,function(){a.current=null}}function bS(r,a,u){u=u!=null?u.concat([r]):null,nm(4,4,yS.bind(null,a,r),u)}function Uv(){}function _S(r,a){var u=qt();a=a===void 0?null:a;var f=u.memoizedState;return a!==null&&Tv(a,f[1])?f[0]:(u.memoizedState=[r,a],r)}function wS(r,a){var u=qt();a=a===void 0?null:a;var f=u.memoizedState;if(a!==null&&Tv(a,f[1]))return f[0];if(f=r(),Ca){je(!0);try{r()}finally{je(!1)}}return u.memoizedState=[f,a],f}function Fv(r,a,u){return u===void 0||(lr&1073741824)!==0&&(Ze&261930)===0?r.memoizedState=a:(r.memoizedState=u,r=xE(),Ge.lanes|=r,xo|=r,u)}function xS(r,a,u,f){return fi(u,a)?u:vc.current!==null?(r=Fv(r,u,f),fi(r,a)||(Kt=!0),r):(lr&42)===0||(lr&1073741824)!==0&&(Ze&261930)===0?(Kt=!0,r.memoizedState=u):(r=xE(),Ge.lanes|=r,xo|=r,a)}function SS(r,a,u,f,_){var x=X.p;X.p=x!==0&&8>x?x:8;var T=z.T,M={};z.T=M,jv(r,!1,a,u);try{var H=_(),Y=z.S;if(Y!==null&&Y(M,H),H!==null&&typeof H=="object"&&typeof H.then=="function"){var Z=A2(H,f);Nd(r,a,Z,bi(r))}else Nd(r,a,f,bi(r))}catch(re){Nd(r,a,{then:function(){},status:"rejected",reason:re},bi())}finally{X.p=x,T!==null&&M.types!==null&&(T.types=M.types),z.T=T}}function I2(){}function Hv(r,a,u,f){if(r.tag!==5)throw Error(n(476));var _=ES(r).queue;SS(r,_,a,te,u===null?I2:function(){return AS(r),u(f)})}function ES(r){var a=r.memoizedState;if(a!==null)return a;a={memoizedState:te,baseState:te,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cr,lastRenderedState:te},next:null};var u={};return a.next={memoizedState:u,baseState:u,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:cr,lastRenderedState:u},next:null},r.memoizedState=a,r=r.alternate,r!==null&&(r.memoizedState=a),a}function AS(r){var a=ES(r);a.next===null&&(a=r.alternate.memoizedState),Nd(r,a.next.queue,{},bi())}function Bv(){return bn($d)}function TS(){return qt().memoizedState}function CS(){return qt().memoizedState}function M2(r){for(var a=r.return;a!==null;){switch(a.tag){case 24:case 3:var u=bi();r=go(u);var f=vo(a,r,u);f!==null&&(si(f,a,u),Ed(f,a,u)),a={cache:mv()},r.payload=a;return}a=a.return}}function D2(r,a,u){var f=bi();u={lane:f,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null},im(r)?NS(a,u):(u=sv(r,a,u,f),u!==null&&(si(u,r,f),kS(u,a,f)))}function RS(r,a,u){var f=bi();Nd(r,a,u,f)}function Nd(r,a,u,f){var _={lane:f,revertLane:0,gesture:null,action:u,hasEagerState:!1,eagerState:null,next:null};if(im(r))NS(a,_);else{var x=r.alternate;if(r.lanes===0&&(x===null||x.lanes===0)&&(x=a.lastRenderedReducer,x!==null))try{var T=a.lastRenderedState,M=x(T,u);if(_.hasEagerState=!0,_.eagerState=M,fi(M,T))return Up(r,a,_,0),Et===null&&Op(),!1}catch{}finally{}if(u=sv(r,a,_,f),u!==null)return si(u,r,f),kS(u,a,f),!0}return!1}function jv(r,a,u,f){if(f={lane:2,revertLane:by(),gesture:null,action:f,hasEagerState:!1,eagerState:null,next:null},im(r)){if(a)throw Error(n(479))}else a=sv(r,u,f,2),a!==null&&si(a,r,2)}function im(r){var a=r.alternate;return r===Ge||a!==null&&a===Ge}function NS(r,a){yc=Wp=!0;var u=r.pending;u===null?a.next=a:(a.next=u.next,u.next=a),r.pending=a}function kS(r,a,u){if((u&4194048)!==0){var f=a.lanes;f&=r.pendingLanes,u|=f,a.lanes=u,Pw(r,u)}}var kd={readContext:bn,use:Zp,useCallback:Pt,useContext:Pt,useEffect:Pt,useImperativeHandle:Pt,useLayoutEffect:Pt,useInsertionEffect:Pt,useMemo:Pt,useReducer:Pt,useRef:Pt,useState:Pt,useDebugValue:Pt,useDeferredValue:Pt,useTransition:Pt,useSyncExternalStore:Pt,useId:Pt,useHostTransitionStatus:Pt,useFormState:Pt,useActionState:Pt,useOptimistic:Pt,useMemoCache:Pt,useCacheRefresh:Pt};kd.useEffectEvent=Pt;var IS={readContext:bn,use:Zp,useCallback:function(r,a){return Gn().memoizedState=[r,a===void 0?null:a],r},useContext:bn,useEffect:pS,useImperativeHandle:function(r,a,u){u=u!=null?u.concat([r]):null,tm(4194308,4,yS.bind(null,a,r),u)},useLayoutEffect:function(r,a){return tm(4194308,4,r,a)},useInsertionEffect:function(r,a){tm(4,2,r,a)},useMemo:function(r,a){var u=Gn();a=a===void 0?null:a;var f=r();if(Ca){je(!0);try{r()}finally{je(!1)}}return u.memoizedState=[f,a],f},useReducer:function(r,a,u){var f=Gn();if(u!==void 0){var _=u(a);if(Ca){je(!0);try{u(a)}finally{je(!1)}}}else _=a;return f.memoizedState=f.baseState=_,r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:r,lastRenderedState:_},f.queue=r,r=r.dispatch=D2.bind(null,Ge,r),[f.memoizedState,r]},useRef:function(r){var a=Gn();return r={current:r},a.memoizedState=r},useState:function(r){r=Lv(r);var a=r.queue,u=RS.bind(null,Ge,a);return a.dispatch=u,[r.memoizedState,u]},useDebugValue:Uv,useDeferredValue:function(r,a){var u=Gn();return Fv(u,r,a)},useTransition:function(){var r=Lv(!1);return r=SS.bind(null,Ge,r.queue,!0,!1),Gn().memoizedState=r,[!1,r]},useSyncExternalStore:function(r,a,u){var f=Ge,_=Gn();if(tt){if(u===void 0)throw Error(n(407));u=u()}else{if(u=a(),Et===null)throw Error(n(349));(Ze&127)!==0||Qx(f,a,u)}_.memoizedState=u;var x={value:u,getSnapshot:a};return _.queue=x,pS(eS.bind(null,f,x,r),[r]),f.flags|=2048,_c(9,{destroy:void 0},Zx.bind(null,f,x,u,a),null),u},useId:function(){var r=Gn(),a=Et.identifierPrefix;if(tt){var u=Ns,f=Rs;u=(f&~(1<<32-Ce(f)-1)).toString(32)+u,a="_"+a+"R_"+u,u=Xp++,0<u&&(a+="H"+u.toString(32)),a+="_"}else u=T2++,a="_"+a+"r_"+u.toString(32)+"_";return r.memoizedState=a},useHostTransitionStatus:Bv,useFormState:cS,useActionState:cS,useOptimistic:function(r){var a=Gn();a.memoizedState=a.baseState=r;var u={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return a.queue=u,a=jv.bind(null,Ge,!0,u),u.dispatch=a,[r,a]},useMemoCache:Iv,useCacheRefresh:function(){return Gn().memoizedState=M2.bind(null,Ge)},useEffectEvent:function(r){var a=Gn(),u={impl:r};return a.memoizedState=u,function(){if((dt&2)!==0)throw Error(n(440));return u.impl.apply(void 0,arguments)}}},qv={readContext:bn,use:Zp,useCallback:_S,useContext:bn,useEffect:Ov,useImperativeHandle:bS,useInsertionEffect:gS,useLayoutEffect:vS,useMemo:wS,useReducer:em,useRef:fS,useState:function(){return em(cr)},useDebugValue:Uv,useDeferredValue:function(r,a){var u=qt();return xS(u,yt.memoizedState,r,a)},useTransition:function(){var r=em(cr)[0],a=qt().memoizedState;return[typeof r=="boolean"?r:Rd(r),a]},useSyncExternalStore:Xx,useId:TS,useHostTransitionStatus:Bv,useFormState:uS,useActionState:uS,useOptimistic:function(r,a){var u=qt();return iS(u,yt,r,a)},useMemoCache:Iv,useCacheRefresh:CS};qv.useEffectEvent=mS;var MS={readContext:bn,use:Zp,useCallback:_S,useContext:bn,useEffect:Ov,useImperativeHandle:bS,useInsertionEffect:gS,useLayoutEffect:vS,useMemo:wS,useReducer:Dv,useRef:fS,useState:function(){return Dv(cr)},useDebugValue:Uv,useDeferredValue:function(r,a){var u=qt();return yt===null?Fv(u,r,a):xS(u,yt.memoizedState,r,a)},useTransition:function(){var r=Dv(cr)[0],a=qt().memoizedState;return[typeof r=="boolean"?r:Rd(r),a]},useSyncExternalStore:Xx,useId:TS,useHostTransitionStatus:Bv,useFormState:hS,useActionState:hS,useOptimistic:function(r,a){var u=qt();return yt!==null?iS(u,yt,r,a):(u.baseState=r,[r,u.queue.dispatch])},useMemoCache:Iv,useCacheRefresh:CS};MS.useEffectEvent=mS;function Gv(r,a,u,f){a=r.memoizedState,u=u(f,a),u=u==null?a:y({},a,u),r.memoizedState=u,r.lanes===0&&(r.updateQueue.baseState=u)}var Vv={enqueueSetState:function(r,a,u){r=r._reactInternals;var f=bi(),_=go(f);_.payload=a,u!=null&&(_.callback=u),a=vo(r,_,f),a!==null&&(si(a,r,f),Ed(a,r,f))},enqueueReplaceState:function(r,a,u){r=r._reactInternals;var f=bi(),_=go(f);_.tag=1,_.payload=a,u!=null&&(_.callback=u),a=vo(r,_,f),a!==null&&(si(a,r,f),Ed(a,r,f))},enqueueForceUpdate:function(r,a){r=r._reactInternals;var u=bi(),f=go(u);f.tag=2,a!=null&&(f.callback=a),a=vo(r,f,u),a!==null&&(si(a,r,u),Ed(a,r,u))}};function DS(r,a,u,f,_,x,T){return r=r.stateNode,typeof r.shouldComponentUpdate=="function"?r.shouldComponentUpdate(f,x,T):a.prototype&&a.prototype.isPureReactComponent?!gd(u,f)||!gd(_,x):!0}function LS(r,a,u,f){r=a.state,typeof a.componentWillReceiveProps=="function"&&a.componentWillReceiveProps(u,f),typeof a.UNSAFE_componentWillReceiveProps=="function"&&a.UNSAFE_componentWillReceiveProps(u,f),a.state!==r&&Vv.enqueueReplaceState(a,a.state,null)}function Ra(r,a){var u=a;if("ref"in a){u={};for(var f in a)f!=="ref"&&(u[f]=a[f])}if(r=r.defaultProps){u===a&&(u=y({},u));for(var _ in r)u[_]===void 0&&(u[_]=r[_])}return u}function PS(r){Pp(r)}function OS(r){console.error(r)}function US(r){Pp(r)}function sm(r,a){try{var u=r.onUncaughtError;u(a.value,{componentStack:a.stack})}catch(f){setTimeout(function(){throw f})}}function FS(r,a,u){try{var f=r.onCaughtError;f(u.value,{componentStack:u.stack,errorBoundary:a.tag===1?a.stateNode:null})}catch(_){setTimeout(function(){throw _})}}function zv(r,a,u){return u=go(u),u.tag=3,u.payload={element:null},u.callback=function(){sm(r,a)},u}function HS(r){return r=go(r),r.tag=3,r}function BS(r,a,u,f){var _=u.type.getDerivedStateFromError;if(typeof _=="function"){var x=f.value;r.payload=function(){return _(x)},r.callback=function(){FS(a,u,f)}}var T=u.stateNode;T!==null&&typeof T.componentDidCatch=="function"&&(r.callback=function(){FS(a,u,f),typeof _!="function"&&(So===null?So=new Set([this]):So.add(this));var M=f.stack;this.componentDidCatch(f.value,{componentStack:M!==null?M:""})})}function L2(r,a,u,f,_){if(u.flags|=32768,f!==null&&typeof f=="object"&&typeof f.then=="function"){if(a=u.alternate,a!==null&&hc(a,u,_,!0),u=mi.current,u!==null){switch(u.tag){case 31:case 13:return Gi===null?gm():u.alternate===null&&Ot===0&&(Ot=3),u.flags&=-257,u.flags|=65536,u.lanes=_,f===zp?u.flags|=16384:(a=u.updateQueue,a===null?u.updateQueue=new Set([f]):a.add(f),gy(r,f,_)),!1;case 22:return u.flags|=65536,f===zp?u.flags|=16384:(a=u.updateQueue,a===null?(a={transitions:null,markerInstances:null,retryQueue:new Set([f])},u.updateQueue=a):(u=a.retryQueue,u===null?a.retryQueue=new Set([f]):u.add(f)),gy(r,f,_)),!1}throw Error(n(435,u.tag))}return gy(r,f,_),gm(),!1}if(tt)return a=mi.current,a!==null?((a.flags&65536)===0&&(a.flags|=256),a.flags|=65536,a.lanes=_,f!==uv&&(r=Error(n(422),{cause:f}),bd(Hi(r,u)))):(f!==uv&&(a=Error(n(423),{cause:f}),bd(Hi(a,u))),r=r.current.alternate,r.flags|=65536,_&=-_,r.lanes|=_,f=Hi(f,u),_=zv(r.stateNode,f,_),wv(r,_),Ot!==4&&(Ot=2)),!1;var x=Error(n(520),{cause:f});if(x=Hi(x,u),Fd===null?Fd=[x]:Fd.push(x),Ot!==4&&(Ot=2),a===null)return!0;f=Hi(f,u),u=a;do{switch(u.tag){case 3:return u.flags|=65536,r=_&-_,u.lanes|=r,r=zv(u.stateNode,f,r),wv(u,r),!1;case 1:if(a=u.type,x=u.stateNode,(u.flags&128)===0&&(typeof a.getDerivedStateFromError=="function"||x!==null&&typeof x.componentDidCatch=="function"&&(So===null||!So.has(x))))return u.flags|=65536,_&=-_,u.lanes|=_,_=HS(_),BS(_,r,u,f),wv(u,_),!1}u=u.return}while(u!==null);return!1}var $v=Error(n(461)),Kt=!1;function _n(r,a,u,f){a.child=r===null?Vx(a,null,u,f):Ta(a,r.child,u,f)}function jS(r,a,u,f,_){u=u.render;var x=a.ref;if("ref"in f){var T={};for(var M in f)M!=="ref"&&(T[M]=f[M])}else T=f;return xa(a),f=Cv(r,a,u,T,x,_),M=Rv(),r!==null&&!Kt?(Nv(r,a,_),ur(r,a,_)):(tt&&M&&lv(a),a.flags|=1,_n(r,a,f,_),a.child)}function qS(r,a,u,f,_){if(r===null){var x=u.type;return typeof x=="function"&&!rv(x)&&x.defaultProps===void 0&&u.compare===null?(a.tag=15,a.type=x,GS(r,a,x,f,_)):(r=Hp(u.type,null,f,a,a.mode,_),r.ref=a.ref,r.return=a,a.child=r)}if(x=r.child,!ey(r,_)){var T=x.memoizedProps;if(u=u.compare,u=u!==null?u:gd,u(T,f)&&r.ref===a.ref)return ur(r,a,_)}return a.flags|=1,r=sr(x,f),r.ref=a.ref,r.return=a,a.child=r}function GS(r,a,u,f,_){if(r!==null){var x=r.memoizedProps;if(gd(x,f)&&r.ref===a.ref)if(Kt=!1,a.pendingProps=f=x,ey(r,_))(r.flags&131072)!==0&&(Kt=!0);else return a.lanes=r.lanes,ur(r,a,_)}return Yv(r,a,u,f,_)}function VS(r,a,u,f){var _=f.children,x=r!==null?r.memoizedState:null;if(r===null&&a.stateNode===null&&(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),f.mode==="hidden"){if((a.flags&128)!==0){if(x=x!==null?x.baseLanes|u:u,r!==null){for(f=a.child=r.child,_=0;f!==null;)_=_|f.lanes|f.childLanes,f=f.sibling;f=_&~x}else f=0,a.child=null;return zS(r,a,x,u,f)}if((u&536870912)!==0)a.memoizedState={baseLanes:0,cachePool:null},r!==null&&Gp(a,x!==null?x.cachePool:null),x!==null?Yx(a,x):Sv(),Jx(a);else return f=a.lanes=536870912,zS(r,a,x!==null?x.baseLanes|u:u,u,f)}else x!==null?(Gp(a,x.cachePool),Yx(a,x),bo(),a.memoizedState=null):(r!==null&&Gp(a,null),Sv(),bo());return _n(r,a,_,u),a.child}function Id(r,a){return r!==null&&r.tag===22||a.stateNode!==null||(a.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),a.sibling}function zS(r,a,u,f,_){var x=vv();return x=x===null?null:{parent:Yt._currentValue,pool:x},a.memoizedState={baseLanes:u,cachePool:x},r!==null&&Gp(a,null),Sv(),Jx(a),r!==null&&hc(r,a,f,!0),a.childLanes=_,null}function rm(r,a){return a=am({mode:a.mode,children:a.children},r.mode),a.ref=r.ref,r.child=a,a.return=r,a}function $S(r,a,u){return Ta(a,r.child,null,u),r=rm(a,a.pendingProps),r.flags|=2,gi(a),a.memoizedState=null,r}function P2(r,a,u){var f=a.pendingProps,_=(a.flags&128)!==0;if(a.flags&=-129,r===null){if(tt){if(f.mode==="hidden")return r=rm(a,f),a.lanes=536870912,Id(null,r);if(Av(a),(r=Nt)?(r=sA(r,qi),r=r!==null&&r.data==="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:uo!==null?{id:Rs,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},u=Nx(r),u.return=a,a.child=u,yn=a,Nt=null)):r=null,r===null)throw fo(a);return a.lanes=536870912,null}return rm(a,f)}var x=r.memoizedState;if(x!==null){var T=x.dehydrated;if(Av(a),_)if(a.flags&256)a.flags&=-257,a=$S(r,a,u);else if(a.memoizedState!==null)a.child=r.child,a.flags|=128,a=null;else throw Error(n(558));else if(Kt||hc(r,a,u,!1),_=(u&r.childLanes)!==0,Kt||_){if(f=Et,f!==null&&(T=Ow(f,u),T!==0&&T!==x.retryLane))throw x.retryLane=T,ya(r,T),si(f,r,T),$v;gm(),a=$S(r,a,u)}else r=x.treeContext,Nt=Vi(T.nextSibling),yn=a,tt=!0,ho=null,qi=!1,r!==null&&Mx(a,r),a=rm(a,f),a.flags|=4096;return a}return r=sr(r.child,{mode:f.mode,children:f.children}),r.ref=a.ref,a.child=r,r.return=a,r}function om(r,a){var u=a.ref;if(u===null)r!==null&&r.ref!==null&&(a.flags|=4194816);else{if(typeof u!="function"&&typeof u!="object")throw Error(n(284));(r===null||r.ref!==u)&&(a.flags|=4194816)}}function Yv(r,a,u,f,_){return xa(a),u=Cv(r,a,u,f,void 0,_),f=Rv(),r!==null&&!Kt?(Nv(r,a,_),ur(r,a,_)):(tt&&f&&lv(a),a.flags|=1,_n(r,a,u,_),a.child)}function YS(r,a,u,f,_,x){return xa(a),a.updateQueue=null,u=Wx(a,f,u,_),Kx(r),f=Rv(),r!==null&&!Kt?(Nv(r,a,x),ur(r,a,x)):(tt&&f&&lv(a),a.flags|=1,_n(r,a,u,x),a.child)}function JS(r,a,u,f,_){if(xa(a),a.stateNode===null){var x=lc,T=u.contextType;typeof T=="object"&&T!==null&&(x=bn(T)),x=new u(f,x),a.memoizedState=x.state!==null&&x.state!==void 0?x.state:null,x.updater=Vv,a.stateNode=x,x._reactInternals=a,x=a.stateNode,x.props=f,x.state=a.memoizedState,x.refs={},bv(a),T=u.contextType,x.context=typeof T=="object"&&T!==null?bn(T):lc,x.state=a.memoizedState,T=u.getDerivedStateFromProps,typeof T=="function"&&(Gv(a,u,T,f),x.state=a.memoizedState),typeof u.getDerivedStateFromProps=="function"||typeof x.getSnapshotBeforeUpdate=="function"||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(T=x.state,typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount(),T!==x.state&&Vv.enqueueReplaceState(x,x.state,null),Td(a,f,x,_),Ad(),x.state=a.memoizedState),typeof x.componentDidMount=="function"&&(a.flags|=4194308),f=!0}else if(r===null){x=a.stateNode;var M=a.memoizedProps,H=Ra(u,M);x.props=H;var Y=x.context,Z=u.contextType;T=lc,typeof Z=="object"&&Z!==null&&(T=bn(Z));var re=u.getDerivedStateFromProps;Z=typeof re=="function"||typeof x.getSnapshotBeforeUpdate=="function",M=a.pendingProps!==M,Z||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(M||Y!==T)&&LS(a,x,f,T),mo=!1;var J=a.memoizedState;x.state=J,Td(a,f,x,_),Ad(),Y=a.memoizedState,M||J!==Y||mo?(typeof re=="function"&&(Gv(a,u,re,f),Y=a.memoizedState),(H=mo||DS(a,u,H,f,J,Y,T))?(Z||typeof x.UNSAFE_componentWillMount!="function"&&typeof x.componentWillMount!="function"||(typeof x.componentWillMount=="function"&&x.componentWillMount(),typeof x.UNSAFE_componentWillMount=="function"&&x.UNSAFE_componentWillMount()),typeof x.componentDidMount=="function"&&(a.flags|=4194308)):(typeof x.componentDidMount=="function"&&(a.flags|=4194308),a.memoizedProps=f,a.memoizedState=Y),x.props=f,x.state=Y,x.context=T,f=H):(typeof x.componentDidMount=="function"&&(a.flags|=4194308),f=!1)}else{x=a.stateNode,_v(r,a),T=a.memoizedProps,Z=Ra(u,T),x.props=Z,re=a.pendingProps,J=x.context,Y=u.contextType,H=lc,typeof Y=="object"&&Y!==null&&(H=bn(Y)),M=u.getDerivedStateFromProps,(Y=typeof M=="function"||typeof x.getSnapshotBeforeUpdate=="function")||typeof x.UNSAFE_componentWillReceiveProps!="function"&&typeof x.componentWillReceiveProps!="function"||(T!==re||J!==H)&&LS(a,x,f,H),mo=!1,J=a.memoizedState,x.state=J,Td(a,f,x,_),Ad();var W=a.memoizedState;T!==re||J!==W||mo||r!==null&&r.dependencies!==null&&jp(r.dependencies)?(typeof M=="function"&&(Gv(a,u,M,f),W=a.memoizedState),(Z=mo||DS(a,u,Z,f,J,W,H)||r!==null&&r.dependencies!==null&&jp(r.dependencies))?(Y||typeof x.UNSAFE_componentWillUpdate!="function"&&typeof x.componentWillUpdate!="function"||(typeof x.componentWillUpdate=="function"&&x.componentWillUpdate(f,W,H),typeof x.UNSAFE_componentWillUpdate=="function"&&x.UNSAFE_componentWillUpdate(f,W,H)),typeof x.componentDidUpdate=="function"&&(a.flags|=4),typeof x.getSnapshotBeforeUpdate=="function"&&(a.flags|=1024)):(typeof x.componentDidUpdate!="function"||T===r.memoizedProps&&J===r.memoizedState||(a.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||T===r.memoizedProps&&J===r.memoizedState||(a.flags|=1024),a.memoizedProps=f,a.memoizedState=W),x.props=f,x.state=W,x.context=H,f=Z):(typeof x.componentDidUpdate!="function"||T===r.memoizedProps&&J===r.memoizedState||(a.flags|=4),typeof x.getSnapshotBeforeUpdate!="function"||T===r.memoizedProps&&J===r.memoizedState||(a.flags|=1024),f=!1)}return x=f,om(r,a),f=(a.flags&128)!==0,x||f?(x=a.stateNode,u=f&&typeof u.getDerivedStateFromError!="function"?null:x.render(),a.flags|=1,r!==null&&f?(a.child=Ta(a,r.child,null,_),a.child=Ta(a,null,u,_)):_n(r,a,u,_),a.memoizedState=x.state,r=a.child):r=ur(r,a,_),r}function KS(r,a,u,f){return _a(),a.flags|=256,_n(r,a,u,f),a.child}var Jv={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Kv(r){return{baseLanes:r,cachePool:Fx()}}function Wv(r,a,u){return r=r!==null?r.childLanes&~u:0,a&&(r|=yi),r}function WS(r,a,u){var f=a.pendingProps,_=!1,x=(a.flags&128)!==0,T;if((T=x)||(T=r!==null&&r.memoizedState===null?!1:(jt.current&2)!==0),T&&(_=!0,a.flags&=-129),T=(a.flags&32)!==0,a.flags&=-33,r===null){if(tt){if(_?yo(a):bo(),(r=Nt)?(r=sA(r,qi),r=r!==null&&r.data!=="&"?r:null,r!==null&&(a.memoizedState={dehydrated:r,treeContext:uo!==null?{id:Rs,overflow:Ns}:null,retryLane:536870912,hydrationErrors:null},u=Nx(r),u.return=a,a.child=u,yn=a,Nt=null)):r=null,r===null)throw fo(a);return My(r)?a.lanes=32:a.lanes=536870912,null}var M=f.children;return f=f.fallback,_?(bo(),_=a.mode,M=am({mode:"hidden",children:M},_),f=ba(f,_,u,null),M.return=a,f.return=a,M.sibling=f,a.child=M,f=a.child,f.memoizedState=Kv(u),f.childLanes=Wv(r,T,u),a.memoizedState=Jv,Id(null,f)):(yo(a),Xv(a,M))}var H=r.memoizedState;if(H!==null&&(M=H.dehydrated,M!==null)){if(x)a.flags&256?(yo(a),a.flags&=-257,a=Qv(r,a,u)):a.memoizedState!==null?(bo(),a.child=r.child,a.flags|=128,a=null):(bo(),M=f.fallback,_=a.mode,f=am({mode:"visible",children:f.children},_),M=ba(M,_,u,null),M.flags|=2,f.return=a,M.return=a,f.sibling=M,a.child=f,Ta(a,r.child,null,u),f=a.child,f.memoizedState=Kv(u),f.childLanes=Wv(r,T,u),a.memoizedState=Jv,a=Id(null,f));else if(yo(a),My(M)){if(T=M.nextSibling&&M.nextSibling.dataset,T)var Y=T.dgst;T=Y,f=Error(n(419)),f.stack="",f.digest=T,bd({value:f,source:null,stack:null}),a=Qv(r,a,u)}else if(Kt||hc(r,a,u,!1),T=(u&r.childLanes)!==0,Kt||T){if(T=Et,T!==null&&(f=Ow(T,u),f!==0&&f!==H.retryLane))throw H.retryLane=f,ya(r,f),si(T,r,f),$v;Iy(M)||gm(),a=Qv(r,a,u)}else Iy(M)?(a.flags|=192,a.child=r.child,a=null):(r=H.treeContext,Nt=Vi(M.nextSibling),yn=a,tt=!0,ho=null,qi=!1,r!==null&&Mx(a,r),a=Xv(a,f.children),a.flags|=4096);return a}return _?(bo(),M=f.fallback,_=a.mode,H=r.child,Y=H.sibling,f=sr(H,{mode:"hidden",children:f.children}),f.subtreeFlags=H.subtreeFlags&65011712,Y!==null?M=sr(Y,M):(M=ba(M,_,u,null),M.flags|=2),M.return=a,f.return=a,f.sibling=M,a.child=f,Id(null,f),f=a.child,M=r.child.memoizedState,M===null?M=Kv(u):(_=M.cachePool,_!==null?(H=Yt._currentValue,_=_.parent!==H?{parent:H,pool:H}:_):_=Fx(),M={baseLanes:M.baseLanes|u,cachePool:_}),f.memoizedState=M,f.childLanes=Wv(r,T,u),a.memoizedState=Jv,Id(r.child,f)):(yo(a),u=r.child,r=u.sibling,u=sr(u,{mode:"visible",children:f.children}),u.return=a,u.sibling=null,r!==null&&(T=a.deletions,T===null?(a.deletions=[r],a.flags|=16):T.push(r)),a.child=u,a.memoizedState=null,u)}function Xv(r,a){return a=am({mode:"visible",children:a},r.mode),a.return=r,r.child=a}function am(r,a){return r=pi(22,r,null,a),r.lanes=0,r}function Qv(r,a,u){return Ta(a,r.child,null,u),r=Xv(a,a.pendingProps.children),r.flags|=2,a.memoizedState=null,r}function XS(r,a,u){r.lanes|=a;var f=r.alternate;f!==null&&(f.lanes|=a),fv(r.return,a,u)}function Zv(r,a,u,f,_,x){var T=r.memoizedState;T===null?r.memoizedState={isBackwards:a,rendering:null,renderingStartTime:0,last:f,tail:u,tailMode:_,treeForkCount:x}:(T.isBackwards=a,T.rendering=null,T.renderingStartTime=0,T.last=f,T.tail=u,T.tailMode=_,T.treeForkCount=x)}function QS(r,a,u){var f=a.pendingProps,_=f.revealOrder,x=f.tail;f=f.children;var T=jt.current,M=(T&2)!==0;if(M?(T=T&1|2,a.flags|=128):T&=1,se(jt,T),_n(r,a,f,u),f=tt?yd:0,!M&&r!==null&&(r.flags&128)!==0)e:for(r=a.child;r!==null;){if(r.tag===13)r.memoizedState!==null&&XS(r,u,a);else if(r.tag===19)XS(r,u,a);else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===a)break e;for(;r.sibling===null;){if(r.return===null||r.return===a)break e;r=r.return}r.sibling.return=r.return,r=r.sibling}switch(_){case"forwards":for(u=a.child,_=null;u!==null;)r=u.alternate,r!==null&&Kp(r)===null&&(_=u),u=u.sibling;u=_,u===null?(_=a.child,a.child=null):(_=u.sibling,u.sibling=null),Zv(a,!1,_,u,x,f);break;case"backwards":case"unstable_legacy-backwards":for(u=null,_=a.child,a.child=null;_!==null;){if(r=_.alternate,r!==null&&Kp(r)===null){a.child=_;break}r=_.sibling,_.sibling=u,u=_,_=r}Zv(a,!0,u,null,x,f);break;case"together":Zv(a,!1,null,null,void 0,f);break;default:a.memoizedState=null}return a.child}function ur(r,a,u){if(r!==null&&(a.dependencies=r.dependencies),xo|=a.lanes,(u&a.childLanes)===0)if(r!==null){if(hc(r,a,u,!1),(u&a.childLanes)===0)return null}else return null;if(r!==null&&a.child!==r.child)throw Error(n(153));if(a.child!==null){for(r=a.child,u=sr(r,r.pendingProps),a.child=u,u.return=a;r.sibling!==null;)r=r.sibling,u=u.sibling=sr(r,r.pendingProps),u.return=a;u.sibling=null}return a.child}function ey(r,a){return(r.lanes&a)!==0?!0:(r=r.dependencies,!!(r!==null&&jp(r)))}function O2(r,a,u){switch(a.tag){case 3:ft(a,a.stateNode.containerInfo),po(a,Yt,r.memoizedState.cache),_a();break;case 27:case 5:As(a);break;case 4:ft(a,a.stateNode.containerInfo);break;case 10:po(a,a.type,a.memoizedProps.value);break;case 31:if(a.memoizedState!==null)return a.flags|=128,Av(a),null;break;case 13:var f=a.memoizedState;if(f!==null)return f.dehydrated!==null?(yo(a),a.flags|=128,null):(u&a.child.childLanes)!==0?WS(r,a,u):(yo(a),r=ur(r,a,u),r!==null?r.sibling:null);yo(a);break;case 19:var _=(r.flags&128)!==0;if(f=(u&a.childLanes)!==0,f||(hc(r,a,u,!1),f=(u&a.childLanes)!==0),_){if(f)return QS(r,a,u);a.flags|=128}if(_=a.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),se(jt,jt.current),f)break;return null;case 22:return a.lanes=0,VS(r,a,u,a.pendingProps);case 24:po(a,Yt,r.memoizedState.cache)}return ur(r,a,u)}function ZS(r,a,u){if(r!==null)if(r.memoizedProps!==a.pendingProps)Kt=!0;else{if(!ey(r,u)&&(a.flags&128)===0)return Kt=!1,O2(r,a,u);Kt=(r.flags&131072)!==0}else Kt=!1,tt&&(a.flags&1048576)!==0&&Ix(a,yd,a.index);switch(a.lanes=0,a.tag){case 16:e:{var f=a.pendingProps;if(r=Ea(a.elementType),a.type=r,typeof r=="function")rv(r)?(f=Ra(r,f),a.tag=1,a=JS(null,a,r,f,u)):(a.tag=0,a=Yv(null,a,r,f,u));else{if(r!=null){var _=r.$$typeof;if(_===O){a.tag=11,a=jS(null,a,r,f,u);break e}else if(_===B){a.tag=14,a=qS(null,a,r,f,u);break e}}throw a=ce(r)||r,Error(n(306,a,""))}}return a;case 0:return Yv(r,a,a.type,a.pendingProps,u);case 1:return f=a.type,_=Ra(f,a.pendingProps),JS(r,a,f,_,u);case 3:e:{if(ft(a,a.stateNode.containerInfo),r===null)throw Error(n(387));f=a.pendingProps;var x=a.memoizedState;_=x.element,_v(r,a),Td(a,f,null,u);var T=a.memoizedState;if(f=T.cache,po(a,Yt,f),f!==x.cache&&pv(a,[Yt],u,!0),Ad(),f=T.element,x.isDehydrated)if(x={element:f,isDehydrated:!1,cache:T.cache},a.updateQueue.baseState=x,a.memoizedState=x,a.flags&256){a=KS(r,a,f,u);break e}else if(f!==_){_=Hi(Error(n(424)),a),bd(_),a=KS(r,a,f,u);break e}else{switch(r=a.stateNode.containerInfo,r.nodeType){case 9:r=r.body;break;default:r=r.nodeName==="HTML"?r.ownerDocument.body:r}for(Nt=Vi(r.firstChild),yn=a,tt=!0,ho=null,qi=!0,u=Vx(a,null,f,u),a.child=u;u;)u.flags=u.flags&-3|4096,u=u.sibling}else{if(_a(),f===_){a=ur(r,a,u);break e}_n(r,a,f,u)}a=a.child}return a;case 26:return om(r,a),r===null?(u=uA(a.type,null,a.pendingProps,null))?a.memoizedState=u:tt||(u=a.type,r=a.pendingProps,f=Sm(ke.current).createElement(u),f[vn]=a,f[Qn]=r,wn(f,u,r),un(f),a.stateNode=f):a.memoizedState=uA(a.type,r.memoizedProps,a.pendingProps,r.memoizedState),null;case 27:return As(a),r===null&&tt&&(f=a.stateNode=aA(a.type,a.pendingProps,ke.current),yn=a,qi=!0,_=Nt,Co(a.type)?(Dy=_,Nt=Vi(f.firstChild)):Nt=_),_n(r,a,a.pendingProps.children,u),om(r,a),r===null&&(a.flags|=4194304),a.child;case 5:return r===null&&tt&&((_=f=Nt)&&(f=hI(f,a.type,a.pendingProps,qi),f!==null?(a.stateNode=f,yn=a,Nt=Vi(f.firstChild),qi=!1,_=!0):_=!1),_||fo(a)),As(a),_=a.type,x=a.pendingProps,T=r!==null?r.memoizedProps:null,f=x.children,Ry(_,x)?f=null:T!==null&&Ry(_,T)&&(a.flags|=32),a.memoizedState!==null&&(_=Cv(r,a,C2,null,null,u),$d._currentValue=_),om(r,a),_n(r,a,f,u),a.child;case 6:return r===null&&tt&&((r=u=Nt)&&(u=fI(u,a.pendingProps,qi),u!==null?(a.stateNode=u,yn=a,Nt=null,r=!0):r=!1),r||fo(a)),null;case 13:return WS(r,a,u);case 4:return ft(a,a.stateNode.containerInfo),f=a.pendingProps,r===null?a.child=Ta(a,null,f,u):_n(r,a,f,u),a.child;case 11:return jS(r,a,a.type,a.pendingProps,u);case 7:return _n(r,a,a.pendingProps,u),a.child;case 8:return _n(r,a,a.pendingProps.children,u),a.child;case 12:return _n(r,a,a.pendingProps.children,u),a.child;case 10:return f=a.pendingProps,po(a,a.type,f.value),_n(r,a,f.children,u),a.child;case 9:return _=a.type._context,f=a.pendingProps.children,xa(a),_=bn(_),f=f(_),a.flags|=1,_n(r,a,f,u),a.child;case 14:return qS(r,a,a.type,a.pendingProps,u);case 15:return GS(r,a,a.type,a.pendingProps,u);case 19:return QS(r,a,u);case 31:return P2(r,a,u);case 22:return VS(r,a,u,a.pendingProps);case 24:return xa(a),f=bn(Yt),r===null?(_=vv(),_===null&&(_=Et,x=mv(),_.pooledCache=x,x.refCount++,x!==null&&(_.pooledCacheLanes|=u),_=x),a.memoizedState={parent:f,cache:_},bv(a),po(a,Yt,_)):((r.lanes&u)!==0&&(_v(r,a),Td(a,null,null,u),Ad()),_=r.memoizedState,x=a.memoizedState,_.parent!==f?(_={parent:f,cache:f},a.memoizedState=_,a.lanes===0&&(a.memoizedState=a.updateQueue.baseState=_),po(a,Yt,f)):(f=x.cache,po(a,Yt,f),f!==_.cache&&pv(a,[Yt],u,!0))),_n(r,a,a.pendingProps.children,u),a.child;case 29:throw a.pendingProps}throw Error(n(156,a.tag))}function dr(r){r.flags|=4}function ty(r,a,u,f,_){if((a=(r.mode&32)!==0)&&(a=!1),a){if(r.flags|=16777216,(_&335544128)===_)if(r.stateNode.complete)r.flags|=8192;else if(TE())r.flags|=8192;else throw Aa=zp,yv}else r.flags&=-16777217}function eE(r,a){if(a.type!=="stylesheet"||(a.state.loading&4)!==0)r.flags&=-16777217;else if(r.flags|=16777216,!mA(a))if(TE())r.flags|=8192;else throw Aa=zp,yv}function lm(r,a){a!==null&&(r.flags|=4),r.flags&16384&&(a=r.tag!==22?Dw():536870912,r.lanes|=a,Ec|=a)}function Md(r,a){if(!tt)switch(r.tailMode){case"hidden":a=r.tail;for(var u=null;a!==null;)a.alternate!==null&&(u=a),a=a.sibling;u===null?r.tail=null:u.sibling=null;break;case"collapsed":u=r.tail;for(var f=null;u!==null;)u.alternate!==null&&(f=u),u=u.sibling;f===null?a||r.tail===null?r.tail=null:r.tail.sibling=null:f.sibling=null}}function kt(r){var a=r.alternate!==null&&r.alternate.child===r.child,u=0,f=0;if(a)for(var _=r.child;_!==null;)u|=_.lanes|_.childLanes,f|=_.subtreeFlags&65011712,f|=_.flags&65011712,_.return=r,_=_.sibling;else for(_=r.child;_!==null;)u|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=r,_=_.sibling;return r.subtreeFlags|=f,r.childLanes=u,a}function U2(r,a,u){var f=a.pendingProps;switch(cv(a),a.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return kt(a),null;case 1:return kt(a),null;case 3:return u=a.stateNode,f=null,r!==null&&(f=r.memoizedState.cache),a.memoizedState.cache!==f&&(a.flags|=2048),ar(Yt),Ye(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(r===null||r.child===null)&&(dc(a)?dr(a):r===null||r.memoizedState.isDehydrated&&(a.flags&256)===0||(a.flags|=1024,dv())),kt(a),null;case 26:var _=a.type,x=a.memoizedState;return r===null?(dr(a),x!==null?(kt(a),eE(a,x)):(kt(a),ty(a,_,null,f,u))):x?x!==r.memoizedState?(dr(a),kt(a),eE(a,x)):(kt(a),a.flags&=-16777217):(r=r.memoizedProps,r!==f&&dr(a),kt(a),ty(a,_,r,f,u)),null;case 27:if(gn(a),u=ke.current,_=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==f&&dr(a);else{if(!f){if(a.stateNode===null)throw Error(n(166));return kt(a),null}r=he.current,dc(a)?Dx(a):(r=aA(_,f,u),a.stateNode=r,dr(a))}return kt(a),null;case 5:if(gn(a),_=a.type,r!==null&&a.stateNode!=null)r.memoizedProps!==f&&dr(a);else{if(!f){if(a.stateNode===null)throw Error(n(166));return kt(a),null}if(x=he.current,dc(a))Dx(a);else{var T=Sm(ke.current);switch(x){case 1:x=T.createElementNS("http://www.w3.org/2000/svg",_);break;case 2:x=T.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;default:switch(_){case"svg":x=T.createElementNS("http://www.w3.org/2000/svg",_);break;case"math":x=T.createElementNS("http://www.w3.org/1998/Math/MathML",_);break;case"script":x=T.createElement("div"),x.innerHTML="<script><\/script>",x=x.removeChild(x.firstChild);break;case"select":x=typeof f.is=="string"?T.createElement("select",{is:f.is}):T.createElement("select"),f.multiple?x.multiple=!0:f.size&&(x.size=f.size);break;default:x=typeof f.is=="string"?T.createElement(_,{is:f.is}):T.createElement(_)}}x[vn]=a,x[Qn]=f;e:for(T=a.child;T!==null;){if(T.tag===5||T.tag===6)x.appendChild(T.stateNode);else if(T.tag!==4&&T.tag!==27&&T.child!==null){T.child.return=T,T=T.child;continue}if(T===a)break e;for(;T.sibling===null;){if(T.return===null||T.return===a)break e;T=T.return}T.sibling.return=T.return,T=T.sibling}a.stateNode=x;e:switch(wn(x,_,f),_){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&dr(a)}}return kt(a),ty(a,a.type,r===null?null:r.memoizedProps,a.pendingProps,u),null;case 6:if(r&&a.stateNode!=null)r.memoizedProps!==f&&dr(a);else{if(typeof f!="string"&&a.stateNode===null)throw Error(n(166));if(r=ke.current,dc(a)){if(r=a.stateNode,u=a.memoizedProps,f=null,_=yn,_!==null)switch(_.tag){case 27:case 5:f=_.memoizedProps}r[vn]=a,r=!!(r.nodeValue===u||f!==null&&f.suppressHydrationWarning===!0||WE(r.nodeValue,u)),r||fo(a,!0)}else r=Sm(r).createTextNode(f),r[vn]=a,a.stateNode=r}return kt(a),null;case 31:if(u=a.memoizedState,r===null||r.memoizedState!==null){if(f=dc(a),u!==null){if(r===null){if(!f)throw Error(n(318));if(r=a.memoizedState,r=r!==null?r.dehydrated:null,!r)throw Error(n(557));r[vn]=a}else _a(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;kt(a),r=!1}else u=dv(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=u),r=!0;if(!r)return a.flags&256?(gi(a),a):(gi(a),null);if((a.flags&128)!==0)throw Error(n(558))}return kt(a),null;case 13:if(f=a.memoizedState,r===null||r.memoizedState!==null&&r.memoizedState.dehydrated!==null){if(_=dc(a),f!==null&&f.dehydrated!==null){if(r===null){if(!_)throw Error(n(318));if(_=a.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(n(317));_[vn]=a}else _a(),(a.flags&128)===0&&(a.memoizedState=null),a.flags|=4;kt(a),_=!1}else _=dv(),r!==null&&r.memoizedState!==null&&(r.memoizedState.hydrationErrors=_),_=!0;if(!_)return a.flags&256?(gi(a),a):(gi(a),null)}return gi(a),(a.flags&128)!==0?(a.lanes=u,a):(u=f!==null,r=r!==null&&r.memoizedState!==null,u&&(f=a.child,_=null,f.alternate!==null&&f.alternate.memoizedState!==null&&f.alternate.memoizedState.cachePool!==null&&(_=f.alternate.memoizedState.cachePool.pool),x=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(x=f.memoizedState.cachePool.pool),x!==_&&(f.flags|=2048)),u!==r&&u&&(a.child.flags|=8192),lm(a,a.updateQueue),kt(a),null);case 4:return Ye(),r===null&&Sy(a.stateNode.containerInfo),kt(a),null;case 10:return ar(a.type),kt(a),null;case 19:if(V(jt),f=a.memoizedState,f===null)return kt(a),null;if(_=(a.flags&128)!==0,x=f.rendering,x===null)if(_)Md(f,!1);else{if(Ot!==0||r!==null&&(r.flags&128)!==0)for(r=a.child;r!==null;){if(x=Kp(r),x!==null){for(a.flags|=128,Md(f,!1),r=x.updateQueue,a.updateQueue=r,lm(a,r),a.subtreeFlags=0,r=u,u=a.child;u!==null;)Rx(u,r),u=u.sibling;return se(jt,jt.current&1|2),tt&&rr(a,f.treeForkCount),a.child}r=r.sibling}f.tail!==null&&Ie()>fm&&(a.flags|=128,_=!0,Md(f,!1),a.lanes=4194304)}else{if(!_)if(r=Kp(x),r!==null){if(a.flags|=128,_=!0,r=r.updateQueue,a.updateQueue=r,lm(a,r),Md(f,!0),f.tail===null&&f.tailMode==="hidden"&&!x.alternate&&!tt)return kt(a),null}else 2*Ie()-f.renderingStartTime>fm&&u!==536870912&&(a.flags|=128,_=!0,Md(f,!1),a.lanes=4194304);f.isBackwards?(x.sibling=a.child,a.child=x):(r=f.last,r!==null?r.sibling=x:a.child=x,f.last=x)}return f.tail!==null?(r=f.tail,f.rendering=r,f.tail=r.sibling,f.renderingStartTime=Ie(),r.sibling=null,u=jt.current,se(jt,_?u&1|2:u&1),tt&&rr(a,f.treeForkCount),r):(kt(a),null);case 22:case 23:return gi(a),Ev(),f=a.memoizedState!==null,r!==null?r.memoizedState!==null!==f&&(a.flags|=8192):f&&(a.flags|=8192),f?(u&536870912)!==0&&(a.flags&128)===0&&(kt(a),a.subtreeFlags&6&&(a.flags|=8192)):kt(a),u=a.updateQueue,u!==null&&lm(a,u.retryQueue),u=null,r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),f=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(f=a.memoizedState.cachePool.pool),f!==u&&(a.flags|=2048),r!==null&&V(Sa),null;case 24:return u=null,r!==null&&(u=r.memoizedState.cache),a.memoizedState.cache!==u&&(a.flags|=2048),ar(Yt),kt(a),null;case 25:return null;case 30:return null}throw Error(n(156,a.tag))}function F2(r,a){switch(cv(a),a.tag){case 1:return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 3:return ar(Yt),Ye(),r=a.flags,(r&65536)!==0&&(r&128)===0?(a.flags=r&-65537|128,a):null;case 26:case 27:case 5:return gn(a),null;case 31:if(a.memoizedState!==null){if(gi(a),a.alternate===null)throw Error(n(340));_a()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 13:if(gi(a),r=a.memoizedState,r!==null&&r.dehydrated!==null){if(a.alternate===null)throw Error(n(340));_a()}return r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 19:return V(jt),null;case 4:return Ye(),null;case 10:return ar(a.type),null;case 22:case 23:return gi(a),Ev(),r!==null&&V(Sa),r=a.flags,r&65536?(a.flags=r&-65537|128,a):null;case 24:return ar(Yt),null;case 25:return null;default:return null}}function tE(r,a){switch(cv(a),a.tag){case 3:ar(Yt),Ye();break;case 26:case 27:case 5:gn(a);break;case 4:Ye();break;case 31:a.memoizedState!==null&&gi(a);break;case 13:gi(a);break;case 19:V(jt);break;case 10:ar(a.type);break;case 22:case 23:gi(a),Ev(),r!==null&&V(Sa);break;case 24:ar(Yt)}}function Dd(r,a){try{var u=a.updateQueue,f=u!==null?u.lastEffect:null;if(f!==null){var _=f.next;u=_;do{if((u.tag&r)===r){f=void 0;var x=u.create,T=u.inst;f=x(),T.destroy=f}u=u.next}while(u!==_)}}catch(M){mt(a,a.return,M)}}function _o(r,a,u){try{var f=a.updateQueue,_=f!==null?f.lastEffect:null;if(_!==null){var x=_.next;f=x;do{if((f.tag&r)===r){var T=f.inst,M=T.destroy;if(M!==void 0){T.destroy=void 0,_=a;var H=u,Y=M;try{Y()}catch(Z){mt(_,H,Z)}}}f=f.next}while(f!==x)}}catch(Z){mt(a,a.return,Z)}}function nE(r){var a=r.updateQueue;if(a!==null){var u=r.stateNode;try{$x(a,u)}catch(f){mt(r,r.return,f)}}}function iE(r,a,u){u.props=Ra(r.type,r.memoizedProps),u.state=r.memoizedState;try{u.componentWillUnmount()}catch(f){mt(r,a,f)}}function Ld(r,a){try{var u=r.ref;if(u!==null){switch(r.tag){case 26:case 27:case 5:var f=r.stateNode;break;case 30:f=r.stateNode;break;default:f=r.stateNode}typeof u=="function"?r.refCleanup=u(f):u.current=f}}catch(_){mt(r,a,_)}}function ks(r,a){var u=r.ref,f=r.refCleanup;if(u!==null)if(typeof f=="function")try{f()}catch(_){mt(r,a,_)}finally{r.refCleanup=null,r=r.alternate,r!=null&&(r.refCleanup=null)}else if(typeof u=="function")try{u(null)}catch(_){mt(r,a,_)}else u.current=null}function sE(r){var a=r.type,u=r.memoizedProps,f=r.stateNode;try{e:switch(a){case"button":case"input":case"select":case"textarea":u.autoFocus&&f.focus();break e;case"img":u.src?f.src=u.src:u.srcSet&&(f.srcset=u.srcSet)}}catch(_){mt(r,r.return,_)}}function ny(r,a,u){try{var f=r.stateNode;oI(f,r.type,u,a),f[Qn]=a}catch(_){mt(r,r.return,_)}}function rE(r){return r.tag===5||r.tag===3||r.tag===26||r.tag===27&&Co(r.type)||r.tag===4}function iy(r){e:for(;;){for(;r.sibling===null;){if(r.return===null||rE(r.return))return null;r=r.return}for(r.sibling.return=r.return,r=r.sibling;r.tag!==5&&r.tag!==6&&r.tag!==18;){if(r.tag===27&&Co(r.type)||r.flags&2||r.child===null||r.tag===4)continue e;r.child.return=r,r=r.child}if(!(r.flags&2))return r.stateNode}}function sy(r,a,u){var f=r.tag;if(f===5||f===6)r=r.stateNode,a?(u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u).insertBefore(r,a):(a=u.nodeType===9?u.body:u.nodeName==="HTML"?u.ownerDocument.body:u,a.appendChild(r),u=u._reactRootContainer,u!=null||a.onclick!==null||(a.onclick=nr));else if(f!==4&&(f===27&&Co(r.type)&&(u=r.stateNode,a=null),r=r.child,r!==null))for(sy(r,a,u),r=r.sibling;r!==null;)sy(r,a,u),r=r.sibling}function cm(r,a,u){var f=r.tag;if(f===5||f===6)r=r.stateNode,a?u.insertBefore(r,a):u.appendChild(r);else if(f!==4&&(f===27&&Co(r.type)&&(u=r.stateNode),r=r.child,r!==null))for(cm(r,a,u),r=r.sibling;r!==null;)cm(r,a,u),r=r.sibling}function oE(r){var a=r.stateNode,u=r.memoizedProps;try{for(var f=r.type,_=a.attributes;_.length;)a.removeAttributeNode(_[0]);wn(a,f,u),a[vn]=r,a[Qn]=u}catch(x){mt(r,r.return,x)}}var hr=!1,Wt=!1,ry=!1,aE=typeof WeakSet=="function"?WeakSet:Set,dn=null;function H2(r,a){if(r=r.containerInfo,Ty=km,r=bx(r),Q0(r)){if("selectionStart"in r)var u={start:r.selectionStart,end:r.selectionEnd};else e:{u=(u=r.ownerDocument)&&u.defaultView||window;var f=u.getSelection&&u.getSelection();if(f&&f.rangeCount!==0){u=f.anchorNode;var _=f.anchorOffset,x=f.focusNode;f=f.focusOffset;try{u.nodeType,x.nodeType}catch{u=null;break e}var T=0,M=-1,H=-1,Y=0,Z=0,re=r,J=null;t:for(;;){for(var W;re!==u||_!==0&&re.nodeType!==3||(M=T+_),re!==x||f!==0&&re.nodeType!==3||(H=T+f),re.nodeType===3&&(T+=re.nodeValue.length),(W=re.firstChild)!==null;)J=re,re=W;for(;;){if(re===r)break t;if(J===u&&++Y===_&&(M=T),J===x&&++Z===f&&(H=T),(W=re.nextSibling)!==null)break;re=J,J=re.parentNode}re=W}u=M===-1||H===-1?null:{start:M,end:H}}else u=null}u=u||{start:0,end:0}}else u=null;for(Cy={focusedElem:r,selectionRange:u},km=!1,dn=a;dn!==null;)if(a=dn,r=a.child,(a.subtreeFlags&1028)!==0&&r!==null)r.return=a,dn=r;else for(;dn!==null;){switch(a=dn,x=a.alternate,r=a.flags,a.tag){case 0:if((r&4)!==0&&(r=a.updateQueue,r=r!==null?r.events:null,r!==null))for(u=0;u<r.length;u++)_=r[u],_.ref.impl=_.nextImpl;break;case 11:case 15:break;case 1:if((r&1024)!==0&&x!==null){r=void 0,u=a,_=x.memoizedProps,x=x.memoizedState,f=u.stateNode;try{var be=Ra(u.type,_);r=f.getSnapshotBeforeUpdate(be,x),f.__reactInternalSnapshotBeforeUpdate=r}catch(Me){mt(u,u.return,Me)}}break;case 3:if((r&1024)!==0){if(r=a.stateNode.containerInfo,u=r.nodeType,u===9)ky(r);else if(u===1)switch(r.nodeName){case"HEAD":case"HTML":case"BODY":ky(r);break;default:r.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((r&1024)!==0)throw Error(n(163))}if(r=a.sibling,r!==null){r.return=a.return,dn=r;break}dn=a.return}}function lE(r,a,u){var f=u.flags;switch(u.tag){case 0:case 11:case 15:pr(r,u),f&4&&Dd(5,u);break;case 1:if(pr(r,u),f&4)if(r=u.stateNode,a===null)try{r.componentDidMount()}catch(T){mt(u,u.return,T)}else{var _=Ra(u.type,a.memoizedProps);a=a.memoizedState;try{r.componentDidUpdate(_,a,r.__reactInternalSnapshotBeforeUpdate)}catch(T){mt(u,u.return,T)}}f&64&&nE(u),f&512&&Ld(u,u.return);break;case 3:if(pr(r,u),f&64&&(r=u.updateQueue,r!==null)){if(a=null,u.child!==null)switch(u.child.tag){case 27:case 5:a=u.child.stateNode;break;case 1:a=u.child.stateNode}try{$x(r,a)}catch(T){mt(u,u.return,T)}}break;case 27:a===null&&f&4&&oE(u);case 26:case 5:pr(r,u),a===null&&f&4&&sE(u),f&512&&Ld(u,u.return);break;case 12:pr(r,u);break;case 31:pr(r,u),f&4&&dE(r,u);break;case 13:pr(r,u),f&4&&hE(r,u),f&64&&(r=u.memoizedState,r!==null&&(r=r.dehydrated,r!==null&&(u=J2.bind(null,u),pI(r,u))));break;case 22:if(f=u.memoizedState!==null||hr,!f){a=a!==null&&a.memoizedState!==null||Wt,_=hr;var x=Wt;hr=f,(Wt=a)&&!x?mr(r,u,(u.subtreeFlags&8772)!==0):pr(r,u),hr=_,Wt=x}break;case 30:break;default:pr(r,u)}}function cE(r){var a=r.alternate;a!==null&&(r.alternate=null,cE(a)),r.child=null,r.deletions=null,r.sibling=null,r.tag===5&&(a=r.stateNode,a!==null&&P0(a)),r.stateNode=null,r.return=null,r.dependencies=null,r.memoizedProps=null,r.memoizedState=null,r.pendingProps=null,r.stateNode=null,r.updateQueue=null}var It=null,ei=!1;function fr(r,a,u){for(u=u.child;u!==null;)uE(r,a,u),u=u.sibling}function uE(r,a,u){if(Ae&&typeof Ae.onCommitFiberUnmount=="function")try{Ae.onCommitFiberUnmount(ye,u)}catch{}switch(u.tag){case 26:Wt||ks(u,a),fr(r,a,u),u.memoizedState?u.memoizedState.count--:u.stateNode&&(u=u.stateNode,u.parentNode.removeChild(u));break;case 27:Wt||ks(u,a);var f=It,_=ei;Co(u.type)&&(It=u.stateNode,ei=!1),fr(r,a,u),Gd(u.stateNode),It=f,ei=_;break;case 5:Wt||ks(u,a);case 6:if(f=It,_=ei,It=null,fr(r,a,u),It=f,ei=_,It!==null)if(ei)try{(It.nodeType===9?It.body:It.nodeName==="HTML"?It.ownerDocument.body:It).removeChild(u.stateNode)}catch(x){mt(u,a,x)}else try{It.removeChild(u.stateNode)}catch(x){mt(u,a,x)}break;case 18:It!==null&&(ei?(r=It,nA(r.nodeType===9?r.body:r.nodeName==="HTML"?r.ownerDocument.body:r,u.stateNode),Mc(r)):nA(It,u.stateNode));break;case 4:f=It,_=ei,It=u.stateNode.containerInfo,ei=!0,fr(r,a,u),It=f,ei=_;break;case 0:case 11:case 14:case 15:_o(2,u,a),Wt||_o(4,u,a),fr(r,a,u);break;case 1:Wt||(ks(u,a),f=u.stateNode,typeof f.componentWillUnmount=="function"&&iE(u,a,f)),fr(r,a,u);break;case 21:fr(r,a,u);break;case 22:Wt=(f=Wt)||u.memoizedState!==null,fr(r,a,u),Wt=f;break;default:fr(r,a,u)}}function dE(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null))){r=r.dehydrated;try{Mc(r)}catch(u){mt(a,a.return,u)}}}function hE(r,a){if(a.memoizedState===null&&(r=a.alternate,r!==null&&(r=r.memoizedState,r!==null&&(r=r.dehydrated,r!==null))))try{Mc(r)}catch(u){mt(a,a.return,u)}}function B2(r){switch(r.tag){case 31:case 13:case 19:var a=r.stateNode;return a===null&&(a=r.stateNode=new aE),a;case 22:return r=r.stateNode,a=r._retryCache,a===null&&(a=r._retryCache=new aE),a;default:throw Error(n(435,r.tag))}}function um(r,a){var u=B2(r);a.forEach(function(f){if(!u.has(f)){u.add(f);var _=K2.bind(null,r,f);f.then(_,_)}})}function ti(r,a){var u=a.deletions;if(u!==null)for(var f=0;f<u.length;f++){var _=u[f],x=r,T=a,M=T;e:for(;M!==null;){switch(M.tag){case 27:if(Co(M.type)){It=M.stateNode,ei=!1;break e}break;case 5:It=M.stateNode,ei=!1;break e;case 3:case 4:It=M.stateNode.containerInfo,ei=!0;break e}M=M.return}if(It===null)throw Error(n(160));uE(x,T,_),It=null,ei=!1,x=_.alternate,x!==null&&(x.return=null),_.return=null}if(a.subtreeFlags&13886)for(a=a.child;a!==null;)fE(a,r),a=a.sibling}var ns=null;function fE(r,a){var u=r.alternate,f=r.flags;switch(r.tag){case 0:case 11:case 14:case 15:ti(a,r),ni(r),f&4&&(_o(3,r,r.return),Dd(3,r),_o(5,r,r.return));break;case 1:ti(a,r),ni(r),f&512&&(Wt||u===null||ks(u,u.return)),f&64&&hr&&(r=r.updateQueue,r!==null&&(f=r.callbacks,f!==null&&(u=r.shared.hiddenCallbacks,r.shared.hiddenCallbacks=u===null?f:u.concat(f))));break;case 26:var _=ns;if(ti(a,r),ni(r),f&512&&(Wt||u===null||ks(u,u.return)),f&4){var x=u!==null?u.memoizedState:null;if(f=r.memoizedState,u===null)if(f===null)if(r.stateNode===null){e:{f=r.type,u=r.memoizedProps,_=_.ownerDocument||_;t:switch(f){case"title":x=_.getElementsByTagName("title")[0],(!x||x[ad]||x[vn]||x.namespaceURI==="http://www.w3.org/2000/svg"||x.hasAttribute("itemprop"))&&(x=_.createElement(f),_.head.insertBefore(x,_.querySelector("head > title"))),wn(x,f,u),x[vn]=r,un(x),f=x;break e;case"link":var T=fA("link","href",_).get(f+(u.href||""));if(T){for(var M=0;M<T.length;M++)if(x=T[M],x.getAttribute("href")===(u.href==null||u.href===""?null:u.href)&&x.getAttribute("rel")===(u.rel==null?null:u.rel)&&x.getAttribute("title")===(u.title==null?null:u.title)&&x.getAttribute("crossorigin")===(u.crossOrigin==null?null:u.crossOrigin)){T.splice(M,1);break t}}x=_.createElement(f),wn(x,f,u),_.head.appendChild(x);break;case"meta":if(T=fA("meta","content",_).get(f+(u.content||""))){for(M=0;M<T.length;M++)if(x=T[M],x.getAttribute("content")===(u.content==null?null:""+u.content)&&x.getAttribute("name")===(u.name==null?null:u.name)&&x.getAttribute("property")===(u.property==null?null:u.property)&&x.getAttribute("http-equiv")===(u.httpEquiv==null?null:u.httpEquiv)&&x.getAttribute("charset")===(u.charSet==null?null:u.charSet)){T.splice(M,1);break t}}x=_.createElement(f),wn(x,f,u),_.head.appendChild(x);break;default:throw Error(n(468,f))}x[vn]=r,un(x),f=x}r.stateNode=f}else pA(_,r.type,r.stateNode);else r.stateNode=hA(_,f,r.memoizedProps);else x!==f?(x===null?u.stateNode!==null&&(u=u.stateNode,u.parentNode.removeChild(u)):x.count--,f===null?pA(_,r.type,r.stateNode):hA(_,f,r.memoizedProps)):f===null&&r.stateNode!==null&&ny(r,r.memoizedProps,u.memoizedProps)}break;case 27:ti(a,r),ni(r),f&512&&(Wt||u===null||ks(u,u.return)),u!==null&&f&4&&ny(r,r.memoizedProps,u.memoizedProps);break;case 5:if(ti(a,r),ni(r),f&512&&(Wt||u===null||ks(u,u.return)),r.flags&32){_=r.stateNode;try{tc(_,"")}catch(be){mt(r,r.return,be)}}f&4&&r.stateNode!=null&&(_=r.memoizedProps,ny(r,_,u!==null?u.memoizedProps:_)),f&1024&&(ry=!0);break;case 6:if(ti(a,r),ni(r),f&4){if(r.stateNode===null)throw Error(n(162));f=r.memoizedProps,u=r.stateNode;try{u.nodeValue=f}catch(be){mt(r,r.return,be)}}break;case 3:if(Tm=null,_=ns,ns=Em(a.containerInfo),ti(a,r),ns=_,ni(r),f&4&&u!==null&&u.memoizedState.isDehydrated)try{Mc(a.containerInfo)}catch(be){mt(r,r.return,be)}ry&&(ry=!1,pE(r));break;case 4:f=ns,ns=Em(r.stateNode.containerInfo),ti(a,r),ni(r),ns=f;break;case 12:ti(a,r),ni(r);break;case 31:ti(a,r),ni(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,um(r,f)));break;case 13:ti(a,r),ni(r),r.child.flags&8192&&r.memoizedState!==null!=(u!==null&&u.memoizedState!==null)&&(hm=Ie()),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,um(r,f)));break;case 22:_=r.memoizedState!==null;var H=u!==null&&u.memoizedState!==null,Y=hr,Z=Wt;if(hr=Y||_,Wt=Z||H,ti(a,r),Wt=Z,hr=Y,ni(r),f&8192)e:for(a=r.stateNode,a._visibility=_?a._visibility&-2:a._visibility|1,_&&(u===null||H||hr||Wt||Na(r)),u=null,a=r;;){if(a.tag===5||a.tag===26){if(u===null){H=u=a;try{if(x=H.stateNode,_)T=x.style,typeof T.setProperty=="function"?T.setProperty("display","none","important"):T.display="none";else{M=H.stateNode;var re=H.memoizedProps.style,J=re!=null&&re.hasOwnProperty("display")?re.display:null;M.style.display=J==null||typeof J=="boolean"?"":(""+J).trim()}}catch(be){mt(H,H.return,be)}}}else if(a.tag===6){if(u===null){H=a;try{H.stateNode.nodeValue=_?"":H.memoizedProps}catch(be){mt(H,H.return,be)}}}else if(a.tag===18){if(u===null){H=a;try{var W=H.stateNode;_?iA(W,!0):iA(H.stateNode,!1)}catch(be){mt(H,H.return,be)}}}else if((a.tag!==22&&a.tag!==23||a.memoizedState===null||a===r)&&a.child!==null){a.child.return=a,a=a.child;continue}if(a===r)break e;for(;a.sibling===null;){if(a.return===null||a.return===r)break e;u===a&&(u=null),a=a.return}u===a&&(u=null),a.sibling.return=a.return,a=a.sibling}f&4&&(f=r.updateQueue,f!==null&&(u=f.retryQueue,u!==null&&(f.retryQueue=null,um(r,u))));break;case 19:ti(a,r),ni(r),f&4&&(f=r.updateQueue,f!==null&&(r.updateQueue=null,um(r,f)));break;case 30:break;case 21:break;default:ti(a,r),ni(r)}}function ni(r){var a=r.flags;if(a&2){try{for(var u,f=r.return;f!==null;){if(rE(f)){u=f;break}f=f.return}if(u==null)throw Error(n(160));switch(u.tag){case 27:var _=u.stateNode,x=iy(r);cm(r,x,_);break;case 5:var T=u.stateNode;u.flags&32&&(tc(T,""),u.flags&=-33);var M=iy(r);cm(r,M,T);break;case 3:case 4:var H=u.stateNode.containerInfo,Y=iy(r);sy(r,Y,H);break;default:throw Error(n(161))}}catch(Z){mt(r,r.return,Z)}r.flags&=-3}a&4096&&(r.flags&=-4097)}function pE(r){if(r.subtreeFlags&1024)for(r=r.child;r!==null;){var a=r;pE(a),a.tag===5&&a.flags&1024&&a.stateNode.reset(),r=r.sibling}}function pr(r,a){if(a.subtreeFlags&8772)for(a=a.child;a!==null;)lE(r,a.alternate,a),a=a.sibling}function Na(r){for(r=r.child;r!==null;){var a=r;switch(a.tag){case 0:case 11:case 14:case 15:_o(4,a,a.return),Na(a);break;case 1:ks(a,a.return);var u=a.stateNode;typeof u.componentWillUnmount=="function"&&iE(a,a.return,u),Na(a);break;case 27:Gd(a.stateNode);case 26:case 5:ks(a,a.return),Na(a);break;case 22:a.memoizedState===null&&Na(a);break;case 30:Na(a);break;default:Na(a)}r=r.sibling}}function mr(r,a,u){for(u=u&&(a.subtreeFlags&8772)!==0,a=a.child;a!==null;){var f=a.alternate,_=r,x=a,T=x.flags;switch(x.tag){case 0:case 11:case 15:mr(_,x,u),Dd(4,x);break;case 1:if(mr(_,x,u),f=x,_=f.stateNode,typeof _.componentDidMount=="function")try{_.componentDidMount()}catch(Y){mt(f,f.return,Y)}if(f=x,_=f.updateQueue,_!==null){var M=f.stateNode;try{var H=_.shared.hiddenCallbacks;if(H!==null)for(_.shared.hiddenCallbacks=null,_=0;_<H.length;_++)zx(H[_],M)}catch(Y){mt(f,f.return,Y)}}u&&T&64&&nE(x),Ld(x,x.return);break;case 27:oE(x);case 26:case 5:mr(_,x,u),u&&f===null&&T&4&&sE(x),Ld(x,x.return);break;case 12:mr(_,x,u);break;case 31:mr(_,x,u),u&&T&4&&dE(_,x);break;case 13:mr(_,x,u),u&&T&4&&hE(_,x);break;case 22:x.memoizedState===null&&mr(_,x,u),Ld(x,x.return);break;case 30:break;default:mr(_,x,u)}a=a.sibling}}function oy(r,a){var u=null;r!==null&&r.memoizedState!==null&&r.memoizedState.cachePool!==null&&(u=r.memoizedState.cachePool.pool),r=null,a.memoizedState!==null&&a.memoizedState.cachePool!==null&&(r=a.memoizedState.cachePool.pool),r!==u&&(r!=null&&r.refCount++,u!=null&&_d(u))}function ay(r,a){r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&_d(r))}function is(r,a,u,f){if(a.subtreeFlags&10256)for(a=a.child;a!==null;)mE(r,a,u,f),a=a.sibling}function mE(r,a,u,f){var _=a.flags;switch(a.tag){case 0:case 11:case 15:is(r,a,u,f),_&2048&&Dd(9,a);break;case 1:is(r,a,u,f);break;case 3:is(r,a,u,f),_&2048&&(r=null,a.alternate!==null&&(r=a.alternate.memoizedState.cache),a=a.memoizedState.cache,a!==r&&(a.refCount++,r!=null&&_d(r)));break;case 12:if(_&2048){is(r,a,u,f),r=a.stateNode;try{var x=a.memoizedProps,T=x.id,M=x.onPostCommit;typeof M=="function"&&M(T,a.alternate===null?"mount":"update",r.passiveEffectDuration,-0)}catch(H){mt(a,a.return,H)}}else is(r,a,u,f);break;case 31:is(r,a,u,f);break;case 13:is(r,a,u,f);break;case 23:break;case 22:x=a.stateNode,T=a.alternate,a.memoizedState!==null?x._visibility&2?is(r,a,u,f):Pd(r,a):x._visibility&2?is(r,a,u,f):(x._visibility|=2,wc(r,a,u,f,(a.subtreeFlags&10256)!==0||!1)),_&2048&&oy(T,a);break;case 24:is(r,a,u,f),_&2048&&ay(a.alternate,a);break;default:is(r,a,u,f)}}function wc(r,a,u,f,_){for(_=_&&((a.subtreeFlags&10256)!==0||!1),a=a.child;a!==null;){var x=r,T=a,M=u,H=f,Y=T.flags;switch(T.tag){case 0:case 11:case 15:wc(x,T,M,H,_),Dd(8,T);break;case 23:break;case 22:var Z=T.stateNode;T.memoizedState!==null?Z._visibility&2?wc(x,T,M,H,_):Pd(x,T):(Z._visibility|=2,wc(x,T,M,H,_)),_&&Y&2048&&oy(T.alternate,T);break;case 24:wc(x,T,M,H,_),_&&Y&2048&&ay(T.alternate,T);break;default:wc(x,T,M,H,_)}a=a.sibling}}function Pd(r,a){if(a.subtreeFlags&10256)for(a=a.child;a!==null;){var u=r,f=a,_=f.flags;switch(f.tag){case 22:Pd(u,f),_&2048&&oy(f.alternate,f);break;case 24:Pd(u,f),_&2048&&ay(f.alternate,f);break;default:Pd(u,f)}a=a.sibling}}var Od=8192;function xc(r,a,u){if(r.subtreeFlags&Od)for(r=r.child;r!==null;)gE(r,a,u),r=r.sibling}function gE(r,a,u){switch(r.tag){case 26:xc(r,a,u),r.flags&Od&&r.memoizedState!==null&&TI(u,ns,r.memoizedState,r.memoizedProps);break;case 5:xc(r,a,u);break;case 3:case 4:var f=ns;ns=Em(r.stateNode.containerInfo),xc(r,a,u),ns=f;break;case 22:r.memoizedState===null&&(f=r.alternate,f!==null&&f.memoizedState!==null?(f=Od,Od=16777216,xc(r,a,u),Od=f):xc(r,a,u));break;default:xc(r,a,u)}}function vE(r){var a=r.alternate;if(a!==null&&(r=a.child,r!==null)){a.child=null;do a=r.sibling,r.sibling=null,r=a;while(r!==null)}}function Ud(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var f=a[u];dn=f,bE(f,r)}vE(r)}if(r.subtreeFlags&10256)for(r=r.child;r!==null;)yE(r),r=r.sibling}function yE(r){switch(r.tag){case 0:case 11:case 15:Ud(r),r.flags&2048&&_o(9,r,r.return);break;case 3:Ud(r);break;case 12:Ud(r);break;case 22:var a=r.stateNode;r.memoizedState!==null&&a._visibility&2&&(r.return===null||r.return.tag!==13)?(a._visibility&=-3,dm(r)):Ud(r);break;default:Ud(r)}}function dm(r){var a=r.deletions;if((r.flags&16)!==0){if(a!==null)for(var u=0;u<a.length;u++){var f=a[u];dn=f,bE(f,r)}vE(r)}for(r=r.child;r!==null;){switch(a=r,a.tag){case 0:case 11:case 15:_o(8,a,a.return),dm(a);break;case 22:u=a.stateNode,u._visibility&2&&(u._visibility&=-3,dm(a));break;default:dm(a)}r=r.sibling}}function bE(r,a){for(;dn!==null;){var u=dn;switch(u.tag){case 0:case 11:case 15:_o(8,u,a);break;case 23:case 22:if(u.memoizedState!==null&&u.memoizedState.cachePool!==null){var f=u.memoizedState.cachePool.pool;f!=null&&f.refCount++}break;case 24:_d(u.memoizedState.cache)}if(f=u.child,f!==null)f.return=u,dn=f;else e:for(u=r;dn!==null;){f=dn;var _=f.sibling,x=f.return;if(cE(f),f===u){dn=null;break e}if(_!==null){_.return=x,dn=_;break e}dn=x}}}var j2={getCacheForType:function(r){var a=bn(Yt),u=a.data.get(r);return u===void 0&&(u=r(),a.data.set(r,u)),u},cacheSignal:function(){return bn(Yt).controller.signal}},q2=typeof WeakMap=="function"?WeakMap:Map,dt=0,Et=null,Ke=null,Ze=0,pt=0,vi=null,wo=!1,Sc=!1,ly=!1,gr=0,Ot=0,xo=0,ka=0,cy=0,yi=0,Ec=0,Fd=null,ii=null,uy=!1,hm=0,_E=0,fm=1/0,pm=null,So=null,tn=0,Eo=null,Ac=null,vr=0,dy=0,hy=null,wE=null,Hd=0,fy=null;function bi(){return(dt&2)!==0&&Ze!==0?Ze&-Ze:z.T!==null?by():Uw()}function xE(){if(yi===0)if((Ze&536870912)===0||tt){var r=xp;xp<<=1,(xp&3932160)===0&&(xp=262144),yi=r}else yi=536870912;return r=mi.current,r!==null&&(r.flags|=32),yi}function si(r,a,u){(r===Et&&(pt===2||pt===9)||r.cancelPendingCommit!==null)&&(Tc(r,0),Ao(r,Ze,yi,!1)),od(r,u),((dt&2)===0||r!==Et)&&(r===Et&&((dt&2)===0&&(ka|=u),Ot===4&&Ao(r,Ze,yi,!1)),Is(r))}function SE(r,a,u){if((dt&6)!==0)throw Error(n(327));var f=!u&&(a&127)===0&&(a&r.expiredLanes)===0||rd(r,a),_=f?z2(r,a):my(r,a,!0),x=f;do{if(_===0){Sc&&!f&&Ao(r,a,0,!1);break}else{if(u=r.current.alternate,x&&!G2(u)){_=my(r,a,!1),x=!1;continue}if(_===2){if(x=a,r.errorRecoveryDisabledLanes&x)var T=0;else T=r.pendingLanes&-536870913,T=T!==0?T:T&536870912?536870912:0;if(T!==0){a=T;e:{var M=r;_=Fd;var H=M.current.memoizedState.isDehydrated;if(H&&(Tc(M,T).flags|=256),T=my(M,T,!1),T!==2){if(ly&&!H){M.errorRecoveryDisabledLanes|=x,ka|=x,_=4;break e}x=ii,ii=_,x!==null&&(ii===null?ii=x:ii.push.apply(ii,x))}_=T}if(x=!1,_!==2)continue}}if(_===1){Tc(r,0),Ao(r,a,0,!0);break}e:{switch(f=r,x=_,x){case 0:case 1:throw Error(n(345));case 4:if((a&4194048)!==a)break;case 6:Ao(f,a,yi,!wo);break e;case 2:ii=null;break;case 3:case 5:break;default:throw Error(n(329))}if((a&62914560)===a&&(_=hm+300-Ie(),10<_)){if(Ao(f,a,yi,!wo),Ep(f,0,!0)!==0)break e;vr=a,f.timeoutHandle=eA(EE.bind(null,f,u,ii,pm,uy,a,yi,ka,Ec,wo,x,"Throttled",-0,0),_);break e}EE(f,u,ii,pm,uy,a,yi,ka,Ec,wo,x,null,-0,0)}}break}while(!0);Is(r)}function EE(r,a,u,f,_,x,T,M,H,Y,Z,re,J,W){if(r.timeoutHandle=-1,re=a.subtreeFlags,re&8192||(re&16785408)===16785408){re={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:nr},gE(a,x,re);var be=(x&62914560)===x?hm-Ie():(x&4194048)===x?_E-Ie():0;if(be=CI(re,be),be!==null){vr=x,r.cancelPendingCommit=be(ME.bind(null,r,a,x,u,f,_,T,M,H,Z,re,null,J,W)),Ao(r,x,T,!Y);return}}ME(r,a,x,u,f,_,T,M,H)}function G2(r){for(var a=r;;){var u=a.tag;if((u===0||u===11||u===15)&&a.flags&16384&&(u=a.updateQueue,u!==null&&(u=u.stores,u!==null)))for(var f=0;f<u.length;f++){var _=u[f],x=_.getSnapshot;_=_.value;try{if(!fi(x(),_))return!1}catch{return!1}}if(u=a.child,a.subtreeFlags&16384&&u!==null)u.return=a,a=u;else{if(a===r)break;for(;a.sibling===null;){if(a.return===null||a.return===r)return!0;a=a.return}a.sibling.return=a.return,a=a.sibling}}return!0}function Ao(r,a,u,f){a&=~cy,a&=~ka,r.suspendedLanes|=a,r.pingedLanes&=~a,f&&(r.warmLanes|=a),f=r.expirationTimes;for(var _=a;0<_;){var x=31-Ce(_),T=1<<x;f[x]=-1,_&=~T}u!==0&&Lw(r,u,a)}function mm(){return(dt&6)===0?(Bd(0),!1):!0}function py(){if(Ke!==null){if(pt===0)var r=Ke.return;else r=Ke,or=wa=null,kv(r),gc=null,xd=0,r=Ke;for(;r!==null;)tE(r.alternate,r),r=r.return;Ke=null}}function Tc(r,a){var u=r.timeoutHandle;u!==-1&&(r.timeoutHandle=-1,cI(u)),u=r.cancelPendingCommit,u!==null&&(r.cancelPendingCommit=null,u()),vr=0,py(),Et=r,Ke=u=sr(r.current,null),Ze=a,pt=0,vi=null,wo=!1,Sc=rd(r,a),ly=!1,Ec=yi=cy=ka=xo=Ot=0,ii=Fd=null,uy=!1,(a&8)!==0&&(a|=a&32);var f=r.entangledLanes;if(f!==0)for(r=r.entanglements,f&=a;0<f;){var _=31-Ce(f),x=1<<_;a|=r[_],f&=~x}return gr=a,Op(),u}function AE(r,a){Ge=null,z.H=kd,a===mc||a===Vp?(a=jx(),pt=3):a===yv?(a=jx(),pt=4):pt=a===$v?8:a!==null&&typeof a=="object"&&typeof a.then=="function"?6:1,vi=a,Ke===null&&(Ot=1,sm(r,Hi(a,r.current)))}function TE(){var r=mi.current;return r===null?!0:(Ze&4194048)===Ze?Gi===null:(Ze&62914560)===Ze||(Ze&536870912)!==0?r===Gi:!1}function CE(){var r=z.H;return z.H=kd,r===null?kd:r}function RE(){var r=z.A;return z.A=j2,r}function gm(){Ot=4,wo||(Ze&4194048)!==Ze&&mi.current!==null||(Sc=!0),(xo&134217727)===0&&(ka&134217727)===0||Et===null||Ao(Et,Ze,yi,!1)}function my(r,a,u){var f=dt;dt|=2;var _=CE(),x=RE();(Et!==r||Ze!==a)&&(pm=null,Tc(r,a)),a=!1;var T=Ot;e:do try{if(pt!==0&&Ke!==null){var M=Ke,H=vi;switch(pt){case 8:py(),T=6;break e;case 3:case 2:case 9:case 6:mi.current===null&&(a=!0);var Y=pt;if(pt=0,vi=null,Cc(r,M,H,Y),u&&Sc){T=0;break e}break;default:Y=pt,pt=0,vi=null,Cc(r,M,H,Y)}}V2(),T=Ot;break}catch(Z){AE(r,Z)}while(!0);return a&&r.shellSuspendCounter++,or=wa=null,dt=f,z.H=_,z.A=x,Ke===null&&(Et=null,Ze=0,Op()),T}function V2(){for(;Ke!==null;)NE(Ke)}function z2(r,a){var u=dt;dt|=2;var f=CE(),_=RE();Et!==r||Ze!==a?(pm=null,fm=Ie()+500,Tc(r,a)):Sc=rd(r,a);e:do try{if(pt!==0&&Ke!==null){a=Ke;var x=vi;t:switch(pt){case 1:pt=0,vi=null,Cc(r,a,x,1);break;case 2:case 9:if(Hx(x)){pt=0,vi=null,kE(a);break}a=function(){pt!==2&&pt!==9||Et!==r||(pt=7),Is(r)},x.then(a,a);break e;case 3:pt=7;break e;case 4:pt=5;break e;case 7:Hx(x)?(pt=0,vi=null,kE(a)):(pt=0,vi=null,Cc(r,a,x,7));break;case 5:var T=null;switch(Ke.tag){case 26:T=Ke.memoizedState;case 5:case 27:var M=Ke;if(T?mA(T):M.stateNode.complete){pt=0,vi=null;var H=M.sibling;if(H!==null)Ke=H;else{var Y=M.return;Y!==null?(Ke=Y,vm(Y)):Ke=null}break t}}pt=0,vi=null,Cc(r,a,x,5);break;case 6:pt=0,vi=null,Cc(r,a,x,6);break;case 8:py(),Ot=6;break e;default:throw Error(n(462))}}$2();break}catch(Z){AE(r,Z)}while(!0);return or=wa=null,z.H=f,z.A=_,dt=u,Ke!==null?0:(Et=null,Ze=0,Op(),Ot)}function $2(){for(;Ke!==null&&!He();)NE(Ke)}function NE(r){var a=ZS(r.alternate,r,gr);r.memoizedProps=r.pendingProps,a===null?vm(r):Ke=a}function kE(r){var a=r,u=a.alternate;switch(a.tag){case 15:case 0:a=YS(u,a,a.pendingProps,a.type,void 0,Ze);break;case 11:a=YS(u,a,a.pendingProps,a.type.render,a.ref,Ze);break;case 5:kv(a);default:tE(u,a),a=Ke=Rx(a,gr),a=ZS(u,a,gr)}r.memoizedProps=r.pendingProps,a===null?vm(r):Ke=a}function Cc(r,a,u,f){or=wa=null,kv(a),gc=null,xd=0;var _=a.return;try{if(L2(r,_,a,u,Ze)){Ot=1,sm(r,Hi(u,r.current)),Ke=null;return}}catch(x){if(_!==null)throw Ke=_,x;Ot=1,sm(r,Hi(u,r.current)),Ke=null;return}a.flags&32768?(tt||f===1?r=!0:Sc||(Ze&536870912)!==0?r=!1:(wo=r=!0,(f===2||f===9||f===3||f===6)&&(f=mi.current,f!==null&&f.tag===13&&(f.flags|=16384))),IE(a,r)):vm(a)}function vm(r){var a=r;do{if((a.flags&32768)!==0){IE(a,wo);return}r=a.return;var u=U2(a.alternate,a,gr);if(u!==null){Ke=u;return}if(a=a.sibling,a!==null){Ke=a;return}Ke=a=r}while(a!==null);Ot===0&&(Ot=5)}function IE(r,a){do{var u=F2(r.alternate,r);if(u!==null){u.flags&=32767,Ke=u;return}if(u=r.return,u!==null&&(u.flags|=32768,u.subtreeFlags=0,u.deletions=null),!a&&(r=r.sibling,r!==null)){Ke=r;return}Ke=r=u}while(r!==null);Ot=6,Ke=null}function ME(r,a,u,f,_,x,T,M,H){r.cancelPendingCommit=null;do ym();while(tn!==0);if((dt&6)!==0)throw Error(n(327));if(a!==null){if(a===r.current)throw Error(n(177));if(x=a.lanes|a.childLanes,x|=iv,Ak(r,u,x,T,M,H),r===Et&&(Ke=Et=null,Ze=0),Ac=a,Eo=r,vr=u,dy=x,hy=_,wE=f,(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?(r.callbackNode=null,r.callbackPriority=0,W2(hi,function(){return UE(),null})):(r.callbackNode=null,r.callbackPriority=0),f=(a.flags&13878)!==0,(a.subtreeFlags&13878)!==0||f){f=z.T,z.T=null,_=X.p,X.p=2,T=dt,dt|=4;try{H2(r,a,u)}finally{dt=T,X.p=_,z.T=f}}tn=1,DE(),LE(),PE()}}function DE(){if(tn===1){tn=0;var r=Eo,a=Ac,u=(a.flags&13878)!==0;if((a.subtreeFlags&13878)!==0||u){u=z.T,z.T=null;var f=X.p;X.p=2;var _=dt;dt|=4;try{fE(a,r);var x=Cy,T=bx(r.containerInfo),M=x.focusedElem,H=x.selectionRange;if(T!==M&&M&&M.ownerDocument&&yx(M.ownerDocument.documentElement,M)){if(H!==null&&Q0(M)){var Y=H.start,Z=H.end;if(Z===void 0&&(Z=Y),"selectionStart"in M)M.selectionStart=Y,M.selectionEnd=Math.min(Z,M.value.length);else{var re=M.ownerDocument||document,J=re&&re.defaultView||window;if(J.getSelection){var W=J.getSelection(),be=M.textContent.length,Me=Math.min(H.start,be),_t=H.end===void 0?Me:Math.min(H.end,be);!W.extend&&Me>_t&&(T=_t,_t=Me,Me=T);var q=vx(M,Me),j=vx(M,_t);if(q&&j&&(W.rangeCount!==1||W.anchorNode!==q.node||W.anchorOffset!==q.offset||W.focusNode!==j.node||W.focusOffset!==j.offset)){var $=re.createRange();$.setStart(q.node,q.offset),W.removeAllRanges(),Me>_t?(W.addRange($),W.extend(j.node,j.offset)):($.setEnd(j.node,j.offset),W.addRange($))}}}}for(re=[],W=M;W=W.parentNode;)W.nodeType===1&&re.push({element:W,left:W.scrollLeft,top:W.scrollTop});for(typeof M.focus=="function"&&M.focus(),M=0;M<re.length;M++){var ie=re[M];ie.element.scrollLeft=ie.left,ie.element.scrollTop=ie.top}}km=!!Ty,Cy=Ty=null}finally{dt=_,X.p=f,z.T=u}}r.current=a,tn=2}}function LE(){if(tn===2){tn=0;var r=Eo,a=Ac,u=(a.flags&8772)!==0;if((a.subtreeFlags&8772)!==0||u){u=z.T,z.T=null;var f=X.p;X.p=2;var _=dt;dt|=4;try{lE(r,a.alternate,a)}finally{dt=_,X.p=f,z.T=u}}tn=3}}function PE(){if(tn===4||tn===3){tn=0,ut();var r=Eo,a=Ac,u=vr,f=wE;(a.subtreeFlags&10256)!==0||(a.flags&10256)!==0?tn=5:(tn=0,Ac=Eo=null,OE(r,r.pendingLanes));var _=r.pendingLanes;if(_===0&&(So=null),D0(u),a=a.stateNode,Ae&&typeof Ae.onCommitFiberRoot=="function")try{Ae.onCommitFiberRoot(ye,a,void 0,(a.current.flags&128)===128)}catch{}if(f!==null){a=z.T,_=X.p,X.p=2,z.T=null;try{for(var x=r.onRecoverableError,T=0;T<f.length;T++){var M=f[T];x(M.value,{componentStack:M.stack})}}finally{z.T=a,X.p=_}}(vr&3)!==0&&ym(),Is(r),_=r.pendingLanes,(u&261930)!==0&&(_&42)!==0?r===fy?Hd++:(Hd=0,fy=r):Hd=0,Bd(0)}}function OE(r,a){(r.pooledCacheLanes&=a)===0&&(a=r.pooledCache,a!=null&&(r.pooledCache=null,_d(a)))}function ym(){return DE(),LE(),PE(),UE()}function UE(){if(tn!==5)return!1;var r=Eo,a=dy;dy=0;var u=D0(vr),f=z.T,_=X.p;try{X.p=32>u?32:u,z.T=null,u=hy,hy=null;var x=Eo,T=vr;if(tn=0,Ac=Eo=null,vr=0,(dt&6)!==0)throw Error(n(331));var M=dt;if(dt|=4,yE(x.current),mE(x,x.current,T,u),dt=M,Bd(0,!1),Ae&&typeof Ae.onPostCommitFiberRoot=="function")try{Ae.onPostCommitFiberRoot(ye,x)}catch{}return!0}finally{X.p=_,z.T=f,OE(r,a)}}function FE(r,a,u){a=Hi(u,a),a=zv(r.stateNode,a,2),r=vo(r,a,2),r!==null&&(od(r,2),Is(r))}function mt(r,a,u){if(r.tag===3)FE(r,r,u);else for(;a!==null;){if(a.tag===3){FE(a,r,u);break}else if(a.tag===1){var f=a.stateNode;if(typeof a.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(So===null||!So.has(f))){r=Hi(u,r),u=HS(2),f=vo(a,u,2),f!==null&&(BS(u,f,a,r),od(f,2),Is(f));break}}a=a.return}}function gy(r,a,u){var f=r.pingCache;if(f===null){f=r.pingCache=new q2;var _=new Set;f.set(a,_)}else _=f.get(a),_===void 0&&(_=new Set,f.set(a,_));_.has(u)||(ly=!0,_.add(u),r=Y2.bind(null,r,a,u),a.then(r,r))}function Y2(r,a,u){var f=r.pingCache;f!==null&&f.delete(a),r.pingedLanes|=r.suspendedLanes&u,r.warmLanes&=~u,Et===r&&(Ze&u)===u&&(Ot===4||Ot===3&&(Ze&62914560)===Ze&&300>Ie()-hm?(dt&2)===0&&Tc(r,0):cy|=u,Ec===Ze&&(Ec=0)),Is(r)}function HE(r,a){a===0&&(a=Dw()),r=ya(r,a),r!==null&&(od(r,a),Is(r))}function J2(r){var a=r.memoizedState,u=0;a!==null&&(u=a.retryLane),HE(r,u)}function K2(r,a){var u=0;switch(r.tag){case 31:case 13:var f=r.stateNode,_=r.memoizedState;_!==null&&(u=_.retryLane);break;case 19:f=r.stateNode;break;case 22:f=r.stateNode._retryCache;break;default:throw Error(n(314))}f!==null&&f.delete(a),HE(r,u)}function W2(r,a){return ha(r,a)}var bm=null,Rc=null,vy=!1,_m=!1,yy=!1,To=0;function Is(r){r!==Rc&&r.next===null&&(Rc===null?bm=Rc=r:Rc=Rc.next=r),_m=!0,vy||(vy=!0,Q2())}function Bd(r,a){if(!yy&&_m){yy=!0;do for(var u=!1,f=bm;f!==null;){if(r!==0){var _=f.pendingLanes;if(_===0)var x=0;else{var T=f.suspendedLanes,M=f.pingedLanes;x=(1<<31-Ce(42|r)+1)-1,x&=_&~(T&~M),x=x&201326741?x&201326741|1:x?x|2:0}x!==0&&(u=!0,GE(f,x))}else x=Ze,x=Ep(f,f===Et?x:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),(x&3)===0||rd(f,x)||(u=!0,GE(f,x));f=f.next}while(u);yy=!1}}function X2(){BE()}function BE(){_m=vy=!1;var r=0;To!==0&&lI()&&(r=To);for(var a=Ie(),u=null,f=bm;f!==null;){var _=f.next,x=jE(f,a);x===0?(f.next=null,u===null?bm=_:u.next=_,_===null&&(Rc=u)):(u=f,(r!==0||(x&3)!==0)&&(_m=!0)),f=_}tn!==0&&tn!==5||Bd(r),To!==0&&(To=0)}function jE(r,a){for(var u=r.suspendedLanes,f=r.pingedLanes,_=r.expirationTimes,x=r.pendingLanes&-62914561;0<x;){var T=31-Ce(x),M=1<<T,H=_[T];H===-1?((M&u)===0||(M&f)!==0)&&(_[T]=Ek(M,a)):H<=a&&(r.expiredLanes|=M),x&=~M}if(a=Et,u=Ze,u=Ep(r,r===a?u:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f=r.callbackNode,u===0||r===a&&(pt===2||pt===9)||r.cancelPendingCommit!==null)return f!==null&&f!==null&&ae(f),r.callbackNode=null,r.callbackPriority=0;if((u&3)===0||rd(r,u)){if(a=u&-u,a===r.callbackPriority)return a;switch(f!==null&&ae(f),D0(u)){case 2:case 8:u=Cs;break;case 32:u=hi;break;case 268435456:u=qn;break;default:u=hi}return f=qE.bind(null,r),u=ha(u,f),r.callbackPriority=a,r.callbackNode=u,a}return f!==null&&f!==null&&ae(f),r.callbackPriority=2,r.callbackNode=null,2}function qE(r,a){if(tn!==0&&tn!==5)return r.callbackNode=null,r.callbackPriority=0,null;var u=r.callbackNode;if(ym()&&r.callbackNode!==u)return null;var f=Ze;return f=Ep(r,r===Et?f:0,r.cancelPendingCommit!==null||r.timeoutHandle!==-1),f===0?null:(SE(r,f,a),jE(r,Ie()),r.callbackNode!=null&&r.callbackNode===u?qE.bind(null,r):null)}function GE(r,a){if(ym())return null;SE(r,a,!0)}function Q2(){uI(function(){(dt&6)!==0?ha(Mt,X2):BE()})}function by(){if(To===0){var r=fc;r===0&&(r=en,en<<=1,(en&261888)===0&&(en=256)),To=r}return To}function VE(r){return r==null||typeof r=="symbol"||typeof r=="boolean"?null:typeof r=="function"?r:Rp(""+r)}function zE(r,a){var u=a.ownerDocument.createElement("input");return u.name=a.name,u.value=a.value,r.id&&u.setAttribute("form",r.id),a.parentNode.insertBefore(u,a),r=new FormData(r),u.parentNode.removeChild(u),r}function Z2(r,a,u,f,_){if(a==="submit"&&u&&u.stateNode===_){var x=VE((_[Qn]||null).action),T=f.submitter;T&&(a=(a=T[Qn]||null)?VE(a.formAction):T.getAttribute("formAction"),a!==null&&(x=a,T=null));var M=new Mp("action","action",null,f,_);r.push({event:M,listeners:[{instance:null,listener:function(){if(f.defaultPrevented){if(To!==0){var H=T?zE(_,T):new FormData(_);Hv(u,{pending:!0,data:H,method:_.method,action:x},null,H)}}else typeof x=="function"&&(M.preventDefault(),H=T?zE(_,T):new FormData(_),Hv(u,{pending:!0,data:H,method:_.method,action:x},x,H))},currentTarget:_}]})}}for(var _y=0;_y<nv.length;_y++){var wy=nv[_y],eI=wy.toLowerCase(),tI=wy[0].toUpperCase()+wy.slice(1);ts(eI,"on"+tI)}ts(xx,"onAnimationEnd"),ts(Sx,"onAnimationIteration"),ts(Ex,"onAnimationStart"),ts("dblclick","onDoubleClick"),ts("focusin","onFocus"),ts("focusout","onBlur"),ts(v2,"onTransitionRun"),ts(y2,"onTransitionStart"),ts(b2,"onTransitionCancel"),ts(Ax,"onTransitionEnd"),Zl("onMouseEnter",["mouseout","mouseover"]),Zl("onMouseLeave",["mouseout","mouseover"]),Zl("onPointerEnter",["pointerout","pointerover"]),Zl("onPointerLeave",["pointerout","pointerover"]),pa("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),pa("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),pa("onBeforeInput",["compositionend","keypress","textInput","paste"]),pa("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),pa("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),pa("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var jd="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nI=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(jd));function $E(r,a){a=(a&4)!==0;for(var u=0;u<r.length;u++){var f=r[u],_=f.event;f=f.listeners;e:{var x=void 0;if(a)for(var T=f.length-1;0<=T;T--){var M=f[T],H=M.instance,Y=M.currentTarget;if(M=M.listener,H!==x&&_.isPropagationStopped())break e;x=M,_.currentTarget=Y;try{x(_)}catch(Z){Pp(Z)}_.currentTarget=null,x=H}else for(T=0;T<f.length;T++){if(M=f[T],H=M.instance,Y=M.currentTarget,M=M.listener,H!==x&&_.isPropagationStopped())break e;x=M,_.currentTarget=Y;try{x(_)}catch(Z){Pp(Z)}_.currentTarget=null,x=H}}}}function We(r,a){var u=a[L0];u===void 0&&(u=a[L0]=new Set);var f=r+"__bubble";u.has(f)||(YE(a,r,2,!1),u.add(f))}function xy(r,a,u){var f=0;a&&(f|=4),YE(u,r,f,a)}var wm="_reactListening"+Math.random().toString(36).slice(2);function Sy(r){if(!r[wm]){r[wm]=!0,Bw.forEach(function(u){u!=="selectionchange"&&(nI.has(u)||xy(u,!1,r),xy(u,!0,r))});var a=r.nodeType===9?r:r.ownerDocument;a===null||a[wm]||(a[wm]=!0,xy("selectionchange",!1,a))}}function YE(r,a,u,f){switch(xA(a)){case 2:var _=kI;break;case 8:_=II;break;default:_=Fy}u=_.bind(null,a,u,r),_=void 0,!G0||a!=="touchstart"&&a!=="touchmove"&&a!=="wheel"||(_=!0),f?_!==void 0?r.addEventListener(a,u,{capture:!0,passive:_}):r.addEventListener(a,u,!0):_!==void 0?r.addEventListener(a,u,{passive:_}):r.addEventListener(a,u,!1)}function Ey(r,a,u,f,_){var x=f;if((a&1)===0&&(a&2)===0&&f!==null)e:for(;;){if(f===null)return;var T=f.tag;if(T===3||T===4){var M=f.stateNode.containerInfo;if(M===_)break;if(T===4)for(T=f.return;T!==null;){var H=T.tag;if((H===3||H===4)&&T.stateNode.containerInfo===_)return;T=T.return}for(;M!==null;){if(T=Wl(M),T===null)return;if(H=T.tag,H===5||H===6||H===26||H===27){f=x=T;continue e}M=M.parentNode}}f=f.return}Qw(function(){var Y=x,Z=j0(u),re=[];e:{var J=Tx.get(r);if(J!==void 0){var W=Mp,be=r;switch(r){case"keypress":if(kp(u)===0)break e;case"keydown":case"keyup":W=Kk;break;case"focusin":be="focus",W=Y0;break;case"focusout":be="blur",W=Y0;break;case"beforeblur":case"afterblur":W=Y0;break;case"click":if(u.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":W=tx;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":W=Uk;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":W=Qk;break;case xx:case Sx:case Ex:W=Bk;break;case Ax:W=e2;break;case"scroll":case"scrollend":W=Pk;break;case"wheel":W=n2;break;case"copy":case"cut":case"paste":W=qk;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":W=ix;break;case"toggle":case"beforetoggle":W=s2}var Me=(a&4)!==0,_t=!Me&&(r==="scroll"||r==="scrollend"),q=Me?J!==null?J+"Capture":null:J;Me=[];for(var j=Y,$;j!==null;){var ie=j;if($=ie.stateNode,ie=ie.tag,ie!==5&&ie!==26&&ie!==27||$===null||q===null||(ie=cd(j,q),ie!=null&&Me.push(qd(j,ie,$))),_t)break;j=j.return}0<Me.length&&(J=new W(J,be,null,u,Z),re.push({event:J,listeners:Me}))}}if((a&7)===0){e:{if(J=r==="mouseover"||r==="pointerover",W=r==="mouseout"||r==="pointerout",J&&u!==B0&&(be=u.relatedTarget||u.fromElement)&&(Wl(be)||be[Kl]))break e;if((W||J)&&(J=Z.window===Z?Z:(J=Z.ownerDocument)?J.defaultView||J.parentWindow:window,W?(be=u.relatedTarget||u.toElement,W=Y,be=be?Wl(be):null,be!==null&&(_t=o(be),Me=be.tag,be!==_t||Me!==5&&Me!==27&&Me!==6)&&(be=null)):(W=null,be=Y),W!==be)){if(Me=tx,ie="onMouseLeave",q="onMouseEnter",j="mouse",(r==="pointerout"||r==="pointerover")&&(Me=ix,ie="onPointerLeave",q="onPointerEnter",j="pointer"),_t=W==null?J:ld(W),$=be==null?J:ld(be),J=new Me(ie,j+"leave",W,u,Z),J.target=_t,J.relatedTarget=$,ie=null,Wl(Z)===Y&&(Me=new Me(q,j+"enter",be,u,Z),Me.target=$,Me.relatedTarget=_t,ie=Me),_t=ie,W&&be)t:{for(Me=iI,q=W,j=be,$=0,ie=q;ie;ie=Me(ie))$++;ie=0;for(var Re=j;Re;Re=Me(Re))ie++;for(;0<$-ie;)q=Me(q),$--;for(;0<ie-$;)j=Me(j),ie--;for(;$--;){if(q===j||j!==null&&q===j.alternate){Me=q;break t}q=Me(q),j=Me(j)}Me=null}else Me=null;W!==null&&JE(re,J,W,Me,!1),be!==null&&_t!==null&&JE(re,_t,be,Me,!0)}}e:{if(J=Y?ld(Y):window,W=J.nodeName&&J.nodeName.toLowerCase(),W==="select"||W==="input"&&J.type==="file")var rt=dx;else if(cx(J))if(hx)rt=p2;else{rt=h2;var we=d2}else W=J.nodeName,!W||W.toLowerCase()!=="input"||J.type!=="checkbox"&&J.type!=="radio"?Y&&H0(Y.elementType)&&(rt=dx):rt=f2;if(rt&&(rt=rt(r,Y))){ux(re,rt,u,Z);break e}we&&we(r,J,Y),r==="focusout"&&Y&&J.type==="number"&&Y.memoizedProps.value!=null&&F0(J,"number",J.value)}switch(we=Y?ld(Y):window,r){case"focusin":(cx(we)||we.contentEditable==="true")&&(rc=we,Z0=Y,vd=null);break;case"focusout":vd=Z0=rc=null;break;case"mousedown":ev=!0;break;case"contextmenu":case"mouseup":case"dragend":ev=!1,_x(re,u,Z);break;case"selectionchange":if(g2)break;case"keydown":case"keyup":_x(re,u,Z)}var ze;if(K0)e:{switch(r){case"compositionstart":var et="onCompositionStart";break e;case"compositionend":et="onCompositionEnd";break e;case"compositionupdate":et="onCompositionUpdate";break e}et=void 0}else sc?ax(r,u)&&(et="onCompositionEnd"):r==="keydown"&&u.keyCode===229&&(et="onCompositionStart");et&&(sx&&u.locale!=="ko"&&(sc||et!=="onCompositionStart"?et==="onCompositionEnd"&&sc&&(ze=Zw()):(co=Z,V0="value"in co?co.value:co.textContent,sc=!0)),we=xm(Y,et),0<we.length&&(et=new nx(et,r,null,u,Z),re.push({event:et,listeners:we}),ze?et.data=ze:(ze=lx(u),ze!==null&&(et.data=ze)))),(ze=o2?a2(r,u):l2(r,u))&&(et=xm(Y,"onBeforeInput"),0<et.length&&(we=new nx("onBeforeInput","beforeinput",null,u,Z),re.push({event:we,listeners:et}),we.data=ze)),Z2(re,r,Y,u,Z)}$E(re,a)})}function qd(r,a,u){return{instance:r,listener:a,currentTarget:u}}function xm(r,a){for(var u=a+"Capture",f=[];r!==null;){var _=r,x=_.stateNode;if(_=_.tag,_!==5&&_!==26&&_!==27||x===null||(_=cd(r,u),_!=null&&f.unshift(qd(r,_,x)),_=cd(r,a),_!=null&&f.push(qd(r,_,x))),r.tag===3)return f;r=r.return}return[]}function iI(r){if(r===null)return null;do r=r.return;while(r&&r.tag!==5&&r.tag!==27);return r||null}function JE(r,a,u,f,_){for(var x=a._reactName,T=[];u!==null&&u!==f;){var M=u,H=M.alternate,Y=M.stateNode;if(M=M.tag,H!==null&&H===f)break;M!==5&&M!==26&&M!==27||Y===null||(H=Y,_?(Y=cd(u,x),Y!=null&&T.unshift(qd(u,Y,H))):_||(Y=cd(u,x),Y!=null&&T.push(qd(u,Y,H)))),u=u.return}T.length!==0&&r.push({event:a,listeners:T})}var sI=/\r\n?/g,rI=/\u0000|\uFFFD/g;function KE(r){return(typeof r=="string"?r:""+r).replace(sI,`
`).replace(rI,"")}function WE(r,a){return a=KE(a),KE(r)===a}function bt(r,a,u,f,_,x){switch(u){case"children":typeof f=="string"?a==="body"||a==="textarea"&&f===""||tc(r,f):(typeof f=="number"||typeof f=="bigint")&&a!=="body"&&tc(r,""+f);break;case"className":Tp(r,"class",f);break;case"tabIndex":Tp(r,"tabindex",f);break;case"dir":case"role":case"viewBox":case"width":case"height":Tp(r,u,f);break;case"style":Ww(r,f,x);break;case"data":if(a!=="object"){Tp(r,"data",f);break}case"src":case"href":if(f===""&&(a!=="a"||u!=="href")){r.removeAttribute(u);break}if(f==null||typeof f=="function"||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(u);break}f=Rp(""+f),r.setAttribute(u,f);break;case"action":case"formAction":if(typeof f=="function"){r.setAttribute(u,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof x=="function"&&(u==="formAction"?(a!=="input"&&bt(r,a,"name",_.name,_,null),bt(r,a,"formEncType",_.formEncType,_,null),bt(r,a,"formMethod",_.formMethod,_,null),bt(r,a,"formTarget",_.formTarget,_,null)):(bt(r,a,"encType",_.encType,_,null),bt(r,a,"method",_.method,_,null),bt(r,a,"target",_.target,_,null)));if(f==null||typeof f=="symbol"||typeof f=="boolean"){r.removeAttribute(u);break}f=Rp(""+f),r.setAttribute(u,f);break;case"onClick":f!=null&&(r.onclick=nr);break;case"onScroll":f!=null&&We("scroll",r);break;case"onScrollEnd":f!=null&&We("scrollend",r);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(n(61));if(u=f.__html,u!=null){if(_.children!=null)throw Error(n(60));r.innerHTML=u}}break;case"multiple":r.multiple=f&&typeof f!="function"&&typeof f!="symbol";break;case"muted":r.muted=f&&typeof f!="function"&&typeof f!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(f==null||typeof f=="function"||typeof f=="boolean"||typeof f=="symbol"){r.removeAttribute("xlink:href");break}u=Rp(""+f),r.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",u);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(u,""+f):r.removeAttribute(u);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":f&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(u,""):r.removeAttribute(u);break;case"capture":case"download":f===!0?r.setAttribute(u,""):f!==!1&&f!=null&&typeof f!="function"&&typeof f!="symbol"?r.setAttribute(u,f):r.removeAttribute(u);break;case"cols":case"rows":case"size":case"span":f!=null&&typeof f!="function"&&typeof f!="symbol"&&!isNaN(f)&&1<=f?r.setAttribute(u,f):r.removeAttribute(u);break;case"rowSpan":case"start":f==null||typeof f=="function"||typeof f=="symbol"||isNaN(f)?r.removeAttribute(u):r.setAttribute(u,f);break;case"popover":We("beforetoggle",r),We("toggle",r),Ap(r,"popover",f);break;case"xlinkActuate":tr(r,"http://www.w3.org/1999/xlink","xlink:actuate",f);break;case"xlinkArcrole":tr(r,"http://www.w3.org/1999/xlink","xlink:arcrole",f);break;case"xlinkRole":tr(r,"http://www.w3.org/1999/xlink","xlink:role",f);break;case"xlinkShow":tr(r,"http://www.w3.org/1999/xlink","xlink:show",f);break;case"xlinkTitle":tr(r,"http://www.w3.org/1999/xlink","xlink:title",f);break;case"xlinkType":tr(r,"http://www.w3.org/1999/xlink","xlink:type",f);break;case"xmlBase":tr(r,"http://www.w3.org/XML/1998/namespace","xml:base",f);break;case"xmlLang":tr(r,"http://www.w3.org/XML/1998/namespace","xml:lang",f);break;case"xmlSpace":tr(r,"http://www.w3.org/XML/1998/namespace","xml:space",f);break;case"is":Ap(r,"is",f);break;case"innerText":case"textContent":break;default:(!(2<u.length)||u[0]!=="o"&&u[0]!=="O"||u[1]!=="n"&&u[1]!=="N")&&(u=Dk.get(u)||u,Ap(r,u,f))}}function Ay(r,a,u,f,_,x){switch(u){case"style":Ww(r,f,x);break;case"dangerouslySetInnerHTML":if(f!=null){if(typeof f!="object"||!("__html"in f))throw Error(n(61));if(u=f.__html,u!=null){if(_.children!=null)throw Error(n(60));r.innerHTML=u}}break;case"children":typeof f=="string"?tc(r,f):(typeof f=="number"||typeof f=="bigint")&&tc(r,""+f);break;case"onScroll":f!=null&&We("scroll",r);break;case"onScrollEnd":f!=null&&We("scrollend",r);break;case"onClick":f!=null&&(r.onclick=nr);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!jw.hasOwnProperty(u))e:{if(u[0]==="o"&&u[1]==="n"&&(_=u.endsWith("Capture"),a=u.slice(2,_?u.length-7:void 0),x=r[Qn]||null,x=x!=null?x[u]:null,typeof x=="function"&&r.removeEventListener(a,x,_),typeof f=="function")){typeof x!="function"&&x!==null&&(u in r?r[u]=null:r.hasAttribute(u)&&r.removeAttribute(u)),r.addEventListener(a,f,_);break e}u in r?r[u]=f:f===!0?r.setAttribute(u,""):Ap(r,u,f)}}}function wn(r,a,u){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":We("error",r),We("load",r);var f=!1,_=!1,x;for(x in u)if(u.hasOwnProperty(x)){var T=u[x];if(T!=null)switch(x){case"src":f=!0;break;case"srcSet":_=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:bt(r,a,x,T,u,null)}}_&&bt(r,a,"srcSet",u.srcSet,u,null),f&&bt(r,a,"src",u.src,u,null);return;case"input":We("invalid",r);var M=x=T=_=null,H=null,Y=null;for(f in u)if(u.hasOwnProperty(f)){var Z=u[f];if(Z!=null)switch(f){case"name":_=Z;break;case"type":T=Z;break;case"checked":H=Z;break;case"defaultChecked":Y=Z;break;case"value":x=Z;break;case"defaultValue":M=Z;break;case"children":case"dangerouslySetInnerHTML":if(Z!=null)throw Error(n(137,a));break;default:bt(r,a,f,Z,u,null)}}$w(r,x,M,H,Y,T,_,!1);return;case"select":We("invalid",r),f=T=x=null;for(_ in u)if(u.hasOwnProperty(_)&&(M=u[_],M!=null))switch(_){case"value":x=M;break;case"defaultValue":T=M;break;case"multiple":f=M;default:bt(r,a,_,M,u,null)}a=x,u=T,r.multiple=!!f,a!=null?ec(r,!!f,a,!1):u!=null&&ec(r,!!f,u,!0);return;case"textarea":We("invalid",r),x=_=f=null;for(T in u)if(u.hasOwnProperty(T)&&(M=u[T],M!=null))switch(T){case"value":f=M;break;case"defaultValue":_=M;break;case"children":x=M;break;case"dangerouslySetInnerHTML":if(M!=null)throw Error(n(91));break;default:bt(r,a,T,M,u,null)}Jw(r,f,_,x);return;case"option":for(H in u)if(u.hasOwnProperty(H)&&(f=u[H],f!=null))switch(H){case"selected":r.selected=f&&typeof f!="function"&&typeof f!="symbol";break;default:bt(r,a,H,f,u,null)}return;case"dialog":We("beforetoggle",r),We("toggle",r),We("cancel",r),We("close",r);break;case"iframe":case"object":We("load",r);break;case"video":case"audio":for(f=0;f<jd.length;f++)We(jd[f],r);break;case"image":We("error",r),We("load",r);break;case"details":We("toggle",r);break;case"embed":case"source":case"link":We("error",r),We("load",r);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Y in u)if(u.hasOwnProperty(Y)&&(f=u[Y],f!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,a));default:bt(r,a,Y,f,u,null)}return;default:if(H0(a)){for(Z in u)u.hasOwnProperty(Z)&&(f=u[Z],f!==void 0&&Ay(r,a,Z,f,u,void 0));return}}for(M in u)u.hasOwnProperty(M)&&(f=u[M],f!=null&&bt(r,a,M,f,u,null))}function oI(r,a,u,f){switch(a){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var _=null,x=null,T=null,M=null,H=null,Y=null,Z=null;for(W in u){var re=u[W];if(u.hasOwnProperty(W)&&re!=null)switch(W){case"checked":break;case"value":break;case"defaultValue":H=re;default:f.hasOwnProperty(W)||bt(r,a,W,null,f,re)}}for(var J in f){var W=f[J];if(re=u[J],f.hasOwnProperty(J)&&(W!=null||re!=null))switch(J){case"type":x=W;break;case"name":_=W;break;case"checked":Y=W;break;case"defaultChecked":Z=W;break;case"value":T=W;break;case"defaultValue":M=W;break;case"children":case"dangerouslySetInnerHTML":if(W!=null)throw Error(n(137,a));break;default:W!==re&&bt(r,a,J,W,f,re)}}U0(r,T,M,H,Y,Z,x,_);return;case"select":W=T=M=J=null;for(x in u)if(H=u[x],u.hasOwnProperty(x)&&H!=null)switch(x){case"value":break;case"multiple":W=H;default:f.hasOwnProperty(x)||bt(r,a,x,null,f,H)}for(_ in f)if(x=f[_],H=u[_],f.hasOwnProperty(_)&&(x!=null||H!=null))switch(_){case"value":J=x;break;case"defaultValue":M=x;break;case"multiple":T=x;default:x!==H&&bt(r,a,_,x,f,H)}a=M,u=T,f=W,J!=null?ec(r,!!u,J,!1):!!f!=!!u&&(a!=null?ec(r,!!u,a,!0):ec(r,!!u,u?[]:"",!1));return;case"textarea":W=J=null;for(M in u)if(_=u[M],u.hasOwnProperty(M)&&_!=null&&!f.hasOwnProperty(M))switch(M){case"value":break;case"children":break;default:bt(r,a,M,null,f,_)}for(T in f)if(_=f[T],x=u[T],f.hasOwnProperty(T)&&(_!=null||x!=null))switch(T){case"value":J=_;break;case"defaultValue":W=_;break;case"children":break;case"dangerouslySetInnerHTML":if(_!=null)throw Error(n(91));break;default:_!==x&&bt(r,a,T,_,f,x)}Yw(r,J,W);return;case"option":for(var be in u)if(J=u[be],u.hasOwnProperty(be)&&J!=null&&!f.hasOwnProperty(be))switch(be){case"selected":r.selected=!1;break;default:bt(r,a,be,null,f,J)}for(H in f)if(J=f[H],W=u[H],f.hasOwnProperty(H)&&J!==W&&(J!=null||W!=null))switch(H){case"selected":r.selected=J&&typeof J!="function"&&typeof J!="symbol";break;default:bt(r,a,H,J,f,W)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Me in u)J=u[Me],u.hasOwnProperty(Me)&&J!=null&&!f.hasOwnProperty(Me)&&bt(r,a,Me,null,f,J);for(Y in f)if(J=f[Y],W=u[Y],f.hasOwnProperty(Y)&&J!==W&&(J!=null||W!=null))switch(Y){case"children":case"dangerouslySetInnerHTML":if(J!=null)throw Error(n(137,a));break;default:bt(r,a,Y,J,f,W)}return;default:if(H0(a)){for(var _t in u)J=u[_t],u.hasOwnProperty(_t)&&J!==void 0&&!f.hasOwnProperty(_t)&&Ay(r,a,_t,void 0,f,J);for(Z in f)J=f[Z],W=u[Z],!f.hasOwnProperty(Z)||J===W||J===void 0&&W===void 0||Ay(r,a,Z,J,f,W);return}}for(var q in u)J=u[q],u.hasOwnProperty(q)&&J!=null&&!f.hasOwnProperty(q)&&bt(r,a,q,null,f,J);for(re in f)J=f[re],W=u[re],!f.hasOwnProperty(re)||J===W||J==null&&W==null||bt(r,a,re,J,f,W)}function XE(r){switch(r){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}function aI(){if(typeof performance.getEntriesByType=="function"){for(var r=0,a=0,u=performance.getEntriesByType("resource"),f=0;f<u.length;f++){var _=u[f],x=_.transferSize,T=_.initiatorType,M=_.duration;if(x&&M&&XE(T)){for(T=0,M=_.responseEnd,f+=1;f<u.length;f++){var H=u[f],Y=H.startTime;if(Y>M)break;var Z=H.transferSize,re=H.initiatorType;Z&&XE(re)&&(H=H.responseEnd,T+=Z*(H<M?1:(M-Y)/(H-Y)))}if(--f,a+=8*(x+T)/(_.duration/1e3),r++,10<r)break}}if(0<r)return a/r/1e6}return navigator.connection&&(r=navigator.connection.downlink,typeof r=="number")?r:5}var Ty=null,Cy=null;function Sm(r){return r.nodeType===9?r:r.ownerDocument}function QE(r){switch(r){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function ZE(r,a){if(r===0)switch(a){case"svg":return 1;case"math":return 2;default:return 0}return r===1&&a==="foreignObject"?0:r}function Ry(r,a){return r==="textarea"||r==="noscript"||typeof a.children=="string"||typeof a.children=="number"||typeof a.children=="bigint"||typeof a.dangerouslySetInnerHTML=="object"&&a.dangerouslySetInnerHTML!==null&&a.dangerouslySetInnerHTML.__html!=null}var Ny=null;function lI(){var r=window.event;return r&&r.type==="popstate"?r===Ny?!1:(Ny=r,!0):(Ny=null,!1)}var eA=typeof setTimeout=="function"?setTimeout:void 0,cI=typeof clearTimeout=="function"?clearTimeout:void 0,tA=typeof Promise=="function"?Promise:void 0,uI=typeof queueMicrotask=="function"?queueMicrotask:typeof tA<"u"?function(r){return tA.resolve(null).then(r).catch(dI)}:eA;function dI(r){setTimeout(function(){throw r})}function Co(r){return r==="head"}function nA(r,a){var u=a,f=0;do{var _=u.nextSibling;if(r.removeChild(u),_&&_.nodeType===8)if(u=_.data,u==="/$"||u==="/&"){if(f===0){r.removeChild(_),Mc(a);return}f--}else if(u==="$"||u==="$?"||u==="$~"||u==="$!"||u==="&")f++;else if(u==="html")Gd(r.ownerDocument.documentElement);else if(u==="head"){u=r.ownerDocument.head,Gd(u);for(var x=u.firstChild;x;){var T=x.nextSibling,M=x.nodeName;x[ad]||M==="SCRIPT"||M==="STYLE"||M==="LINK"&&x.rel.toLowerCase()==="stylesheet"||u.removeChild(x),x=T}}else u==="body"&&Gd(r.ownerDocument.body);u=_}while(u);Mc(a)}function iA(r,a){var u=r;r=0;do{var f=u.nextSibling;if(u.nodeType===1?a?(u._stashedDisplay=u.style.display,u.style.display="none"):(u.style.display=u._stashedDisplay||"",u.getAttribute("style")===""&&u.removeAttribute("style")):u.nodeType===3&&(a?(u._stashedText=u.nodeValue,u.nodeValue=""):u.nodeValue=u._stashedText||""),f&&f.nodeType===8)if(u=f.data,u==="/$"){if(r===0)break;r--}else u!=="$"&&u!=="$?"&&u!=="$~"&&u!=="$!"||r++;u=f}while(u)}function ky(r){var a=r.firstChild;for(a&&a.nodeType===10&&(a=a.nextSibling);a;){var u=a;switch(a=a.nextSibling,u.nodeName){case"HTML":case"HEAD":case"BODY":ky(u),P0(u);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(u.rel.toLowerCase()==="stylesheet")continue}r.removeChild(u)}}function hI(r,a,u,f){for(;r.nodeType===1;){var _=u;if(r.nodeName.toLowerCase()!==a.toLowerCase()){if(!f&&(r.nodeName!=="INPUT"||r.type!=="hidden"))break}else if(f){if(!r[ad])switch(a){case"meta":if(!r.hasAttribute("itemprop"))break;return r;case"link":if(x=r.getAttribute("rel"),x==="stylesheet"&&r.hasAttribute("data-precedence"))break;if(x!==_.rel||r.getAttribute("href")!==(_.href==null||_.href===""?null:_.href)||r.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin)||r.getAttribute("title")!==(_.title==null?null:_.title))break;return r;case"style":if(r.hasAttribute("data-precedence"))break;return r;case"script":if(x=r.getAttribute("src"),(x!==(_.src==null?null:_.src)||r.getAttribute("type")!==(_.type==null?null:_.type)||r.getAttribute("crossorigin")!==(_.crossOrigin==null?null:_.crossOrigin))&&x&&r.hasAttribute("async")&&!r.hasAttribute("itemprop"))break;return r;default:return r}}else if(a==="input"&&r.type==="hidden"){var x=_.name==null?null:""+_.name;if(_.type==="hidden"&&r.getAttribute("name")===x)return r}else return r;if(r=Vi(r.nextSibling),r===null)break}return null}function fI(r,a,u){if(a==="")return null;for(;r.nodeType!==3;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!u||(r=Vi(r.nextSibling),r===null))return null;return r}function sA(r,a){for(;r.nodeType!==8;)if((r.nodeType!==1||r.nodeName!=="INPUT"||r.type!=="hidden")&&!a||(r=Vi(r.nextSibling),r===null))return null;return r}function Iy(r){return r.data==="$?"||r.data==="$~"}function My(r){return r.data==="$!"||r.data==="$?"&&r.ownerDocument.readyState!=="loading"}function pI(r,a){var u=r.ownerDocument;if(r.data==="$~")r._reactRetry=a;else if(r.data!=="$?"||u.readyState!=="loading")a();else{var f=function(){a(),u.removeEventListener("DOMContentLoaded",f)};u.addEventListener("DOMContentLoaded",f),r._reactRetry=f}}function Vi(r){for(;r!=null;r=r.nextSibling){var a=r.nodeType;if(a===1||a===3)break;if(a===8){if(a=r.data,a==="$"||a==="$!"||a==="$?"||a==="$~"||a==="&"||a==="F!"||a==="F")break;if(a==="/$"||a==="/&")return null}}return r}var Dy=null;function rA(r){r=r.nextSibling;for(var a=0;r;){if(r.nodeType===8){var u=r.data;if(u==="/$"||u==="/&"){if(a===0)return Vi(r.nextSibling);a--}else u!=="$"&&u!=="$!"&&u!=="$?"&&u!=="$~"&&u!=="&"||a++}r=r.nextSibling}return null}function oA(r){r=r.previousSibling;for(var a=0;r;){if(r.nodeType===8){var u=r.data;if(u==="$"||u==="$!"||u==="$?"||u==="$~"||u==="&"){if(a===0)return r;a--}else u!=="/$"&&u!=="/&"||a++}r=r.previousSibling}return null}function aA(r,a,u){switch(a=Sm(u),r){case"html":if(r=a.documentElement,!r)throw Error(n(452));return r;case"head":if(r=a.head,!r)throw Error(n(453));return r;case"body":if(r=a.body,!r)throw Error(n(454));return r;default:throw Error(n(451))}}function Gd(r){for(var a=r.attributes;a.length;)r.removeAttributeNode(a[0]);P0(r)}var zi=new Map,lA=new Set;function Em(r){return typeof r.getRootNode=="function"?r.getRootNode():r.nodeType===9?r:r.ownerDocument}var yr=X.d;X.d={f:mI,r:gI,D:vI,C:yI,L:bI,m:_I,X:xI,S:wI,M:SI};function mI(){var r=yr.f(),a=mm();return r||a}function gI(r){var a=Xl(r);a!==null&&a.tag===5&&a.type==="form"?AS(a):yr.r(r)}var Nc=typeof document>"u"?null:document;function cA(r,a,u){var f=Nc;if(f&&typeof a=="string"&&a){var _=Ui(a);_='link[rel="'+r+'"][href="'+_+'"]',typeof u=="string"&&(_+='[crossorigin="'+u+'"]'),lA.has(_)||(lA.add(_),r={rel:r,crossOrigin:u,href:a},f.querySelector(_)===null&&(a=f.createElement("link"),wn(a,"link",r),un(a),f.head.appendChild(a)))}}function vI(r){yr.D(r),cA("dns-prefetch",r,null)}function yI(r,a){yr.C(r,a),cA("preconnect",r,a)}function bI(r,a,u){yr.L(r,a,u);var f=Nc;if(f&&r&&a){var _='link[rel="preload"][as="'+Ui(a)+'"]';a==="image"&&u&&u.imageSrcSet?(_+='[imagesrcset="'+Ui(u.imageSrcSet)+'"]',typeof u.imageSizes=="string"&&(_+='[imagesizes="'+Ui(u.imageSizes)+'"]')):_+='[href="'+Ui(r)+'"]';var x=_;switch(a){case"style":x=kc(r);break;case"script":x=Ic(r)}zi.has(x)||(r=y({rel:"preload",href:a==="image"&&u&&u.imageSrcSet?void 0:r,as:a},u),zi.set(x,r),f.querySelector(_)!==null||a==="style"&&f.querySelector(Vd(x))||a==="script"&&f.querySelector(zd(x))||(a=f.createElement("link"),wn(a,"link",r),un(a),f.head.appendChild(a)))}}function _I(r,a){yr.m(r,a);var u=Nc;if(u&&r){var f=a&&typeof a.as=="string"?a.as:"script",_='link[rel="modulepreload"][as="'+Ui(f)+'"][href="'+Ui(r)+'"]',x=_;switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":x=Ic(r)}if(!zi.has(x)&&(r=y({rel:"modulepreload",href:r},a),zi.set(x,r),u.querySelector(_)===null)){switch(f){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(u.querySelector(zd(x)))return}f=u.createElement("link"),wn(f,"link",r),un(f),u.head.appendChild(f)}}}function wI(r,a,u){yr.S(r,a,u);var f=Nc;if(f&&r){var _=Ql(f).hoistableStyles,x=kc(r);a=a||"default";var T=_.get(x);if(!T){var M={loading:0,preload:null};if(T=f.querySelector(Vd(x)))M.loading=5;else{r=y({rel:"stylesheet",href:r,"data-precedence":a},u),(u=zi.get(x))&&Ly(r,u);var H=T=f.createElement("link");un(H),wn(H,"link",r),H._p=new Promise(function(Y,Z){H.onload=Y,H.onerror=Z}),H.addEventListener("load",function(){M.loading|=1}),H.addEventListener("error",function(){M.loading|=2}),M.loading|=4,Am(T,a,f)}T={type:"stylesheet",instance:T,count:1,state:M},_.set(x,T)}}}function xI(r,a){yr.X(r,a);var u=Nc;if(u&&r){var f=Ql(u).hoistableScripts,_=Ic(r),x=f.get(_);x||(x=u.querySelector(zd(_)),x||(r=y({src:r,async:!0},a),(a=zi.get(_))&&Py(r,a),x=u.createElement("script"),un(x),wn(x,"link",r),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},f.set(_,x))}}function SI(r,a){yr.M(r,a);var u=Nc;if(u&&r){var f=Ql(u).hoistableScripts,_=Ic(r),x=f.get(_);x||(x=u.querySelector(zd(_)),x||(r=y({src:r,async:!0,type:"module"},a),(a=zi.get(_))&&Py(r,a),x=u.createElement("script"),un(x),wn(x,"link",r),u.head.appendChild(x)),x={type:"script",instance:x,count:1,state:null},f.set(_,x))}}function uA(r,a,u,f){var _=(_=ke.current)?Em(_):null;if(!_)throw Error(n(446));switch(r){case"meta":case"title":return null;case"style":return typeof u.precedence=="string"&&typeof u.href=="string"?(a=kc(u.href),u=Ql(_).hoistableStyles,f=u.get(a),f||(f={type:"style",instance:null,count:0,state:null},u.set(a,f)),f):{type:"void",instance:null,count:0,state:null};case"link":if(u.rel==="stylesheet"&&typeof u.href=="string"&&typeof u.precedence=="string"){r=kc(u.href);var x=Ql(_).hoistableStyles,T=x.get(r);if(T||(_=_.ownerDocument||_,T={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},x.set(r,T),(x=_.querySelector(Vd(r)))&&!x._p&&(T.instance=x,T.state.loading=5),zi.has(r)||(u={rel:"preload",as:"style",href:u.href,crossOrigin:u.crossOrigin,integrity:u.integrity,media:u.media,hrefLang:u.hrefLang,referrerPolicy:u.referrerPolicy},zi.set(r,u),x||EI(_,r,u,T.state))),a&&f===null)throw Error(n(528,""));return T}if(a&&f!==null)throw Error(n(529,""));return null;case"script":return a=u.async,u=u.src,typeof u=="string"&&a&&typeof a!="function"&&typeof a!="symbol"?(a=Ic(u),u=Ql(_).hoistableScripts,f=u.get(a),f||(f={type:"script",instance:null,count:0,state:null},u.set(a,f)),f):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,r))}}function kc(r){return'href="'+Ui(r)+'"'}function Vd(r){return'link[rel="stylesheet"]['+r+"]"}function dA(r){return y({},r,{"data-precedence":r.precedence,precedence:null})}function EI(r,a,u,f){r.querySelector('link[rel="preload"][as="style"]['+a+"]")?f.loading=1:(a=r.createElement("link"),f.preload=a,a.addEventListener("load",function(){return f.loading|=1}),a.addEventListener("error",function(){return f.loading|=2}),wn(a,"link",u),un(a),r.head.appendChild(a))}function Ic(r){return'[src="'+Ui(r)+'"]'}function zd(r){return"script[async]"+r}function hA(r,a,u){if(a.count++,a.instance===null)switch(a.type){case"style":var f=r.querySelector('style[data-href~="'+Ui(u.href)+'"]');if(f)return a.instance=f,un(f),f;var _=y({},u,{"data-href":u.href,"data-precedence":u.precedence,href:null,precedence:null});return f=(r.ownerDocument||r).createElement("style"),un(f),wn(f,"style",_),Am(f,u.precedence,r),a.instance=f;case"stylesheet":_=kc(u.href);var x=r.querySelector(Vd(_));if(x)return a.state.loading|=4,a.instance=x,un(x),x;f=dA(u),(_=zi.get(_))&&Ly(f,_),x=(r.ownerDocument||r).createElement("link"),un(x);var T=x;return T._p=new Promise(function(M,H){T.onload=M,T.onerror=H}),wn(x,"link",f),a.state.loading|=4,Am(x,u.precedence,r),a.instance=x;case"script":return x=Ic(u.src),(_=r.querySelector(zd(x)))?(a.instance=_,un(_),_):(f=u,(_=zi.get(x))&&(f=y({},u),Py(f,_)),r=r.ownerDocument||r,_=r.createElement("script"),un(_),wn(_,"link",f),r.head.appendChild(_),a.instance=_);case"void":return null;default:throw Error(n(443,a.type))}else a.type==="stylesheet"&&(a.state.loading&4)===0&&(f=a.instance,a.state.loading|=4,Am(f,u.precedence,r));return a.instance}function Am(r,a,u){for(var f=u.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),_=f.length?f[f.length-1]:null,x=_,T=0;T<f.length;T++){var M=f[T];if(M.dataset.precedence===a)x=M;else if(x!==_)break}x?x.parentNode.insertBefore(r,x.nextSibling):(a=u.nodeType===9?u.head:u,a.insertBefore(r,a.firstChild))}function Ly(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.title==null&&(r.title=a.title)}function Py(r,a){r.crossOrigin==null&&(r.crossOrigin=a.crossOrigin),r.referrerPolicy==null&&(r.referrerPolicy=a.referrerPolicy),r.integrity==null&&(r.integrity=a.integrity)}var Tm=null;function fA(r,a,u){if(Tm===null){var f=new Map,_=Tm=new Map;_.set(u,f)}else _=Tm,f=_.get(u),f||(f=new Map,_.set(u,f));if(f.has(r))return f;for(f.set(r,null),u=u.getElementsByTagName(r),_=0;_<u.length;_++){var x=u[_];if(!(x[ad]||x[vn]||r==="link"&&x.getAttribute("rel")==="stylesheet")&&x.namespaceURI!=="http://www.w3.org/2000/svg"){var T=x.getAttribute(a)||"";T=r+T;var M=f.get(T);M?M.push(x):f.set(T,[x])}}return f}function pA(r,a,u){r=r.ownerDocument||r,r.head.insertBefore(u,a==="title"?r.querySelector("head > title"):null)}function AI(r,a,u){if(u===1||a.itemProp!=null)return!1;switch(r){case"meta":case"title":return!0;case"style":if(typeof a.precedence!="string"||typeof a.href!="string"||a.href==="")break;return!0;case"link":if(typeof a.rel!="string"||typeof a.href!="string"||a.href===""||a.onLoad||a.onError)break;switch(a.rel){case"stylesheet":return r=a.disabled,typeof a.precedence=="string"&&r==null;default:return!0}case"script":if(a.async&&typeof a.async!="function"&&typeof a.async!="symbol"&&!a.onLoad&&!a.onError&&a.src&&typeof a.src=="string")return!0}return!1}function mA(r){return!(r.type==="stylesheet"&&(r.state.loading&3)===0)}function TI(r,a,u,f){if(u.type==="stylesheet"&&(typeof f.media!="string"||matchMedia(f.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var _=kc(f.href),x=a.querySelector(Vd(_));if(x){a=x._p,a!==null&&typeof a=="object"&&typeof a.then=="function"&&(r.count++,r=Cm.bind(r),a.then(r,r)),u.state.loading|=4,u.instance=x,un(x);return}x=a.ownerDocument||a,f=dA(f),(_=zi.get(_))&&Ly(f,_),x=x.createElement("link"),un(x);var T=x;T._p=new Promise(function(M,H){T.onload=M,T.onerror=H}),wn(x,"link",f),u.instance=x}r.stylesheets===null&&(r.stylesheets=new Map),r.stylesheets.set(u,a),(a=u.state.preload)&&(u.state.loading&3)===0&&(r.count++,u=Cm.bind(r),a.addEventListener("load",u),a.addEventListener("error",u))}}var Oy=0;function CI(r,a){return r.stylesheets&&r.count===0&&Nm(r,r.stylesheets),0<r.count||0<r.imgCount?function(u){var f=setTimeout(function(){if(r.stylesheets&&Nm(r,r.stylesheets),r.unsuspend){var x=r.unsuspend;r.unsuspend=null,x()}},6e4+a);0<r.imgBytes&&Oy===0&&(Oy=62500*aI());var _=setTimeout(function(){if(r.waitingForImages=!1,r.count===0&&(r.stylesheets&&Nm(r,r.stylesheets),r.unsuspend)){var x=r.unsuspend;r.unsuspend=null,x()}},(r.imgBytes>Oy?50:800)+a);return r.unsuspend=u,function(){r.unsuspend=null,clearTimeout(f),clearTimeout(_)}}:null}function Cm(){if(this.count--,this.count===0&&(this.imgCount===0||!this.waitingForImages)){if(this.stylesheets)Nm(this,this.stylesheets);else if(this.unsuspend){var r=this.unsuspend;this.unsuspend=null,r()}}}var Rm=null;function Nm(r,a){r.stylesheets=null,r.unsuspend!==null&&(r.count++,Rm=new Map,a.forEach(RI,r),Rm=null,Cm.call(r))}function RI(r,a){if(!(a.state.loading&4)){var u=Rm.get(r);if(u)var f=u.get(null);else{u=new Map,Rm.set(r,u);for(var _=r.querySelectorAll("link[data-precedence],style[data-precedence]"),x=0;x<_.length;x++){var T=_[x];(T.nodeName==="LINK"||T.getAttribute("media")!=="not all")&&(u.set(T.dataset.precedence,T),f=T)}f&&u.set(null,f)}_=a.instance,T=_.getAttribute("data-precedence"),x=u.get(T)||f,x===f&&u.set(null,_),u.set(T,_),this.count++,f=Cm.bind(this),_.addEventListener("load",f),_.addEventListener("error",f),x?x.parentNode.insertBefore(_,x.nextSibling):(r=r.nodeType===9?r.head:r,r.insertBefore(_,r.firstChild)),a.state.loading|=4}}var $d={$$typeof:I,Provider:null,Consumer:null,_currentValue:te,_currentValue2:te,_threadCount:0};function NI(r,a,u,f,_,x,T,M,H){this.tag=1,this.containerInfo=r,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=I0(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=I0(0),this.hiddenUpdates=I0(null),this.identifierPrefix=f,this.onUncaughtError=_,this.onCaughtError=x,this.onRecoverableError=T,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=H,this.incompleteTransitions=new Map}function gA(r,a,u,f,_,x,T,M,H,Y,Z,re){return r=new NI(r,a,u,T,H,Y,Z,re,M),a=1,x===!0&&(a|=24),x=pi(3,null,null,a),r.current=x,x.stateNode=r,a=mv(),a.refCount++,r.pooledCache=a,a.refCount++,x.memoizedState={element:f,isDehydrated:u,cache:a},bv(x),r}function vA(r){return r?(r=lc,r):lc}function yA(r,a,u,f,_,x){_=vA(_),f.context===null?f.context=_:f.pendingContext=_,f=go(a),f.payload={element:u},x=x===void 0?null:x,x!==null&&(f.callback=x),u=vo(r,f,a),u!==null&&(si(u,r,a),Ed(u,r,a))}function bA(r,a){if(r=r.memoizedState,r!==null&&r.dehydrated!==null){var u=r.retryLane;r.retryLane=u!==0&&u<a?u:a}}function Uy(r,a){bA(r,a),(r=r.alternate)&&bA(r,a)}function _A(r){if(r.tag===13||r.tag===31){var a=ya(r,67108864);a!==null&&si(a,r,67108864),Uy(r,67108864)}}function wA(r){if(r.tag===13||r.tag===31){var a=bi();a=M0(a);var u=ya(r,a);u!==null&&si(u,r,a),Uy(r,a)}}var km=!0;function kI(r,a,u,f){var _=z.T;z.T=null;var x=X.p;try{X.p=2,Fy(r,a,u,f)}finally{X.p=x,z.T=_}}function II(r,a,u,f){var _=z.T;z.T=null;var x=X.p;try{X.p=8,Fy(r,a,u,f)}finally{X.p=x,z.T=_}}function Fy(r,a,u,f){if(km){var _=Hy(f);if(_===null)Ey(r,a,f,Im,u),SA(r,f);else if(DI(_,r,a,u,f))f.stopPropagation();else if(SA(r,f),a&4&&-1<MI.indexOf(r)){for(;_!==null;){var x=Xl(_);if(x!==null)switch(x.tag){case 3:if(x=x.stateNode,x.current.memoizedState.isDehydrated){var T=fa(x.pendingLanes);if(T!==0){var M=x;for(M.pendingLanes|=2,M.entangledLanes|=2;T;){var H=1<<31-Ce(T);M.entanglements[1]|=H,T&=~H}Is(x),(dt&6)===0&&(fm=Ie()+500,Bd(0))}}break;case 31:case 13:M=ya(x,2),M!==null&&si(M,x,2),mm(),Uy(x,2)}if(x=Hy(f),x===null&&Ey(r,a,f,Im,u),x===_)break;_=x}_!==null&&f.stopPropagation()}else Ey(r,a,f,null,u)}}function Hy(r){return r=j0(r),By(r)}var Im=null;function By(r){if(Im=null,r=Wl(r),r!==null){var a=o(r);if(a===null)r=null;else{var u=a.tag;if(u===13){if(r=l(a),r!==null)return r;r=null}else if(u===31){if(r=c(a),r!==null)return r;r=null}else if(u===3){if(a.stateNode.current.memoizedState.isDehydrated)return a.tag===3?a.stateNode.containerInfo:null;r=null}else a!==r&&(r=null)}}return Im=r,null}function xA(r){switch(r){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(zt()){case Mt:return 2;case Cs:return 8;case hi:case jn:return 32;case qn:return 268435456;default:return 32}default:return 32}}var jy=!1,Ro=null,No=null,ko=null,Yd=new Map,Jd=new Map,Io=[],MI="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function SA(r,a){switch(r){case"focusin":case"focusout":Ro=null;break;case"dragenter":case"dragleave":No=null;break;case"mouseover":case"mouseout":ko=null;break;case"pointerover":case"pointerout":Yd.delete(a.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jd.delete(a.pointerId)}}function Kd(r,a,u,f,_,x){return r===null||r.nativeEvent!==x?(r={blockedOn:a,domEventName:u,eventSystemFlags:f,nativeEvent:x,targetContainers:[_]},a!==null&&(a=Xl(a),a!==null&&_A(a)),r):(r.eventSystemFlags|=f,a=r.targetContainers,_!==null&&a.indexOf(_)===-1&&a.push(_),r)}function DI(r,a,u,f,_){switch(a){case"focusin":return Ro=Kd(Ro,r,a,u,f,_),!0;case"dragenter":return No=Kd(No,r,a,u,f,_),!0;case"mouseover":return ko=Kd(ko,r,a,u,f,_),!0;case"pointerover":var x=_.pointerId;return Yd.set(x,Kd(Yd.get(x)||null,r,a,u,f,_)),!0;case"gotpointercapture":return x=_.pointerId,Jd.set(x,Kd(Jd.get(x)||null,r,a,u,f,_)),!0}return!1}function EA(r){var a=Wl(r.target);if(a!==null){var u=o(a);if(u!==null){if(a=u.tag,a===13){if(a=l(u),a!==null){r.blockedOn=a,Fw(r.priority,function(){wA(u)});return}}else if(a===31){if(a=c(u),a!==null){r.blockedOn=a,Fw(r.priority,function(){wA(u)});return}}else if(a===3&&u.stateNode.current.memoizedState.isDehydrated){r.blockedOn=u.tag===3?u.stateNode.containerInfo:null;return}}}r.blockedOn=null}function Mm(r){if(r.blockedOn!==null)return!1;for(var a=r.targetContainers;0<a.length;){var u=Hy(r.nativeEvent);if(u===null){u=r.nativeEvent;var f=new u.constructor(u.type,u);B0=f,u.target.dispatchEvent(f),B0=null}else return a=Xl(u),a!==null&&_A(a),r.blockedOn=u,!1;a.shift()}return!0}function AA(r,a,u){Mm(r)&&u.delete(a)}function LI(){jy=!1,Ro!==null&&Mm(Ro)&&(Ro=null),No!==null&&Mm(No)&&(No=null),ko!==null&&Mm(ko)&&(ko=null),Yd.forEach(AA),Jd.forEach(AA)}function Dm(r,a){r.blockedOn===a&&(r.blockedOn=null,jy||(jy=!0,i.unstable_scheduleCallback(i.unstable_NormalPriority,LI)))}var Lm=null;function TA(r){Lm!==r&&(Lm=r,i.unstable_scheduleCallback(i.unstable_NormalPriority,function(){Lm===r&&(Lm=null);for(var a=0;a<r.length;a+=3){var u=r[a],f=r[a+1],_=r[a+2];if(typeof f!="function"){if(By(f||u)===null)continue;break}var x=Xl(u);x!==null&&(r.splice(a,3),a-=3,Hv(x,{pending:!0,data:_,method:u.method,action:f},f,_))}}))}function Mc(r){function a(H){return Dm(H,r)}Ro!==null&&Dm(Ro,r),No!==null&&Dm(No,r),ko!==null&&Dm(ko,r),Yd.forEach(a),Jd.forEach(a);for(var u=0;u<Io.length;u++){var f=Io[u];f.blockedOn===r&&(f.blockedOn=null)}for(;0<Io.length&&(u=Io[0],u.blockedOn===null);)EA(u),u.blockedOn===null&&Io.shift();if(u=(r.ownerDocument||r).$$reactFormReplay,u!=null)for(f=0;f<u.length;f+=3){var _=u[f],x=u[f+1],T=_[Qn]||null;if(typeof x=="function")T||TA(u);else if(T){var M=null;if(x&&x.hasAttribute("formAction")){if(_=x,T=x[Qn]||null)M=T.formAction;else if(By(_)!==null)continue}else M=T.action;typeof M=="function"?u[f+1]=M:(u.splice(f,3),f-=3),TA(u)}}}function CA(){function r(x){x.canIntercept&&x.info==="react-transition"&&x.intercept({handler:function(){return new Promise(function(T){return _=T})},focusReset:"manual",scroll:"manual"})}function a(){_!==null&&(_(),_=null),f||setTimeout(u,20)}function u(){if(!f&&!navigation.transition){var x=navigation.currentEntry;x&&x.url!=null&&navigation.navigate(x.url,{state:x.getState(),info:"react-transition",history:"replace"})}}if(typeof navigation=="object"){var f=!1,_=null;return navigation.addEventListener("navigate",r),navigation.addEventListener("navigatesuccess",a),navigation.addEventListener("navigateerror",a),setTimeout(u,100),function(){f=!0,navigation.removeEventListener("navigate",r),navigation.removeEventListener("navigatesuccess",a),navigation.removeEventListener("navigateerror",a),_!==null&&(_(),_=null)}}}function qy(r){this._internalRoot=r}Pm.prototype.render=qy.prototype.render=function(r){var a=this._internalRoot;if(a===null)throw Error(n(409));var u=a.current,f=bi();yA(u,f,r,a,null,null)},Pm.prototype.unmount=qy.prototype.unmount=function(){var r=this._internalRoot;if(r!==null){this._internalRoot=null;var a=r.containerInfo;yA(r.current,2,null,r,null,null),mm(),a[Kl]=null}};function Pm(r){this._internalRoot=r}Pm.prototype.unstable_scheduleHydration=function(r){if(r){var a=Uw();r={blockedOn:null,target:r,priority:a};for(var u=0;u<Io.length&&a!==0&&a<Io[u].priority;u++);Io.splice(u,0,r),u===0&&EA(r)}};var RA=e.version;if(RA!=="19.2.4")throw Error(n(527,RA,"19.2.4"));X.findDOMNode=function(r){var a=r._reactInternals;if(a===void 0)throw typeof r.render=="function"?Error(n(188)):(r=Object.keys(r).join(","),Error(n(268,r)));return r=h(a),r=r!==null?p(r):null,r=r===null?null:r.stateNode,r};var PI={bundleType:0,version:"19.2.4",rendererPackageName:"react-dom",currentDispatcherRef:z,reconcilerVersion:"19.2.4"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Om=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Om.isDisabled&&Om.supportsFiber)try{ye=Om.inject(PI),Ae=Om}catch{}}return Xd.createRoot=function(r,a){if(!s(r))throw Error(n(299));var u=!1,f="",_=PS,x=OS,T=US;return a!=null&&(a.unstable_strictMode===!0&&(u=!0),a.identifierPrefix!==void 0&&(f=a.identifierPrefix),a.onUncaughtError!==void 0&&(_=a.onUncaughtError),a.onCaughtError!==void 0&&(x=a.onCaughtError),a.onRecoverableError!==void 0&&(T=a.onRecoverableError)),a=gA(r,1,!1,null,null,u,f,null,_,x,T,CA),r[Kl]=a.current,Sy(r),new qy(a)},Xd.hydrateRoot=function(r,a,u){if(!s(r))throw Error(n(299));var f=!1,_="",x=PS,T=OS,M=US,H=null;return u!=null&&(u.unstable_strictMode===!0&&(f=!0),u.identifierPrefix!==void 0&&(_=u.identifierPrefix),u.onUncaughtError!==void 0&&(x=u.onUncaughtError),u.onCaughtError!==void 0&&(T=u.onCaughtError),u.onRecoverableError!==void 0&&(M=u.onRecoverableError),u.formState!==void 0&&(H=u.formState)),a=gA(r,1,!0,a,u??null,f,_,H,x,T,M,CA),a.context=vA(null),u=a.current,f=bi(),f=M0(f),_=go(f),_.callback=null,vo(u,_,f),u=f,a.current.lanes=u,od(a,u),Is(a),r[Kl]=a.current,Sy(r),new Pm(a)},Xd.version="19.2.4",Xd}var HA;function YI(){if(HA)return $y.exports;HA=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),$y.exports=$I(),$y.exports}var JI=YI(),$e=(i=>(i.PENDING="PENDING",i.VALID="VALID",i.EXTENDABLE="EXTENDABLE",i.REFRESH_NEEDED="REFRESH_NEEDED",i.EXPIRED="EXPIRED",i.OTHER="OTHER",i))($e||{}),Di=(i=>(i.ADMIN="ADMIN",i.CREW="CREW",i))(Di||{});const BA=(i,e=!1)=>{if(!i)return new Date;const t=i.split("-").map(Number);if(t.length!==3)return new Date(i);const[n,s,o]=t;return e?new Date(n,s-1,o,23,59,59,999):new Date(n,s-1,o,0,0,0,0)},Ks=i=>{if(i.refreshRequested)return $e.REFRESH_NEEDED;const e=new Date,t=BA(i.workDate,!1),n=BA(i.expires,!0),s=new Date(e.getFullYear(),e.getMonth(),e.getDate()).getTime(),l=new Date(n.getFullYear(),n.getMonth(),n.getDate()).getTime()-s,c=Math.floor(l/(1e3*60*60*24));return e>n?$e.EXPIRED:c<=3&&c>=0?$e.EXTENDABLE:e>=t?$e.VALID:$e.PENDING},gb=i=>{switch(i){case $e.VALID:return"bg-emerald-50 text-emerald-700 border-emerald-200";case $e.EXTENDABLE:return"bg-orange-50 text-orange-700 border-orange-200";case $e.REFRESH_NEEDED:return"bg-amber-100 text-amber-900 border-amber-400 shadow-sm";case $e.EXPIRED:return"bg-rose-100 text-rose-900 border-rose-300";default:return"bg-slate-100 text-slate-600 border-slate-200"}},KI=i=>{switch(i){case $e.VALID:return"bg-emerald-500";case $e.EXTENDABLE:return"bg-orange-500";case $e.REFRESH_NEEDED:return"bg-amber-500";case $e.EXPIRED:return"bg-rose-600";default:return"bg-slate-400"}};function h0(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t}function WI(i,e,t,n){function s(o){return o instanceof t?o:new t(function(l){l(o)})}return new(t||(t=Promise))(function(o,l){function c(p){try{h(n.next(p))}catch(y){l(y)}}function d(p){try{h(n.throw(p))}catch(y){l(y)}}function h(p){p.done?o(p.value):s(p.value).then(c,d)}h((n=n.apply(i,e||[])).next())})}const XI=i=>i?(...e)=>i(...e):(...e)=>fetch(...e);class aw extends Error{constructor(e,t="FunctionsError",n){super(e),this.name=t,this.context=n}}class QI extends aw{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class jA extends aw{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class qA extends aw{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var vb;(function(i){i.Any="any",i.ApNortheast1="ap-northeast-1",i.ApNortheast2="ap-northeast-2",i.ApSouth1="ap-south-1",i.ApSoutheast1="ap-southeast-1",i.ApSoutheast2="ap-southeast-2",i.CaCentral1="ca-central-1",i.EuCentral1="eu-central-1",i.EuWest1="eu-west-1",i.EuWest2="eu-west-2",i.EuWest3="eu-west-3",i.SaEast1="sa-east-1",i.UsEast1="us-east-1",i.UsWest1="us-west-1",i.UsWest2="us-west-2"})(vb||(vb={}));class ZI{constructor(e,{headers:t={},customFetch:n,region:s=vb.Any}={}){this.url=e,this.headers=t,this.region=s,this.fetch=XI(n)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e){return WI(this,arguments,void 0,function*(t,n={}){var s;let o,l;try{const{headers:c,method:d,body:h,signal:p,timeout:y}=n;let b={},{region:S}=n;S||(S=this.region);const E=new URL(`${this.url}/${t}`);S&&S!=="any"&&(b["x-region"]=S,E.searchParams.set("forceFunctionRegion",S));let R;h&&(c&&!Object.prototype.hasOwnProperty.call(c,"Content-Type")||!c)?typeof Blob<"u"&&h instanceof Blob||h instanceof ArrayBuffer?(b["Content-Type"]="application/octet-stream",R=h):typeof h=="string"?(b["Content-Type"]="text/plain",R=h):typeof FormData<"u"&&h instanceof FormData?R=h:(b["Content-Type"]="application/json",R=JSON.stringify(h)):h&&typeof h!="string"&&!(typeof Blob<"u"&&h instanceof Blob)&&!(h instanceof ArrayBuffer)&&!(typeof FormData<"u"&&h instanceof FormData)?R=JSON.stringify(h):R=h;let A=p;y&&(l=new AbortController,o=setTimeout(()=>l.abort(),y),p?(A=l.signal,p.addEventListener("abort",()=>l.abort())):A=l.signal);const C=yield this.fetch(E.toString(),{method:d||"POST",headers:Object.assign(Object.assign(Object.assign({},b),this.headers),c),body:R,signal:A}).catch(U=>{throw new QI(U)}),k=C.headers.get("x-relay-error");if(k&&k==="true")throw new jA(C);if(!C.ok)throw new qA(C);let I=((s=C.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),O;return I==="application/json"?O=yield C.json():I==="application/octet-stream"||I==="application/pdf"?O=yield C.blob():I==="text/event-stream"?O=C:I==="multipart/form-data"?O=yield C.formData():O=yield C.text(),{data:O,error:null,response:C}}catch(c){return{data:null,error:c,response:c instanceof qA||c instanceof jA?c.context:void 0}}finally{o&&clearTimeout(o)}})}}var eM=class extends Error{constructor(i){super(i.message),this.name="PostgrestError",this.details=i.details,this.hint=i.hint,this.code=i.code}},tM=class{constructor(i){var e,t,n;this.shouldThrowOnError=!1,this.method=i.method,this.url=i.url,this.headers=new Headers(i.headers),this.schema=i.schema,this.body=i.body,this.shouldThrowOnError=(e=i.shouldThrowOnError)!==null&&e!==void 0?e:!1,this.signal=i.signal,this.isMaybeSingle=(t=i.isMaybeSingle)!==null&&t!==void 0?t:!1,this.urlLengthLimit=(n=i.urlLengthLimit)!==null&&n!==void 0?n:8e3,i.fetch?this.fetch=i.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,e){return this.headers=new Headers(this.headers),this.headers.set(i,e),this}then(i,e){var t=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const n=this.fetch;let s=n(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async o=>{let l=null,c=null,d=null,h=o.status,p=o.statusText;if(o.ok){var y,b;if(t.method!=="HEAD"){var S;const C=await o.text();C===""||(t.headers.get("Accept")==="text/csv"||t.headers.get("Accept")&&(!((S=t.headers.get("Accept"))===null||S===void 0)&&S.includes("application/vnd.pgrst.plan+text"))?c=C:c=JSON.parse(C))}const R=(y=t.headers.get("Prefer"))===null||y===void 0?void 0:y.match(/count=(exact|planned|estimated)/),A=(b=o.headers.get("content-range"))===null||b===void 0?void 0:b.split("/");R&&A&&A.length>1&&(d=parseInt(A[1])),t.isMaybeSingle&&t.method==="GET"&&Array.isArray(c)&&(c.length>1?(l={code:"PGRST116",details:`Results contain ${c.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},c=null,d=null,h=406,p="Not Acceptable"):c.length===1?c=c[0]:c=null)}else{var E;const R=await o.text();try{l=JSON.parse(R),Array.isArray(l)&&o.status===404&&(c=[],l=null,h=200,p="OK")}catch{o.status===404&&R===""?(h=204,p="No Content"):l={message:R}}if(l&&t.isMaybeSingle&&(!(l==null||(E=l.details)===null||E===void 0)&&E.includes("0 rows"))&&(l=null,h=200,p="OK"),l&&t.shouldThrowOnError)throw new eM(l)}return{error:l,data:c,count:d,status:h,statusText:p}});return this.shouldThrowOnError||(s=s.catch(o=>{var l;let c="",d="",h="";const p=o==null?void 0:o.cause;if(p){var y,b,S,E;const C=(y=p==null?void 0:p.message)!==null&&y!==void 0?y:"",k=(b=p==null?void 0:p.code)!==null&&b!==void 0?b:"";c=`${(S=o==null?void 0:o.name)!==null&&S!==void 0?S:"FetchError"}: ${o==null?void 0:o.message}`,c+=`

Caused by: ${(E=p==null?void 0:p.name)!==null&&E!==void 0?E:"Error"}: ${C}`,k&&(c+=` (${k})`),p!=null&&p.stack&&(c+=`
${p.stack}`)}else{var R;c=(R=o==null?void 0:o.stack)!==null&&R!==void 0?R:""}const A=this.url.toString().length;return(o==null?void 0:o.name)==="AbortError"||(o==null?void 0:o.code)==="ABORT_ERR"?(h="",d="Request was aborted (timeout or manual cancellation)",A>this.urlLengthLimit&&(d+=`. Note: Your request URL is ${A} characters, which may exceed server limits. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [many IDs])), consider using an RPC function to pass values server-side.`)):((p==null?void 0:p.name)==="HeadersOverflowError"||(p==null?void 0:p.code)==="UND_ERR_HEADERS_OVERFLOW")&&(h="",d="HTTP headers exceeded server limits (typically 16KB)",A>this.urlLengthLimit&&(d+=`. Your request URL is ${A} characters. If selecting many fields, consider using views. If filtering with large arrays (e.g., .in('id', [200+ IDs])), consider using an RPC function instead.`)),{error:{message:`${(l=o==null?void 0:o.name)!==null&&l!==void 0?l:"FetchError"}: ${o==null?void 0:o.message}`,details:c,hint:d,code:h},data:null,count:null,status:0,statusText:""}})),s.then(i,e)}returns(){return this}overrideTypes(){return this}},nM=class extends tM{select(i){let e=!1;const t=(i??"*").split("").map(n=>/\s/.test(n)&&!e?"":(n==='"'&&(e=!e),n)).join("");return this.url.searchParams.set("select",t),this.headers.append("Prefer","return=representation"),this}order(i,{ascending:e=!0,nullsFirst:t,foreignTable:n,referencedTable:s=n}={}){const o=s?`${s}.order`:"order",l=this.url.searchParams.get(o);return this.url.searchParams.set(o,`${l?`${l},`:""}${i}.${e?"asc":"desc"}${t===void 0?"":t?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:e,referencedTable:t=e}={}){const n=typeof t>"u"?"limit":`${t}.limit`;return this.url.searchParams.set(n,`${i}`),this}range(i,e,{foreignTable:t,referencedTable:n=t}={}){const s=typeof n>"u"?"offset":`${n}.offset`,o=typeof n>"u"?"limit":`${n}.limit`;return this.url.searchParams.set(s,`${i}`),this.url.searchParams.set(o,`${e-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:i=!1,verbose:e=!1,settings:t=!1,buffers:n=!1,wal:s=!1,format:o="text"}={}){var l;const c=[i?"analyze":null,e?"verbose":null,t?"settings":null,n?"buffers":null,s?"wal":null].filter(Boolean).join("|"),d=(l=this.headers.get("Accept"))!==null&&l!==void 0?l:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${o}; for="${d}"; options=${c};`),o==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(i){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${i}`),this}};const GA=new RegExp("[,()]");var Bc=class extends nM{eq(i,e){return this.url.searchParams.append(i,`eq.${e}`),this}neq(i,e){return this.url.searchParams.append(i,`neq.${e}`),this}gt(i,e){return this.url.searchParams.append(i,`gt.${e}`),this}gte(i,e){return this.url.searchParams.append(i,`gte.${e}`),this}lt(i,e){return this.url.searchParams.append(i,`lt.${e}`),this}lte(i,e){return this.url.searchParams.append(i,`lte.${e}`),this}like(i,e){return this.url.searchParams.append(i,`like.${e}`),this}likeAllOf(i,e){return this.url.searchParams.append(i,`like(all).{${e.join(",")}}`),this}likeAnyOf(i,e){return this.url.searchParams.append(i,`like(any).{${e.join(",")}}`),this}ilike(i,e){return this.url.searchParams.append(i,`ilike.${e}`),this}ilikeAllOf(i,e){return this.url.searchParams.append(i,`ilike(all).{${e.join(",")}}`),this}ilikeAnyOf(i,e){return this.url.searchParams.append(i,`ilike(any).{${e.join(",")}}`),this}regexMatch(i,e){return this.url.searchParams.append(i,`match.${e}`),this}regexIMatch(i,e){return this.url.searchParams.append(i,`imatch.${e}`),this}is(i,e){return this.url.searchParams.append(i,`is.${e}`),this}isDistinct(i,e){return this.url.searchParams.append(i,`isdistinct.${e}`),this}in(i,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&GA.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(i,`in.(${t})`),this}notIn(i,e){const t=Array.from(new Set(e)).map(n=>typeof n=="string"&&GA.test(n)?`"${n}"`:`${n}`).join(",");return this.url.searchParams.append(i,`not.in.(${t})`),this}contains(i,e){return typeof e=="string"?this.url.searchParams.append(i,`cs.${e}`):Array.isArray(e)?this.url.searchParams.append(i,`cs.{${e.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(e)}`),this}containedBy(i,e){return typeof e=="string"?this.url.searchParams.append(i,`cd.${e}`):Array.isArray(e)?this.url.searchParams.append(i,`cd.{${e.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(e)}`),this}rangeGt(i,e){return this.url.searchParams.append(i,`sr.${e}`),this}rangeGte(i,e){return this.url.searchParams.append(i,`nxl.${e}`),this}rangeLt(i,e){return this.url.searchParams.append(i,`sl.${e}`),this}rangeLte(i,e){return this.url.searchParams.append(i,`nxr.${e}`),this}rangeAdjacent(i,e){return this.url.searchParams.append(i,`adj.${e}`),this}overlaps(i,e){return typeof e=="string"?this.url.searchParams.append(i,`ov.${e}`):this.url.searchParams.append(i,`ov.{${e.join(",")}}`),this}textSearch(i,e,{config:t,type:n}={}){let s="";n==="plain"?s="pl":n==="phrase"?s="ph":n==="websearch"&&(s="w");const o=t===void 0?"":`(${t})`;return this.url.searchParams.append(i,`${s}fts${o}.${e}`),this}match(i){return Object.entries(i).forEach(([e,t])=>{this.url.searchParams.append(e,`eq.${t}`)}),this}not(i,e,t){return this.url.searchParams.append(i,`not.${e}.${t}`),this}or(i,{foreignTable:e,referencedTable:t=e}={}){const n=t?`${t}.or`:"or";return this.url.searchParams.append(n,`(${i})`),this}filter(i,e,t){return this.url.searchParams.append(i,`${e}.${t}`),this}},iM=class{constructor(i,{headers:e={},schema:t,fetch:n,urlLengthLimit:s=8e3}){this.url=i,this.headers=new Headers(e),this.schema=t,this.fetch=n,this.urlLengthLimit=s}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(i,e){const{head:t=!1,count:n}=e??{},s=t?"HEAD":"GET";let o=!1;const l=(i??"*").split("").map(h=>/\s/.test(h)&&!o?"":(h==='"'&&(o=!o),h)).join(""),{url:c,headers:d}=this.cloneRequestState();return c.searchParams.set("select",l),n&&d.append("Prefer",`count=${n}`),new Bc({method:s,url:c,headers:d,schema:this.schema,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}insert(i,{count:e,defaultToNull:t=!0}={}){var n;const s="POST",{url:o,headers:l}=this.cloneRequestState();if(e&&l.append("Prefer",`count=${e}`),t||l.append("Prefer","missing=default"),Array.isArray(i)){const c=i.reduce((d,h)=>d.concat(Object.keys(h)),[]);if(c.length>0){const d=[...new Set(c)].map(h=>`"${h}"`);o.searchParams.set("columns",d.join(","))}}return new Bc({method:s,url:o,headers:l,schema:this.schema,body:i,fetch:(n=this.fetch)!==null&&n!==void 0?n:fetch,urlLengthLimit:this.urlLengthLimit})}upsert(i,{onConflict:e,ignoreDuplicates:t=!1,count:n,defaultToNull:s=!0}={}){var o;const l="POST",{url:c,headers:d}=this.cloneRequestState();if(d.append("Prefer",`resolution=${t?"ignore":"merge"}-duplicates`),e!==void 0&&c.searchParams.set("on_conflict",e),n&&d.append("Prefer",`count=${n}`),s||d.append("Prefer","missing=default"),Array.isArray(i)){const h=i.reduce((p,y)=>p.concat(Object.keys(y)),[]);if(h.length>0){const p=[...new Set(h)].map(y=>`"${y}"`);c.searchParams.set("columns",p.join(","))}}return new Bc({method:l,url:c,headers:d,schema:this.schema,body:i,fetch:(o=this.fetch)!==null&&o!==void 0?o:fetch,urlLengthLimit:this.urlLengthLimit})}update(i,{count:e}={}){var t;const n="PATCH",{url:s,headers:o}=this.cloneRequestState();return e&&o.append("Prefer",`count=${e}`),new Bc({method:n,url:s,headers:o,schema:this.schema,body:i,fetch:(t=this.fetch)!==null&&t!==void 0?t:fetch,urlLengthLimit:this.urlLengthLimit})}delete({count:i}={}){var e;const t="DELETE",{url:n,headers:s}=this.cloneRequestState();return i&&s.append("Prefer",`count=${i}`),new Bc({method:t,url:n,headers:s,schema:this.schema,fetch:(e=this.fetch)!==null&&e!==void 0?e:fetch,urlLengthLimit:this.urlLengthLimit})}};function Ch(i){"@babel/helpers - typeof";return Ch=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ch(i)}function sM(i,e){if(Ch(i)!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(Ch(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function rM(i){var e=sM(i,"string");return Ch(e)=="symbol"?e:e+""}function oM(i,e,t){return(e=rM(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function VA(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,n)}return t}function Um(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?VA(Object(t),!0).forEach(function(n){oM(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):VA(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}var aM=class y1{constructor(e,{headers:t={},schema:n,fetch:s,timeout:o,urlLengthLimit:l=8e3}={}){this.url=e,this.headers=new Headers(t),this.schemaName=n,this.urlLengthLimit=l;const c=s??globalThis.fetch;o!==void 0&&o>0?this.fetch=(d,h)=>{const p=new AbortController,y=setTimeout(()=>p.abort(),o),b=h==null?void 0:h.signal;if(b){if(b.aborted)return clearTimeout(y),c(d,h);const S=()=>{clearTimeout(y),p.abort()};return b.addEventListener("abort",S,{once:!0}),c(d,Um(Um({},h),{},{signal:p.signal})).finally(()=>{clearTimeout(y),b.removeEventListener("abort",S)})}return c(d,Um(Um({},h),{},{signal:p.signal})).finally(()=>clearTimeout(y))}:this.fetch=c}from(e){if(!e||typeof e!="string"||e.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new iM(new URL(`${this.url}/${e}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}schema(e){return new y1(this.url,{headers:this.headers,schema:e,fetch:this.fetch,urlLengthLimit:this.urlLengthLimit})}rpc(e,t={},{head:n=!1,get:s=!1,count:o}={}){var l;let c;const d=new URL(`${this.url}/rpc/${e}`);let h;const p=S=>S!==null&&typeof S=="object"&&(!Array.isArray(S)||S.some(p)),y=n&&Object.values(t).some(p);y?(c="POST",h=t):n||s?(c=n?"HEAD":"GET",Object.entries(t).filter(([S,E])=>E!==void 0).map(([S,E])=>[S,Array.isArray(E)?`{${E.join(",")}}`:`${E}`]).forEach(([S,E])=>{d.searchParams.append(S,E)})):(c="POST",h=t);const b=new Headers(this.headers);return y?b.set("Prefer",o?`count=${o},return=minimal`:"return=minimal"):o&&b.set("Prefer",`count=${o}`),new Bc({method:c,url:d,headers:b,schema:this.schemaName,body:h,fetch:(l=this.fetch)!==null&&l!==void 0?l:fetch,urlLengthLimit:this.urlLengthLimit})}};class lM{constructor(){}static detectEnvironment(){var e;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((e=navigator.userAgent)===null||e===void 0)&&e.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const t=globalThis.process;if(t){const n=t.versions;if(n&&n.node){const s=n.node,o=parseInt(s.replace(/^v/,"").split(".")[0]);return o>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${o} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${o} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const e=this.detectEnvironment();if(e.constructor)return e.constructor;let t=e.error||"WebSocket not supported in this environment.";throw e.workaround&&(t+=`

Suggested solution: ${e.workaround}`),new Error(t)}static createWebSocket(e,t){const n=this.getWebSocketConstructor();return new n(e,t)}static isWebSocketSupported(){try{const e=this.detectEnvironment();return e.type==="native"||e.type==="ws"}catch{return!1}}}const cM="2.97.0",uM=`realtime-js/${cM}`,dM="1.0.0",b1="2.0.0",zA=b1,yb=1e4,hM=1e3,fM=100;var Oo;(function(i){i[i.connecting=0]="connecting",i[i.open=1]="open",i[i.closing=2]="closing",i[i.closed=3]="closed"})(Oo||(Oo={}));var sn;(function(i){i.closed="closed",i.errored="errored",i.joined="joined",i.joining="joining",i.leaving="leaving"})(sn||(sn={}));var ws;(function(i){i.close="phx_close",i.error="phx_error",i.join="phx_join",i.reply="phx_reply",i.leave="phx_leave",i.access_token="access_token"})(ws||(ws={}));var bb;(function(i){i.websocket="websocket"})(bb||(bb={}));var Fa;(function(i){i.Connecting="connecting",i.Open="open",i.Closing="closing",i.Closed="closed"})(Fa||(Fa={}));class pM{constructor(e){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=e??[]}encode(e,t){if(e.event===this.BROADCAST_EVENT&&!(e.payload instanceof ArrayBuffer)&&typeof e.payload.event=="string")return t(this._binaryEncodeUserBroadcastPush(e));let n=[e.join_ref,e.ref,e.topic,e.event,e.payload];return t(JSON.stringify(n))}_binaryEncodeUserBroadcastPush(e){var t;return this._isArrayBuffer((t=e.payload)===null||t===void 0?void 0:t.payload)?this._encodeBinaryUserBroadcastPush(e):this._encodeJsonUserBroadcastPush(e)}_encodeBinaryUserBroadcastPush(e){var t,n;const s=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:new ArrayBuffer(0);return this._encodeUserBroadcastPush(e,this.BINARY_ENCODING,s)}_encodeJsonUserBroadcastPush(e){var t,n;const s=(n=(t=e.payload)===null||t===void 0?void 0:t.payload)!==null&&n!==void 0?n:{},l=new TextEncoder().encode(JSON.stringify(s)).buffer;return this._encodeUserBroadcastPush(e,this.JSON_ENCODING,l)}_encodeUserBroadcastPush(e,t,n){var s,o;const l=e.topic,c=(s=e.ref)!==null&&s!==void 0?s:"",d=(o=e.join_ref)!==null&&o!==void 0?o:"",h=e.payload.event,p=this.allowedMetadataKeys?this._pick(e.payload,this.allowedMetadataKeys):{},y=Object.keys(p).length===0?"":JSON.stringify(p);if(d.length>255)throw new Error(`joinRef length ${d.length} exceeds maximum of 255`);if(c.length>255)throw new Error(`ref length ${c.length} exceeds maximum of 255`);if(l.length>255)throw new Error(`topic length ${l.length} exceeds maximum of 255`);if(h.length>255)throw new Error(`userEvent length ${h.length} exceeds maximum of 255`);if(y.length>255)throw new Error(`metadata length ${y.length} exceeds maximum of 255`);const b=this.USER_BROADCAST_PUSH_META_LENGTH+d.length+c.length+l.length+h.length+y.length,S=new ArrayBuffer(this.HEADER_LENGTH+b);let E=new DataView(S),R=0;E.setUint8(R++,this.KINDS.userBroadcastPush),E.setUint8(R++,d.length),E.setUint8(R++,c.length),E.setUint8(R++,l.length),E.setUint8(R++,h.length),E.setUint8(R++,y.length),E.setUint8(R++,t),Array.from(d,C=>E.setUint8(R++,C.charCodeAt(0))),Array.from(c,C=>E.setUint8(R++,C.charCodeAt(0))),Array.from(l,C=>E.setUint8(R++,C.charCodeAt(0))),Array.from(h,C=>E.setUint8(R++,C.charCodeAt(0))),Array.from(y,C=>E.setUint8(R++,C.charCodeAt(0)));var A=new Uint8Array(S.byteLength+n.byteLength);return A.set(new Uint8Array(S),0),A.set(new Uint8Array(n),S.byteLength),A.buffer}decode(e,t){if(this._isArrayBuffer(e)){let n=this._binaryDecode(e);return t(n)}if(typeof e=="string"){const n=JSON.parse(e),[s,o,l,c,d]=n;return t({join_ref:s,ref:o,topic:l,event:c,payload:d})}return t({})}_binaryDecode(e){const t=new DataView(e),n=t.getUint8(0),s=new TextDecoder;switch(n){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(e,t,s)}}_decodeUserBroadcast(e,t,n){const s=t.getUint8(1),o=t.getUint8(2),l=t.getUint8(3),c=t.getUint8(4);let d=this.HEADER_LENGTH+4;const h=n.decode(e.slice(d,d+s));d=d+s;const p=n.decode(e.slice(d,d+o));d=d+o;const y=n.decode(e.slice(d,d+l));d=d+l;const b=e.slice(d,e.byteLength),S=c===this.JSON_ENCODING?JSON.parse(n.decode(b)):b,E={type:this.BROADCAST_EVENT,event:p,payload:S};return l>0&&(E.meta=JSON.parse(y)),{join_ref:null,ref:null,topic:h,event:this.BROADCAST_EVENT,payload:E}}_isArrayBuffer(e){var t;return e instanceof ArrayBuffer||((t=e==null?void 0:e.constructor)===null||t===void 0?void 0:t.name)==="ArrayBuffer"}_pick(e,t){return!e||typeof e!="object"?{}:Object.fromEntries(Object.entries(e).filter(([n])=>t.includes(n)))}}class _1{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Ct;(function(i){i.abstime="abstime",i.bool="bool",i.date="date",i.daterange="daterange",i.float4="float4",i.float8="float8",i.int2="int2",i.int4="int4",i.int4range="int4range",i.int8="int8",i.int8range="int8range",i.json="json",i.jsonb="jsonb",i.money="money",i.numeric="numeric",i.oid="oid",i.reltime="reltime",i.text="text",i.time="time",i.timestamp="timestamp",i.timestamptz="timestamptz",i.timetz="timetz",i.tsrange="tsrange",i.tstzrange="tstzrange"})(Ct||(Ct={}));const $A=(i,e,t={})=>{var n;const s=(n=t.skipTypes)!==null&&n!==void 0?n:[];return e?Object.keys(e).reduce((o,l)=>(o[l]=mM(l,i,e,s),o),{}):{}},mM=(i,e,t,n)=>{const s=e.find(c=>c.name===i),o=s==null?void 0:s.type,l=t[i];return o&&!n.includes(o)?w1(o,l):_b(l)},w1=(i,e)=>{if(i.charAt(0)==="_"){const t=i.slice(1,i.length);return bM(e,t)}switch(i){case Ct.bool:return gM(e);case Ct.float4:case Ct.float8:case Ct.int2:case Ct.int4:case Ct.int8:case Ct.numeric:case Ct.oid:return vM(e);case Ct.json:case Ct.jsonb:return yM(e);case Ct.timestamp:return _M(e);case Ct.abstime:case Ct.date:case Ct.daterange:case Ct.int4range:case Ct.int8range:case Ct.money:case Ct.reltime:case Ct.text:case Ct.time:case Ct.timestamptz:case Ct.timetz:case Ct.tsrange:case Ct.tstzrange:return _b(e);default:return _b(e)}},_b=i=>i,gM=i=>{switch(i){case"t":return!0;case"f":return!1;default:return i}},vM=i=>{if(typeof i=="string"){const e=parseFloat(i);if(!Number.isNaN(e))return e}return i},yM=i=>{if(typeof i=="string")try{return JSON.parse(i)}catch{return i}return i},bM=(i,e)=>{if(typeof i!="string")return i;const t=i.length-1,n=i[t];if(i[0]==="{"&&n==="}"){let o;const l=i.slice(1,t);try{o=JSON.parse("["+l+"]")}catch{o=l?l.split(","):[]}return o.map(c=>w1(e,c))}return i},_M=i=>typeof i=="string"?i.replace(" ","T"):i,x1=i=>{const e=new URL(i);return e.protocol=e.protocol.replace(/^ws/i,"http"),e.pathname=e.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),e.pathname===""||e.pathname==="/"?e.pathname="/api/broadcast":e.pathname=e.pathname+"/api/broadcast",e.href};class Wy{constructor(e,t,n={},s=yb){this.channel=e,this.event=t,this.payload=n,this.timeout=s,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var n;return this._hasReceived(e)&&t((n=this.receivedResp)===null||n===void 0?void 0:n.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(n=>n.status===e).forEach(n=>n.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var YA;(function(i){i.SYNC="sync",i.JOIN="join",i.LEAVE="leave"})(YA||(YA={}));class xh{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const n=(t==null?void 0:t.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(n.state,{},s=>{const{onJoin:o,onLeave:l,onSync:c}=this.caller;this.joinRef=this.channel._joinRef(),this.state=xh.syncState(this.state,s,o,l),this.pendingDiffs.forEach(d=>{this.state=xh.syncDiff(this.state,d,o,l)}),this.pendingDiffs=[],c()}),this.channel._on(n.diff,{},s=>{const{onJoin:o,onLeave:l,onSync:c}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(s):(this.state=xh.syncDiff(this.state,s,o,l),c())}),this.onJoin((s,o,l)=>{this.channel._trigger("presence",{event:"join",key:s,currentPresences:o,newPresences:l})}),this.onLeave((s,o,l)=>{this.channel._trigger("presence",{event:"leave",key:s,currentPresences:o,leftPresences:l})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,n,s){const o=this.cloneDeep(e),l=this.transformState(t),c={},d={};return this.map(o,(h,p)=>{l[h]||(d[h]=p)}),this.map(l,(h,p)=>{const y=o[h];if(y){const b=p.map(A=>A.presence_ref),S=y.map(A=>A.presence_ref),E=p.filter(A=>S.indexOf(A.presence_ref)<0),R=y.filter(A=>b.indexOf(A.presence_ref)<0);E.length>0&&(c[h]=E),R.length>0&&(d[h]=R)}else c[h]=p}),this.syncDiff(o,{joins:c,leaves:d},n,s)}static syncDiff(e,t,n,s){const{joins:o,leaves:l}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return n||(n=()=>{}),s||(s=()=>{}),this.map(o,(c,d)=>{var h;const p=(h=e[c])!==null&&h!==void 0?h:[];if(e[c]=this.cloneDeep(d),p.length>0){const y=e[c].map(S=>S.presence_ref),b=p.filter(S=>y.indexOf(S.presence_ref)<0);e[c].unshift(...b)}n(c,p,d)}),this.map(l,(c,d)=>{let h=e[c];if(!h)return;const p=d.map(y=>y.presence_ref);h=h.filter(y=>p.indexOf(y.presence_ref)<0),e[c]=h,s(c,h,d),h.length===0&&delete e[c]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(n=>t(n,e[n]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,n)=>{const s=e[n];return"metas"in s?t[n]=s.metas.map(o=>(o.presence_ref=o.phx_ref,delete o.phx_ref,delete o.phx_ref_prev,o)):t[n]=s,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var JA;(function(i){i.ALL="*",i.INSERT="INSERT",i.UPDATE="UPDATE",i.DELETE="DELETE"})(JA||(JA={}));var Sh;(function(i){i.BROADCAST="broadcast",i.PRESENCE="presence",i.POSTGRES_CHANGES="postgres_changes",i.SYSTEM="system"})(Sh||(Sh={}));var xr;(function(i){i.SUBSCRIBED="SUBSCRIBED",i.TIMED_OUT="TIMED_OUT",i.CLOSED="CLOSED",i.CHANNEL_ERROR="CHANNEL_ERROR"})(xr||(xr={}));class Wc{constructor(e,t={config:{}},n){var s,o;if(this.topic=e,this.params=t,this.socket=n,this.bindings={},this.state=sn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new Wy(this,ws.join,this.params,this.timeout),this.rejoinTimer=new _1(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=sn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(l=>l.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=sn.closed,this.socket._remove(this)}),this._onError(l=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,l),this.state=sn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=sn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",l=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,l),this.state=sn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(ws.reply,{},(l,c)=>{this._trigger(this._replyEventName(c),l)}),this.presence=new xh(this),this.broadcastEndpointURL=x1(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((o=(s=this.params.config)===null||s===void 0?void 0:s.broadcast)===null||o===void 0)&&o.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(e,t=this.timeout){var n,s,o;if(this.socket.isConnected()||this.socket.connect(),this.state==sn.closed){const{config:{broadcast:l,presence:c,private:d}}=this.params,h=(s=(n=this.bindings.postgres_changes)===null||n===void 0?void 0:n.map(S=>S.filter))!==null&&s!==void 0?s:[],p=!!this.bindings[Sh.PRESENCE]&&this.bindings[Sh.PRESENCE].length>0||((o=this.params.config.presence)===null||o===void 0?void 0:o.enabled)===!0,y={},b={broadcast:l,presence:Object.assign(Object.assign({},c),{enabled:p}),postgres_changes:h,private:d};this.socket.accessTokenValue&&(y.access_token=this.socket.accessTokenValue),this._onError(S=>e==null?void 0:e(xr.CHANNEL_ERROR,S)),this._onClose(()=>e==null?void 0:e(xr.CLOSED)),this.updateJoinPayload(Object.assign({config:b},y)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:S})=>{var E;if(this.socket._isManualToken()||this.socket.setAuth(),S===void 0){e==null||e(xr.SUBSCRIBED);return}else{const R=this.bindings.postgres_changes,A=(E=R==null?void 0:R.length)!==null&&E!==void 0?E:0,C=[];for(let k=0;k<A;k++){const I=R[k],{filter:{event:O,schema:U,table:P,filter:B}}=I,Q=S&&S[k];if(Q&&Q.event===O&&Wc.isFilterValueEqual(Q.schema,U)&&Wc.isFilterValueEqual(Q.table,P)&&Wc.isFilterValueEqual(Q.filter,B))C.push(Object.assign(Object.assign({},I),{id:Q.id}));else{this.unsubscribe(),this.state=sn.errored,e==null||e(xr.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=C,e&&e(xr.SUBSCRIBED);return}}).receive("error",S=>{this.state=sn.errored,e==null||e(xr.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(S).join(", ")||"error")))}).receive("timeout",()=>{e==null||e(xr.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,n){return this.state===sn.joined&&e===Sh.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(e,t,n)}async httpSend(e,t,n={}){var s;if(t==null)return Promise.reject("Payload is required for httpSend()");const o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const l={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:e,payload:t,private:this.private}]})},c=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=n.timeout)!==null&&s!==void 0?s:this.timeout);if(c.status===202)return{success:!0};let d=c.statusText;try{const h=await c.json();d=h.error||h.message||d}catch{}return Promise.reject(new Error(d))}async send(e,t={}){var n,s;if(!this._canPush()&&e.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:o,payload:l}=e,c={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(c.Authorization=`Bearer ${this.socket.accessTokenValue}`);const d={method:"POST",headers:c,body:JSON.stringify({messages:[{topic:this.subTopic,event:o,payload:l,private:this.private}]})};try{const h=await this._fetchWithTimeout(this.broadcastEndpointURL,d,(n=t.timeout)!==null&&n!==void 0?n:this.timeout);return await((s=h.body)===null||s===void 0?void 0:s.cancel()),h.ok?"ok":"error"}catch(h){return h.name==="AbortError"?"timed out":"error"}}else return new Promise(o=>{var l,c,d;const h=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((d=(c=(l=this.params)===null||l===void 0?void 0:l.config)===null||c===void 0?void 0:c.broadcast)===null||d===void 0)&&d.ack)&&o("ok"),h.receive("ok",()=>o("ok")),h.receive("error",()=>o("error")),h.receive("timeout",()=>o("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=sn.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(ws.close,"leave",this._joinRef())};this.joinPush.destroy();let n=null;return new Promise(s=>{n=new Wy(this,ws.leave,{},e),n.receive("ok",()=>{t(),s("ok")}).receive("timeout",()=>{t(),s("timed out")}).receive("error",()=>{s("error")}),n.send(),this._canPush()||n.trigger("ok",{})}).finally(()=>{n==null||n.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=sn.closed,this.bindings={}}async _fetchWithTimeout(e,t,n){const s=new AbortController,o=setTimeout(()=>s.abort(),n),l=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:s.signal}));return clearTimeout(o),l}_push(e,t,n=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let s=new Wy(this,e,t,n);return this._canPush()?s.send():this._addToPushBuffer(s),s}_addToPushBuffer(e){if(e.startTimeout(),this.pushBuffer.push(e),this.pushBuffer.length>fM){const t=this.pushBuffer.shift();t&&(t.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${t.event}`,t.payload))}}_onMessage(e,t,n){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,n){var s,o;const l=e.toLocaleLowerCase(),{close:c,error:d,leave:h,join:p}=ws;if(n&&[c,d,h,p].indexOf(l)>=0&&n!==this._joinRef())return;let b=this._onMessage(l,t,n);if(t&&!b)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(l)?(s=this.bindings.postgres_changes)===null||s===void 0||s.filter(S=>{var E,R,A;return((E=S.filter)===null||E===void 0?void 0:E.event)==="*"||((A=(R=S.filter)===null||R===void 0?void 0:R.event)===null||A===void 0?void 0:A.toLocaleLowerCase())===l}).map(S=>S.callback(b,n)):(o=this.bindings[l])===null||o===void 0||o.filter(S=>{var E,R,A,C,k,I;if(["broadcast","presence","postgres_changes"].includes(l))if("id"in S){const O=S.id,U=(E=S.filter)===null||E===void 0?void 0:E.event;return O&&((R=t.ids)===null||R===void 0?void 0:R.includes(O))&&(U==="*"||(U==null?void 0:U.toLocaleLowerCase())===((A=t.data)===null||A===void 0?void 0:A.type.toLocaleLowerCase()))}else{const O=(k=(C=S==null?void 0:S.filter)===null||C===void 0?void 0:C.event)===null||k===void 0?void 0:k.toLocaleLowerCase();return O==="*"||O===((I=t==null?void 0:t.event)===null||I===void 0?void 0:I.toLocaleLowerCase())}else return S.type.toLocaleLowerCase()===l}).map(S=>{if(typeof b=="object"&&"ids"in b){const E=b.data,{schema:R,table:A,commit_timestamp:C,type:k,errors:I}=E;b=Object.assign(Object.assign({},{schema:R,table:A,commit_timestamp:C,eventType:k,new:{},old:{},errors:I}),this._getPayloadRecords(E))}S.callback(b,n)})}_isClosed(){return this.state===sn.closed}_isJoined(){return this.state===sn.joined}_isJoining(){return this.state===sn.joining}_isLeaving(){return this.state===sn.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,n){const s=e.toLocaleLowerCase(),o={type:s,filter:t,callback:n};return this.bindings[s]?this.bindings[s].push(o):this.bindings[s]=[o],this}_off(e,t){const n=e.toLocaleLowerCase();return this.bindings[n]&&(this.bindings[n]=this.bindings[n].filter(s=>{var o;return!(((o=s.type)===null||o===void 0?void 0:o.toLocaleLowerCase())===n&&Wc.isEqual(s.filter,t))})),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const n in e)if(e[n]!==t[n])return!1;return!0}static isFilterValueEqual(e,t){return(e??void 0)===(t??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(ws.close,{},e)}_onError(e){this._on(ws.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=sn.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=$A(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=$A(e.columns,e.old_record)),t}}const Xy=()=>{},Fm={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},wM=[1e3,2e3,5e3,1e4],xM=1e4,SM=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class EM{constructor(e,t){var n;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=yb,this.transport=null,this.heartbeatIntervalMs=Fm.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Xy,this.ref=0,this.reconnectTimer=null,this.vsn=zA,this.logger=Xy,this.conn=null,this.sendBuffer=[],this.serializer=new pM,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=s=>s?(...o)=>s(...o):(...o)=>fetch(...o),!(!((n=t==null?void 0:t.params)===null||n===void 0)&&n.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=t.params.apikey,this.endPoint=`${e}/${bb.websocket}`,this.httpEndpoint=x1(e),this._initializeOptions(t),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(t==null?void 0:t.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=lM.createWebSocket(this.endpointURL())}catch(e){this._setConnectionState("disconnected");const t=e.message;throw t.includes("Node.js")?new Error(`${t}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${t}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(e,t){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const n=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(n),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(e?this.conn.close(e,t??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,n){this.logger(e,t,n)}connectionState(){switch(this.conn&&this.conn.readyState){case Oo.connecting:return Fa.Connecting;case Oo.open:return Fa.Open;case Oo.closing:return Fa.Closing;default:return Fa.Closed}}isConnected(){return this.connectionState()===Fa.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(e,t={config:{}}){const n=`realtime:${e}`,s=this.getChannels().find(o=>o.topic===n);if(s)return s;{const o=new Wc(`realtime:${e}`,t,this);return this.channels.push(o),o}}push(e){const{topic:t,event:n,payload:s,ref:o}=e,l=()=>{this.encode(e,c=>{var d;(d=this.conn)===null||d===void 0||d.send(c)})};this.log("push",`${t} ${n} (${o})`,s),this.isConnected()?l():this.sendBuffer.push(l)}async setAuth(e=null){this._authPromise=this._performAuth(e);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var e;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(t){this.log("error","error in heartbeat callback",t)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(t){this.log("error","error in heartbeat callback",t)}this._wasManualDisconnect=!1,(e=this.conn)===null||e===void 0||e.close(hM,"heartbeat timeout"),setTimeout(()=>{var t;this.isConnected()||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout()},Fm.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(t){this.log("error","error in heartbeat callback",t)}this._setAuthSafely("heartbeat")}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(n=>n.topic===e&&(n._isJoined()||n._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}_onConnMessage(e){this.decode(e.data,t=>{if(t.topic==="phoenix"&&t.event==="phx_reply"&&t.ref&&t.ref===this.pendingHeartbeatRef){const h=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(t.payload.status==="ok"?"ok":"error",h)}catch(p){this.log("error","error in heartbeat callback",p)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:n,event:s,payload:o,ref:l}=t,c=l?`(${l})`:"",d=o.status||"";this.log("receive",`${d} ${n} ${s} ${c}`.trim(),o),this.channels.filter(h=>h._isMember(n)).forEach(h=>h._trigger(s,o,l)),this._triggerStateCallbacks("message",t)})}_clearTimer(e){var t;e==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):e==="reconnect"&&((t=this.reconnectTimer)===null||t===void 0||t.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e),this.conn.readyState===Oo.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===Oo.open||this.conn.readyState===Oo.connecting)try{this.conn.close()}catch(e){this.log("error","Error closing connection",e)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(e=>e.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(t=>{this.log("error","error waiting for auth on connect",t),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this._terminateWorker()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(e){var t;this._setConnectionState("disconnected"),this.log("transport","close",e),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(t=this.reconnectTimer)===null||t===void 0||t.scheduleTimeout(),this._triggerStateCallbacks("close",e)}_onConnError(e){this._setConnectionState("disconnected"),this.log("transport",`${e}`),this._triggerChanError(),this._triggerStateCallbacks("error",e);try{this.heartbeatCallback("error")}catch(t){this.log("error","error in heartbeat callback",t)}}_triggerChanError(){this.channels.forEach(e=>e._trigger(ws.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const n=e.match(/\?/)?"&":"?",s=new URLSearchParams(t);return`${e}${n}${s}`}_workerObjectUrl(e){let t;if(e)t=e;else{const n=new Blob([SM],{type:"application/javascript"});t=URL.createObjectURL(n)}return t}_setConnectionState(e,t=!1){this._connectionState=e,e==="connecting"?this._wasManualDisconnect=!1:e==="disconnecting"&&(this._wasManualDisconnect=t)}async _performAuth(e=null){let t,n=!1;if(e)t=e,n=!0;else if(this.accessToken)try{t=await this.accessToken()}catch(s){this.log("error","Error fetching access token from callback",s),t=this.accessTokenValue}else t=this.accessTokenValue;n?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const o={access_token:t,version:uM};t&&s.updateJoinPayload(o),s.joinedOnce&&s._isJoined()&&s._push(ws.access_token,{access_token:t})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(e="general"){this._isManualToken()||this.setAuth().catch(t=>{this.log("error",`Error setting auth in ${e}`,t)})}_triggerStateCallbacks(e,t){try{this.stateChangeCallbacks[e].forEach(n=>{try{n(t)}catch(s){this.log("error",`error in ${e} callback`,s)}})}catch(n){this.log("error",`error triggering ${e} callbacks`,n)}}_setupReconnectionTimer(){this.reconnectTimer=new _1(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},Fm.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(e){var t,n,s,o,l,c,d,h,p,y,b,S;switch(this.transport=(t=e==null?void 0:e.transport)!==null&&t!==void 0?t:null,this.timeout=(n=e==null?void 0:e.timeout)!==null&&n!==void 0?n:yb,this.heartbeatIntervalMs=(s=e==null?void 0:e.heartbeatIntervalMs)!==null&&s!==void 0?s:Fm.HEARTBEAT_INTERVAL,this.worker=(o=e==null?void 0:e.worker)!==null&&o!==void 0?o:!1,this.accessToken=(l=e==null?void 0:e.accessToken)!==null&&l!==void 0?l:null,this.heartbeatCallback=(c=e==null?void 0:e.heartbeatCallback)!==null&&c!==void 0?c:Xy,this.vsn=(d=e==null?void 0:e.vsn)!==null&&d!==void 0?d:zA,e!=null&&e.params&&(this.params=e.params),e!=null&&e.logger&&(this.logger=e.logger),(e!=null&&e.logLevel||e!=null&&e.log_level)&&(this.logLevel=e.logLevel||e.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(h=e==null?void 0:e.reconnectAfterMs)!==null&&h!==void 0?h:(E=>wM[E-1]||xM),this.vsn){case dM:this.encode=(p=e==null?void 0:e.encode)!==null&&p!==void 0?p:((E,R)=>R(JSON.stringify(E))),this.decode=(y=e==null?void 0:e.decode)!==null&&y!==void 0?y:((E,R)=>R(JSON.parse(E)));break;case b1:this.encode=(b=e==null?void 0:e.encode)!==null&&b!==void 0?b:this.serializer.encode.bind(this.serializer),this.decode=(S=e==null?void 0:e.decode)!==null&&S!==void 0?S:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=e==null?void 0:e.workerUrl}}}var Rh=class extends Error{constructor(i,e){var t;super(i),this.name="IcebergError",this.status=e.status,this.icebergType=e.icebergType,this.icebergCode=e.icebergCode,this.details=e.details,this.isCommitStateUnknown=e.icebergType==="CommitStateUnknownException"||[500,502,504].includes(e.status)&&((t=e.icebergType)==null?void 0:t.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function AM(i,e,t){const n=new URL(e,i);if(t)for(const[s,o]of Object.entries(t))o!==void 0&&n.searchParams.set(s,o);return n.toString()}async function TM(i){return!i||i.type==="none"?{}:i.type==="bearer"?{Authorization:`Bearer ${i.token}`}:i.type==="header"?{[i.name]:i.value}:i.type==="custom"?await i.getHeaders():{}}function CM(i){const e=i.fetchImpl??globalThis.fetch;return{async request({method:t,path:n,query:s,body:o,headers:l}){const c=AM(i.baseUrl,n,s),d=await TM(i.auth),h=await e(c,{method:t,headers:{...o?{"Content-Type":"application/json"}:{},...d,...l},body:o?JSON.stringify(o):void 0}),p=await h.text(),y=(h.headers.get("content-type")||"").includes("application/json"),b=y&&p?JSON.parse(p):p;if(!h.ok){const S=y?b:void 0,E=S==null?void 0:S.error;throw new Rh((E==null?void 0:E.message)??`Request failed with status ${h.status}`,{status:h.status,icebergType:E==null?void 0:E.type,icebergCode:E==null?void 0:E.code,details:S})}return{status:h.status,headers:h.headers,data:b}}}}function Hm(i){return i.join("")}var RM=class{constructor(i,e=""){this.client=i,this.prefix=e}async listNamespaces(i){const e=i?{parent:Hm(i.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:e})).data.namespaces.map(n=>({namespace:n}))}async createNamespace(i,e){const t={namespace:i.namespace,properties:e==null?void 0:e.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:t})).data}async dropNamespace(i){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Hm(i.namespace)}`})}async loadNamespaceMetadata(i){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Hm(i.namespace)}`})).data.properties}}async namespaceExists(i){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Hm(i.namespace)}`}),!0}catch(e){if(e instanceof Rh&&e.status===404)return!1;throw e}}async createNamespaceIfNotExists(i,e){try{return await this.createNamespace(i,e)}catch(t){if(t instanceof Rh&&t.status===409)return;throw t}}};function Dc(i){return i.join("")}var NM=class{constructor(i,e="",t){this.client=i,this.prefix=e,this.accessDelegation=t}async listTables(i){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Dc(i.namespace)}/tables`})).data.identifiers}async createTable(i,e){const t={};return this.accessDelegation&&(t["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Dc(i.namespace)}/tables`,body:e,headers:t})).data.metadata}async updateTable(i,e){const t=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Dc(i.namespace)}/tables/${i.name}`,body:e});return{"metadata-location":t.data["metadata-location"],metadata:t.data.metadata}}async dropTable(i,e){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Dc(i.namespace)}/tables/${i.name}`,query:{purgeRequested:String((e==null?void 0:e.purge)??!1)}})}async loadTable(i){const e={};return this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Dc(i.namespace)}/tables/${i.name}`,headers:e})).data.metadata}async tableExists(i){const e={};this.accessDelegation&&(e["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Dc(i.namespace)}/tables/${i.name}`,headers:e}),!0}catch(t){if(t instanceof Rh&&t.status===404)return!1;throw t}}async createTableIfNotExists(i,e){try{return await this.createTable(i,e)}catch(t){if(t instanceof Rh&&t.status===409)return await this.loadTable({namespace:i.namespace,name:e.name});throw t}}},kM=class{constructor(i){var n;let e="v1";i.catalogName&&(e+=`/${i.catalogName}`);const t=i.baseUrl.endsWith("/")?i.baseUrl:`${i.baseUrl}/`;this.client=CM({baseUrl:t,auth:i.auth,fetchImpl:i.fetch}),this.accessDelegation=(n=i.accessDelegation)==null?void 0:n.join(","),this.namespaceOps=new RM(this.client,e),this.tableOps=new NM(this.client,e,this.accessDelegation)}async listNamespaces(i){return this.namespaceOps.listNamespaces(i)}async createNamespace(i,e){return this.namespaceOps.createNamespace(i,e)}async dropNamespace(i){await this.namespaceOps.dropNamespace(i)}async loadNamespaceMetadata(i){return this.namespaceOps.loadNamespaceMetadata(i)}async listTables(i){return this.tableOps.listTables(i)}async createTable(i,e){return this.tableOps.createTable(i,e)}async updateTable(i,e){return this.tableOps.updateTable(i,e)}async dropTable(i,e){await this.tableOps.dropTable(i,e)}async loadTable(i){return this.tableOps.loadTable(i)}async namespaceExists(i){return this.namespaceOps.namespaceExists(i)}async tableExists(i){return this.tableOps.tableExists(i)}async createNamespaceIfNotExists(i,e){return this.namespaceOps.createNamespaceIfNotExists(i,e)}async createTableIfNotExists(i,e){return this.tableOps.createTableIfNotExists(i,e)}},f0=class extends Error{constructor(i,e="storage",t,n){super(i),this.__isStorageError=!0,this.namespace=e,this.name=e==="vectors"?"StorageVectorsError":"StorageError",this.status=t,this.statusCode=n}};function p0(i){return typeof i=="object"&&i!==null&&"__isStorageError"in i}var Bm=class extends f0{constructor(i,e,t,n="storage"){super(i,n,e,t),this.name=n==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=e,this.statusCode=t}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},S1=class extends f0{constructor(i,e,t="storage"){super(i,t),this.name=t==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=e}};const IM=i=>i?(...e)=>i(...e):(...e)=>fetch(...e),MM=i=>{if(typeof i!="object"||i===null)return!1;const e=Object.getPrototypeOf(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},wb=i=>{if(Array.isArray(i))return i.map(t=>wb(t));if(typeof i=="function"||i!==Object(i))return i;const e={};return Object.entries(i).forEach(([t,n])=>{const s=t.replace(/([-_][a-z])/gi,o=>o.toUpperCase().replace(/[-_]/g,""));e[s]=wb(n)}),e},DM=i=>!i||typeof i!="string"||i.length===0||i.length>100||i.trim()!==i||i.includes("/")||i.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(i);function Nh(i){"@babel/helpers - typeof";return Nh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Nh(i)}function LM(i,e){if(Nh(i)!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(Nh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function PM(i){var e=LM(i,"string");return Nh(e)=="symbol"?e:e+""}function OM(i,e,t){return(e=PM(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function KA(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,n)}return t}function De(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?KA(Object(t),!0).forEach(function(n){OM(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):KA(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}const WA=i=>{var e;return i.msg||i.message||i.error_description||(typeof i.error=="string"?i.error:(e=i.error)===null||e===void 0?void 0:e.message)||JSON.stringify(i)},UM=async(i,e,t,n)=>{if(i&&typeof i=="object"&&"status"in i&&"ok"in i&&typeof i.status=="number"&&!(t!=null&&t.noResolveJson)){const s=i,o=s.status||500;if(typeof s.json=="function")s.json().then(l=>{const c=(l==null?void 0:l.statusCode)||(l==null?void 0:l.code)||o+"";e(new Bm(WA(l),o,c,n))}).catch(()=>{if(n==="vectors"){const l=o+"";e(new Bm(s.statusText||`HTTP ${o} error`,o,l,n))}else{const l=o+"";e(new Bm(s.statusText||`HTTP ${o} error`,o,l,n))}});else{const l=o+"";e(new Bm(s.statusText||`HTTP ${o} error`,o,l,n))}}else e(new S1(WA(i),i,n))},FM=(i,e,t,n)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"||i==="HEAD"||!n?De(De({},s),t):(MM(n)?(s.headers=De({"Content-Type":"application/json"},e==null?void 0:e.headers),s.body=JSON.stringify(n)):s.body=n,e!=null&&e.duplex&&(s.duplex=e.duplex),De(De({},s),t))};async function Qd(i,e,t,n,s,o,l){return new Promise((c,d)=>{i(t,FM(e,n,s,o)).then(h=>{if(!h.ok)throw h;if(n!=null&&n.noResolveJson)return h;if(l==="vectors"){const p=h.headers.get("content-type");if(h.headers.get("content-length")==="0"||h.status===204)return{};if(!p||!p.includes("application/json"))return{}}return h.json()}).then(h=>c(h)).catch(h=>UM(h,d,n,l))})}function E1(i="storage"){return{get:async(e,t,n,s)=>Qd(e,"GET",t,n,s,void 0,i),post:async(e,t,n,s,o)=>Qd(e,"POST",t,s,o,n,i),put:async(e,t,n,s,o)=>Qd(e,"PUT",t,s,o,n,i),head:async(e,t,n,s)=>Qd(e,"HEAD",t,De(De({},n),{},{noResolveJson:!0}),s,void 0,i),remove:async(e,t,n,s,o)=>Qd(e,"DELETE",t,s,o,n,i)}}const HM=E1("storage"),{get:kh,post:os,put:xb,head:BM,remove:lw}=HM,Li=E1("vectors");var td=class{constructor(i,e={},t,n="storage"){this.shouldThrowOnError=!1,this.url=i,this.headers=e,this.fetch=IM(t),this.namespace=n}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(i,e){return this.headers=De(De({},this.headers),{},{[i]:e}),this}async handleOperation(i){var e=this;try{return{data:await i(),error:null}}catch(t){if(e.shouldThrowOnError)throw t;if(p0(t))return{data:null,error:t};throw t}}},jM=class{constructor(i,e){this.downloadFn=i,this.shouldThrowOnError=e}then(i,e){return this.execute().then(i,e)}async execute(){var i=this;try{return{data:(await i.downloadFn()).body,error:null}}catch(e){if(i.shouldThrowOnError)throw e;if(p0(e))return{data:null,error:e};throw e}}};let A1;A1=Symbol.toStringTag;var qM=class{constructor(i,e){this.downloadFn=i,this.shouldThrowOnError=e,this[A1]="BlobDownloadBuilder",this.promise=null}asStream(){return new jM(this.downloadFn,this.shouldThrowOnError)}then(i,e){return this.getPromise().then(i,e)}catch(i){return this.getPromise().catch(i)}finally(i){return this.getPromise().finally(i)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var i=this;try{return{data:await(await i.downloadFn()).blob(),error:null}}catch(e){if(i.shouldThrowOnError)throw e;if(p0(e))return{data:null,error:e};throw e}}};const GM={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},XA={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var VM=class extends td{constructor(i,e={},t,n){super(i,e,n,"storage"),this.bucketId=t}async uploadOrUpdate(i,e,t,n){var s=this;return s.handleOperation(async()=>{let o;const l=De(De({},XA),n);let c=De(De({},s.headers),i==="POST"&&{"x-upsert":String(l.upsert)});const d=l.metadata;typeof Blob<"u"&&t instanceof Blob?(o=new FormData,o.append("cacheControl",l.cacheControl),d&&o.append("metadata",s.encodeMetadata(d)),o.append("",t)):typeof FormData<"u"&&t instanceof FormData?(o=t,o.has("cacheControl")||o.append("cacheControl",l.cacheControl),d&&!o.has("metadata")&&o.append("metadata",s.encodeMetadata(d))):(o=t,c["cache-control"]=`max-age=${l.cacheControl}`,c["content-type"]=l.contentType,d&&(c["x-metadata"]=s.toBase64(s.encodeMetadata(d))),(typeof ReadableStream<"u"&&o instanceof ReadableStream||o&&typeof o=="object"&&"pipe"in o&&typeof o.pipe=="function")&&!l.duplex&&(l.duplex="half")),n!=null&&n.headers&&(c=De(De({},c),n.headers));const h=s._removeEmptyFolders(e),p=s._getFinalPath(h),y=await(i=="PUT"?xb:os)(s.fetch,`${s.url}/object/${p}`,o,De({headers:c},l!=null&&l.duplex?{duplex:l.duplex}:{}));return{path:h,id:y.Id,fullPath:y.Key}})}async upload(i,e,t){return this.uploadOrUpdate("POST",i,e,t)}async uploadToSignedUrl(i,e,t,n){var s=this;const o=s._removeEmptyFolders(i),l=s._getFinalPath(o),c=new URL(s.url+`/object/upload/sign/${l}`);return c.searchParams.set("token",e),s.handleOperation(async()=>{let d;const h=De({upsert:XA.upsert},n),p=De(De({},s.headers),{"x-upsert":String(h.upsert)});return typeof Blob<"u"&&t instanceof Blob?(d=new FormData,d.append("cacheControl",h.cacheControl),d.append("",t)):typeof FormData<"u"&&t instanceof FormData?(d=t,d.append("cacheControl",h.cacheControl)):(d=t,p["cache-control"]=`max-age=${h.cacheControl}`,p["content-type"]=h.contentType),{path:o,fullPath:(await xb(s.fetch,c.toString(),d,{headers:p})).Key}})}async createSignedUploadUrl(i,e){var t=this;return t.handleOperation(async()=>{let n=t._getFinalPath(i);const s=De({},t.headers);e!=null&&e.upsert&&(s["x-upsert"]="true");const o=await os(t.fetch,`${t.url}/object/upload/sign/${n}`,{},{headers:s}),l=new URL(t.url+o.url),c=l.searchParams.get("token");if(!c)throw new f0("No token returned by API");return{signedUrl:l.toString(),path:i,token:c}})}async update(i,e,t){return this.uploadOrUpdate("PUT",i,e,t)}async move(i,e,t){var n=this;return n.handleOperation(async()=>await os(n.fetch,`${n.url}/object/move`,{bucketId:n.bucketId,sourceKey:i,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:n.headers}))}async copy(i,e,t){var n=this;return n.handleOperation(async()=>({path:(await os(n.fetch,`${n.url}/object/copy`,{bucketId:n.bucketId,sourceKey:i,destinationKey:e,destinationBucket:t==null?void 0:t.destinationBucket},{headers:n.headers})).Key}))}async createSignedUrl(i,e,t){var n=this;return n.handleOperation(async()=>{let s=n._getFinalPath(i),o=await os(n.fetch,`${n.url}/object/sign/${s}`,De({expiresIn:e},t!=null&&t.transform?{transform:t.transform}:{}),{headers:n.headers});const l=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return{signedUrl:encodeURI(`${n.url}${o.signedURL}${l}`)}})}async createSignedUrls(i,e,t){var n=this;return n.handleOperation(async()=>{const s=await os(n.fetch,`${n.url}/object/sign/${n.bucketId}`,{expiresIn:e,paths:i},{headers:n.headers}),o=t!=null&&t.download?`&download=${t.download===!0?"":t.download}`:"";return s.map(l=>De(De({},l),{},{signedUrl:l.signedURL?encodeURI(`${n.url}${l.signedURL}${o}`):null}))})}download(i,e,t){const n=typeof(e==null?void 0:e.transform)<"u"?"render/image/authenticated":"object",s=this.transformOptsToQueryString((e==null?void 0:e.transform)||{}),o=s?`?${s}`:"",l=this._getFinalPath(i),c=()=>kh(this.fetch,`${this.url}/${n}/${l}${o}`,{headers:this.headers,noResolveJson:!0},t);return new qM(c,this.shouldThrowOnError)}async info(i){var e=this;const t=e._getFinalPath(i);return e.handleOperation(async()=>wb(await kh(e.fetch,`${e.url}/object/info/${t}`,{headers:e.headers})))}async exists(i){var e=this;const t=e._getFinalPath(i);try{return await BM(e.fetch,`${e.url}/object/${t}`,{headers:e.headers}),{data:!0,error:null}}catch(n){if(e.shouldThrowOnError)throw n;if(p0(n)&&n instanceof S1){const s=n.originalError;if([400,404].includes(s==null?void 0:s.status))return{data:!1,error:n}}throw n}}getPublicUrl(i,e){const t=this._getFinalPath(i),n=[],s=e!=null&&e.download?`download=${e.download===!0?"":e.download}`:"";s!==""&&n.push(s);const o=typeof(e==null?void 0:e.transform)<"u"?"render/image":"object",l=this.transformOptsToQueryString((e==null?void 0:e.transform)||{});l!==""&&n.push(l);let c=n.join("&");return c!==""&&(c=`?${c}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${t}${c}`)}}}async remove(i){var e=this;return e.handleOperation(async()=>await lw(e.fetch,`${e.url}/object/${e.bucketId}`,{prefixes:i},{headers:e.headers}))}async list(i,e,t){var n=this;return n.handleOperation(async()=>{const s=De(De(De({},GM),e),{},{prefix:i||""});return await os(n.fetch,`${n.url}/object/list/${n.bucketId}`,s,{headers:n.headers},t)})}async listV2(i,e){var t=this;return t.handleOperation(async()=>{const n=De({},i);return await os(t.fetch,`${t.url}/object/list-v2/${t.bucketId}`,n,{headers:t.headers},e)})}encodeMetadata(i){return JSON.stringify(i)}toBase64(i){return typeof Buffer<"u"?Buffer.from(i).toString("base64"):btoa(i)}_getFinalPath(i){return`${this.bucketId}/${i.replace(/^\/+/,"")}`}_removeEmptyFolders(i){return i.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(i){const e=[];return i.width&&e.push(`width=${i.width}`),i.height&&e.push(`height=${i.height}`),i.resize&&e.push(`resize=${i.resize}`),i.format&&e.push(`format=${i.format}`),i.quality&&e.push(`quality=${i.quality}`),e.join("&")}};const zM="2.97.0",mp={"X-Client-Info":`storage-js/${zM}`};var $M=class extends td{constructor(i,e={},t,n){const s=new URL(i);n!=null&&n.useNewHostname&&/supabase\.(co|in|red)$/.test(s.hostname)&&!s.hostname.includes("storage.supabase.")&&(s.hostname=s.hostname.replace("supabase.","storage.supabase."));const o=s.href.replace(/\/$/,""),l=De(De({},mp),e);super(o,l,t,"storage")}async listBuckets(i){var e=this;return e.handleOperation(async()=>{const t=e.listBucketOptionsToQueryString(i);return await kh(e.fetch,`${e.url}/bucket${t}`,{headers:e.headers})})}async getBucket(i){var e=this;return e.handleOperation(async()=>await kh(e.fetch,`${e.url}/bucket/${i}`,{headers:e.headers}))}async createBucket(i,e={public:!1}){var t=this;return t.handleOperation(async()=>await os(t.fetch,`${t.url}/bucket`,{id:i,name:i,type:e.type,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}))}async updateBucket(i,e){var t=this;return t.handleOperation(async()=>await xb(t.fetch,`${t.url}/bucket/${i}`,{id:i,name:i,public:e.public,file_size_limit:e.fileSizeLimit,allowed_mime_types:e.allowedMimeTypes},{headers:t.headers}))}async emptyBucket(i){var e=this;return e.handleOperation(async()=>await os(e.fetch,`${e.url}/bucket/${i}/empty`,{},{headers:e.headers}))}async deleteBucket(i){var e=this;return e.handleOperation(async()=>await lw(e.fetch,`${e.url}/bucket/${i}`,{},{headers:e.headers}))}listBucketOptionsToQueryString(i){const e={};return i&&("limit"in i&&(e.limit=String(i.limit)),"offset"in i&&(e.offset=String(i.offset)),i.search&&(e.search=i.search),i.sortColumn&&(e.sortColumn=i.sortColumn),i.sortOrder&&(e.sortOrder=i.sortOrder)),Object.keys(e).length>0?"?"+new URLSearchParams(e).toString():""}},YM=class extends td{constructor(i,e={},t){const n=i.replace(/\/$/,""),s=De(De({},mp),e);super(n,s,t,"storage")}async createBucket(i){var e=this;return e.handleOperation(async()=>await os(e.fetch,`${e.url}/bucket`,{name:i},{headers:e.headers}))}async listBuckets(i){var e=this;return e.handleOperation(async()=>{const t=new URLSearchParams;(i==null?void 0:i.limit)!==void 0&&t.set("limit",i.limit.toString()),(i==null?void 0:i.offset)!==void 0&&t.set("offset",i.offset.toString()),i!=null&&i.sortColumn&&t.set("sortColumn",i.sortColumn),i!=null&&i.sortOrder&&t.set("sortOrder",i.sortOrder),i!=null&&i.search&&t.set("search",i.search);const n=t.toString(),s=n?`${e.url}/bucket?${n}`:`${e.url}/bucket`;return await kh(e.fetch,s,{headers:e.headers})})}async deleteBucket(i){var e=this;return e.handleOperation(async()=>await lw(e.fetch,`${e.url}/bucket/${i}`,{},{headers:e.headers}))}from(i){var e=this;if(!DM(i))throw new f0("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const t=new kM({baseUrl:this.url,catalogName:i,auth:{type:"custom",getHeaders:async()=>e.headers},fetch:this.fetch}),n=this.shouldThrowOnError;return new Proxy(t,{get(s,o){const l=s[o];return typeof l!="function"?l:async(...c)=>{try{return{data:await l.apply(s,c),error:null}}catch(d){if(n)throw d;return{data:null,error:d}}}}})}},JM=class extends td{constructor(i,e={},t){const n=i.replace(/\/$/,""),s=De(De({},mp),{},{"Content-Type":"application/json"},e);super(n,s,t,"vectors")}async createIndex(i){var e=this;return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/CreateIndex`,i,{headers:e.headers})||{})}async getIndex(i,e){var t=this;return t.handleOperation(async()=>await Li.post(t.fetch,`${t.url}/GetIndex`,{vectorBucketName:i,indexName:e},{headers:t.headers}))}async listIndexes(i){var e=this;return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/ListIndexes`,i,{headers:e.headers}))}async deleteIndex(i,e){var t=this;return t.handleOperation(async()=>await Li.post(t.fetch,`${t.url}/DeleteIndex`,{vectorBucketName:i,indexName:e},{headers:t.headers})||{})}},KM=class extends td{constructor(i,e={},t){const n=i.replace(/\/$/,""),s=De(De({},mp),{},{"Content-Type":"application/json"},e);super(n,s,t,"vectors")}async putVectors(i){var e=this;if(i.vectors.length<1||i.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/PutVectors`,i,{headers:e.headers})||{})}async getVectors(i){var e=this;return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/GetVectors`,i,{headers:e.headers}))}async listVectors(i){var e=this;if(i.segmentCount!==void 0){if(i.segmentCount<1||i.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(i.segmentIndex!==void 0&&(i.segmentIndex<0||i.segmentIndex>=i.segmentCount))throw new Error(`segmentIndex must be between 0 and ${i.segmentCount-1}`)}return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/ListVectors`,i,{headers:e.headers}))}async queryVectors(i){var e=this;return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/QueryVectors`,i,{headers:e.headers}))}async deleteVectors(i){var e=this;if(i.keys.length<1||i.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/DeleteVectors`,i,{headers:e.headers})||{})}},WM=class extends td{constructor(i,e={},t){const n=i.replace(/\/$/,""),s=De(De({},mp),{},{"Content-Type":"application/json"},e);super(n,s,t,"vectors")}async createBucket(i){var e=this;return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/CreateVectorBucket`,{vectorBucketName:i},{headers:e.headers})||{})}async getBucket(i){var e=this;return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/GetVectorBucket`,{vectorBucketName:i},{headers:e.headers}))}async listBuckets(i={}){var e=this;return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/ListVectorBuckets`,i,{headers:e.headers}))}async deleteBucket(i){var e=this;return e.handleOperation(async()=>await Li.post(e.fetch,`${e.url}/DeleteVectorBucket`,{vectorBucketName:i},{headers:e.headers})||{})}},XM=class extends WM{constructor(i,e={}){super(i,e.headers||{},e.fetch)}from(i){return new QM(this.url,this.headers,i,this.fetch)}async createBucket(i){var e=()=>super.createBucket,t=this;return e().call(t,i)}async getBucket(i){var e=()=>super.getBucket,t=this;return e().call(t,i)}async listBuckets(i={}){var e=()=>super.listBuckets,t=this;return e().call(t,i)}async deleteBucket(i){var e=()=>super.deleteBucket,t=this;return e().call(t,i)}},QM=class extends JM{constructor(i,e,t,n){super(i,e,n),this.vectorBucketName=t}async createIndex(i){var e=()=>super.createIndex,t=this;return e().call(t,De(De({},i),{},{vectorBucketName:t.vectorBucketName}))}async listIndexes(i={}){var e=()=>super.listIndexes,t=this;return e().call(t,De(De({},i),{},{vectorBucketName:t.vectorBucketName}))}async getIndex(i){var e=()=>super.getIndex,t=this;return e().call(t,t.vectorBucketName,i)}async deleteIndex(i){var e=()=>super.deleteIndex,t=this;return e().call(t,t.vectorBucketName,i)}index(i){return new ZM(this.url,this.headers,this.vectorBucketName,i,this.fetch)}},ZM=class extends KM{constructor(i,e,t,n,s){super(i,e,s),this.vectorBucketName=t,this.indexName=n}async putVectors(i){var e=()=>super.putVectors,t=this;return e().call(t,De(De({},i),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async getVectors(i){var e=()=>super.getVectors,t=this;return e().call(t,De(De({},i),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async listVectors(i={}){var e=()=>super.listVectors,t=this;return e().call(t,De(De({},i),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async queryVectors(i){var e=()=>super.queryVectors,t=this;return e().call(t,De(De({},i),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}async deleteVectors(i){var e=()=>super.deleteVectors,t=this;return e().call(t,De(De({},i),{},{vectorBucketName:t.vectorBucketName,indexName:t.indexName}))}},eD=class extends $M{constructor(i,e={},t,n){super(i,e,t,n)}from(i){return new VM(this.url,this.headers,i,this.fetch)}get vectors(){return new XM(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new YM(this.url+"/iceberg",this.headers,this.fetch)}};const T1="2.97.0",jc=30*1e3,Sb=3,Qy=Sb*jc,tD="http://localhost:9999",nD="supabase.auth.token",iD={"X-Client-Info":`gotrue-js/${T1}`},Eb="X-Supabase-Api-Version",C1={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},sD=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,rD=600*1e3;class Ih extends Error{constructor(e,t,n){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=n}}function Se(i){return typeof i=="object"&&i!==null&&"__isAuthError"in i}class oD extends Ih{constructor(e,t,n){super(e,t,n),this.name="AuthApiError",this.status=t,this.code=n}}function aD(i){return Se(i)&&i.name==="AuthApiError"}class Ha extends Ih{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class so extends Ih{constructor(e,t,n,s){super(e,n,s),this.name=t,this.status=n}}class xi extends so{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Zy(i){return Se(i)&&i.name==="AuthSessionMissingError"}class Lc extends so{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class jm extends so{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class qm extends so{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function lD(i){return Se(i)&&i.name==="AuthImplicitGrantRedirectError"}class QA extends so{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class cD extends so{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class Ab extends so{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function eb(i){return Se(i)&&i.name==="AuthRetryableFetchError"}class ZA extends so{constructor(e,t,n){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=n}}class Tb extends so{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const kg="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),eT=` 	
\r=`.split(""),uD=(()=>{const i=new Array(128);for(let e=0;e<i.length;e+=1)i[e]=-1;for(let e=0;e<eT.length;e+=1)i[eT[e].charCodeAt(0)]=-2;for(let e=0;e<kg.length;e+=1)i[kg[e].charCodeAt(0)]=e;return i})();function tT(i,e,t){if(i!==null)for(e.queue=e.queue<<8|i,e.queuedBits+=8;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(kg[n]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const n=e.queue>>e.queuedBits-6&63;t(kg[n]),e.queuedBits-=6}}function R1(i,e,t){const n=uD[i];if(n>-1)for(e.queue=e.queue<<6|n,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(n===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(i)}"`)}}function nT(i){const e=[],t=l=>{e.push(String.fromCodePoint(l))},n={utf8seq:0,codepoint:0},s={queue:0,queuedBits:0},o=l=>{fD(l,n,t)};for(let l=0;l<i.length;l+=1)R1(i.charCodeAt(l),s,o);return e.join("")}function dD(i,e){if(i<=127){e(i);return}else if(i<=2047){e(192|i>>6),e(128|i&63);return}else if(i<=65535){e(224|i>>12),e(128|i>>6&63),e(128|i&63);return}else if(i<=1114111){e(240|i>>18),e(128|i>>12&63),e(128|i>>6&63),e(128|i&63);return}throw new Error(`Unrecognized Unicode codepoint: ${i.toString(16)}`)}function hD(i,e){for(let t=0;t<i.length;t+=1){let n=i.charCodeAt(t);if(n>55295&&n<=56319){const s=(n-55296)*1024&65535;n=(i.charCodeAt(t+1)-56320&65535|s)+65536,t+=1}dD(n,e)}}function fD(i,e,t){if(e.utf8seq===0){if(i<=127){t(i);return}for(let n=1;n<6;n+=1)if((i>>7-n&1)===0){e.utf8seq=n;break}if(e.utf8seq===2)e.codepoint=i&31;else if(e.utf8seq===3)e.codepoint=i&15;else if(e.utf8seq===4)e.codepoint=i&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(i<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|i&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function eu(i){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};for(let s=0;s<i.length;s+=1)R1(i.charCodeAt(s),t,n);return new Uint8Array(e)}function pD(i){const e=[];return hD(i,t=>e.push(t)),new Uint8Array(e)}function qa(i){const e=[],t={queue:0,queuedBits:0},n=s=>{e.push(s)};return i.forEach(s=>tT(s,t,n)),tT(null,t,n),e.join("")}function mD(i){return Math.round(Date.now()/1e3)+i}function gD(){return Symbol("auth-callback")}const Sn=()=>typeof window<"u"&&typeof document<"u",Ia={tested:!1,writable:!1},N1=()=>{if(!Sn())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Ia.tested)return Ia.writable;const i=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(i,i),globalThis.localStorage.removeItem(i),Ia.tested=!0,Ia.writable=!0}catch{Ia.tested=!0,Ia.writable=!1}return Ia.writable};function vD(i){const e={},t=new URL(i);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((s,o)=>{e[o]=s})}catch{}return t.searchParams.forEach((n,s)=>{e[s]=n}),e}const k1=i=>i?(...e)=>i(...e):(...e)=>fetch(...e),yD=i=>typeof i=="object"&&i!==null&&"status"in i&&"ok"in i&&"json"in i&&typeof i.json=="function",qc=async(i,e,t)=>{await i.setItem(e,JSON.stringify(t))},Ma=async(i,e)=>{const t=await i.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},xn=async(i,e)=>{await i.removeItem(e)};class m0{constructor(){this.promise=new m0.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}m0.promiseConstructor=Promise;function Gm(i){const e=i.split(".");if(e.length!==3)throw new Tb("Invalid JWT structure");for(let n=0;n<e.length;n++)if(!sD.test(e[n]))throw new Tb("JWT not in base64url format");return{header:JSON.parse(nT(e[0])),payload:JSON.parse(nT(e[1])),signature:eu(e[2]),raw:{header:e[0],payload:e[1]}}}async function bD(i){return await new Promise(e=>{setTimeout(()=>e(null),i)})}function _D(i,e){return new Promise((n,s)=>{(async()=>{for(let o=0;o<1/0;o++)try{const l=await i(o);if(!e(o,null,l)){n(l);return}}catch(l){if(!e(o,l)){s(l);return}}})()})}function wD(i){return("0"+i.toString(16)).substr(-2)}function xD(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",n=t.length;let s="";for(let o=0;o<56;o++)s+=t.charAt(Math.floor(Math.random()*n));return s}return crypto.getRandomValues(e),Array.from(e,wD).join("")}async function SD(i){const t=new TextEncoder().encode(i),n=await crypto.subtle.digest("SHA-256",t),s=new Uint8Array(n);return Array.from(s).map(o=>String.fromCharCode(o)).join("")}async function ED(i){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),i;const t=await SD(i);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function Pc(i,e,t=!1){const n=xD();let s=n;t&&(s+="/PASSWORD_RECOVERY"),await qc(i,`${e}-code-verifier`,s);const o=await ED(n);return[o,n===o?"plain":"s256"]}const AD=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function TD(i){const e=i.headers.get(Eb);if(!e||!e.match(AD))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function CD(i){if(!i)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(i<=e)throw new Error("JWT has expired")}function RD(i){switch(i){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const ND=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Oc(i){if(!ND.test(i))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function tb(){const i={};return new Proxy(i,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const n=t.toString();if(n==="Symbol(Symbol.toPrimitive)"||n==="Symbol(Symbol.toStringTag)"||n==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function kD(i,e){return new Proxy(i,{get:(t,n,s)=>{if(n==="__isInsecureUserWarningProxy")return!0;if(typeof n=="symbol"){const o=n.toString();if(o==="Symbol(Symbol.toPrimitive)"||o==="Symbol(Symbol.toStringTag)"||o==="Symbol(util.inspect.custom)"||o==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(t,n,s)}return!e.value&&typeof n=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),e.value=!0),Reflect.get(t,n,s)}})}function iT(i){return JSON.parse(JSON.stringify(i))}const Da=i=>i.msg||i.message||i.error_description||i.error||JSON.stringify(i),ID=[502,503,504];async function sT(i){var e;if(!yD(i))throw new Ab(Da(i),0);if(ID.includes(i.status))throw new Ab(Da(i),i.status);let t;try{t=await i.json()}catch(o){throw new Ha(Da(o),o)}let n;const s=TD(i);if(s&&s.getTime()>=C1["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?n=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(n=t.error_code),n){if(n==="weak_password")throw new ZA(Da(t),i.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(n==="session_not_found")throw new xi}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((o,l)=>o&&typeof l=="string",!0))throw new ZA(Da(t),i.status,t.weak_password.reasons);throw new oD(Da(t),i.status||500,n)}const MD=(i,e,t,n)=>{const s={method:i,headers:(e==null?void 0:e.headers)||{}};return i==="GET"?s:(s.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e==null?void 0:e.headers),s.body=JSON.stringify(n),Object.assign(Object.assign({},s),t))};async function Le(i,e,t,n){var s;const o=Object.assign({},n==null?void 0:n.headers);o[Eb]||(o[Eb]=C1["2024-01-01"].name),n!=null&&n.jwt&&(o.Authorization=`Bearer ${n.jwt}`);const l=(s=n==null?void 0:n.query)!==null&&s!==void 0?s:{};n!=null&&n.redirectTo&&(l.redirect_to=n.redirectTo);const c=Object.keys(l).length?"?"+new URLSearchParams(l).toString():"",d=await DD(i,e,t+c,{headers:o,noResolveJson:n==null?void 0:n.noResolveJson},{},n==null?void 0:n.body);return n!=null&&n.xform?n==null?void 0:n.xform(d):{data:Object.assign({},d),error:null}}async function DD(i,e,t,n,s,o){const l=MD(e,n,s,o);let c;try{c=await i(t,Object.assign({},l))}catch(d){throw console.error(d),new Ab(Da(d),0)}if(c.ok||await sT(c),n!=null&&n.noResolveJson)return c;try{return await c.json()}catch(d){await sT(d)}}function ss(i){var e;let t=null;OD(i)&&(t=Object.assign({},i),i.expires_at||(t.expires_at=mD(i.expires_in)));const n=(e=i.user)!==null&&e!==void 0?e:i;return{data:{session:t,user:n},error:null}}function rT(i){const e=ss(i);return!e.error&&i.weak_password&&typeof i.weak_password=="object"&&Array.isArray(i.weak_password.reasons)&&i.weak_password.reasons.length&&i.weak_password.message&&typeof i.weak_password.message=="string"&&i.weak_password.reasons.reduce((t,n)=>t&&typeof n=="string",!0)&&(e.data.weak_password=i.weak_password),e}function Uo(i){var e;return{data:{user:(e=i.user)!==null&&e!==void 0?e:i},error:null}}function LD(i){return{data:i,error:null}}function PD(i){const{action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:o}=i,l=h0(i,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),c={action_link:e,email_otp:t,hashed_token:n,redirect_to:s,verification_type:o},d=Object.assign({},l);return{data:{properties:c,user:d},error:null}}function oT(i){return i}function OD(i){return i.access_token&&i.refresh_token&&i.expires_in}const nb=["global","local","others"];class UD{constructor({url:e="",headers:t={},fetch:n}){this.url=e,this.headers=t,this.fetch=k1(n),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(e,t=nb[0]){if(nb.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${nb.join(", ")}`);try{return await Le(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(n){if(Se(n))return{data:null,error:n};throw n}}async inviteUserByEmail(e,t={}){try{return await Le(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:Uo})}catch(n){if(Se(n))return{data:{user:null},error:n};throw n}}async generateLink(e){try{const{options:t}=e,n=h0(e,["options"]),s=Object.assign(Object.assign({},n),t);return"newEmail"in n&&(s.new_email=n==null?void 0:n.newEmail,delete s.newEmail),await Le(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:s,headers:this.headers,xform:PD,redirectTo:t==null?void 0:t.redirectTo})}catch(t){if(Se(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await Le(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:Uo})}catch(t){if(Se(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,n,s,o,l,c,d;try{const h={nextPage:null,lastPage:0,total:0},p=await Le(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:oT});if(p.error)throw p.error;const y=await p.json(),b=(l=p.headers.get("x-total-count"))!==null&&l!==void 0?l:0,S=(d=(c=p.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&d!==void 0?d:[];return S.length>0&&(S.forEach(E=>{const R=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),A=JSON.parse(E.split(";")[1].split("=")[1]);h[`${A}Page`]=R}),h.total=parseInt(b)),{data:Object.assign(Object.assign({},y),h),error:null}}catch(h){if(Se(h))return{data:{users:[]},error:h};throw h}}async getUserById(e){Oc(e);try{return await Le(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:Uo})}catch(t){if(Se(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){Oc(e);try{return await Le(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:Uo})}catch(n){if(Se(n))return{data:{user:null},error:n};throw n}}async deleteUser(e,t=!1){Oc(e);try{return await Le(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:Uo})}catch(n){if(Se(n))return{data:{user:null},error:n};throw n}}async _listFactors(e){Oc(e.userId);try{const{data:t,error:n}=await Le(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:s=>({data:{factors:s},error:null})});return{data:t,error:n}}catch(t){if(Se(t))return{data:null,error:t};throw t}}async _deleteFactor(e){Oc(e.userId),Oc(e.id);try{return{data:await Le(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(Se(t))return{data:null,error:t};throw t}}async _listOAuthClients(e){var t,n,s,o,l,c,d;try{const h={nextPage:null,lastPage:0,total:0},p=await Le(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(n=(t=e==null?void 0:e.page)===null||t===void 0?void 0:t.toString())!==null&&n!==void 0?n:"",per_page:(o=(s=e==null?void 0:e.perPage)===null||s===void 0?void 0:s.toString())!==null&&o!==void 0?o:""},xform:oT});if(p.error)throw p.error;const y=await p.json(),b=(l=p.headers.get("x-total-count"))!==null&&l!==void 0?l:0,S=(d=(c=p.headers.get("link"))===null||c===void 0?void 0:c.split(","))!==null&&d!==void 0?d:[];return S.length>0&&(S.forEach(E=>{const R=parseInt(E.split(";")[0].split("=")[1].substring(0,1)),A=JSON.parse(E.split(";")[1].split("=")[1]);h[`${A}Page`]=R}),h.total=parseInt(b)),{data:Object.assign(Object.assign({},y),h),error:null}}catch(h){if(Se(h))return{data:{clients:[]},error:h};throw h}}async _createOAuthClient(e){try{return await Le(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:e,headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Se(t))return{data:null,error:t};throw t}}async _getOAuthClient(e){try{return await Le(this.fetch,"GET",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Se(t))return{data:null,error:t};throw t}}async _updateOAuthClient(e,t){try{return await Le(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${e}`,{body:t,headers:this.headers,xform:n=>({data:n,error:null})})}catch(n){if(Se(n))return{data:null,error:n};throw n}}async _deleteOAuthClient(e){try{return await Le(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${e}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(t){if(Se(t))return{data:null,error:t};throw t}}async _regenerateOAuthClientSecret(e){try{return await Le(this.fetch,"POST",`${this.url}/admin/oauth/clients/${e}/regenerate_secret`,{headers:this.headers,xform:t=>({data:t,error:null})})}catch(t){if(Se(t))return{data:null,error:t};throw t}}}function aT(i={}){return{getItem:e=>i[e]||null,setItem:(e,t)=>{i[e]=t},removeItem:e=>{delete i[e]}}}const Uc={debug:!!(globalThis&&N1()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class I1 extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class lT extends I1{}async function FD(i,e,t){Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",i,e);const n=new globalThis.AbortController;e>0&&setTimeout(()=>{n.abort(),Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",i)},e),await Promise.resolve();try{return await globalThis.navigator.locks.request(i,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:n.signal},async s=>{if(s){Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",i,s.name);try{return await t()}finally{Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",i,s.name)}}else{if(e===0)throw Uc.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",i),new lT(`Acquiring an exclusive Navigator LockManager lock "${i}" immediately failed`);if(Uc.debug)try{const o=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(o,null,"  "))}catch(o){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",o)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}})}catch(s){throw(s==null?void 0:s.name)==="AbortError"?new lT(`Acquiring an exclusive Navigator LockManager lock "${i}" timed out waiting ${e}ms`):s}}function HD(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function M1(i){if(!/^0x[a-fA-F0-9]{40}$/.test(i))throw new Error(`@supabase/auth-js: Address "${i}" is invalid.`);return i.toLowerCase()}function BD(i){return parseInt(i,16)}function jD(i){const e=new TextEncoder().encode(i);return"0x"+Array.from(e,n=>n.toString(16).padStart(2,"0")).join("")}function qD(i){var e;const{chainId:t,domain:n,expirationTime:s,issuedAt:o=new Date,nonce:l,notBefore:c,requestId:d,resources:h,scheme:p,uri:y,version:b}=i;{if(!Number.isInteger(t))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${t}`);if(!n)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(l&&l.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${l}`);if(!y)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(b!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${b}`);if(!((e=i.statement)===null||e===void 0)&&e.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${i.statement}`)}const S=M1(i.address),E=p?`${p}://${n}`:n,R=i.statement?`${i.statement}
`:"",A=`${E} wants you to sign in with your Ethereum account:
${S}

${R}`;let C=`URI: ${y}
Version: ${b}
Chain ID: ${t}${l?`
Nonce: ${l}`:""}
Issued At: ${o.toISOString()}`;if(s&&(C+=`
Expiration Time: ${s.toISOString()}`),c&&(C+=`
Not Before: ${c.toISOString()}`),d&&(C+=`
Request ID: ${d}`),h){let k=`
Resources:`;for(const I of h){if(!I||typeof I!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${I}`);k+=`
- ${I}`}C+=k}return`${A}
${C}`}class Qt extends Error{constructor({message:e,code:t,cause:n,name:s}){var o;super(e,{cause:n}),this.__isWebAuthnError=!0,this.name=(o=s??(n instanceof Error?n.name:void 0))!==null&&o!==void 0?o:"Unknown Error",this.code=t}}class Ig extends Qt{constructor(e,t){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:t,message:e}),this.name="WebAuthnUnknownError",this.originalError=t}}function GD({error:i,options:e}){var t,n,s;const{publicKey:o}=e;if(!o)throw Error("options was missing required publicKey property");if(i.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Qt({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else if(i.name==="ConstraintError"){if(((t=o.authenticatorSelection)===null||t===void 0?void 0:t.requireResidentKey)===!0)return new Qt({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:i});if(e.mediation==="conditional"&&((n=o.authenticatorSelection)===null||n===void 0?void 0:n.userVerification)==="required")return new Qt({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:i});if(((s=o.authenticatorSelection)===null||s===void 0?void 0:s.userVerification)==="required")return new Qt({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:i})}else{if(i.name==="InvalidStateError")return new Qt({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:i});if(i.name==="NotAllowedError")return new Qt({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});if(i.name==="NotSupportedError")return o.pubKeyCredParams.filter(c=>c.type==="public-key").length===0?new Qt({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:i}):new Qt({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:i});if(i.name==="SecurityError"){const l=window.location.hostname;if(D1(l)){if(o.rp.id!==l)return new Qt({message:`The RP ID "${o.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:i})}else return new Qt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:i})}else if(i.name==="TypeError"){if(o.user.id.byteLength<1||o.user.id.byteLength>64)return new Qt({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:i})}else if(i.name==="UnknownError")return new Qt({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i})}return new Qt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}function VD({error:i,options:e}){const{publicKey:t}=e;if(!t)throw Error("options was missing required publicKey property");if(i.name==="AbortError"){if(e.signal instanceof AbortSignal)return new Qt({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:i})}else{if(i.name==="NotAllowedError")return new Qt({message:i.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i});if(i.name==="SecurityError"){const n=window.location.hostname;if(D1(n)){if(t.rpId!==n)return new Qt({message:`The RP ID "${t.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:i})}else return new Qt({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:i})}else if(i.name==="UnknownError")return new Qt({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:i})}return new Qt({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:i})}class zD{createNewAbortSignal(){if(this.controller){const t=new Error("Cancelling existing WebAuthn API call for new one");t.name="AbortError",this.controller.abort(t)}const e=new AbortController;return this.controller=e,e.signal}cancelCeremony(){if(this.controller){const e=new Error("Manually cancelling existing WebAuthn API call");e.name="AbortError",this.controller.abort(e),this.controller=void 0}}}const $D=new zD;function YD(i){if(!i)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(i);const{challenge:e,user:t,excludeCredentials:n}=i,s=h0(i,["challenge","user","excludeCredentials"]),o=eu(e).buffer,l=Object.assign(Object.assign({},t),{id:eu(t.id).buffer}),c=Object.assign(Object.assign({},s),{challenge:o,user:l});if(n&&n.length>0){c.excludeCredentials=new Array(n.length);for(let d=0;d<n.length;d++){const h=n[d];c.excludeCredentials[d]=Object.assign(Object.assign({},h),{id:eu(h.id).buffer,type:h.type||"public-key",transports:h.transports})}}return c}function JD(i){if(!i)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(i);const{challenge:e,allowCredentials:t}=i,n=h0(i,["challenge","allowCredentials"]),s=eu(e).buffer,o=Object.assign(Object.assign({},n),{challenge:s});if(t&&t.length>0){o.allowCredentials=new Array(t.length);for(let l=0;l<t.length;l++){const c=t[l];o.allowCredentials[l]=Object.assign(Object.assign({},c),{id:eu(c.id).buffer,type:c.type||"public-key",transports:c.transports})}}return o}function KD(i){var e;if("toJSON"in i&&typeof i.toJSON=="function")return i.toJSON();const t=i;return{id:i.id,rawId:i.id,response:{attestationObject:qa(new Uint8Array(i.response.attestationObject)),clientDataJSON:qa(new Uint8Array(i.response.clientDataJSON))},type:"public-key",clientExtensionResults:i.getClientExtensionResults(),authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function WD(i){var e;if("toJSON"in i&&typeof i.toJSON=="function")return i.toJSON();const t=i,n=i.getClientExtensionResults(),s=i.response;return{id:i.id,rawId:i.id,response:{authenticatorData:qa(new Uint8Array(s.authenticatorData)),clientDataJSON:qa(new Uint8Array(s.clientDataJSON)),signature:qa(new Uint8Array(s.signature)),userHandle:s.userHandle?qa(new Uint8Array(s.userHandle)):void 0},type:"public-key",clientExtensionResults:n,authenticatorAttachment:(e=t.authenticatorAttachment)!==null&&e!==void 0?e:void 0}}function D1(i){return i==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(i)}function cT(){var i,e;return!!(Sn()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((i=navigator==null?void 0:navigator.credentials)===null||i===void 0?void 0:i.create)=="function"&&typeof((e=navigator==null?void 0:navigator.credentials)===null||e===void 0?void 0:e.get)=="function")}async function XD(i){try{const e=await navigator.credentials.create(i);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ig("Browser returned unexpected credential type",e)}:{data:null,error:new Ig("Empty credential response",e)}}catch(e){return{data:null,error:GD({error:e,options:i})}}}async function QD(i){try{const e=await navigator.credentials.get(i);return e?e instanceof PublicKeyCredential?{data:e,error:null}:{data:null,error:new Ig("Browser returned unexpected credential type",e)}:{data:null,error:new Ig("Empty credential response",e)}}catch(e){return{data:null,error:VD({error:e,options:i})}}}const ZD={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},eL={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Mg(...i){const e=s=>s!==null&&typeof s=="object"&&!Array.isArray(s),t=s=>s instanceof ArrayBuffer||ArrayBuffer.isView(s),n={};for(const s of i)if(s)for(const o in s){const l=s[o];if(l!==void 0)if(Array.isArray(l))n[o]=l;else if(t(l))n[o]=l;else if(e(l)){const c=n[o];e(c)?n[o]=Mg(c,l):n[o]=Mg(l)}else n[o]=l}return n}function tL(i,e){return Mg(ZD,i,e||{})}function nL(i,e){return Mg(eL,i,e||{})}class iL{constructor(e){this.client=e,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(e){return this.client.mfa.enroll(Object.assign(Object.assign({},e),{factorType:"webauthn"}))}async _challenge({factorId:e,webauthn:t,friendlyName:n,signal:s},o){var l;try{const{data:c,error:d}=await this.client.mfa.challenge({factorId:e,webauthn:t});if(!c)return{data:null,error:d};const h=s??$D.createNewAbortSignal();if(c.webauthn.type==="create"){const{user:p}=c.webauthn.credential_options.publicKey;if(!p.name){const y=n;if(y)p.name=`${p.id}:${y}`;else{const S=(await this.client.getUser()).data.user,E=((l=S==null?void 0:S.user_metadata)===null||l===void 0?void 0:l.name)||(S==null?void 0:S.email)||(S==null?void 0:S.id)||"User";p.name=`${p.id}:${E}`}}p.displayName||(p.displayName=p.name)}switch(c.webauthn.type){case"create":{const p=tL(c.webauthn.credential_options.publicKey,o==null?void 0:o.create),{data:y,error:b}=await XD({publicKey:p,signal:h});return y?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:y}},error:null}:{data:null,error:b}}case"request":{const p=nL(c.webauthn.credential_options.publicKey,o==null?void 0:o.request),{data:y,error:b}=await QD(Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:p,signal:h}));return y?{data:{factorId:e,challengeId:c.id,webauthn:{type:c.webauthn.type,credential_response:y}},error:null}:{data:null,error:b}}}}catch(c){return Se(c)?{data:null,error:c}:{data:null,error:new Ha("Unexpected error in challenge",c)}}}async _verify({challengeId:e,factorId:t,webauthn:n}){return this.client.mfa.verify({factorId:t,challengeId:e,webauthn:n})}async _authenticate({factorId:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},o){if(!t)return{data:null,error:new Ih("rpId is required for WebAuthn authentication")};try{if(!cT())return{data:null,error:new Ha("Browser does not support WebAuthn",null)};const{data:l,error:c}=await this.challenge({factorId:e,webauthn:{rpId:t,rpOrigins:n},signal:s},{request:o});if(!l)return{data:null,error:c};const{webauthn:d}=l;return this._verify({factorId:e,challengeId:l.challengeId,webauthn:{type:d.type,rpId:t,rpOrigins:n,credential_response:d.credential_response}})}catch(l){return Se(l)?{data:null,error:l}:{data:null,error:new Ha("Unexpected error in authenticate",l)}}}async _register({friendlyName:e,webauthn:{rpId:t=typeof window<"u"?window.location.hostname:void 0,rpOrigins:n=typeof window<"u"?[window.location.origin]:void 0,signal:s}={}},o){if(!t)return{data:null,error:new Ih("rpId is required for WebAuthn registration")};try{if(!cT())return{data:null,error:new Ha("Browser does not support WebAuthn",null)};const{data:l,error:c}=await this._enroll({friendlyName:e});if(!l)return await this.client.mfa.listFactors().then(p=>{var y;return(y=p.data)===null||y===void 0?void 0:y.all.find(b=>b.factor_type==="webauthn"&&b.friendly_name===e&&b.status!=="unverified")}).then(p=>p?this.client.mfa.unenroll({factorId:p==null?void 0:p.id}):void 0),{data:null,error:c};const{data:d,error:h}=await this._challenge({factorId:l.id,friendlyName:l.friendly_name,webauthn:{rpId:t,rpOrigins:n},signal:s},{create:o});return d?this._verify({factorId:l.id,challengeId:d.challengeId,webauthn:{rpId:t,rpOrigins:n,type:d.webauthn.type,credential_response:d.webauthn.credential_response}}):{data:null,error:h}}catch(l){return Se(l)?{data:null,error:l}:{data:null,error:new Ha("Unexpected error in register",l)}}}}HD();const sL={url:tD,storageKey:nD,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:iD,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4,skipAutoInitialize:!1};async function uT(i,e,t){return await t()}const Fc={};class Mh{get jwks(){var e,t;return(t=(e=Fc[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){Fc[this.storageKey]=Object.assign(Object.assign({},Fc[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=Fc[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){Fc[this.storageKey]=Object.assign(Object.assign({},Fc[this.storageKey]),{cachedAt:e})}constructor(e){var t,n,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const o=Object.assign(Object.assign({},sL),e);if(this.storageKey=o.storageKey,this.instanceID=(t=Mh.nextInstanceID[this.storageKey])!==null&&t!==void 0?t:0,Mh.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!o.debug,typeof o.debug=="function"&&(this.logger=o.debug),this.instanceID>0&&Sn()){const l=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(l),this.logDebugMessages&&console.trace(l)}if(this.persistSession=o.persistSession,this.autoRefreshToken=o.autoRefreshToken,this.admin=new UD({url:o.url,headers:o.headers,fetch:o.fetch}),this.url=o.url,this.headers=o.headers,this.fetch=k1(o.fetch),this.lock=o.lock||uT,this.detectSessionInUrl=o.detectSessionInUrl,this.flowType=o.flowType,this.hasCustomAuthorizationHeader=o.hasCustomAuthorizationHeader,this.throwOnError=o.throwOnError,this.lockAcquireTimeout=o.lockAcquireTimeout,o.lock?this.lock=o.lock:this.persistSession&&Sn()&&(!((n=globalThis==null?void 0:globalThis.navigator)===null||n===void 0)&&n.locks)?this.lock=FD:this.lock=uT,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new iL(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(o.storage?this.storage=o.storage:N1()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=aT(this.memoryStorage)),o.userStorage&&(this.userStorage=o.userStorage)):(this.memoryStorage={},this.storage=aT(this.memoryStorage)),Sn()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(l){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",l)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async l=>{this._debug("received broadcast notification from other tab or client",l);try{await this._notifyAllSubscribers(l.data.event,l.data.session,!1)}catch(c){this._debug("#broadcastChannel","error",c)}})}o.skipAutoInitialize||this.initialize().catch(l=>{this._debug("#initialize()","error",l)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(e){if(this.throwOnError&&e&&e.error)throw e.error;return e}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${T1}) ${new Date().toISOString()}`}_debug(...e){return this.logDebugMessages&&this.logger(this._logPrefix(),...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{let t={},n="none";if(Sn()&&(t=vD(window.location.href),this._isImplicitGrantCallback(t)?n="implicit":await this._isPKCECallback(t)&&(n="pkce")),Sn()&&this.detectSessionInUrl&&n!=="none"){const{data:s,error:o}=await this._getSessionFromURL(t,n);if(o){if(this._debug("#_initialize()","error detecting session from URL",o),lD(o)){const d=(e=o.details)===null||e===void 0?void 0:e.code;if(d==="identity_already_exists"||d==="identity_not_found"||d==="single_identity_not_deletable")return{error:o}}return{error:o}}const{session:l,redirectType:c}=s;return this._debug("#_initialize()","detected session in URL",l,"redirect type",c),await this._saveSession(l),setTimeout(async()=>{c==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",l):await this._notifyAllSubscribers("SIGNED_IN",l)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return Se(t)?this._returnResult({error:t}):this._returnResult({error:new Ha("Unexpected error during initialization",t)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,n,s;try{const o=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(n=(t=e==null?void 0:e.options)===null||t===void 0?void 0:t.data)!==null&&n!==void 0?n:{},gotrue_meta_security:{captcha_token:(s=e==null?void 0:e.options)===null||s===void 0?void 0:s.captchaToken}},xform:ss}),{data:l,error:c}=o;if(c||!l)return this._returnResult({data:{user:null,session:null},error:c});const d=l.session,h=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:h,session:d},error:null})}catch(o){if(Se(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signUp(e){var t,n,s;try{let o;if("email"in e){const{email:p,password:y,options:b}=e;let S=null,E=null;this.flowType==="pkce"&&([S,E]=await Pc(this.storage,this.storageKey)),o=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:b==null?void 0:b.emailRedirectTo,body:{email:p,password:y,data:(t=b==null?void 0:b.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken},code_challenge:S,code_challenge_method:E},xform:ss})}else if("phone"in e){const{phone:p,password:y,options:b}=e;o=await Le(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:p,password:y,data:(n=b==null?void 0:b.data)!==null&&n!==void 0?n:{},channel:(s=b==null?void 0:b.channel)!==null&&s!==void 0?s:"sms",gotrue_meta_security:{captcha_token:b==null?void 0:b.captchaToken}},xform:ss})}else throw new jm("You must provide either an email or phone number and a password");const{data:l,error:c}=o;if(c||!l)return await xn(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:c});const d=l.session,h=l.user;return l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",d)),this._returnResult({data:{user:h,session:d},error:null})}catch(o){if(await xn(this.storage,`${this.storageKey}-code-verifier`),Se(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async signInWithPassword(e){try{let t;if("email"in e){const{email:o,password:l,options:c}=e;t=await Le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:o,password:l,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:rT})}else if("phone"in e){const{phone:o,password:l,options:c}=e;t=await Le(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:o,password:l,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:rT})}else throw new jm("You must provide either an email or phone number and a password");const{data:n,error:s}=t;if(s)return this._returnResult({data:{user:null,session:null},error:s});if(!n||!n.session||!n.user){const o=new Lc;return this._returnResult({data:{user:null,session:null},error:o})}return n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),this._returnResult({data:Object.assign({user:n.user,session:n.session},n.weak_password?{weakPassword:n.weak_password}:null),error:s})}catch(t){if(Se(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOAuth(e){var t,n,s,o;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(n=e.options)===null||n===void 0?void 0:n.scopes,queryParams:(s=e.options)===null||s===void 0?void 0:s.queryParams,skipBrowserRedirect:(o=e.options)===null||o===void 0?void 0:o.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;switch(t){case"ethereum":return await this.signInWithEthereum(e);case"solana":return await this.signInWithSolana(e);default:throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}}async signInWithEthereum(e){var t,n,s,o,l,c,d,h,p,y,b;let S,E;if("message"in e)S=e.message,E=e.signature;else{const{chain:R,wallet:A,statement:C,options:k}=e;let I;if(Sn())if(typeof A=="object")I=A;else{const K=window;if("ethereum"in K&&typeof K.ethereum=="object"&&"request"in K.ethereum&&typeof K.ethereum.request=="function")I=K.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof A!="object"||!(k!=null&&k.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");I=A}const O=new URL((t=k==null?void 0:k.url)!==null&&t!==void 0?t:window.location.href),U=await I.request({method:"eth_requestAccounts"}).then(K=>K).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!U||U.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const P=M1(U[0]);let B=(n=k==null?void 0:k.signInWithEthereum)===null||n===void 0?void 0:n.chainId;if(!B){const K=await I.request({method:"eth_chainId"});B=BD(K)}const Q={domain:O.host,address:P,statement:C,uri:O.href,version:"1",chainId:B,nonce:(s=k==null?void 0:k.signInWithEthereum)===null||s===void 0?void 0:s.nonce,issuedAt:(l=(o=k==null?void 0:k.signInWithEthereum)===null||o===void 0?void 0:o.issuedAt)!==null&&l!==void 0?l:new Date,expirationTime:(c=k==null?void 0:k.signInWithEthereum)===null||c===void 0?void 0:c.expirationTime,notBefore:(d=k==null?void 0:k.signInWithEthereum)===null||d===void 0?void 0:d.notBefore,requestId:(h=k==null?void 0:k.signInWithEthereum)===null||h===void 0?void 0:h.requestId,resources:(p=k==null?void 0:k.signInWithEthereum)===null||p===void 0?void 0:p.resources};S=qD(Q),E=await I.request({method:"personal_sign",params:[jD(S),P]})}try{const{data:R,error:A}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:S,signature:E},!((y=e.options)===null||y===void 0)&&y.captchaToken?{gotrue_meta_security:{captcha_token:(b=e.options)===null||b===void 0?void 0:b.captchaToken}}:null),xform:ss});if(A)throw A;if(!R||!R.session||!R.user){const C=new Lc;return this._returnResult({data:{user:null,session:null},error:C})}return R.session&&(await this._saveSession(R.session),await this._notifyAllSubscribers("SIGNED_IN",R.session)),this._returnResult({data:Object.assign({},R),error:A})}catch(R){if(Se(R))return this._returnResult({data:{user:null,session:null},error:R});throw R}}async signInWithSolana(e){var t,n,s,o,l,c,d,h,p,y,b,S;let E,R;if("message"in e)E=e.message,R=e.signature;else{const{chain:A,wallet:C,statement:k,options:I}=e;let O;if(Sn())if(typeof C=="object")O=C;else{const P=window;if("solana"in P&&typeof P.solana=="object"&&("signIn"in P.solana&&typeof P.solana.signIn=="function"||"signMessage"in P.solana&&typeof P.solana.signMessage=="function"))O=P.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof C!="object"||!(I!=null&&I.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");O=C}const U=new URL((t=I==null?void 0:I.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in O&&O.signIn){const P=await O.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},I==null?void 0:I.signInWithSolana),{version:"1",domain:U.host,uri:U.href}),k?{statement:k}:null));let B;if(Array.isArray(P)&&P[0]&&typeof P[0]=="object")B=P[0];else if(P&&typeof P=="object"&&"signedMessage"in P&&"signature"in P)B=P;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in B&&"signature"in B&&(typeof B.signedMessage=="string"||B.signedMessage instanceof Uint8Array)&&B.signature instanceof Uint8Array)E=typeof B.signedMessage=="string"?B.signedMessage:new TextDecoder().decode(B.signedMessage),R=B.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in O)||typeof O.signMessage!="function"||!("publicKey"in O)||typeof O!="object"||!O.publicKey||!("toBase58"in O.publicKey)||typeof O.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");E=[`${U.host} wants you to sign in with your Solana account:`,O.publicKey.toBase58(),...k?["",k,""]:[""],"Version: 1",`URI: ${U.href}`,`Issued At: ${(s=(n=I==null?void 0:I.signInWithSolana)===null||n===void 0?void 0:n.issuedAt)!==null&&s!==void 0?s:new Date().toISOString()}`,...!((o=I==null?void 0:I.signInWithSolana)===null||o===void 0)&&o.notBefore?[`Not Before: ${I.signInWithSolana.notBefore}`]:[],...!((l=I==null?void 0:I.signInWithSolana)===null||l===void 0)&&l.expirationTime?[`Expiration Time: ${I.signInWithSolana.expirationTime}`]:[],...!((c=I==null?void 0:I.signInWithSolana)===null||c===void 0)&&c.chainId?[`Chain ID: ${I.signInWithSolana.chainId}`]:[],...!((d=I==null?void 0:I.signInWithSolana)===null||d===void 0)&&d.nonce?[`Nonce: ${I.signInWithSolana.nonce}`]:[],...!((h=I==null?void 0:I.signInWithSolana)===null||h===void 0)&&h.requestId?[`Request ID: ${I.signInWithSolana.requestId}`]:[],...!((y=(p=I==null?void 0:I.signInWithSolana)===null||p===void 0?void 0:p.resources)===null||y===void 0)&&y.length?["Resources",...I.signInWithSolana.resources.map(B=>`- ${B}`)]:[]].join(`
`);const P=await O.signMessage(new TextEncoder().encode(E),"utf8");if(!P||!(P instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");R=P}}try{const{data:A,error:C}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:E,signature:qa(R)},!((b=e.options)===null||b===void 0)&&b.captchaToken?{gotrue_meta_security:{captcha_token:(S=e.options)===null||S===void 0?void 0:S.captchaToken}}:null),xform:ss});if(C)throw C;if(!A||!A.session||!A.user){const k=new Lc;return this._returnResult({data:{user:null,session:null},error:k})}return A.session&&(await this._saveSession(A.session),await this._notifyAllSubscribers("SIGNED_IN",A.session)),this._returnResult({data:Object.assign({},A),error:C})}catch(A){if(Se(A))return this._returnResult({data:{user:null,session:null},error:A});throw A}}async _exchangeCodeForSession(e){const t=await Ma(this.storage,`${this.storageKey}-code-verifier`),[n,s]=(t??"").split("/");try{if(!n&&this.flowType==="pkce")throw new cD;const{data:o,error:l}=await Le(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:n},xform:ss});if(await xn(this.storage,`${this.storageKey}-code-verifier`),l)throw l;if(!o||!o.session||!o.user){const c=new Lc;return this._returnResult({data:{user:null,session:null,redirectType:null},error:c})}return o.session&&(await this._saveSession(o.session),await this._notifyAllSubscribers("SIGNED_IN",o.session)),this._returnResult({data:Object.assign(Object.assign({},o),{redirectType:s??null}),error:l})}catch(o){if(await xn(this.storage,`${this.storageKey}-code-verifier`),Se(o))return this._returnResult({data:{user:null,session:null,redirectType:null},error:o});throw o}}async signInWithIdToken(e){try{const{options:t,provider:n,token:s,access_token:o,nonce:l}=e,c=await Le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:n,id_token:s,access_token:o,nonce:l,gotrue_meta_security:{captcha_token:t==null?void 0:t.captchaToken}},xform:ss}),{data:d,error:h}=c;if(h)return this._returnResult({data:{user:null,session:null},error:h});if(!d||!d.session||!d.user){const p=new Lc;return this._returnResult({data:{user:null,session:null},error:p})}return d.session&&(await this._saveSession(d.session),await this._notifyAllSubscribers("SIGNED_IN",d.session)),this._returnResult({data:d,error:h})}catch(t){if(Se(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async signInWithOtp(e){var t,n,s,o,l;try{if("email"in e){const{email:c,options:d}=e;let h=null,p=null;this.flowType==="pkce"&&([h,p]=await Pc(this.storage,this.storageKey));const{error:y}=await Le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:c,data:(t=d==null?void 0:d.data)!==null&&t!==void 0?t:{},create_user:(n=d==null?void 0:d.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},code_challenge:h,code_challenge_method:p},redirectTo:d==null?void 0:d.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:y})}if("phone"in e){const{phone:c,options:d}=e,{data:h,error:p}=await Le(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:c,data:(s=d==null?void 0:d.data)!==null&&s!==void 0?s:{},create_user:(o=d==null?void 0:d.shouldCreateUser)!==null&&o!==void 0?o:!0,gotrue_meta_security:{captcha_token:d==null?void 0:d.captchaToken},channel:(l=d==null?void 0:d.channel)!==null&&l!==void 0?l:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:h==null?void 0:h.message_id},error:p})}throw new jm("You must provide either an email or phone number.")}catch(c){if(await xn(this.storage,`${this.storageKey}-code-verifier`),Se(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async verifyOtp(e){var t,n;try{let s,o;"options"in e&&(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo,o=(n=e.options)===null||n===void 0?void 0:n.captchaToken);const{data:l,error:c}=await Le(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:o}}),redirectTo:s,xform:ss});if(c)throw c;if(!l)throw new Error("An error occurred on token verification.");const d=l.session,h=l.user;return d!=null&&d.access_token&&(await this._saveSession(d),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",d)),this._returnResult({data:{user:h,session:d},error:null})}catch(s){if(Se(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}}async signInWithSSO(e){var t,n,s,o,l;try{let c=null,d=null;this.flowType==="pkce"&&([c,d]=await Pc(this.storage,this.storageKey));const h=await Le(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(n=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&n!==void 0?n:void 0}),!((s=e==null?void 0:e.options)===null||s===void 0)&&s.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:c,code_challenge_method:d}),headers:this.headers,xform:LD});return!((o=h.data)===null||o===void 0)&&o.url&&Sn()&&!(!((l=e.options)===null||l===void 0)&&l.skipBrowserRedirect)&&window.location.assign(h.data.url),this._returnResult(h)}catch(c){if(await xn(this.storage,`${this.storageKey}-code-verifier`),Se(c))return this._returnResult({data:null,error:c});throw c}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;if(n)throw n;if(!t)throw new xi;const{error:s}=await Le(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return this._returnResult({data:{user:null,session:null},error:s})})}catch(e){if(Se(e))return this._returnResult({data:{user:null,session:null},error:e});throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:n,type:s,options:o}=e,{error:l}=await Le(this.fetch,"POST",t,{headers:this.headers,body:{email:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},redirectTo:o==null?void 0:o.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:l})}else if("phone"in e){const{phone:n,type:s,options:o}=e,{data:l,error:c}=await Le(this.fetch,"POST",t,{headers:this.headers,body:{phone:n,type:s,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:l==null?void 0:l.message_id},error:c})}throw new jm("You must provide either an email or phone number and a type")}catch(t){if(Se(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const n=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),s=(async()=>(await n,await t()))();return this.pendingInLock.push((async()=>{try{await s}catch{}})()),s}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const n=t();for(this.pendingInLock.push((async()=>{try{await n}catch{}})()),await n;this.pendingInLock.length;){const s=[...this.pendingInLock];await Promise.all(s),this.pendingInLock.splice(0,s.length)}return await n}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Ma(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const n=e.expires_at?e.expires_at*1e3-Date.now()<Qy:!1;if(this._debug("#__loadSession()",`session has${n?"":" not"} expired`,"expires_at",e.expires_at),!n){if(this.userStorage){const l=await Ma(this.userStorage,this.storageKey+"-user");l!=null&&l.user?e.user=l.user:e.user=tb()}if(this.storage.isServer&&e.user&&!e.user.__isUserNotAvailableProxy){const l={value:this.suppressGetSessionWarning};e.user=kD(e.user,l),l.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:e},error:null}}const{data:s,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{session:null},error:o}):this._returnResult({data:{session:s},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(e){if(e)return await this._getUser(e);await this.initializePromise;const t=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return t.data.user&&(this.suppressGetSessionWarning=!0),t}async _getUser(e){try{return e?await Le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:Uo}):await this._useSession(async t=>{var n,s,o;const{data:l,error:c}=t;if(c)throw c;return!(!((n=l.session)===null||n===void 0)&&n.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new xi}:await Le(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(o=(s=l.session)===null||s===void 0?void 0:s.access_token)!==null&&o!==void 0?o:void 0,xform:Uo})})}catch(t){if(Se(t))return Zy(t)&&(await this._removeSession(),await xn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:t});throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async n=>{const{data:s,error:o}=n;if(o)throw o;if(!s.session)throw new xi;const l=s.session;let c=null,d=null;this.flowType==="pkce"&&e.email!=null&&([c,d]=await Pc(this.storage,this.storageKey));const{data:h,error:p}=await Le(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t==null?void 0:t.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:c,code_challenge_method:d}),jwt:l.access_token,xform:Uo});if(p)throw p;return l.user=h.user,await this._saveSession(l),await this._notifyAllSubscribers("USER_UPDATED",l),this._returnResult({data:{user:l.user},error:null})})}catch(n){if(await xn(this.storage,`${this.storageKey}-code-verifier`),Se(n))return this._returnResult({data:{user:null},error:n});throw n}}async setSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new xi;const t=Date.now()/1e3;let n=t,s=!0,o=null;const{payload:l}=Gm(e.access_token);if(l.exp&&(n=l.exp,s=n<=t),s){const{data:c,error:d}=await this._callRefreshToken(e.refresh_token);if(d)return this._returnResult({data:{user:null,session:null},error:d});if(!c)return{data:{user:null,session:null},error:null};o=c}else{const{data:c,error:d}=await this._getUser(e.access_token);if(d)return this._returnResult({data:{user:null,session:null},error:d});o={access_token:e.access_token,refresh_token:e.refresh_token,user:c.user,token_type:"bearer",expires_in:n-t,expires_at:n},await this._saveSession(o),await this._notifyAllSubscribers("SIGNED_IN",o)}return this._returnResult({data:{user:o.user,session:o},error:null})}catch(t){if(Se(t))return this._returnResult({data:{session:null,user:null},error:t});throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var n;if(!e){const{data:l,error:c}=t;if(c)throw c;e=(n=l.session)!==null&&n!==void 0?n:void 0}if(!(e!=null&&e.refresh_token))throw new xi;const{data:s,error:o}=await this._callRefreshToken(e.refresh_token);return o?this._returnResult({data:{user:null,session:null},error:o}):s?this._returnResult({data:{user:s.user,session:s},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(t){if(Se(t))return this._returnResult({data:{user:null,session:null},error:t});throw t}}async _getSessionFromURL(e,t){try{if(!Sn())throw new qm("No browser detected.");if(e.error||e.error_description||e.error_code)throw new qm(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new QA("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new qm("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new QA("No code detected.");const{data:k,error:I}=await this._exchangeCodeForSession(e.code);if(I)throw I;const O=new URL(window.location.href);return O.searchParams.delete("code"),window.history.replaceState(window.history.state,"",O.toString()),{data:{session:k.session,redirectType:null},error:null}}const{provider_token:n,provider_refresh_token:s,access_token:o,refresh_token:l,expires_in:c,expires_at:d,token_type:h}=e;if(!o||!c||!l||!h)throw new qm("No session defined in URL");const p=Math.round(Date.now()/1e3),y=parseInt(c);let b=p+y;d&&(b=parseInt(d));const S=b-p;S*1e3<=jc&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${S}s, should have been closer to ${y}s`);const E=b-y;p-E>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",E,b,p):p-E<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",E,b,p);const{data:R,error:A}=await this._getUser(o);if(A)throw A;const C={provider_token:n,provider_refresh_token:s,access_token:o,expires_in:y,expires_at:b,refresh_token:l,token_type:h,user:R.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:C,redirectType:e.type},error:null})}catch(n){if(Se(n))return this._returnResult({data:{session:null,redirectType:null},error:n});throw n}}_isImplicitGrantCallback(e){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),e):!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Ma(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var n;const{data:s,error:o}=t;if(o&&!Zy(o))return this._returnResult({error:o});const l=(n=s.session)===null||n===void 0?void 0:n.access_token;if(l){const{error:c}=await this.admin.signOut(l,e);if(c&&!(aD(c)&&(c.status===404||c.status===401||c.status===403)||Zy(c)))return this._returnResult({error:c})}return e!=="others"&&(await this._removeSession(),await xn(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(e){const t=gD(),n={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,n),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:n}}}async _emitInitialSession(e){return await this._useSession(async t=>{var n,s;try{const{data:{session:o},error:l}=t;if(l)throw l;await((n=this.stateChangeEmitters.get(e))===null||n===void 0?void 0:n.callback("INITIAL_SESSION",o)),this._debug("INITIAL_SESSION","callback id",e,"session",o)}catch(o){await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",o),console.error(o)}})}async resetPasswordForEmail(e,t={}){let n=null,s=null;this.flowType==="pkce"&&([n,s]=await Pc(this.storage,this.storageKey,!0));try{return await Le(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:n,code_challenge_method:s,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(o){if(await xn(this.storage,`${this.storageKey}-code-verifier`),Se(o))return this._returnResult({data:null,error:o});throw o}}async getUserIdentities(){var e;try{const{data:t,error:n}=await this.getUser();if(n)throw n;return this._returnResult({data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null})}catch(t){if(Se(t))return this._returnResult({data:null,error:t});throw t}}async linkIdentity(e){return"token"in e?this.linkIdentityIdToken(e):this.linkIdentityOAuth(e)}async linkIdentityOAuth(e){var t;try{const{data:n,error:s}=await this._useSession(async o=>{var l,c,d,h,p;const{data:y,error:b}=o;if(b)throw b;const S=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(l=e.options)===null||l===void 0?void 0:l.redirectTo,scopes:(c=e.options)===null||c===void 0?void 0:c.scopes,queryParams:(d=e.options)===null||d===void 0?void 0:d.queryParams,skipBrowserRedirect:!0});return await Le(this.fetch,"GET",S,{headers:this.headers,jwt:(p=(h=y.session)===null||h===void 0?void 0:h.access_token)!==null&&p!==void 0?p:void 0})});if(s)throw s;return Sn()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(n==null?void 0:n.url),this._returnResult({data:{provider:e.provider,url:n==null?void 0:n.url},error:null})}catch(n){if(Se(n))return this._returnResult({data:{provider:e.provider,url:null},error:n});throw n}}async linkIdentityIdToken(e){return await this._useSession(async t=>{var n;try{const{error:s,data:{session:o}}=t;if(s)throw s;const{options:l,provider:c,token:d,access_token:h,nonce:p}=e,y=await Le(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(n=o==null?void 0:o.access_token)!==null&&n!==void 0?n:void 0,body:{provider:c,id_token:d,access_token:h,nonce:p,link_identity:!0,gotrue_meta_security:{captcha_token:l==null?void 0:l.captchaToken}},xform:ss}),{data:b,error:S}=y;return S?this._returnResult({data:{user:null,session:null},error:S}):!b||!b.session||!b.user?this._returnResult({data:{user:null,session:null},error:new Lc}):(b.session&&(await this._saveSession(b.session),await this._notifyAllSubscribers("USER_UPDATED",b.session)),this._returnResult({data:b,error:S}))}catch(s){if(await xn(this.storage,`${this.storageKey}-code-verifier`),Se(s))return this._returnResult({data:{user:null,session:null},error:s});throw s}})}async unlinkIdentity(e){try{return await this._useSession(async t=>{var n,s;const{data:o,error:l}=t;if(l)throw l;return await Le(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(s=(n=o.session)===null||n===void 0?void 0:n.access_token)!==null&&s!==void 0?s:void 0})})}catch(t){if(Se(t))return this._returnResult({data:null,error:t});throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const n=Date.now();return await _D(async s=>(s>0&&await bD(200*Math.pow(2,s-1)),this._debug(t,"refreshing attempt",s),await Le(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:ss})),(s,o)=>{const l=200*Math.pow(2,s);return o&&eb(o)&&Date.now()+l-n<jc})}catch(n){if(this._debug(t,"error",n),Se(n))return this._returnResult({data:{session:null,user:null},error:n});throw n}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const n=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",n),Sn()&&!t.skipBrowserRedirect&&window.location.assign(n),{data:{provider:e,url:n},error:null}}async _recoverAndRefresh(){var e,t;const n="#_recoverAndRefresh()";this._debug(n,"begin");try{const s=await Ma(this.storage,this.storageKey);if(s&&this.userStorage){let l=await Ma(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!l&&(l={user:s.user},await qc(this.userStorage,this.storageKey+"-user",l)),s.user=(e=l==null?void 0:l.user)!==null&&e!==void 0?e:tb()}else if(s&&!s.user&&!s.user){const l=await Ma(this.storage,this.storageKey+"-user");l&&(l!=null&&l.user)?(s.user=l.user,await xn(this.storage,this.storageKey+"-user"),await qc(this.storage,this.storageKey,s)):s.user=tb()}if(this._debug(n,"session from storage",s),!this._isValidSession(s)){this._debug(n,"session is not valid"),s!==null&&await this._removeSession();return}const o=((t=s.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<Qy;if(this._debug(n,`session has${o?"":" not"} expired with margin of ${Qy}s`),o){if(this.autoRefreshToken&&s.refresh_token){const{error:l}=await this._callRefreshToken(s.refresh_token);l&&(console.error(l),eb(l)||(this._debug(n,"refresh failed with a non-retryable error, removing the session",l),await this._removeSession()))}}else if(s.user&&s.user.__isUserNotAvailableProxy===!0)try{const{data:l,error:c}=await this._getUser(s.access_token);!c&&(l!=null&&l.user)?(s.user=l.user,await this._saveSession(s),await this._notifyAllSubscribers("SIGNED_IN",s)):this._debug(n,"could not get user data, skipping SIGNED_IN notification")}catch(l){console.error("Error getting user data:",l),this._debug(n,"error getting user data, skipping SIGNED_IN notification",l)}else await this._notifyAllSubscribers("SIGNED_IN",s)}catch(s){this._debug(n,"error",s),console.error(s);return}finally{this._debug(n,"end")}}async _callRefreshToken(e){var t,n;if(!e)throw new xi;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const s=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(s,"begin");try{this.refreshingDeferred=new m0;const{data:o,error:l}=await this._refreshAccessToken(e);if(l)throw l;if(!o.session)throw new xi;await this._saveSession(o.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",o.session);const c={data:o.session,error:null};return this.refreshingDeferred.resolve(c),c}catch(o){if(this._debug(s,"error",o),Se(o)){const l={data:null,error:o};return eb(o)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(l),l}throw(n=this.refreshingDeferred)===null||n===void 0||n.reject(o),o}finally{this.refreshingDeferred=null,this._debug(s,"end")}}async _notifyAllSubscribers(e,t,n=!0){const s=`#_notifyAllSubscribers(${e})`;this._debug(s,"begin",t,`broadcast = ${n}`);try{this.broadcastChannel&&n&&this.broadcastChannel.postMessage({event:e,session:t});const o=[],l=Array.from(this.stateChangeEmitters.values()).map(async c=>{try{await c.callback(e,t)}catch(d){o.push(d)}});if(await Promise.all(l),o.length>0){for(let c=0;c<o.length;c+=1)console.error(o[c]);throw o[0]}}finally{this._debug(s,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0,await xn(this.storage,`${this.storageKey}-code-verifier`);const t=Object.assign({},e),n=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!n&&t.user&&await qc(this.userStorage,this.storageKey+"-user",{user:t.user});const s=Object.assign({},t);delete s.user;const o=iT(s);await qc(this.storage,this.storageKey,o)}else{const s=iT(t);await qc(this.storage,this.storageKey,s)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await xn(this.storage,this.storageKey),await xn(this.storage,this.storageKey+"-code-verifier"),await xn(this.storage,this.storageKey+"-user"),this.userStorage&&await xn(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&Sn()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),jc);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e);const t=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=t,t&&typeof t=="object"&&typeof t.unref=="function"?t.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(t)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e);const t=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,t&&clearTimeout(t)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:n}}=t;if(!n||!n.refresh_token||!n.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const s=Math.floor((n.expires_at*1e3-e)/jc);this._debug("#_autoRefreshTokenTick()",`access token expires in ${s} ticks, a tick lasts ${jc}ms, refresh threshold is ${Sb} ticks`),s<=Sb&&await this._callRefreshToken(n.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof I1)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Sn()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(e){this._debug("#visibilityChangedCallback","error",e)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,n){const s=[`provider=${encodeURIComponent(t)}`];if(n!=null&&n.redirectTo&&s.push(`redirect_to=${encodeURIComponent(n.redirectTo)}`),n!=null&&n.scopes&&s.push(`scopes=${encodeURIComponent(n.scopes)}`),this.flowType==="pkce"){const[o,l]=await Pc(this.storage,this.storageKey),c=new URLSearchParams({code_challenge:`${encodeURIComponent(o)}`,code_challenge_method:`${encodeURIComponent(l)}`});s.push(c.toString())}if(n!=null&&n.queryParams){const o=new URLSearchParams(n.queryParams);s.push(o.toString())}return n!=null&&n.skipBrowserRedirect&&s.push(`skip_http_redirect=${n.skipBrowserRedirect}`),`${e}?${s.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var n;const{data:s,error:o}=t;return o?this._returnResult({data:null,error:o}):await Le(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token})})}catch(t){if(Se(t))return this._returnResult({data:null,error:t});throw t}}async _enroll(e){try{return await this._useSession(async t=>{var n,s;const{data:o,error:l}=t;if(l)return this._returnResult({data:null,error:l});const c=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:e.factorType==="totp"?{issuer:e.issuer}:{}),{data:d,error:h}=await Le(this.fetch,"POST",`${this.url}/factors`,{body:c,headers:this.headers,jwt:(n=o==null?void 0:o.session)===null||n===void 0?void 0:n.access_token});return h?this._returnResult({data:null,error:h}):(e.factorType==="totp"&&d.type==="totp"&&(!((s=d==null?void 0:d.totp)===null||s===void 0)&&s.qr_code)&&(d.totp.qr_code=`data:image/svg+xml;utf-8,${d.totp.qr_code}`),this._returnResult({data:d,error:null}))})}catch(t){if(Se(t))return this._returnResult({data:null,error:t});throw t}}async _verify(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:o}=t;if(o)return this._returnResult({data:null,error:o});const l=Object.assign({challenge_id:e.challengeId},"webauthn"in e?{webauthn:Object.assign(Object.assign({},e.webauthn),{credential_response:e.webauthn.type==="create"?KD(e.webauthn.credential_response):WD(e.webauthn.credential_response)})}:{code:e.code}),{data:c,error:d}=await Le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:l,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});return d?this._returnResult({data:null,error:d}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+c.expires_in},c)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",c),this._returnResult({data:c,error:d}))})}catch(t){if(Se(t))return this._returnResult({data:null,error:t});throw t}})}async _challenge(e){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async t=>{var n;const{data:s,error:o}=t;if(o)return this._returnResult({data:null,error:o});const l=await Le(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:e,headers:this.headers,jwt:(n=s==null?void 0:s.session)===null||n===void 0?void 0:n.access_token});if(l.error)return l;const{data:c}=l;if(c.type!=="webauthn")return{data:c,error:null};switch(c.webauthn.type){case"create":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:YD(c.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},c),{webauthn:Object.assign(Object.assign({},c.webauthn),{credential_options:Object.assign(Object.assign({},c.webauthn.credential_options),{publicKey:JD(c.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(t){if(Se(t))return this._returnResult({data:null,error:t});throw t}})}async _challengeAndVerify(e){const{data:t,error:n}=await this._challenge({factorId:e.factorId});return n?this._returnResult({data:null,error:n}):await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){var e;const{data:{user:t},error:n}=await this.getUser();if(n)return{data:null,error:n};const s={all:[],phone:[],totp:[],webauthn:[]};for(const o of(e=t==null?void 0:t.factors)!==null&&e!==void 0?e:[])s.all.push(o),o.status==="verified"&&s[o.factor_type].push(o);return{data:s,error:null}}async _getAuthenticatorAssuranceLevel(e){var t,n,s,o;if(e)try{const{payload:S}=Gm(e);let E=null;S.aal&&(E=S.aal);let R=E;const{data:{user:A},error:C}=await this.getUser(e);if(C)return this._returnResult({data:null,error:C});((n=(t=A==null?void 0:A.factors)===null||t===void 0?void 0:t.filter(O=>O.status==="verified"))!==null&&n!==void 0?n:[]).length>0&&(R="aal2");const I=S.amr||[];return{data:{currentLevel:E,nextLevel:R,currentAuthenticationMethods:I},error:null}}catch(S){if(Se(S))return this._returnResult({data:null,error:S});throw S}const{data:{session:l},error:c}=await this.getSession();if(c)return this._returnResult({data:null,error:c});if(!l)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:d}=Gm(l.access_token);let h=null;d.aal&&(h=d.aal);let p=h;((o=(s=l.user.factors)===null||s===void 0?void 0:s.filter(S=>S.status==="verified"))!==null&&o!==void 0?o:[]).length>0&&(p="aal2");const b=d.amr||[];return{data:{currentLevel:h,nextLevel:p,currentAuthenticationMethods:b},error:null}}async _getAuthorizationDetails(e){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;return s?this._returnResult({data:null,error:s}):n?await Le(this.fetch,"GET",`${this.url}/oauth/authorizations/${e}`,{headers:this.headers,jwt:n.access_token,xform:o=>({data:o,error:null})}):this._returnResult({data:null,error:new xi})})}catch(t){if(Se(t))return this._returnResult({data:null,error:t});throw t}}async _approveAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;if(o)return this._returnResult({data:null,error:o});if(!s)return this._returnResult({data:null,error:new xi});const l=await Le(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"approve"},xform:c=>({data:c,error:null})});return l.data&&l.data.redirect_url&&Sn()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(l.data.redirect_url),l})}catch(n){if(Se(n))return this._returnResult({data:null,error:n});throw n}}async _denyAuthorization(e,t){try{return await this._useSession(async n=>{const{data:{session:s},error:o}=n;if(o)return this._returnResult({data:null,error:o});if(!s)return this._returnResult({data:null,error:new xi});const l=await Le(this.fetch,"POST",`${this.url}/oauth/authorizations/${e}/consent`,{headers:this.headers,jwt:s.access_token,body:{action:"deny"},xform:c=>({data:c,error:null})});return l.data&&l.data.redirect_url&&Sn()&&!(t!=null&&t.skipBrowserRedirect)&&window.location.assign(l.data.redirect_url),l})}catch(n){if(Se(n))return this._returnResult({data:null,error:n});throw n}}async _listOAuthGrants(){try{return await this._useSession(async e=>{const{data:{session:t},error:n}=e;return n?this._returnResult({data:null,error:n}):t?await Le(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:t.access_token,xform:s=>({data:s,error:null})}):this._returnResult({data:null,error:new xi})})}catch(e){if(Se(e))return this._returnResult({data:null,error:e});throw e}}async _revokeOAuthGrant(e){try{return await this._useSession(async t=>{const{data:{session:n},error:s}=t;return s?this._returnResult({data:null,error:s}):n?(await Le(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:n.access_token,query:{client_id:e.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new xi})})}catch(t){if(Se(t))return this._returnResult({data:null,error:t});throw t}}async fetchJwk(e,t={keys:[]}){let n=t.keys.find(c=>c.kid===e);if(n)return n;const s=Date.now();if(n=this.jwks.keys.find(c=>c.kid===e),n&&this.jwks_cached_at+rD>s)return n;const{data:o,error:l}=await Le(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(l)throw l;return!o.keys||o.keys.length===0||(this.jwks=o,this.jwks_cached_at=s,n=o.keys.find(c=>c.kid===e),!n)?null:n}async getClaims(e,t={}){try{let n=e;if(!n){const{data:S,error:E}=await this.getSession();if(E||!S.session)return this._returnResult({data:null,error:E});n=S.session.access_token}const{header:s,payload:o,signature:l,raw:{header:c,payload:d}}=Gm(n);t!=null&&t.allowExpired||CD(o.exp);const h=!s.alg||s.alg.startsWith("HS")||!s.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(s.kid,t!=null&&t.keys?{keys:t.keys}:t==null?void 0:t.jwks);if(!h){const{error:S}=await this.getUser(n);if(S)throw S;return{data:{claims:o,header:s,signature:l},error:null}}const p=RD(s.alg),y=await crypto.subtle.importKey("jwk",h,p,!0,["verify"]);if(!await crypto.subtle.verify(p,y,l,pD(`${c}.${d}`)))throw new Tb("Invalid JWT signature");return{data:{claims:o,header:s,signature:l},error:null}}catch(n){if(Se(n))return this._returnResult({data:null,error:n});throw n}}}Mh.nextInstanceID={};const rL=Mh,oL="2.97.0";let rh="";typeof Deno<"u"?rh="deno":typeof document<"u"?rh="web":typeof navigator<"u"&&navigator.product==="ReactNative"?rh="react-native":rh="node";const aL={"X-Client-Info":`supabase-js-${rh}/${oL}`},lL={headers:aL},cL={schema:"public"},uL={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},dL={};function Dh(i){"@babel/helpers - typeof";return Dh=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Dh(i)}function hL(i,e){if(Dh(i)!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(Dh(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function fL(i){var e=hL(i,"string");return Dh(e)=="symbol"?e:e+""}function pL(i,e,t){return(e=fL(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function dT(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(s){return Object.getOwnPropertyDescriptor(i,s).enumerable})),t.push.apply(t,n)}return t}function Ht(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?dT(Object(t),!0).forEach(function(n){pL(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):dT(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}const mL=i=>i?(...e)=>i(...e):(...e)=>fetch(...e),gL=()=>Headers,vL=(i,e,t)=>{const n=mL(t),s=gL();return async(o,l)=>{var c;const d=(c=await e())!==null&&c!==void 0?c:i;let h=new s(l==null?void 0:l.headers);return h.has("apikey")||h.set("apikey",i),h.has("Authorization")||h.set("Authorization",`Bearer ${d}`),n(o,Ht(Ht({},l),{},{headers:h}))}};function yL(i){return i.endsWith("/")?i:i+"/"}function bL(i,e){var t,n;const{db:s,auth:o,realtime:l,global:c}=i,{db:d,auth:h,realtime:p,global:y}=e,b={db:Ht(Ht({},d),s),auth:Ht(Ht({},h),o),realtime:Ht(Ht({},p),l),storage:{},global:Ht(Ht(Ht({},y),c),{},{headers:Ht(Ht({},(t=y==null?void 0:y.headers)!==null&&t!==void 0?t:{}),(n=c==null?void 0:c.headers)!==null&&n!==void 0?n:{})}),accessToken:async()=>""};return i.accessToken?b.accessToken=i.accessToken:delete b.accessToken,b}function _L(i){const e=i==null?void 0:i.trim();if(!e)throw new Error("supabaseUrl is required.");if(!e.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(yL(e))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var wL=class extends rL{constructor(i){super(i)}},xL=class{constructor(i,e,t){var n,s;this.supabaseUrl=i,this.supabaseKey=e;const o=_L(i);if(!e)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",o),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",o),this.storageUrl=new URL("storage/v1",o),this.functionsUrl=new URL("functions/v1",o);const l=`sb-${o.hostname.split(".")[0]}-auth-token`,c={db:cL,realtime:dL,auth:Ht(Ht({},uL),{},{storageKey:l}),global:lL},d=bL(t??{},c);if(this.storageKey=(n=d.auth.storageKey)!==null&&n!==void 0?n:"",this.headers=(s=d.global.headers)!==null&&s!==void 0?s:{},d.accessToken)this.accessToken=d.accessToken,this.auth=new Proxy({},{get:(p,y)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(y)} is not possible`)}});else{var h;this.auth=this._initSupabaseAuthClient((h=d.auth)!==null&&h!==void 0?h:{},this.headers,d.global.fetch)}this.fetch=vL(e,this._getAccessToken.bind(this),d.global.fetch),this.realtime=this._initRealtimeClient(Ht({headers:this.headers,accessToken:this._getAccessToken.bind(this)},d.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(p=>this.realtime.setAuth(p)).catch(p=>console.warn("Failed to set initial Realtime auth token:",p)),this.rest=new aM(new URL("rest/v1",o).href,{headers:this.headers,schema:d.db.schema,fetch:this.fetch,timeout:d.db.timeout,urlLengthLimit:d.db.urlLengthLimit}),this.storage=new eD(this.storageUrl.href,this.headers,this.fetch,t==null?void 0:t.storage),d.accessToken||this._listenForAuthEvents()}get functions(){return new ZI(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(i){return this.rest.from(i)}schema(i){return this.rest.schema(i)}rpc(i,e={},t={head:!1,get:!1,count:void 0}){return this.rest.rpc(i,e,t)}channel(i,e={config:{}}){return this.realtime.channel(i,e)}getChannels(){return this.realtime.getChannels()}removeChannel(i){return this.realtime.removeChannel(i)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var i=this,e,t;if(i.accessToken)return await i.accessToken();const{data:n}=await i.auth.getSession();return(e=(t=n.session)===null||t===void 0?void 0:t.access_token)!==null&&e!==void 0?e:i.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:i,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:s,storageKey:o,flowType:l,lock:c,debug:d,throwOnError:h},p,y){const b={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new wL({url:this.authUrl.href,headers:Ht(Ht({},b),p),storageKey:o,autoRefreshToken:i,persistSession:e,detectSessionInUrl:t,storage:n,userStorage:s,flowType:l,lock:c,debug:d,throwOnError:h,fetch:y,hasCustomAuthorizationHeader:Object.keys(this.headers).some(S=>S.toLowerCase()==="authorization")})}_initRealtimeClient(i){return new EM(this.realtimeUrl.href,Ht(Ht({},i),{},{params:Ht(Ht({},{apikey:this.supabaseKey}),i==null?void 0:i.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((i,e)=>{this._handleTokenChanged(i,"CLIENT",e==null?void 0:e.access_token)})}_handleTokenChanged(i,e,t){(i==="TOKEN_REFRESHED"||i==="SIGNED_IN")&&this.changedAccessToken!==t?(this.changedAccessToken=t,this.realtime.setAuth(t)):i==="SIGNED_OUT"&&(this.realtime.setAuth(),e=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const SL=(i,e,t)=>new xL(i,e,t);function EL(){if(typeof window<"u")return!1;const i=globalThis.process;if(!i)return!1;const e=i.version;if(e==null)return!1;const t=e.match(/^v(\d+)\./);return t?parseInt(t[1],10)<=18:!1}EL()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Hc={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};var hT={};const gp=i=>{var s,o,l,c;const e=`VITE_${i}`,t=(Hc==null?void 0:Hc[e])||(Hc==null?void 0:Hc[i]);if(t)return t.trim();const n=((o=(s=window.process)==null?void 0:s.env)==null?void 0:o[i])||((c=(l=window.process)==null?void 0:l.env)==null?void 0:c[e]);if(n)return n.trim();try{const d=hT[i]||hT[e];if(d)return d.trim()}catch{}return""},L1=gp("SUPABASE_URL")||"https://fusubnzndmngjfgatzrq.supabase.co",Cb=gp("SUPABASE_ANON_KEY")||"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZ1c3VibnpuZG1uZ2pmZ2F0enJxIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjczNTQ5NzcsImV4cCI6MjA4MjkzMDk3N30.O5Vp5R_KxAUpi8esYjqCHrjmyG3PzkNj1gDxpaNuKtI",Ve=SL(L1,Cb),AL=()=>L1.includes("supabase.co")&&Cb&&Cb.length>20,Vm=()=>crypto.randomUUID(),fT=i=>({id:i.id,companyId:i.company_id,jobNumber:i.job_number||"UNKNOWN",customer:i.customer||"",address:i.address||"",city:i.city||"",state:i.state||"",county:i.county||"",createdAt:i.created_at?new Date(i.created_at).getTime():Date.now(),isComplete:i.is_complete??!1}),at={async getCompany(i){const{data:e,error:t}=await Ve.from("companies").select("*").eq("id",i).single();return t?null:{id:e.id,name:e.name,brandColor:e.brand_color,createdAt:new Date(e.created_at).getTime()}},async getUsers(){const{data:i,error:e}=await Ve.from("profiles").select("*");return e?[]:(i||[]).map(t=>{var n;return{...t,companyId:t.company_id,role:((n=t.role)==null?void 0:n.toUpperCase())==="ADMIN"?Di.ADMIN:Di.CREW}})},async addUser(i){var o;const t={id:i.id||Vm(),name:i.name,username:i.username,role:i.role||Di.CREW,company_id:i.companyId},{data:n,error:s}=await Ve.from("profiles").upsert([t]).select().single();if(s)throw s;return{...n,companyId:n.company_id,role:((o=n.role)==null?void 0:o.toUpperCase())==="ADMIN"?Di.ADMIN:Di.CREW}},async updateUserRole(i,e){const{error:t}=await Ve.from("profiles").update({role:e}).eq("id",i);if(t)throw t},async deleteUser(i){const{error:e}=await Ve.from("profiles").delete().eq("id",i);if(e)throw e},async getJobs(){const{data:i,error:e}=await Ve.from("jobs").select("*");return e?[]:(i||[]).map(fT)},async saveJob(i){const{data:e,error:t}=await Ve.from("jobs").upsert({id:i.id,company_id:i.companyId,job_number:i.jobNumber,customer:i.customer,address:i.address,city:i.city,state:i.state,county:i.county,is_complete:i.isComplete}).select().single();if(t)throw t;return fT(e)},async deleteJob(i){const{error:e}=await Ve.from("jobs").delete().eq("id",i);if(e)throw e},async getTickets(){const{data:i,error:e}=await Ve.from("tickets").select("*");return e?[]:(i||[]).map(t=>({id:t.id,companyId:t.company_id,jobNumber:t.job_number,ticketNo:t.ticket_no,street:t.street,crossStreet:t.cross_street||"",place:t.place||"",extent:t.extent||"",county:t.county,city:t.city,state:t.state,callInDate:t.call_in_date,workDate:t.work_date,expires:t.expires,site_contact:t.site_contact,refreshRequested:t.refresh_requested??!1,noShowRequested:t.no_show_requested??!1,isArchived:t.is_archived??!1,documentUrl:t.document_url||"",createdAt:new Date(t.created_at).getTime()}))},async saveTicket(i,e=!1){e&&await Ve.from("tickets").update({is_archived:!0}).eq("ticket_no",i.ticketNo).eq("job_number",i.jobNumber).neq("id",i.id);const{data:t,error:n}=await Ve.from("tickets").upsert({id:i.id,company_id:i.companyId,job_number:i.jobNumber,ticket_no:i.ticketNo,street:i.street,cross_street:i.crossStreet,place:i.place,extent:i.extent,county:i.county,city:i.city,state:i.state,call_in_date:i.callInDate,work_date:i.workDate,expires:i.expires,site_contact:i.siteContact,refresh_requested:i.refreshRequested??!1,no_show_requested:i.noShowRequested??!1,is_archived:i.isArchived??!1,document_url:i.documentUrl}).select().single();if(n)throw n;return{id:t.id,companyId:t.company_id,jobNumber:t.job_number,ticketNo:t.ticket_no,street:t.street,crossStreet:t.cross_street||"",place:t.place||"",extent:t.extent,county:t.county,city:t.city,state:t.state,callInDate:t.call_in_date,workDate:t.work_date,expires:t.expires,siteContact:t.site_contact,refreshRequested:t.refresh_requested??!1,noShowRequested:t.no_show_requested??!1,isArchived:t.is_archived??!1,documentUrl:t.document_url||"",createdAt:new Date(t.created_at).getTime()}},async getPhotos(){const{data:i,error:e}=await Ve.from("photos").select("*");return e?[]:(i||[]).map(t=>({...t,jobNumber:t.job_number,companyId:t.company_id,dataUrl:t.data_url,timestamp:new Date(t.created_at).getTime()}))},async addPhoto(i,e){const t=Vm(),n=e.name.split(".").pop(),s=`${i.jobNumber}/${t}.${n}`,{error:o}=await Ve.storage.from("job-photos").upload(s,e);if(o)throw o;const{data:{publicUrl:l}}=Ve.storage.from("job-photos").getPublicUrl(s),{error:c}=await Ve.from("photos").insert([{id:t,company_id:i.companyId,job_number:i.jobNumber,data_url:l,caption:i.caption}]);if(c)throw c;return{...i,id:t,dataUrl:l}},async deletePhoto(i){const{error:e}=await Ve.from("photos").delete().eq("id",i);if(e)throw e},async getNotes(){const{data:i,error:e}=await Ve.from("notes").select("*");return e?[]:(i||[]).map(t=>({...t,jobNumber:t.job_number,companyId:t.company_id}))},async addNote(i){const{error:e}=await Ve.from("notes").insert([{id:i.id,company_id:i.companyId,job_number:i.jobNumber,text:i.text,author:i.author,timestamp:i.timestamp}]);if(e)throw e;return i},async addTicketFile(i,e){const t=Vm(),n=e.name.split(".").pop(),s=`${i}/tickets/${t}.${n}`,{error:o}=await Ve.storage.from("Ticket_Images").upload(s,e);if(o)throw o;const{data:{publicUrl:l}}=Ve.storage.from("Ticket_Images").getPublicUrl(s);return l},async savePushSubscription(i,e){const{error:t}=await Ve.from("push_subscriptions").upsert([{user_id:i,subscription_json:JSON.stringify(e)}]);if(t)throw t},async getNoShows(){const{data:i,error:e}=await Ve.from("no_shows").select("*");return e?[]:(i||[]).map(t=>({id:t.id,ticketId:t.ticket_id,companyId:t.company_id,jobNumber:t.job_number,utilities:t.utilities||[],companies:t.companies||"",author:t.author||"",timestamp:Number(t.timestamp)}))},async addNoShow(i){const{error:e}=await Ve.from("no_shows").insert([{id:i.id,company_id:i.companyId,ticket_id:i.ticketId,job_number:i.jobNumber,utilities:i.utilities,companies:i.companies,author:i.author,timestamp:i.timestamp}]);if(e)throw e;await Ve.from("tickets").update({no_show_requested:!0}).eq("id",i.ticketId)},async deleteNoShow(i){await Ve.from("no_shows").delete().eq("ticket_id",i),await Ve.from("tickets").update({no_show_requested:!1}).eq("id",i)},async getJobPrints(i){const{data:e,error:t}=await Ve.from("job_prints").select("*").eq("job_number",i);return t?[]:(e||[]).map(n=>{const{data:{publicUrl:s}}=Ve.storage.from("job-prints").getPublicUrl(n.storage_path);return{id:n.id,jobNumber:n.job_number,companyId:n.company_id,storagePath:n.storage_path,fileName:n.file_name,isPinned:n.is_pinned,createdAt:new Date(n.created_at).getTime(),url:s}})},async uploadJobPrint(i,e){const t=Vm(),n=e.name.split(".").pop(),s=`${i}/${t}.${n}`,{error:o}=await Ve.storage.from("job-prints").upload(s,e);if(o)throw o;const{data:{publicUrl:l}}=Ve.storage.from("job-prints").getPublicUrl(s),{data:c,error:d}=await Ve.from("job_prints").insert([{id:t,job_number:i,storage_path:s,file_name:e.name,is_pinned:!0}]).select().single();if(d)throw d;return{...c,companyId:c.company_id,url:l,createdAt:new Date(c.created_at).getTime()}},async getPrintMarkers(i){const{data:e,error:t}=await Ve.from("print_markers").select("*").eq("print_id",i);return t?[]:(e||[]).map(n=>({id:n.id,printId:n.print_id,ticketId:n.ticket_id,xPercent:n.x_percent,yPercent:n.y_percent,pageNumber:n.page_number,label:n.label}))},async savePrintMarker(i){const{data:e,error:t}=await Ve.from("print_markers").insert({print_id:i.printId,ticket_id:i.ticketId,x_percent:i.xPercent,y_percent:i.yPercent,page_number:i.pageNumber,label:i.label}).select().single();if(t)throw t;return{id:e.id,printId:e.print_id,ticketId:e.ticket_id,xPercent:e.x_percent,yPercent:e.y_percent,pageNumber:e.page_number,label:e.label}},async deletePrintMarker(i){const{error:e}=await Ve.from("print_markers").delete().eq("id",i);if(e)throw e},async createCompany(i){const{data:e,error:t}=await Ve.from("companies").insert([{id:i.id,name:i.name,brand_color:i.brandColor,created_at:new Date().toISOString()}]).select().single();if(t)throw t;return{id:e.id,name:e.name,brandColor:e.brand_color,createdAt:new Date(e.created_at).getTime()}},async updateUserCompany(i,e){const{error:t}=await Ve.from("profiles").update({company_id:e}).eq("id",i);if(t)throw t}};var Zd={exports:{}},ib={},sb,pT;function TL(){if(pT)return sb;pT=1;function i(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return sb=i,i.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},i.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},i.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var s=this;return this._timer=setTimeout(function(){s._attempts++,s._operationTimeoutCb&&(s._timeout=setTimeout(function(){s._operationTimeoutCb(s._attempts)},s._operationTimeout),s._options.unref&&s._timeout.unref()),s._fn(s._attempts)},n),this._options.unref&&this._timer.unref(),!0},i.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},i.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},i.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},i.prototype.start=i.prototype.try,i.prototype.errors=function(){return this._errors},i.prototype.attempts=function(){return this._attempts},i.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,s=0;s<this._errors.length;s++){var o=this._errors[s],l=o.message,c=(e[l]||0)+1;e[l]=c,c>=n&&(t=o,n=c)}return t},sb}var mT;function CL(){return mT||(mT=1,(function(i){var e=TL();i.operation=function(t){var n=i.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},i.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var s in t)n[s]=t[s];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var o=[],l=0;l<n.retries;l++)o.push(this.createTimeout(l,n));return t&&t.forever&&!o.length&&o.push(this.createTimeout(l,n)),o.sort(function(c,d){return c-d}),o},i.createTimeout=function(t,n){var s=n.randomize?Math.random()+1:1,o=Math.round(s*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return o=Math.min(o,n.maxTimeout),o},i.wrap=function(t,n,s){if(n instanceof Array&&(s=n,n=null),!s){s=[];for(var o in t)typeof t[o]=="function"&&s.push(o)}for(var l=0;l<s.length;l++){var c=s[l],d=t[c];t[c]=(function(p){var y=i.operation(n),b=Array.prototype.slice.call(arguments,1),S=b.pop();b.push(function(E){y.retry(E)||(E&&(arguments[0]=y.mainError()),S.apply(this,arguments))}),y.attempt(function(){p.apply(t,b)})}).bind(t,d),t[c].options=n}}})(ib)),ib}var rb,gT;function RL(){return gT||(gT=1,rb=CL()),rb}var vT;function NL(){if(vT)return Zd.exports;vT=1;const i=RL(),e=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];class t extends Error{constructor(c){super(),c instanceof Error?(this.originalError=c,{message:c}=c):(this.originalError=new Error(c),this.originalError.stack=this.stack),this.name="AbortError",this.message=c}}const n=(l,c,d)=>{const h=d.retries-(c-1);return l.attemptNumber=c,l.retriesLeft=h,l},s=l=>e.includes(l),o=(l,c)=>new Promise((d,h)=>{c={onFailedAttempt:()=>{},retries:10,...c};const p=i.operation(c);p.attempt(async y=>{try{d(await l(y))}catch(b){if(!(b instanceof Error)){h(new TypeError(`Non-error was thrown: "${b}". You should only throw errors.`));return}if(b instanceof t)p.stop(),h(b.originalError);else if(b instanceof TypeError&&!s(b.message))p.stop(),h(b);else{n(b,y,c);try{await c.onFailedAttempt(b)}catch(S){h(S);return}p.retry(b)||h(p.mainError())}}})});return Zd.exports=o,Zd.exports.default=o,Zd.exports.AbortError=t,Zd.exports}var P1=NL();const kL=v1(P1);var IL={};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let ML,DL;function LL(){return{geminiUrl:ML,vertexUrl:DL}}function PL(i,e,t,n){var s,o;if(!(i!=null&&i.baseUrl)){const l=LL();return e?(s=l.vertexUrl)!==null&&s!==void 0?s:t:(o=l.geminiUrl)!==null&&o!==void 0?o:n}return i.baseUrl}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class ro{}function me(i,e){const t=/\{([^}]+)\}/g;return i.replace(t,(n,s)=>{if(Object.prototype.hasOwnProperty.call(e,s)){const o=e[s];return o!=null?String(o):""}else throw new Error(`Key '${s}' not found in valueMap.`)})}function v(i,e,t){for(let o=0;o<e.length-1;o++){const l=e[o];if(l.endsWith("[]")){const c=l.slice(0,-2);if(!(c in i))if(Array.isArray(t))i[c]=Array.from({length:t.length},()=>({}));else throw new Error(`Value must be a list given an array path ${l}`);if(Array.isArray(i[c])){const d=i[c];if(Array.isArray(t))for(let h=0;h<d.length;h++){const p=d[h];v(p,e.slice(o+1),t[h])}else for(const h of d)v(h,e.slice(o+1),t)}return}else if(l.endsWith("[0]")){const c=l.slice(0,-3);c in i||(i[c]=[{}]);const d=i[c];v(d[0],e.slice(o+1),t);return}(!i[l]||typeof i[l]!="object")&&(i[l]={}),i=i[l]}const n=e[e.length-1],s=i[n];if(s!==void 0){if(!t||typeof t=="object"&&Object.keys(t).length===0||t===s)return;if(typeof s=="object"&&typeof t=="object"&&s!==null&&t!==null)Object.assign(s,t);else throw new Error(`Cannot set value for an existing key. Key: ${n}`)}else n==="_self"&&typeof t=="object"&&t!==null&&!Array.isArray(t)?Object.assign(i,t):i[n]=t}function m(i,e,t=void 0){try{if(e.length===1&&e[0]==="_self")return i;for(let n=0;n<e.length;n++){if(typeof i!="object"||i===null)return t;const s=e[n];if(s.endsWith("[]")){const o=s.slice(0,-2);if(o in i){const l=i[o];return Array.isArray(l)?l.map(c=>m(c,e.slice(n+1),t)):t}else return t}else i=i[s]}return i}catch(n){if(n instanceof TypeError)return t;throw n}}function OL(i,e){for(const[t,n]of Object.entries(e)){const s=t.split("."),o=n.split("."),l=new Set;let c=-1;for(let d=0;d<s.length;d++)if(s[d]==="*"){c=d;break}if(c!==-1&&o.length>c)for(let d=c;d<o.length;d++){const h=o[d];h!=="*"&&!h.endsWith("[]")&&!h.endsWith("[0]")&&l.add(h)}Rb(i,s,o,0,l)}}function Rb(i,e,t,n,s){if(n>=e.length||typeof i!="object"||i===null)return;const o=e[n];if(o.endsWith("[]")){const l=o.slice(0,-2),c=i;if(l in c&&Array.isArray(c[l]))for(const d of c[l])Rb(d,e,t,n+1,s)}else if(o==="*"){if(typeof i=="object"&&i!==null&&!Array.isArray(i)){const l=i,c=Object.keys(l).filter(h=>!h.startsWith("_")&&!s.has(h)),d={};for(const h of c)d[h]=l[h];for(const[h,p]of Object.entries(d)){const y=[];for(const b of t.slice(n))b==="*"?y.push(h):y.push(b);v(l,y,p)}for(const h of c)delete l[h]}}else{const l=i;o in l&&Rb(l[o],e,t,n+1,s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function cw(i){if(typeof i!="string")throw new Error("fromImageBytes must be a string");return i}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function UL(i){const e={},t=m(i,["operationName"]);t!=null&&v(e,["operationName"],t);const n=m(i,["resourceName"]);return n!=null&&v(e,["_url","resourceName"],n),e}function FL(i){const e={},t=m(i,["name"]);t!=null&&v(e,["name"],t);const n=m(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=m(i,["done"]);s!=null&&v(e,["done"],s);const o=m(i,["error"]);o!=null&&v(e,["error"],o);const l=m(i,["response","generateVideoResponse"]);return l!=null&&v(e,["response"],BL(l)),e}function HL(i){const e={},t=m(i,["name"]);t!=null&&v(e,["name"],t);const n=m(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=m(i,["done"]);s!=null&&v(e,["done"],s);const o=m(i,["error"]);o!=null&&v(e,["error"],o);const l=m(i,["response"]);return l!=null&&v(e,["response"],jL(l)),e}function BL(i){const e={},t=m(i,["generatedSamples"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>qL(l))),v(e,["generatedVideos"],o)}const n=m(i,["raiMediaFilteredCount"]);n!=null&&v(e,["raiMediaFilteredCount"],n);const s=m(i,["raiMediaFilteredReasons"]);return s!=null&&v(e,["raiMediaFilteredReasons"],s),e}function jL(i){const e={},t=m(i,["videos"]);if(t!=null){let o=t;Array.isArray(o)&&(o=o.map(l=>GL(l))),v(e,["generatedVideos"],o)}const n=m(i,["raiMediaFilteredCount"]);n!=null&&v(e,["raiMediaFilteredCount"],n);const s=m(i,["raiMediaFilteredReasons"]);return s!=null&&v(e,["raiMediaFilteredReasons"],s),e}function qL(i){const e={},t=m(i,["video"]);return t!=null&&v(e,["video"],KL(t)),e}function GL(i){const e={},t=m(i,["_self"]);return t!=null&&v(e,["video"],WL(t)),e}function VL(i){const e={},t=m(i,["operationName"]);return t!=null&&v(e,["_url","operationName"],t),e}function zL(i){const e={},t=m(i,["operationName"]);return t!=null&&v(e,["_url","operationName"],t),e}function $L(i){const e={},t=m(i,["name"]);t!=null&&v(e,["name"],t);const n=m(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=m(i,["done"]);s!=null&&v(e,["done"],s);const o=m(i,["error"]);o!=null&&v(e,["error"],o);const l=m(i,["response"]);return l!=null&&v(e,["response"],YL(l)),e}function YL(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["parent"]);n!=null&&v(e,["parent"],n);const s=m(i,["documentName"]);return s!=null&&v(e,["documentName"],s),e}function O1(i){const e={},t=m(i,["name"]);t!=null&&v(e,["name"],t);const n=m(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=m(i,["done"]);s!=null&&v(e,["done"],s);const o=m(i,["error"]);o!=null&&v(e,["error"],o);const l=m(i,["response"]);return l!=null&&v(e,["response"],JL(l)),e}function JL(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["parent"]);n!=null&&v(e,["parent"],n);const s=m(i,["documentName"]);return s!=null&&v(e,["documentName"],s),e}function KL(i){const e={},t=m(i,["uri"]);t!=null&&v(e,["uri"],t);const n=m(i,["encodedVideo"]);n!=null&&v(e,["videoBytes"],cw(n));const s=m(i,["encoding"]);return s!=null&&v(e,["mimeType"],s),e}function WL(i){const e={},t=m(i,["gcsUri"]);t!=null&&v(e,["uri"],t);const n=m(i,["bytesBase64Encoded"]);n!=null&&v(e,["videoBytes"],cw(n));const s=m(i,["mimeType"]);return s!=null&&v(e,["mimeType"],s),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var yT;(function(i){i.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",i.OUTCOME_OK="OUTCOME_OK",i.OUTCOME_FAILED="OUTCOME_FAILED",i.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(yT||(yT={}));var bT;(function(i){i.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",i.PYTHON="PYTHON"})(bT||(bT={}));var _T;(function(i){i.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",i.SILENT="SILENT",i.WHEN_IDLE="WHEN_IDLE",i.INTERRUPT="INTERRUPT"})(_T||(_T={}));var Ft;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.STRING="STRING",i.NUMBER="NUMBER",i.INTEGER="INTEGER",i.BOOLEAN="BOOLEAN",i.ARRAY="ARRAY",i.OBJECT="OBJECT",i.NULL="NULL"})(Ft||(Ft={}));var wT;(function(i){i.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",i.SIMPLE_SEARCH="SIMPLE_SEARCH",i.ELASTIC_SEARCH="ELASTIC_SEARCH"})(wT||(wT={}));var xT;(function(i){i.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",i.NO_AUTH="NO_AUTH",i.API_KEY_AUTH="API_KEY_AUTH",i.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",i.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",i.OAUTH="OAUTH",i.OIDC_AUTH="OIDC_AUTH"})(xT||(xT={}));var ST;(function(i){i.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",i.HTTP_IN_QUERY="HTTP_IN_QUERY",i.HTTP_IN_HEADER="HTTP_IN_HEADER",i.HTTP_IN_PATH="HTTP_IN_PATH",i.HTTP_IN_BODY="HTTP_IN_BODY",i.HTTP_IN_COOKIE="HTTP_IN_COOKIE"})(ST||(ST={}));var ET;(function(i){i.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",i.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",i.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",i.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"})(ET||(ET={}));var AT;(function(i){i.UNSPECIFIED="UNSPECIFIED",i.BLOCKING="BLOCKING",i.NON_BLOCKING="NON_BLOCKING"})(AT||(AT={}));var TT;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.MODE_DYNAMIC="MODE_DYNAMIC"})(TT||(TT={}));var CT;(function(i){i.MODE_UNSPECIFIED="MODE_UNSPECIFIED",i.AUTO="AUTO",i.ANY="ANY",i.NONE="NONE",i.VALIDATED="VALIDATED"})(CT||(CT={}));var RT;(function(i){i.THINKING_LEVEL_UNSPECIFIED="THINKING_LEVEL_UNSPECIFIED",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH",i.MINIMAL="MINIMAL"})(RT||(RT={}));var NT;(function(i){i.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",i.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",i.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",i.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",i.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",i.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",i.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",i.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",i.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",i.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"})(NT||(NT={}));var kT;(function(i){i.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",i.SEVERITY="SEVERITY",i.PROBABILITY="PROBABILITY"})(kT||(kT={}));var IT;(function(i){i.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE",i.OFF="OFF"})(IT||(IT={}));var MT;(function(i){i.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",i.STOP="STOP",i.MAX_TOKENS="MAX_TOKENS",i.SAFETY="SAFETY",i.RECITATION="RECITATION",i.LANGUAGE="LANGUAGE",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.SPII="SPII",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.IMAGE_SAFETY="IMAGE_SAFETY",i.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",i.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",i.NO_IMAGE="NO_IMAGE",i.IMAGE_RECITATION="IMAGE_RECITATION",i.IMAGE_OTHER="IMAGE_OTHER"})(MT||(MT={}));var DT;(function(i){i.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",i.NEGLIGIBLE="NEGLIGIBLE",i.LOW="LOW",i.MEDIUM="MEDIUM",i.HIGH="HIGH"})(DT||(DT={}));var LT;(function(i){i.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",i.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",i.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",i.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",i.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"})(LT||(LT={}));var PT;(function(i){i.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",i.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",i.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",i.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",i.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"})(PT||(PT={}));var OT;(function(i){i.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",i.SAFETY="SAFETY",i.OTHER="OTHER",i.BLOCKLIST="BLOCKLIST",i.PROHIBITED_CONTENT="PROHIBITED_CONTENT",i.IMAGE_SAFETY="IMAGE_SAFETY",i.MODEL_ARMOR="MODEL_ARMOR",i.JAILBREAK="JAILBREAK"})(OT||(OT={}));var UT;(function(i){i.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",i.ON_DEMAND="ON_DEMAND",i.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"})(UT||(UT={}));var Dg;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.AUDIO="AUDIO"})(Dg||(Dg={}));var FT;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"})(FT||(FT={}));var HT;(function(i){i.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",i.TUNING_MODE_FULL="TUNING_MODE_FULL",i.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"})(HT||(HT={}));var BT;(function(i){i.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",i.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",i.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",i.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",i.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",i.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",i.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"})(BT||(BT={}));var Nb;(function(i){i.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",i.JOB_STATE_QUEUED="JOB_STATE_QUEUED",i.JOB_STATE_PENDING="JOB_STATE_PENDING",i.JOB_STATE_RUNNING="JOB_STATE_RUNNING",i.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",i.JOB_STATE_FAILED="JOB_STATE_FAILED",i.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",i.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",i.JOB_STATE_PAUSED="JOB_STATE_PAUSED",i.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",i.JOB_STATE_UPDATING="JOB_STATE_UPDATING",i.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"})(Nb||(Nb={}));var jT;(function(i){i.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",i.TUNING_TASK_I2V="TUNING_TASK_I2V",i.TUNING_TASK_T2V="TUNING_TASK_T2V",i.TUNING_TASK_R2V="TUNING_TASK_R2V"})(jT||(jT={}));var qT;(function(i){i.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",i.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",i.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",i.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH",i.MEDIA_RESOLUTION_ULTRA_HIGH="MEDIA_RESOLUTION_ULTRA_HIGH"})(qT||(qT={}));var kb;(function(i){i.COLLECTION="COLLECTION"})(kb||(kb={}));var GT;(function(i){i.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",i.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",i.BALANCED="BALANCED",i.PRIORITIZE_COST="PRIORITIZE_COST"})(GT||(GT={}));var VT;(function(i){i.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",i.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"})(VT||(VT={}));var Lg;(function(i){i.PREDICT="PREDICT",i.EMBED_CONTENT="EMBED_CONTENT"})(Lg||(Lg={}));var zT;(function(i){i.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",i.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",i.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",i.BLOCK_NONE="BLOCK_NONE"})(zT||(zT={}));var $T;(function(i){i.DONT_ALLOW="DONT_ALLOW",i.ALLOW_ADULT="ALLOW_ADULT",i.ALLOW_ALL="ALLOW_ALL"})($T||($T={}));var YT;(function(i){i.auto="auto",i.en="en",i.ja="ja",i.ko="ko",i.hi="hi",i.zh="zh",i.pt="pt",i.es="es"})(YT||(YT={}));var JT;(function(i){i.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",i.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",i.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",i.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",i.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"})(JT||(JT={}));var KT;(function(i){i.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",i.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",i.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",i.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"})(KT||(KT={}));var WT;(function(i){i.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",i.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",i.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",i.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"})(WT||(WT={}));var XT;(function(i){i.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",i.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",i.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",i.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",i.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",i.EDIT_MODE_STYLE="EDIT_MODE_STYLE",i.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",i.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"})(XT||(XT={}));var QT;(function(i){i.FOREGROUND="FOREGROUND",i.BACKGROUND="BACKGROUND",i.PROMPT="PROMPT",i.SEMANTIC="SEMANTIC",i.INTERACTIVE="INTERACTIVE"})(QT||(QT={}));var ZT;(function(i){i.ASSET="ASSET",i.STYLE="STYLE"})(ZT||(ZT={}));var eC;(function(i){i.INSERT="INSERT",i.REMOVE="REMOVE",i.REMOVE_STATIC="REMOVE_STATIC",i.OUTPAINT="OUTPAINT"})(eC||(eC={}));var tC;(function(i){i.OPTIMIZED="OPTIMIZED",i.LOSSLESS="LOSSLESS"})(tC||(tC={}));var nC;(function(i){i.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",i.PREFERENCE_TUNING="PREFERENCE_TUNING",i.DISTILLATION="DISTILLATION"})(nC||(nC={}));var iC;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.STATE_PENDING="STATE_PENDING",i.STATE_ACTIVE="STATE_ACTIVE",i.STATE_FAILED="STATE_FAILED"})(iC||(iC={}));var sC;(function(i){i.STATE_UNSPECIFIED="STATE_UNSPECIFIED",i.PROCESSING="PROCESSING",i.ACTIVE="ACTIVE",i.FAILED="FAILED"})(sC||(sC={}));var rC;(function(i){i.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",i.UPLOADED="UPLOADED",i.GENERATED="GENERATED",i.REGISTERED="REGISTERED"})(rC||(rC={}));var oC;(function(i){i.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",i.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",i.RESPONSE_REJECTED="RESPONSE_REJECTED",i.NEED_MORE_INPUT="NEED_MORE_INPUT"})(oC||(oC={}));var aC;(function(i){i.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",i.TEXT="TEXT",i.IMAGE="IMAGE",i.VIDEO="VIDEO",i.AUDIO="AUDIO",i.DOCUMENT="DOCUMENT"})(aC||(aC={}));var lC;(function(i){i.VAD_SIGNAL_TYPE_UNSPECIFIED="VAD_SIGNAL_TYPE_UNSPECIFIED",i.VAD_SIGNAL_TYPE_SOS="VAD_SIGNAL_TYPE_SOS",i.VAD_SIGNAL_TYPE_EOS="VAD_SIGNAL_TYPE_EOS"})(lC||(lC={}));var cC;(function(i){i.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",i.ACTIVITY_START="ACTIVITY_START",i.ACTIVITY_END="ACTIVITY_END"})(cC||(cC={}));var uC;(function(i){i.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",i.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",i.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"})(uC||(uC={}));var dC;(function(i){i.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",i.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",i.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"})(dC||(dC={}));var hC;(function(i){i.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",i.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",i.NO_INTERRUPTION="NO_INTERRUPTION"})(hC||(hC={}));var fC;(function(i){i.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",i.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",i.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"})(fC||(fC={}));var pC;(function(i){i.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",i.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",i.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",i.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",i.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",i.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",i.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",i.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",i.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",i.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",i.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",i.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",i.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"})(pC||(pC={}));var mC;(function(i){i.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",i.QUALITY="QUALITY",i.DIVERSITY="DIVERSITY",i.VOCALIZATION="VOCALIZATION"})(mC||(mC={}));var Xc;(function(i){i.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",i.PLAY="PLAY",i.PAUSE="PAUSE",i.STOP="STOP",i.RESET_CONTEXT="RESET_CONTEXT"})(Xc||(Xc={}));class Ib{constructor(e){const t={};for(const n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class eh{get text(){var e,t,n,s,o,l,c,d;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let h="",p=!1;const y=[];for(const b of(d=(c=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)!==null&&d!==void 0?d:[]){for(const[S,E]of Object.entries(b))S!=="text"&&S!=="thought"&&S!=="thoughtSignature"&&(E!==null||E!==void 0)&&y.push(S);if(typeof b.text=="string"){if(typeof b.thought=="boolean"&&b.thought)continue;p=!0,h+=b.text}}return y.length>0&&console.warn(`there are non-text parts ${y} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),p?h:void 0}get data(){var e,t,n,s,o,l,c,d;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let h="";const p=[];for(const y of(d=(c=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)!==null&&d!==void 0?d:[]){for(const[b,S]of Object.entries(y))b!=="inlineData"&&(S!==null||S!==void 0)&&p.push(b);y.inlineData&&typeof y.inlineData.data=="string"&&(h+=atob(y.inlineData.data))}return p.length>0&&console.warn(`there are non-data parts ${p} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),h.length>0?btoa(h):void 0}get functionCalls(){var e,t,n,s,o,l,c,d;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");const h=(d=(c=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)===null||d===void 0?void 0:d.filter(p=>p.functionCall).map(p=>p.functionCall).filter(p=>p!==void 0);if((h==null?void 0:h.length)!==0)return h}get executableCode(){var e,t,n,s,o,l,c,d,h;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");const p=(d=(c=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)===null||d===void 0?void 0:d.filter(y=>y.executableCode).map(y=>y.executableCode).filter(y=>y!==void 0);if((p==null?void 0:p.length)!==0)return(h=p==null?void 0:p[0])===null||h===void 0?void 0:h.code}get codeExecutionResult(){var e,t,n,s,o,l,c,d,h;if(((s=(n=(t=(e=this.candidates)===null||e===void 0?void 0:e[0])===null||t===void 0?void 0:t.content)===null||n===void 0?void 0:n.parts)===null||s===void 0?void 0:s.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");const p=(d=(c=(l=(o=this.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content)===null||c===void 0?void 0:c.parts)===null||d===void 0?void 0:d.filter(y=>y.codeExecutionResult).map(y=>y.codeExecutionResult).filter(y=>y!==void 0);if((p==null?void 0:p.length)!==0)return(h=p==null?void 0:p[0])===null||h===void 0?void 0:h.output}}class gC{}class vC{}class XL{}class QL{}class ZL{}class eP{}class yC{}class bC{}class _C{}class tP{}class Pg{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new Pg;let s;const o=e;return t?s=HL(o):s=FL(o),Object.assign(n,s),n}}class wC{}class xC{}class SC{}class EC{}class nP{}class iP{}class sP{}class uw{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new uw,o=$L(e);return Object.assign(n,o),n}}class rP{}class oP{}class aP{}class lP{}class AC{}class cP{get text(){var e,t,n;let s="",o=!1;const l=[];for(const c of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[d,h]of Object.entries(c))d!=="text"&&d!=="thought"&&h!==null&&l.push(d);if(typeof c.text=="string"){if(typeof c.thought=="boolean"&&c.thought)continue;o=!0,s+=c.text}}return l.length>0&&console.warn(`there are non-text parts ${l} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),o?s:void 0}get data(){var e,t,n;let s="";const o=[];for(const l of(n=(t=(e=this.serverContent)===null||e===void 0?void 0:e.modelTurn)===null||t===void 0?void 0:t.parts)!==null&&n!==void 0?n:[]){for(const[c,d]of Object.entries(l))c!=="inlineData"&&d!==null&&o.push(c);l.inlineData&&typeof l.inlineData.data=="string"&&(s+=atob(l.inlineData.data))}return o.length>0&&console.warn(`there are non-data parts ${o} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),s.length>0?btoa(s):void 0}}class uP{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class dw{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){const n=new dw,o=O1(e);return Object.assign(n,o),n}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ct(i,e){if(!e||typeof e!="string")throw new Error("model is required and must be a string");if(e.includes("..")||e.includes("?")||e.includes("&"))throw new Error("invalid model parameter");if(i.isVertexAI()){if(e.startsWith("publishers/")||e.startsWith("projects/")||e.startsWith("models/"))return e;if(e.indexOf("/")>=0){const t=e.split("/",2);return`publishers/${t[0]}/models/${t[1]}`}else return`publishers/google/models/${e}`}else return e.startsWith("models/")||e.startsWith("tunedModels/")?e:`models/${e}`}function U1(i,e){const t=ct(i,e);return t?t.startsWith("publishers/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}`:t.startsWith("models/")&&i.isVertexAI()?`projects/${i.getProject()}/locations/${i.getLocation()}/publishers/google/${t}`:t:""}function F1(i){return Array.isArray(i)?i.map(e=>Og(e)):[Og(i)]}function Og(i){if(typeof i=="object"&&i!==null)return i;throw new Error(`Could not parse input as Blob. Unsupported blob type: ${typeof i}`)}function H1(i){const e=Og(i);if(e.mimeType&&e.mimeType.startsWith("image/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function B1(i){const e=Og(i);if(e.mimeType&&e.mimeType.startsWith("audio/"))return e;throw new Error(`Unsupported mime type: ${e.mimeType}`)}function TC(i){if(i==null)throw new Error("PartUnion is required");if(typeof i=="object")return i;if(typeof i=="string")return{text:i};throw new Error(`Unsupported part type: ${typeof i}`)}function j1(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("PartListUnion is required");return Array.isArray(i)?i.map(e=>TC(e)):[TC(i)]}function Mb(i){return i!=null&&typeof i=="object"&&"parts"in i&&Array.isArray(i.parts)}function CC(i){return i!=null&&typeof i=="object"&&"functionCall"in i}function RC(i){return i!=null&&typeof i=="object"&&"functionResponse"in i}function pn(i){if(i==null)throw new Error("ContentUnion is required");return Mb(i)?i:{role:"user",parts:j1(i)}}function hw(i,e){if(!e)return[];if(i.isVertexAI()&&Array.isArray(e))return e.flatMap(t=>{const n=pn(t);return n.parts&&n.parts.length>0&&n.parts[0].text!==void 0?[n.parts[0].text]:[]});if(i.isVertexAI()){const t=pn(e);return t.parts&&t.parts.length>0&&t.parts[0].text!==void 0?[t.parts[0].text]:[]}return Array.isArray(e)?e.map(t=>pn(t)):[pn(e)]}function Pi(i){if(i==null||Array.isArray(i)&&i.length===0)throw new Error("contents are required");if(!Array.isArray(i)){if(CC(i)||RC(i))throw new Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[pn(i)]}const e=[],t=[],n=Mb(i[0]);for(const s of i){const o=Mb(s);if(o!=n)throw new Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(o)e.push(s);else{if(CC(s)||RC(s))throw new Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");t.push(s)}}return n||e.push({role:"user",parts:j1(t)}),e}function dP(i,e){i.includes("null")&&(e.nullable=!0);const t=i.filter(n=>n!=="null");if(t.length===1)e.type=Object.values(Ft).includes(t[0].toUpperCase())?t[0].toUpperCase():Ft.TYPE_UNSPECIFIED;else{e.anyOf=[];for(const n of t)e.anyOf.push({type:Object.values(Ft).includes(n.toUpperCase())?n.toUpperCase():Ft.TYPE_UNSPECIFIED})}}function tu(i){const e={},t=["items"],n=["anyOf"],s=["properties"];if(i.type&&i.anyOf)throw new Error("type and anyOf cannot be both populated.");const o=i.anyOf;o!=null&&o.length==2&&(o[0].type==="null"?(e.nullable=!0,i=o[1]):o[1].type==="null"&&(e.nullable=!0,i=o[0])),i.type instanceof Array&&dP(i.type,e);for(const[l,c]of Object.entries(i))if(c!=null)if(l=="type"){if(c==="null")throw new Error("type: null can not be the only possible type for the field.");if(c instanceof Array)continue;e.type=Object.values(Ft).includes(c.toUpperCase())?c.toUpperCase():Ft.TYPE_UNSPECIFIED}else if(t.includes(l))e[l]=tu(c);else if(n.includes(l)){const d=[];for(const h of c){if(h.type=="null"){e.nullable=!0;continue}d.push(tu(h))}e[l]=d}else if(s.includes(l)){const d={};for(const[h,p]of Object.entries(c))d[h]=tu(p);e[l]=d}else{if(l==="additionalProperties")continue;e[l]=c}return e}function fw(i){return tu(i)}function pw(i){if(typeof i=="object")return i;if(typeof i=="string")return{voiceConfig:{prebuiltVoiceConfig:{voiceName:i}}};throw new Error(`Unsupported speechConfig type: ${typeof i}`)}function mw(i){if("multiSpeakerVoiceConfig"in i)throw new Error("multiSpeakerVoiceConfig is not supported in the live API.");return i}function nd(i){if(i.functionDeclarations)for(const e of i.functionDeclarations)e.parameters&&(Object.keys(e.parameters).includes("$schema")?e.parametersJsonSchema||(e.parametersJsonSchema=e.parameters,delete e.parameters):e.parameters=tu(e.parameters)),e.response&&(Object.keys(e.response).includes("$schema")?e.responseJsonSchema||(e.responseJsonSchema=e.response,delete e.response):e.response=tu(e.response));return i}function id(i){if(i==null)throw new Error("tools is required");if(!Array.isArray(i))throw new Error("tools is required and must be an array of Tools");const e=[];for(const t of i)e.push(t);return e}function hP(i,e,t,n=1){const s=!e.startsWith(`${t}/`)&&e.split("/").length===n;return i.isVertexAI()?e.startsWith("projects/")?e:e.startsWith("locations/")?`projects/${i.getProject()}/${e}`:e.startsWith(`${t}/`)?`projects/${i.getProject()}/locations/${i.getLocation()}/${e}`:s?`projects/${i.getProject()}/locations/${i.getLocation()}/${t}/${e}`:e:s?`${t}/${e}`:e}function oo(i,e){if(typeof e!="string")throw new Error("name must be a string");return hP(i,e,"cachedContents")}function q1(i){switch(i){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return i}}function ca(i){return cw(i)}function fP(i){return i!=null&&typeof i=="object"&&"name"in i}function pP(i){return i!=null&&typeof i=="object"&&"video"in i}function mP(i){return i!=null&&typeof i=="object"&&"uri"in i}function G1(i){var e;let t;if(fP(i)&&(t=i.name),!(mP(i)&&(t=i.uri,t===void 0))&&!(pP(i)&&(t=(e=i.video)===null||e===void 0?void 0:e.uri,t===void 0))){if(typeof i=="string"&&(t=i),t===void 0)throw new Error("Could not extract file name from the provided input.");if(t.startsWith("https://")){const s=t.split("files/")[1].match(/[a-z0-9]+/);if(s===null)throw new Error(`Could not extract file name from URI ${t}`);t=s[0]}else t.startsWith("files/")&&(t=t.split("files/")[1]);return t}}function V1(i,e){let t;return i.isVertexAI()?t=e?"publishers/google/models":"models":t=e?"models":"tunedModels",t}function z1(i){for(const e of["models","tunedModels","publisherModels"])if(gP(i,e))return i[e];return[]}function gP(i,e){return i!==null&&typeof i=="object"&&e in i}function vP(i,e={}){const t=i,n={name:t.name,description:t.description,parametersJsonSchema:t.inputSchema};return t.outputSchema&&(n.responseJsonSchema=t.outputSchema),e.behavior&&(n.behavior=e.behavior),{functionDeclarations:[n]}}function yP(i,e={}){const t=[],n=new Set;for(const s of i){const o=s.name;if(n.has(o))throw new Error(`Duplicate function name ${o} found in MCP tools. Please ensure function names are unique.`);n.add(o);const l=vP(s,e);l.functionDeclarations&&t.push(...l.functionDeclarations)}return{functionDeclarations:t}}function $1(i,e){let t;if(typeof e=="string")if(i.isVertexAI())if(e.startsWith("gs://"))t={format:"jsonl",gcsUri:[e]};else if(e.startsWith("bq://"))t={format:"bigquery",bigqueryUri:e};else throw new Error(`Unsupported string source for Vertex AI: ${e}`);else if(e.startsWith("files/"))t={fileName:e};else throw new Error(`Unsupported string source for Gemini API: ${e}`);else if(Array.isArray(e)){if(i.isVertexAI())throw new Error("InlinedRequest[] is not supported in Vertex AI.");t={inlinedRequests:e}}else t=e;const n=[t.gcsUri,t.bigqueryUri].filter(Boolean).length,s=[t.inlinedRequests,t.fileName].filter(Boolean).length;if(i.isVertexAI()){if(s>0||n!==1)throw new Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(n>0||s!==1)throw new Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return t}function bP(i){if(typeof i!="string")return i;const e=i;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw new Error(`Unsupported destination: ${e}`)}function Y1(i){if(typeof i!="object"||i===null)return{};const e=i,t=e.inlinedResponses;if(typeof t!="object"||t===null)return i;const s=t.inlinedResponses;if(!Array.isArray(s)||s.length===0)return i;let o=!1;for(const l of s){if(typeof l!="object"||l===null)continue;const d=l.response;if(typeof d!="object"||d===null)continue;if(d.embedding!==void 0){o=!0;break}}return o&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),i}function sd(i,e){const t=e;if(!i.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw new Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw new Error(`Invalid batch job name: ${t}.`)}function J1(i){const e=i;return e==="BATCH_STATE_UNSPECIFIED"?"JOB_STATE_UNSPECIFIED":e==="BATCH_STATE_PENDING"?"JOB_STATE_PENDING":e==="BATCH_STATE_RUNNING"?"JOB_STATE_RUNNING":e==="BATCH_STATE_SUCCEEDED"?"JOB_STATE_SUCCEEDED":e==="BATCH_STATE_FAILED"?"JOB_STATE_FAILED":e==="BATCH_STATE_CANCELLED"?"JOB_STATE_CANCELLED":e==="BATCH_STATE_EXPIRED"?"JOB_STATE_EXPIRED":e}function _P(i){return i.includes("gemini")&&i!=="gemini-embedding-001"||i.includes("maas")}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wP(i){const e={},t=m(i,["responsesFile"]);t!=null&&v(e,["fileName"],t);const n=m(i,["inlinedResponses","inlinedResponses"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(l=>tO(l))),v(e,["inlinedResponses"],o)}const s=m(i,["inlinedEmbedContentResponses","inlinedResponses"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["inlinedEmbedContentResponses"],o)}return e}function xP(i){const e={},t=m(i,["predictionsFormat"]);t!=null&&v(e,["format"],t);const n=m(i,["gcsDestination","outputUriPrefix"]);n!=null&&v(e,["gcsUri"],n);const s=m(i,["bigqueryDestination","outputUri"]);return s!=null&&v(e,["bigqueryUri"],s),e}function SP(i){const e={},t=m(i,["format"]);t!=null&&v(e,["predictionsFormat"],t);const n=m(i,["gcsUri"]);n!=null&&v(e,["gcsDestination","outputUriPrefix"],n);const s=m(i,["bigqueryUri"]);if(s!=null&&v(e,["bigqueryDestination","outputUri"],s),m(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(i,["inlinedResponses"])!==void 0)throw new Error("inlinedResponses parameter is not supported in Vertex AI.");if(m(i,["inlinedEmbedContentResponses"])!==void 0)throw new Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return e}function ng(i){const e={},t=m(i,["name"]);t!=null&&v(e,["name"],t);const n=m(i,["metadata","displayName"]);n!=null&&v(e,["displayName"],n);const s=m(i,["metadata","state"]);s!=null&&v(e,["state"],J1(s));const o=m(i,["metadata","createTime"]);o!=null&&v(e,["createTime"],o);const l=m(i,["metadata","endTime"]);l!=null&&v(e,["endTime"],l);const c=m(i,["metadata","updateTime"]);c!=null&&v(e,["updateTime"],c);const d=m(i,["metadata","model"]);d!=null&&v(e,["model"],d);const h=m(i,["metadata","output"]);return h!=null&&v(e,["dest"],wP(Y1(h))),e}function Db(i){const e={},t=m(i,["name"]);t!=null&&v(e,["name"],t);const n=m(i,["displayName"]);n!=null&&v(e,["displayName"],n);const s=m(i,["state"]);s!=null&&v(e,["state"],J1(s));const o=m(i,["error"]);o!=null&&v(e,["error"],o);const l=m(i,["createTime"]);l!=null&&v(e,["createTime"],l);const c=m(i,["startTime"]);c!=null&&v(e,["startTime"],c);const d=m(i,["endTime"]);d!=null&&v(e,["endTime"],d);const h=m(i,["updateTime"]);h!=null&&v(e,["updateTime"],h);const p=m(i,["model"]);p!=null&&v(e,["model"],p);const y=m(i,["inputConfig"]);y!=null&&v(e,["src"],EP(y));const b=m(i,["outputConfig"]);b!=null&&v(e,["dest"],xP(Y1(b)));const S=m(i,["completionStats"]);return S!=null&&v(e,["completionStats"],S),e}function EP(i){const e={},t=m(i,["instancesFormat"]);t!=null&&v(e,["format"],t);const n=m(i,["gcsSource","uris"]);n!=null&&v(e,["gcsUri"],n);const s=m(i,["bigquerySource","inputUri"]);return s!=null&&v(e,["bigqueryUri"],s),e}function AP(i,e){const t={};if(m(e,["format"])!==void 0)throw new Error("format parameter is not supported in Gemini API.");if(m(e,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(e,["bigqueryUri"])!==void 0)throw new Error("bigqueryUri parameter is not supported in Gemini API.");const n=m(e,["fileName"]);n!=null&&v(t,["fileName"],n);const s=m(e,["inlinedRequests"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>eO(i,l))),v(t,["requests","requests"],o)}return t}function TP(i){const e={},t=m(i,["format"]);t!=null&&v(e,["instancesFormat"],t);const n=m(i,["gcsUri"]);n!=null&&v(e,["gcsSource","uris"],n);const s=m(i,["bigqueryUri"]);if(s!=null&&v(e,["bigquerySource","inputUri"],s),m(i,["fileName"])!==void 0)throw new Error("fileName parameter is not supported in Vertex AI.");if(m(i,["inlinedRequests"])!==void 0)throw new Error("inlinedRequests parameter is not supported in Vertex AI.");return e}function CP(i){const e={},t=m(i,["data"]);if(t!=null&&v(e,["data"],t),m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function RP(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],sd(i,n)),t}function NP(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],sd(i,n)),t}function kP(i){const e={},t=m(i,["content"]);t!=null&&v(e,["content"],t);const n=m(i,["citationMetadata"]);n!=null&&v(e,["citationMetadata"],IP(n));const s=m(i,["tokenCount"]);s!=null&&v(e,["tokenCount"],s);const o=m(i,["finishReason"]);o!=null&&v(e,["finishReason"],o);const l=m(i,["avgLogprobs"]);l!=null&&v(e,["avgLogprobs"],l);const c=m(i,["groundingMetadata"]);c!=null&&v(e,["groundingMetadata"],c);const d=m(i,["index"]);d!=null&&v(e,["index"],d);const h=m(i,["logprobsResult"]);h!=null&&v(e,["logprobsResult"],h);const p=m(i,["safetyRatings"]);if(p!=null){let b=p;Array.isArray(b)&&(b=b.map(S=>S)),v(e,["safetyRatings"],b)}const y=m(i,["urlContextMetadata"]);return y!=null&&v(e,["urlContextMetadata"],y),e}function IP(i){const e={},t=m(i,["citationSources"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),v(e,["citations"],n)}return e}function K1(i){const e={},t=m(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>lO(o))),v(e,["parts"],s)}const n=m(i,["role"]);return n!=null&&v(e,["role"],n),e}function MP(i,e){const t={},n=m(i,["displayName"]);if(e!==void 0&&n!=null&&v(e,["batch","displayName"],n),m(i,["dest"])!==void 0)throw new Error("dest parameter is not supported in Gemini API.");return t}function DP(i,e){const t={},n=m(i,["displayName"]);e!==void 0&&n!=null&&v(e,["displayName"],n);const s=m(i,["dest"]);return e!==void 0&&s!=null&&v(e,["outputConfig"],SP(bP(s))),t}function NC(i,e){const t={},n=m(e,["model"]);n!=null&&v(t,["_url","model"],ct(i,n));const s=m(e,["src"]);s!=null&&v(t,["batch","inputConfig"],AP(i,$1(i,s)));const o=m(e,["config"]);return o!=null&&MP(o,t),t}function LP(i,e){const t={},n=m(e,["model"]);n!=null&&v(t,["model"],ct(i,n));const s=m(e,["src"]);s!=null&&v(t,["inputConfig"],TP($1(i,s)));const o=m(e,["config"]);return o!=null&&DP(o,t),t}function PP(i,e){const t={},n=m(i,["displayName"]);return e!==void 0&&n!=null&&v(e,["batch","displayName"],n),t}function OP(i,e){const t={},n=m(e,["model"]);n!=null&&v(t,["_url","model"],ct(i,n));const s=m(e,["src"]);s!=null&&v(t,["batch","inputConfig"],GP(i,s));const o=m(e,["config"]);return o!=null&&PP(o,t),t}function UP(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],sd(i,n)),t}function FP(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],sd(i,n)),t}function HP(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["name"]);n!=null&&v(e,["name"],n);const s=m(i,["done"]);s!=null&&v(e,["done"],s);const o=m(i,["error"]);return o!=null&&v(e,["error"],o),e}function BP(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["name"]);n!=null&&v(e,["name"],n);const s=m(i,["done"]);s!=null&&v(e,["done"],s);const o=m(i,["error"]);return o!=null&&v(e,["error"],o),e}function jP(i,e){const t={},n=m(e,["contents"]);if(n!=null){let o=hw(i,n);Array.isArray(o)&&(o=o.map(l=>l)),v(t,["requests[]","request","content"],o)}const s=m(e,["config"]);return s!=null&&(v(t,["_self"],qP(s,t)),OL(t,{"requests[].*":"requests[].request.*"})),t}function qP(i,e){const t={},n=m(i,["taskType"]);e!==void 0&&n!=null&&v(e,["requests[]","taskType"],n);const s=m(i,["title"]);e!==void 0&&s!=null&&v(e,["requests[]","title"],s);const o=m(i,["outputDimensionality"]);if(e!==void 0&&o!=null&&v(e,["requests[]","outputDimensionality"],o),m(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return t}function GP(i,e){const t={},n=m(e,["fileName"]);n!=null&&v(t,["file_name"],n);const s=m(e,["inlinedRequests"]);return s!=null&&v(t,["requests"],jP(i,s)),t}function VP(i){const e={};if(m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=m(i,["fileUri"]);t!=null&&v(e,["fileUri"],t);const n=m(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function zP(i){const e={},t=m(i,["id"]);t!=null&&v(e,["id"],t);const n=m(i,["args"]);n!=null&&v(e,["args"],n);const s=m(i,["name"]);if(s!=null&&v(e,["name"],s),m(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function $P(i){const e={},t=m(i,["allowedFunctionNames"]);t!=null&&v(e,["allowedFunctionNames"],t);const n=m(i,["mode"]);if(n!=null&&v(e,["mode"],n),m(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function YP(i,e,t){const n={},s=m(e,["systemInstruction"]);t!==void 0&&s!=null&&v(t,["systemInstruction"],K1(pn(s)));const o=m(e,["temperature"]);o!=null&&v(n,["temperature"],o);const l=m(e,["topP"]);l!=null&&v(n,["topP"],l);const c=m(e,["topK"]);c!=null&&v(n,["topK"],c);const d=m(e,["candidateCount"]);d!=null&&v(n,["candidateCount"],d);const h=m(e,["maxOutputTokens"]);h!=null&&v(n,["maxOutputTokens"],h);const p=m(e,["stopSequences"]);p!=null&&v(n,["stopSequences"],p);const y=m(e,["responseLogprobs"]);y!=null&&v(n,["responseLogprobs"],y);const b=m(e,["logprobs"]);b!=null&&v(n,["logprobs"],b);const S=m(e,["presencePenalty"]);S!=null&&v(n,["presencePenalty"],S);const E=m(e,["frequencyPenalty"]);E!=null&&v(n,["frequencyPenalty"],E);const R=m(e,["seed"]);R!=null&&v(n,["seed"],R);const A=m(e,["responseMimeType"]);A!=null&&v(n,["responseMimeType"],A);const C=m(e,["responseSchema"]);C!=null&&v(n,["responseSchema"],fw(C));const k=m(e,["responseJsonSchema"]);if(k!=null&&v(n,["responseJsonSchema"],k),m(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const I=m(e,["safetySettings"]);if(t!==void 0&&I!=null){let fe=I;Array.isArray(fe)&&(fe=fe.map(ce=>cO(ce))),v(t,["safetySettings"],fe)}const O=m(e,["tools"]);if(t!==void 0&&O!=null){let fe=id(O);Array.isArray(fe)&&(fe=fe.map(ce=>dO(nd(ce)))),v(t,["tools"],fe)}const U=m(e,["toolConfig"]);if(t!==void 0&&U!=null&&v(t,["toolConfig"],uO(U)),m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const P=m(e,["cachedContent"]);t!==void 0&&P!=null&&v(t,["cachedContent"],oo(i,P));const B=m(e,["responseModalities"]);B!=null&&v(n,["responseModalities"],B);const Q=m(e,["mediaResolution"]);Q!=null&&v(n,["mediaResolution"],Q);const K=m(e,["speechConfig"]);if(K!=null&&v(n,["speechConfig"],pw(K)),m(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const le=m(e,["thinkingConfig"]);le!=null&&v(n,["thinkingConfig"],le);const de=m(e,["imageConfig"]);de!=null&&v(n,["imageConfig"],ZP(de));const G=m(e,["enableEnhancedCivicAnswers"]);if(G!=null&&v(n,["enableEnhancedCivicAnswers"],G),m(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return n}function JP(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["candidates"]);if(n!=null){let d=n;Array.isArray(d)&&(d=d.map(h=>kP(h))),v(e,["candidates"],d)}const s=m(i,["modelVersion"]);s!=null&&v(e,["modelVersion"],s);const o=m(i,["promptFeedback"]);o!=null&&v(e,["promptFeedback"],o);const l=m(i,["responseId"]);l!=null&&v(e,["responseId"],l);const c=m(i,["usageMetadata"]);return c!=null&&v(e,["usageMetadata"],c),e}function KP(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],sd(i,n)),t}function WP(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],sd(i,n)),t}function XP(i){const e={};if(m(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=m(i,["enableWidget"]);return t!=null&&v(e,["enableWidget"],t),e}function QP(i){const e={};if(m(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=m(i,["timeRangeFilter"]);return t!=null&&v(e,["timeRangeFilter"],t),e}function ZP(i){const e={},t=m(i,["aspectRatio"]);t!=null&&v(e,["aspectRatio"],t);const n=m(i,["imageSize"]);if(n!=null&&v(e,["imageSize"],n),m(i,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(m(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(m(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return e}function eO(i,e){const t={},n=m(e,["model"]);n!=null&&v(t,["request","model"],ct(i,n));const s=m(e,["contents"]);if(s!=null){let c=Pi(s);Array.isArray(c)&&(c=c.map(d=>K1(d))),v(t,["request","contents"],c)}const o=m(e,["metadata"]);o!=null&&v(t,["metadata"],o);const l=m(e,["config"]);return l!=null&&v(t,["request","generationConfig"],YP(i,l,m(t,["request"],{}))),t}function tO(i){const e={},t=m(i,["response"]);t!=null&&v(e,["response"],JP(t));const n=m(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=m(i,["error"]);return s!=null&&v(e,["error"],s),e}function nO(i,e){const t={},n=m(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=m(i,["pageToken"]);if(e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),m(i,["filter"])!==void 0)throw new Error("filter parameter is not supported in Gemini API.");return t}function iO(i,e){const t={},n=m(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=m(i,["pageToken"]);e!==void 0&&s!=null&&v(e,["_query","pageToken"],s);const o=m(i,["filter"]);return e!==void 0&&o!=null&&v(e,["_query","filter"],o),t}function sO(i){const e={},t=m(i,["config"]);return t!=null&&nO(t,e),e}function rO(i){const e={},t=m(i,["config"]);return t!=null&&iO(t,e),e}function oO(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=m(i,["operations"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>ng(l))),v(e,["batchJobs"],o)}return e}function aO(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=m(i,["batchPredictionJobs"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>Db(l))),v(e,["batchJobs"],o)}return e}function lO(i){const e={},t=m(i,["mediaResolution"]);t!=null&&v(e,["mediaResolution"],t);const n=m(i,["codeExecutionResult"]);n!=null&&v(e,["codeExecutionResult"],n);const s=m(i,["executableCode"]);s!=null&&v(e,["executableCode"],s);const o=m(i,["fileData"]);o!=null&&v(e,["fileData"],VP(o));const l=m(i,["functionCall"]);l!=null&&v(e,["functionCall"],zP(l));const c=m(i,["functionResponse"]);c!=null&&v(e,["functionResponse"],c);const d=m(i,["inlineData"]);d!=null&&v(e,["inlineData"],CP(d));const h=m(i,["text"]);h!=null&&v(e,["text"],h);const p=m(i,["thought"]);p!=null&&v(e,["thought"],p);const y=m(i,["thoughtSignature"]);y!=null&&v(e,["thoughtSignature"],y);const b=m(i,["videoMetadata"]);return b!=null&&v(e,["videoMetadata"],b),e}function cO(i){const e={},t=m(i,["category"]);if(t!=null&&v(e,["category"],t),m(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const n=m(i,["threshold"]);return n!=null&&v(e,["threshold"],n),e}function uO(i){const e={},t=m(i,["retrievalConfig"]);t!=null&&v(e,["retrievalConfig"],t);const n=m(i,["functionCallingConfig"]);return n!=null&&v(e,["functionCallingConfig"],$P(n)),e}function dO(i){const e={};if(m(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const t=m(i,["computerUse"]);t!=null&&v(e,["computerUse"],t);const n=m(i,["fileSearch"]);n!=null&&v(e,["fileSearch"],n);const s=m(i,["codeExecution"]);if(s!=null&&v(e,["codeExecution"],s),m(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=m(i,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(y=>y)),v(e,["functionDeclarations"],p)}const l=m(i,["googleMaps"]);l!=null&&v(e,["googleMaps"],XP(l));const c=m(i,["googleSearch"]);c!=null&&v(e,["googleSearch"],QP(c));const d=m(i,["googleSearchRetrieval"]);d!=null&&v(e,["googleSearchRetrieval"],d);const h=m(i,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var to;(function(i){i.PAGED_ITEM_BATCH_JOBS="batchJobs",i.PAGED_ITEM_MODELS="models",i.PAGED_ITEM_TUNING_JOBS="tuningJobs",i.PAGED_ITEM_FILES="files",i.PAGED_ITEM_CACHED_CONTENTS="cachedContents",i.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",i.PAGED_ITEM_DOCUMENTS="documents"})(to||(to={}));class Gl{constructor(e,t,n,s){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,s)}init(e,t,n){var s,o;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=t==null?void 0:t.sdkHttpResponse,this.idxInternal=0;let l={config:{}};!n||Object.keys(n).length===0?l={config:{}}:typeof n=="object"?l=Object.assign({},n):l=n,l.config&&(l.config.pageToken=t.nextPageToken),this.paramsInternal=l,this.pageInternalSize=(o=(s=l.config)===null||s===void 0?void 0:s.pageSize)!==null&&o!==void 0?o:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength)if(this.hasNextPage())await this.nextPage();else return{value:void 0,done:!0};const e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw new Error("No more pages to fetch.");const e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return((e=this.params.config)===null||e===void 0?void 0:e.pageToken)!==void 0}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class hO extends ro{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Gl(to.PAGED_ITEM_BATCH_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.create=async t=>(this.apiClient.isVertexAI()&&(t.config=this.formatDestination(t.src,t.config)),this.createInternal(t)),this.createEmbeddings=async t=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw new Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(t)}}createInlinedGenerateContentRequest(e){const t=NC(this.apiClient,e),n=t._url,s=me("{model}:batchGenerateContent",n),c=t.batch.inputConfig.requests,d=c.requests,h=[];for(const p of d){const y=Object.assign({},p);if(y.systemInstruction){const b=y.systemInstruction;delete y.systemInstruction;const S=y.request;S.systemInstruction=b,y.request=S}h.push(y)}return c.requests=h,delete t.config,delete t._url,delete t._query,{path:s,body:t}}getGcsUri(e){if(typeof e=="string")return e.startsWith("gs://")?e:void 0;if(!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0)return e.gcsUri[0]}getBigqueryUri(e){if(typeof e=="string")return e.startsWith("bq://")?e:void 0;if(!Array.isArray(e))return e.bigqueryUri}formatDestination(e,t){const n=t?Object.assign({},t):{},s=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${s}`),n.dest===void 0){const o=this.getGcsUri(e),l=this.getBigqueryUri(e);if(o)o.endsWith(".jsonl")?n.dest=`${o.slice(0,-6)}/dest`:n.dest=`${o}_dest_${s}`;else if(l)n.dest=`${l}_dest_${s}`;else throw new Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=LP(this.apiClient,e);return c=me("batchPredictionJobs",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),l.then(p=>Db(p))}else{const h=NC(this.apiClient,e);return c=me("{model}:batchGenerateContent",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()),l.then(p=>ng(p))}}async createEmbeddingsInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=OP(this.apiClient,e);return o=me("{model}:asyncBatchEmbedContent",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>ng(d))}}async get(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=WP(this.apiClient,e);return c=me("batchPredictionJobs/{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),l.then(p=>Db(p))}else{const h=KP(this.apiClient,e);return c=me("batches/{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()),l.then(p=>ng(p))}}async cancel(e){var t,n,s,o;let l="",c={};if(this.apiClient.isVertexAI()){const d=NP(this.apiClient,e);l=me("batchPredictionJobs/{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,await this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}else{const d=RP(this.apiClient,e);l=me("batches/{name}:cancel",d._url),c=d._query,delete d._url,delete d._query,await this.apiClient.request({path:l,queryParams:c,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal})}}async listInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=rO(e);return c=me("batchPredictionJobs",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=aO(p),b=new AC;return Object.assign(b,y),b})}else{const h=sO(e);return c=me("batches",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=oO(p),b=new AC;return Object.assign(b,y),b})}}async delete(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=FP(this.apiClient,e);return c=me("batchPredictionJobs/{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>BP(p))}else{const h=UP(this.apiClient,e);return c=me("batches/{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>HP(p))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function fO(i){const e={},t=m(i,["data"]);if(t!=null&&v(e,["data"],t),m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function kC(i){const e={},t=m(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>OO(o))),v(e,["parts"],s)}const n=m(i,["role"]);return n!=null&&v(e,["role"],n),e}function pO(i,e){const t={},n=m(i,["ttl"]);e!==void 0&&n!=null&&v(e,["ttl"],n);const s=m(i,["expireTime"]);e!==void 0&&s!=null&&v(e,["expireTime"],s);const o=m(i,["displayName"]);e!==void 0&&o!=null&&v(e,["displayName"],o);const l=m(i,["contents"]);if(e!==void 0&&l!=null){let p=Pi(l);Array.isArray(p)&&(p=p.map(y=>kC(y))),v(e,["contents"],p)}const c=m(i,["systemInstruction"]);e!==void 0&&c!=null&&v(e,["systemInstruction"],kC(pn(c)));const d=m(i,["tools"]);if(e!==void 0&&d!=null){let p=d;Array.isArray(p)&&(p=p.map(y=>FO(y))),v(e,["tools"],p)}const h=m(i,["toolConfig"]);if(e!==void 0&&h!=null&&v(e,["toolConfig"],UO(h)),m(i,["kmsKeyName"])!==void 0)throw new Error("kmsKeyName parameter is not supported in Gemini API.");return t}function mO(i,e){const t={},n=m(i,["ttl"]);e!==void 0&&n!=null&&v(e,["ttl"],n);const s=m(i,["expireTime"]);e!==void 0&&s!=null&&v(e,["expireTime"],s);const o=m(i,["displayName"]);e!==void 0&&o!=null&&v(e,["displayName"],o);const l=m(i,["contents"]);if(e!==void 0&&l!=null){let y=Pi(l);Array.isArray(y)&&(y=y.map(b=>b)),v(e,["contents"],y)}const c=m(i,["systemInstruction"]);e!==void 0&&c!=null&&v(e,["systemInstruction"],pn(c));const d=m(i,["tools"]);if(e!==void 0&&d!=null){let y=d;Array.isArray(y)&&(y=y.map(b=>HO(b))),v(e,["tools"],y)}const h=m(i,["toolConfig"]);e!==void 0&&h!=null&&v(e,["toolConfig"],h);const p=m(i,["kmsKeyName"]);return e!==void 0&&p!=null&&v(e,["encryption_spec","kmsKeyName"],p),t}function gO(i,e){const t={},n=m(e,["model"]);n!=null&&v(t,["model"],U1(i,n));const s=m(e,["config"]);return s!=null&&pO(s,t),t}function vO(i,e){const t={},n=m(e,["model"]);n!=null&&v(t,["model"],U1(i,n));const s=m(e,["config"]);return s!=null&&mO(s,t),t}function yO(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],oo(i,n)),t}function bO(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],oo(i,n)),t}function _O(i){const e={},t=m(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function wO(i){const e={},t=m(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function xO(i){const e={};if(m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=m(i,["fileUri"]);t!=null&&v(e,["fileUri"],t);const n=m(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function SO(i){const e={},t=m(i,["id"]);t!=null&&v(e,["id"],t);const n=m(i,["args"]);n!=null&&v(e,["args"],n);const s=m(i,["name"]);if(s!=null&&v(e,["name"],s),m(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function EO(i){const e={},t=m(i,["allowedFunctionNames"]);t!=null&&v(e,["allowedFunctionNames"],t);const n=m(i,["mode"]);if(n!=null&&v(e,["mode"],n),m(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return e}function AO(i){const e={},t=m(i,["description"]);t!=null&&v(e,["description"],t);const n=m(i,["name"]);n!=null&&v(e,["name"],n);const s=m(i,["parameters"]);s!=null&&v(e,["parameters"],s);const o=m(i,["parametersJsonSchema"]);o!=null&&v(e,["parametersJsonSchema"],o);const l=m(i,["response"]);l!=null&&v(e,["response"],l);const c=m(i,["responseJsonSchema"]);if(c!=null&&v(e,["responseJsonSchema"],c),m(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function TO(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],oo(i,n)),t}function CO(i,e){const t={},n=m(e,["name"]);return n!=null&&v(t,["_url","name"],oo(i,n)),t}function RO(i){const e={};if(m(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=m(i,["enableWidget"]);return t!=null&&v(e,["enableWidget"],t),e}function NO(i){const e={};if(m(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=m(i,["timeRangeFilter"]);return t!=null&&v(e,["timeRangeFilter"],t),e}function kO(i,e){const t={},n=m(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=m(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function IO(i,e){const t={},n=m(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=m(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function MO(i){const e={},t=m(i,["config"]);return t!=null&&kO(t,e),e}function DO(i){const e={},t=m(i,["config"]);return t!=null&&IO(t,e),e}function LO(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=m(i,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["cachedContents"],o)}return e}function PO(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=m(i,["cachedContents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["cachedContents"],o)}return e}function OO(i){const e={},t=m(i,["mediaResolution"]);t!=null&&v(e,["mediaResolution"],t);const n=m(i,["codeExecutionResult"]);n!=null&&v(e,["codeExecutionResult"],n);const s=m(i,["executableCode"]);s!=null&&v(e,["executableCode"],s);const o=m(i,["fileData"]);o!=null&&v(e,["fileData"],xO(o));const l=m(i,["functionCall"]);l!=null&&v(e,["functionCall"],SO(l));const c=m(i,["functionResponse"]);c!=null&&v(e,["functionResponse"],c);const d=m(i,["inlineData"]);d!=null&&v(e,["inlineData"],fO(d));const h=m(i,["text"]);h!=null&&v(e,["text"],h);const p=m(i,["thought"]);p!=null&&v(e,["thought"],p);const y=m(i,["thoughtSignature"]);y!=null&&v(e,["thoughtSignature"],y);const b=m(i,["videoMetadata"]);return b!=null&&v(e,["videoMetadata"],b),e}function UO(i){const e={},t=m(i,["retrievalConfig"]);t!=null&&v(e,["retrievalConfig"],t);const n=m(i,["functionCallingConfig"]);return n!=null&&v(e,["functionCallingConfig"],EO(n)),e}function FO(i){const e={};if(m(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const t=m(i,["computerUse"]);t!=null&&v(e,["computerUse"],t);const n=m(i,["fileSearch"]);n!=null&&v(e,["fileSearch"],n);const s=m(i,["codeExecution"]);if(s!=null&&v(e,["codeExecution"],s),m(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=m(i,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(y=>y)),v(e,["functionDeclarations"],p)}const l=m(i,["googleMaps"]);l!=null&&v(e,["googleMaps"],RO(l));const c=m(i,["googleSearch"]);c!=null&&v(e,["googleSearch"],NO(c));const d=m(i,["googleSearchRetrieval"]);d!=null&&v(e,["googleSearchRetrieval"],d);const h=m(i,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}function HO(i){const e={},t=m(i,["retrieval"]);t!=null&&v(e,["retrieval"],t);const n=m(i,["computerUse"]);if(n!=null&&v(e,["computerUse"],n),m(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=m(i,["codeExecution"]);s!=null&&v(e,["codeExecution"],s);const o=m(i,["enterpriseWebSearch"]);o!=null&&v(e,["enterpriseWebSearch"],o);const l=m(i,["functionDeclarations"]);if(l!=null){let y=l;Array.isArray(y)&&(y=y.map(b=>AO(b))),v(e,["functionDeclarations"],y)}const c=m(i,["googleMaps"]);c!=null&&v(e,["googleMaps"],c);const d=m(i,["googleSearch"]);d!=null&&v(e,["googleSearch"],d);const h=m(i,["googleSearchRetrieval"]);h!=null&&v(e,["googleSearchRetrieval"],h);const p=m(i,["urlContext"]);return p!=null&&v(e,["urlContext"],p),e}function BO(i,e){const t={},n=m(i,["ttl"]);e!==void 0&&n!=null&&v(e,["ttl"],n);const s=m(i,["expireTime"]);return e!==void 0&&s!=null&&v(e,["expireTime"],s),t}function jO(i,e){const t={},n=m(i,["ttl"]);e!==void 0&&n!=null&&v(e,["ttl"],n);const s=m(i,["expireTime"]);return e!==void 0&&s!=null&&v(e,["expireTime"],s),t}function qO(i,e){const t={},n=m(e,["name"]);n!=null&&v(t,["_url","name"],oo(i,n));const s=m(e,["config"]);return s!=null&&BO(s,t),t}function GO(i,e){const t={},n=m(e,["name"]);n!=null&&v(t,["_url","name"],oo(i,n));const s=m(e,["config"]);return s!=null&&jO(s,t),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class VO extends ro{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Gl(to.PAGED_ITEM_CACHED_CONTENTS,n=>this.listInternal(n),await this.listInternal(t),t)}async create(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=vO(this.apiClient,e);return c=me("cachedContents",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),l.then(p=>p)}else{const h=gO(this.apiClient,e);return c=me("cachedContents",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()),l.then(p=>p)}}async get(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=CO(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),l.then(p=>p)}else{const h=TO(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()),l.then(p=>p)}}async delete(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=bO(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=wO(p),b=new SC;return Object.assign(b,y),b})}else{const h=yO(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=_O(p),b=new SC;return Object.assign(b,y),b})}}async update(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=GO(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),l.then(p=>p)}else{const h=qO(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()),l.then(p=>p)}}async listInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=DO(e);return c=me("cachedContents",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=PO(p),b=new EC;return Object.assign(b,y),b})}else{const h=MO(e);return c=me("cachedContents",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=LO(p),b=new EC;return Object.assign(b,y),b})}}}function Ug(i,e){var t={};for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,n=Object.getOwnPropertySymbols(i);s<n.length;s++)e.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(i,n[s])&&(t[n[s]]=i[n[s]]);return t}function IC(i){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&i[e],n=0;if(t)return t.call(i);if(i&&typeof i.length=="number")return{next:function(){return i&&n>=i.length&&(i=void 0),{value:i&&i[n++],done:!i}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ue(i){return this instanceof Ue?(this.v=i,this):new Ue(i)}function xs(i,e,t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=t.apply(i,e||[]),s,o=[];return s=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),c("next"),c("throw"),c("return",l),s[Symbol.asyncIterator]=function(){return this},s;function l(S){return function(E){return Promise.resolve(E).then(S,y)}}function c(S,E){n[S]&&(s[S]=function(R){return new Promise(function(A,C){o.push([S,R,A,C])>1||d(S,R)})},E&&(s[S]=E(s[S])))}function d(S,E){try{h(n[S](E))}catch(R){b(o[0][3],R)}}function h(S){S.value instanceof Ue?Promise.resolve(S.value.v).then(p,y):b(o[0][2],S)}function p(S){d("next",S)}function y(S){d("throw",S)}function b(S,E){S(E),o.shift(),o.length&&d(o[0][0],o[0][1])}}function Ss(i){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=i[Symbol.asyncIterator],t;return e?e.call(i):(i=typeof IC=="function"?IC(i):i[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(o){t[o]=i[o]&&function(l){return new Promise(function(c,d){l=i[o](l),s(c,d,l.done,l.value)})}}function s(o,l,c,d){Promise.resolve(d).then(function(h){o({value:h,done:c})},l)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function zO(i){var e;if(i.candidates==null||i.candidates.length===0)return!1;const t=(e=i.candidates[0])===null||e===void 0?void 0:e.content;return t===void 0?!1:W1(t)}function W1(i){if(i.parts===void 0||i.parts.length===0)return!1;for(const e of i.parts)if(e===void 0||Object.keys(e).length===0)return!1;return!0}function $O(i){if(i.length!==0){for(const e of i)if(e.role!=="user"&&e.role!=="model")throw new Error(`Role must be user or model, but got ${e.role}.`)}}function MC(i){if(i===void 0||i.length===0)return[];const e=[],t=i.length;let n=0;for(;n<t;)if(i[n].role==="user")e.push(i[n]),n++;else{const s=[];let o=!0;for(;n<t&&i[n].role==="model";)s.push(i[n]),o&&!W1(i[n])&&(o=!1),n++;o?e.push(...s):e.pop()}return e}class YO{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new JO(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class JO{constructor(e,t,n,s={},o=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=s,this.history=o,this.sendPromise=Promise.resolve(),$O(o)}async sendMessage(e){var t;await this.sendPromise;const n=pn(e.message),s=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});return this.sendPromise=(async()=>{var o,l,c;const d=await s,h=(l=(o=d.candidates)===null||o===void 0?void 0:o[0])===null||l===void 0?void 0:l.content,p=d.automaticFunctionCallingHistory,y=this.getHistory(!0).length;let b=[];p!=null&&(b=(c=p.slice(y))!==null&&c!==void 0?c:[]);const S=h?[h]:[];this.recordHistory(n,S,b)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),s}async sendMessageStream(e){var t;await this.sendPromise;const n=pn(e.message),s=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:(t=e.config)!==null&&t!==void 0?t:this.config});this.sendPromise=s.then(()=>{}).catch(()=>{});const o=await s;return this.processStreamResponse(o,n)}getHistory(e=!1){const t=e?MC(this.history):this.history;return structuredClone(t)}processStreamResponse(e,t){return xs(this,arguments,function*(){var s,o,l,c,d,h;const p=[];try{for(var y=!0,b=Ss(e),S;S=yield Ue(b.next()),s=S.done,!s;y=!0){c=S.value,y=!1;const E=c;if(zO(E)){const R=(h=(d=E.candidates)===null||d===void 0?void 0:d[0])===null||h===void 0?void 0:h.content;R!==void 0&&p.push(R)}yield yield Ue(E)}}catch(E){o={error:E}}finally{try{!y&&!s&&(l=b.return)&&(yield Ue(l.call(b)))}finally{if(o)throw o.error}}this.recordHistory(t,p)})}recordHistory(e,t,n){let s=[];t.length>0&&t.every(o=>o.role!==void 0)?s=t:s.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...MC(n)):this.history.push(e),this.history.push(...s)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Lh extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,Lh.prototype)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function KO(i){const e={},t=m(i,["file"]);return t!=null&&v(e,["file"],t),e}function WO(i){const e={},t=m(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function XO(i){const e={},t=m(i,["name"]);return t!=null&&v(e,["_url","file"],G1(t)),e}function QO(i){const e={},t=m(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}function ZO(i){const e={},t=m(i,["name"]);return t!=null&&v(e,["_url","file"],G1(t)),e}function eU(i){const e={},t=m(i,["uris"]);return t!=null&&v(e,["uris"],t),e}function tU(i,e){const t={},n=m(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=m(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function nU(i){const e={},t=m(i,["config"]);return t!=null&&tU(t,e),e}function iU(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=m(i,["files"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["files"],o)}return e}function sU(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["files"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>o)),v(e,["files"],s)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class rU extends ro{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Gl(to.PAGED_ITEM_FILES,n=>this.listInternal(n),await this.listInternal(t),t)}async upload(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(t=>t)}async download(e){await this.apiClient.downloadFile(e)}async registerFiles(e){throw new Error("registerFiles is only supported in Node.js environments.")}async _registerFiles(e){return this.registerFilesInternal(e)}async listInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=nU(e);return o=me("files",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),s.then(d=>{const h=iU(d),p=new rP;return Object.assign(p,h),p})}}async createInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=KO(e);return o=me("upload/v1beta/files",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const h=WO(d),p=new oP;return Object.assign(p,h),p})}}async get(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=ZO(e);return o=me("files/{file}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>d)}}async delete(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=XO(e);return o=me("files/{file}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),s.then(d=>{const h=QO(d),p=new aP;return Object.assign(p,h),p})}}async registerFilesInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=eU(e);return o=me("files:register",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const h=sU(d),p=new lP;return Object.assign(p,h),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function ig(i){const e={},t=m(i,["data"]);if(t!=null&&v(e,["data"],t),m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function oU(i){const e={},t=m(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>xU(o))),v(e,["parts"],s)}const n=m(i,["role"]);return n!=null&&v(e,["role"],n),e}function aU(i){const e={};if(m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=m(i,["fileUri"]);t!=null&&v(e,["fileUri"],t);const n=m(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function lU(i){const e={},t=m(i,["id"]);t!=null&&v(e,["id"],t);const n=m(i,["args"]);n!=null&&v(e,["args"],n);const s=m(i,["name"]);if(s!=null&&v(e,["name"],s),m(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function cU(i){const e={},t=m(i,["description"]);t!=null&&v(e,["description"],t);const n=m(i,["name"]);n!=null&&v(e,["name"],n);const s=m(i,["parameters"]);s!=null&&v(e,["parameters"],s);const o=m(i,["parametersJsonSchema"]);o!=null&&v(e,["parametersJsonSchema"],o);const l=m(i,["response"]);l!=null&&v(e,["response"],l);const c=m(i,["responseJsonSchema"]);if(c!=null&&v(e,["responseJsonSchema"],c),m(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return e}function uU(i){const e={},t=m(i,["modelSelectionConfig"]);t!=null&&v(e,["modelConfig"],t);const n=m(i,["responseJsonSchema"]);n!=null&&v(e,["responseJsonSchema"],n);const s=m(i,["audioTimestamp"]);s!=null&&v(e,["audioTimestamp"],s);const o=m(i,["candidateCount"]);o!=null&&v(e,["candidateCount"],o);const l=m(i,["enableAffectiveDialog"]);l!=null&&v(e,["enableAffectiveDialog"],l);const c=m(i,["frequencyPenalty"]);c!=null&&v(e,["frequencyPenalty"],c);const d=m(i,["logprobs"]);d!=null&&v(e,["logprobs"],d);const h=m(i,["maxOutputTokens"]);h!=null&&v(e,["maxOutputTokens"],h);const p=m(i,["mediaResolution"]);p!=null&&v(e,["mediaResolution"],p);const y=m(i,["presencePenalty"]);y!=null&&v(e,["presencePenalty"],y);const b=m(i,["responseLogprobs"]);b!=null&&v(e,["responseLogprobs"],b);const S=m(i,["responseMimeType"]);S!=null&&v(e,["responseMimeType"],S);const E=m(i,["responseModalities"]);E!=null&&v(e,["responseModalities"],E);const R=m(i,["responseSchema"]);R!=null&&v(e,["responseSchema"],R);const A=m(i,["routingConfig"]);A!=null&&v(e,["routingConfig"],A);const C=m(i,["seed"]);C!=null&&v(e,["seed"],C);const k=m(i,["speechConfig"]);k!=null&&v(e,["speechConfig"],k);const I=m(i,["stopSequences"]);I!=null&&v(e,["stopSequences"],I);const O=m(i,["temperature"]);O!=null&&v(e,["temperature"],O);const U=m(i,["thinkingConfig"]);U!=null&&v(e,["thinkingConfig"],U);const P=m(i,["topK"]);P!=null&&v(e,["topK"],P);const B=m(i,["topP"]);if(B!=null&&v(e,["topP"],B),m(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return e}function dU(i){const e={};if(m(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=m(i,["enableWidget"]);return t!=null&&v(e,["enableWidget"],t),e}function hU(i){const e={};if(m(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=m(i,["timeRangeFilter"]);return t!=null&&v(e,["timeRangeFilter"],t),e}function fU(i,e){const t={},n=m(i,["generationConfig"]);e!==void 0&&n!=null&&v(e,["setup","generationConfig"],n);const s=m(i,["responseModalities"]);e!==void 0&&s!=null&&v(e,["setup","generationConfig","responseModalities"],s);const o=m(i,["temperature"]);e!==void 0&&o!=null&&v(e,["setup","generationConfig","temperature"],o);const l=m(i,["topP"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","topP"],l);const c=m(i,["topK"]);e!==void 0&&c!=null&&v(e,["setup","generationConfig","topK"],c);const d=m(i,["maxOutputTokens"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","maxOutputTokens"],d);const h=m(i,["mediaResolution"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","mediaResolution"],h);const p=m(i,["seed"]);e!==void 0&&p!=null&&v(e,["setup","generationConfig","seed"],p);const y=m(i,["speechConfig"]);e!==void 0&&y!=null&&v(e,["setup","generationConfig","speechConfig"],mw(y));const b=m(i,["thinkingConfig"]);e!==void 0&&b!=null&&v(e,["setup","generationConfig","thinkingConfig"],b);const S=m(i,["enableAffectiveDialog"]);e!==void 0&&S!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],S);const E=m(i,["systemInstruction"]);e!==void 0&&E!=null&&v(e,["setup","systemInstruction"],oU(pn(E)));const R=m(i,["tools"]);if(e!==void 0&&R!=null){let P=id(R);Array.isArray(P)&&(P=P.map(B=>EU(nd(B)))),v(e,["setup","tools"],P)}const A=m(i,["sessionResumption"]);e!==void 0&&A!=null&&v(e,["setup","sessionResumption"],SU(A));const C=m(i,["inputAudioTranscription"]);e!==void 0&&C!=null&&v(e,["setup","inputAudioTranscription"],C);const k=m(i,["outputAudioTranscription"]);e!==void 0&&k!=null&&v(e,["setup","outputAudioTranscription"],k);const I=m(i,["realtimeInputConfig"]);e!==void 0&&I!=null&&v(e,["setup","realtimeInputConfig"],I);const O=m(i,["contextWindowCompression"]);e!==void 0&&O!=null&&v(e,["setup","contextWindowCompression"],O);const U=m(i,["proactivity"]);if(e!==void 0&&U!=null&&v(e,["setup","proactivity"],U),m(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function pU(i,e){const t={},n=m(i,["generationConfig"]);e!==void 0&&n!=null&&v(e,["setup","generationConfig"],uU(n));const s=m(i,["responseModalities"]);e!==void 0&&s!=null&&v(e,["setup","generationConfig","responseModalities"],s);const o=m(i,["temperature"]);e!==void 0&&o!=null&&v(e,["setup","generationConfig","temperature"],o);const l=m(i,["topP"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","topP"],l);const c=m(i,["topK"]);e!==void 0&&c!=null&&v(e,["setup","generationConfig","topK"],c);const d=m(i,["maxOutputTokens"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","maxOutputTokens"],d);const h=m(i,["mediaResolution"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","mediaResolution"],h);const p=m(i,["seed"]);e!==void 0&&p!=null&&v(e,["setup","generationConfig","seed"],p);const y=m(i,["speechConfig"]);e!==void 0&&y!=null&&v(e,["setup","generationConfig","speechConfig"],mw(y));const b=m(i,["thinkingConfig"]);e!==void 0&&b!=null&&v(e,["setup","generationConfig","thinkingConfig"],b);const S=m(i,["enableAffectiveDialog"]);e!==void 0&&S!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],S);const E=m(i,["systemInstruction"]);e!==void 0&&E!=null&&v(e,["setup","systemInstruction"],pn(E));const R=m(i,["tools"]);if(e!==void 0&&R!=null){let B=id(R);Array.isArray(B)&&(B=B.map(Q=>AU(nd(Q)))),v(e,["setup","tools"],B)}const A=m(i,["sessionResumption"]);e!==void 0&&A!=null&&v(e,["setup","sessionResumption"],A);const C=m(i,["inputAudioTranscription"]);e!==void 0&&C!=null&&v(e,["setup","inputAudioTranscription"],C);const k=m(i,["outputAudioTranscription"]);e!==void 0&&k!=null&&v(e,["setup","outputAudioTranscription"],k);const I=m(i,["realtimeInputConfig"]);e!==void 0&&I!=null&&v(e,["setup","realtimeInputConfig"],I);const O=m(i,["contextWindowCompression"]);e!==void 0&&O!=null&&v(e,["setup","contextWindowCompression"],O);const U=m(i,["proactivity"]);e!==void 0&&U!=null&&v(e,["setup","proactivity"],U);const P=m(i,["explicitVadSignal"]);return e!==void 0&&P!=null&&v(e,["setup","explicitVadSignal"],P),t}function mU(i,e){const t={},n=m(e,["model"]);n!=null&&v(t,["setup","model"],ct(i,n));const s=m(e,["config"]);return s!=null&&v(t,["config"],fU(s,t)),t}function gU(i,e){const t={},n=m(e,["model"]);n!=null&&v(t,["setup","model"],ct(i,n));const s=m(e,["config"]);return s!=null&&v(t,["config"],pU(s,t)),t}function vU(i){const e={},t=m(i,["musicGenerationConfig"]);return t!=null&&v(e,["musicGenerationConfig"],t),e}function yU(i){const e={},t=m(i,["weightedPrompts"]);if(t!=null){let n=t;Array.isArray(n)&&(n=n.map(s=>s)),v(e,["weightedPrompts"],n)}return e}function bU(i){const e={},t=m(i,["media"]);if(t!=null){let h=F1(t);Array.isArray(h)&&(h=h.map(p=>ig(p))),v(e,["mediaChunks"],h)}const n=m(i,["audio"]);n!=null&&v(e,["audio"],ig(B1(n)));const s=m(i,["audioStreamEnd"]);s!=null&&v(e,["audioStreamEnd"],s);const o=m(i,["video"]);o!=null&&v(e,["video"],ig(H1(o)));const l=m(i,["text"]);l!=null&&v(e,["text"],l);const c=m(i,["activityStart"]);c!=null&&v(e,["activityStart"],c);const d=m(i,["activityEnd"]);return d!=null&&v(e,["activityEnd"],d),e}function _U(i){const e={},t=m(i,["media"]);if(t!=null){let h=F1(t);Array.isArray(h)&&(h=h.map(p=>p)),v(e,["mediaChunks"],h)}const n=m(i,["audio"]);n!=null&&v(e,["audio"],B1(n));const s=m(i,["audioStreamEnd"]);s!=null&&v(e,["audioStreamEnd"],s);const o=m(i,["video"]);o!=null&&v(e,["video"],H1(o));const l=m(i,["text"]);l!=null&&v(e,["text"],l);const c=m(i,["activityStart"]);c!=null&&v(e,["activityStart"],c);const d=m(i,["activityEnd"]);return d!=null&&v(e,["activityEnd"],d),e}function wU(i){const e={},t=m(i,["setupComplete"]);t!=null&&v(e,["setupComplete"],t);const n=m(i,["serverContent"]);n!=null&&v(e,["serverContent"],n);const s=m(i,["toolCall"]);s!=null&&v(e,["toolCall"],s);const o=m(i,["toolCallCancellation"]);o!=null&&v(e,["toolCallCancellation"],o);const l=m(i,["usageMetadata"]);l!=null&&v(e,["usageMetadata"],TU(l));const c=m(i,["goAway"]);c!=null&&v(e,["goAway"],c);const d=m(i,["sessionResumptionUpdate"]);d!=null&&v(e,["sessionResumptionUpdate"],d);const h=m(i,["voiceActivityDetectionSignal"]);h!=null&&v(e,["voiceActivityDetectionSignal"],h);const p=m(i,["voiceActivity"]);return p!=null&&v(e,["voiceActivity"],CU(p)),e}function xU(i){const e={},t=m(i,["mediaResolution"]);t!=null&&v(e,["mediaResolution"],t);const n=m(i,["codeExecutionResult"]);n!=null&&v(e,["codeExecutionResult"],n);const s=m(i,["executableCode"]);s!=null&&v(e,["executableCode"],s);const o=m(i,["fileData"]);o!=null&&v(e,["fileData"],aU(o));const l=m(i,["functionCall"]);l!=null&&v(e,["functionCall"],lU(l));const c=m(i,["functionResponse"]);c!=null&&v(e,["functionResponse"],c);const d=m(i,["inlineData"]);d!=null&&v(e,["inlineData"],ig(d));const h=m(i,["text"]);h!=null&&v(e,["text"],h);const p=m(i,["thought"]);p!=null&&v(e,["thought"],p);const y=m(i,["thoughtSignature"]);y!=null&&v(e,["thoughtSignature"],y);const b=m(i,["videoMetadata"]);return b!=null&&v(e,["videoMetadata"],b),e}function SU(i){const e={},t=m(i,["handle"]);if(t!=null&&v(e,["handle"],t),m(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function EU(i){const e={};if(m(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const t=m(i,["computerUse"]);t!=null&&v(e,["computerUse"],t);const n=m(i,["fileSearch"]);n!=null&&v(e,["fileSearch"],n);const s=m(i,["codeExecution"]);if(s!=null&&v(e,["codeExecution"],s),m(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=m(i,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(y=>y)),v(e,["functionDeclarations"],p)}const l=m(i,["googleMaps"]);l!=null&&v(e,["googleMaps"],dU(l));const c=m(i,["googleSearch"]);c!=null&&v(e,["googleSearch"],hU(c));const d=m(i,["googleSearchRetrieval"]);d!=null&&v(e,["googleSearchRetrieval"],d);const h=m(i,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}function AU(i){const e={},t=m(i,["retrieval"]);t!=null&&v(e,["retrieval"],t);const n=m(i,["computerUse"]);if(n!=null&&v(e,["computerUse"],n),m(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const s=m(i,["codeExecution"]);s!=null&&v(e,["codeExecution"],s);const o=m(i,["enterpriseWebSearch"]);o!=null&&v(e,["enterpriseWebSearch"],o);const l=m(i,["functionDeclarations"]);if(l!=null){let y=l;Array.isArray(y)&&(y=y.map(b=>cU(b))),v(e,["functionDeclarations"],y)}const c=m(i,["googleMaps"]);c!=null&&v(e,["googleMaps"],c);const d=m(i,["googleSearch"]);d!=null&&v(e,["googleSearch"],d);const h=m(i,["googleSearchRetrieval"]);h!=null&&v(e,["googleSearchRetrieval"],h);const p=m(i,["urlContext"]);return p!=null&&v(e,["urlContext"],p),e}function TU(i){const e={},t=m(i,["promptTokenCount"]);t!=null&&v(e,["promptTokenCount"],t);const n=m(i,["cachedContentTokenCount"]);n!=null&&v(e,["cachedContentTokenCount"],n);const s=m(i,["candidatesTokenCount"]);s!=null&&v(e,["responseTokenCount"],s);const o=m(i,["toolUsePromptTokenCount"]);o!=null&&v(e,["toolUsePromptTokenCount"],o);const l=m(i,["thoughtsTokenCount"]);l!=null&&v(e,["thoughtsTokenCount"],l);const c=m(i,["totalTokenCount"]);c!=null&&v(e,["totalTokenCount"],c);const d=m(i,["promptTokensDetails"]);if(d!=null){let S=d;Array.isArray(S)&&(S=S.map(E=>E)),v(e,["promptTokensDetails"],S)}const h=m(i,["cacheTokensDetails"]);if(h!=null){let S=h;Array.isArray(S)&&(S=S.map(E=>E)),v(e,["cacheTokensDetails"],S)}const p=m(i,["candidatesTokensDetails"]);if(p!=null){let S=p;Array.isArray(S)&&(S=S.map(E=>E)),v(e,["responseTokensDetails"],S)}const y=m(i,["toolUsePromptTokensDetails"]);if(y!=null){let S=y;Array.isArray(S)&&(S=S.map(E=>E)),v(e,["toolUsePromptTokensDetails"],S)}const b=m(i,["trafficType"]);return b!=null&&v(e,["trafficType"],b),e}function CU(i){const e={},t=m(i,["type"]);return t!=null&&v(e,["voiceActivityType"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function RU(i,e){const t={},n=m(i,["data"]);if(n!=null&&v(t,["data"],n),m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const s=m(i,["mimeType"]);return s!=null&&v(t,["mimeType"],s),t}function NU(i,e){const t={},n=m(i,["content"]);n!=null&&v(t,["content"],n);const s=m(i,["citationMetadata"]);s!=null&&v(t,["citationMetadata"],kU(s));const o=m(i,["tokenCount"]);o!=null&&v(t,["tokenCount"],o);const l=m(i,["finishReason"]);l!=null&&v(t,["finishReason"],l);const c=m(i,["avgLogprobs"]);c!=null&&v(t,["avgLogprobs"],c);const d=m(i,["groundingMetadata"]);d!=null&&v(t,["groundingMetadata"],d);const h=m(i,["index"]);h!=null&&v(t,["index"],h);const p=m(i,["logprobsResult"]);p!=null&&v(t,["logprobsResult"],p);const y=m(i,["safetyRatings"]);if(y!=null){let S=y;Array.isArray(S)&&(S=S.map(E=>E)),v(t,["safetyRatings"],S)}const b=m(i,["urlContextMetadata"]);return b!=null&&v(t,["urlContextMetadata"],b),t}function kU(i,e){const t={},n=m(i,["citationSources"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>o)),v(t,["citations"],s)}return t}function IU(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["contents"]);if(o!=null){let l=Pi(o);Array.isArray(l)&&(l=l.map(c=>c)),v(n,["contents"],l)}return n}function MU(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["tokensInfo"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(t,["tokensInfo"],o)}return t}function DU(i,e){const t={},n=m(i,["values"]);n!=null&&v(t,["values"],n);const s=m(i,["statistics"]);return s!=null&&v(t,["statistics"],LU(s)),t}function LU(i,e){const t={},n=m(i,["truncated"]);n!=null&&v(t,["truncated"],n);const s=m(i,["token_count"]);return s!=null&&v(t,["tokenCount"],s),t}function vp(i,e){const t={},n=m(i,["parts"]);if(n!=null){let o=n;Array.isArray(o)&&(o=o.map(l=>G4(l))),v(t,["parts"],o)}const s=m(i,["role"]);return s!=null&&v(t,["role"],s),t}function PU(i,e){const t={},n=m(i,["controlType"]);n!=null&&v(t,["controlType"],n);const s=m(i,["enableControlImageComputation"]);return s!=null&&v(t,["computeControl"],s),t}function OU(i,e){const t={};if(m(i,["systemInstruction"])!==void 0)throw new Error("systemInstruction parameter is not supported in Gemini API.");if(m(i,["tools"])!==void 0)throw new Error("tools parameter is not supported in Gemini API.");if(m(i,["generationConfig"])!==void 0)throw new Error("generationConfig parameter is not supported in Gemini API.");return t}function UU(i,e,t){const n={},s=m(i,["systemInstruction"]);e!==void 0&&s!=null&&v(e,["systemInstruction"],pn(s));const o=m(i,["tools"]);if(e!==void 0&&o!=null){let c=o;Array.isArray(c)&&(c=c.map(d=>eR(d))),v(e,["tools"],c)}const l=m(i,["generationConfig"]);return e!==void 0&&l!=null&&v(e,["generationConfig"],R4(l)),n}function FU(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["contents"]);if(o!=null){let c=Pi(o);Array.isArray(c)&&(c=c.map(d=>vp(d))),v(n,["contents"],c)}const l=m(e,["config"]);return l!=null&&OU(l),n}function HU(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["contents"]);if(o!=null){let c=Pi(o);Array.isArray(c)&&(c=c.map(d=>d)),v(n,["contents"],c)}const l=m(e,["config"]);return l!=null&&UU(l,n),n}function BU(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["totalTokens"]);s!=null&&v(t,["totalTokens"],s);const o=m(i,["cachedContentTokenCount"]);return o!=null&&v(t,["cachedContentTokenCount"],o),t}function jU(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["totalTokens"]);return s!=null&&v(t,["totalTokens"],s),t}function qU(i,e,t){const n={},s=m(e,["model"]);return s!=null&&v(n,["_url","name"],ct(i,s)),n}function GU(i,e,t){const n={},s=m(e,["model"]);return s!=null&&v(n,["_url","name"],ct(i,s)),n}function VU(i,e){const t={},n=m(i,["sdkHttpResponse"]);return n!=null&&v(t,["sdkHttpResponse"],n),t}function zU(i,e){const t={},n=m(i,["sdkHttpResponse"]);return n!=null&&v(t,["sdkHttpResponse"],n),t}function $U(i,e,t){const n={},s=m(i,["outputGcsUri"]);e!==void 0&&s!=null&&v(e,["parameters","storageUri"],s);const o=m(i,["negativePrompt"]);e!==void 0&&o!=null&&v(e,["parameters","negativePrompt"],o);const l=m(i,["numberOfImages"]);e!==void 0&&l!=null&&v(e,["parameters","sampleCount"],l);const c=m(i,["aspectRatio"]);e!==void 0&&c!=null&&v(e,["parameters","aspectRatio"],c);const d=m(i,["guidanceScale"]);e!==void 0&&d!=null&&v(e,["parameters","guidanceScale"],d);const h=m(i,["seed"]);e!==void 0&&h!=null&&v(e,["parameters","seed"],h);const p=m(i,["safetyFilterLevel"]);e!==void 0&&p!=null&&v(e,["parameters","safetySetting"],p);const y=m(i,["personGeneration"]);e!==void 0&&y!=null&&v(e,["parameters","personGeneration"],y);const b=m(i,["includeSafetyAttributes"]);e!==void 0&&b!=null&&v(e,["parameters","includeSafetyAttributes"],b);const S=m(i,["includeRaiReason"]);e!==void 0&&S!=null&&v(e,["parameters","includeRaiReason"],S);const E=m(i,["language"]);e!==void 0&&E!=null&&v(e,["parameters","language"],E);const R=m(i,["outputMimeType"]);e!==void 0&&R!=null&&v(e,["parameters","outputOptions","mimeType"],R);const A=m(i,["outputCompressionQuality"]);e!==void 0&&A!=null&&v(e,["parameters","outputOptions","compressionQuality"],A);const C=m(i,["addWatermark"]);e!==void 0&&C!=null&&v(e,["parameters","addWatermark"],C);const k=m(i,["labels"]);e!==void 0&&k!=null&&v(e,["labels"],k);const I=m(i,["editMode"]);e!==void 0&&I!=null&&v(e,["parameters","editMode"],I);const O=m(i,["baseSteps"]);return e!==void 0&&O!=null&&v(e,["parameters","editConfig","baseSteps"],O),n}function YU(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["prompt"]);o!=null&&v(n,["instances[0]","prompt"],o);const l=m(e,["referenceImages"]);if(l!=null){let d=l;Array.isArray(d)&&(d=d.map(h=>K4(h))),v(n,["instances[0]","referenceImages"],d)}const c=m(e,["config"]);return c!=null&&$U(c,n),n}function JU(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>g0(l))),v(t,["generatedImages"],o)}return t}function KU(i,e,t){const n={},s=m(i,["taskType"]);e!==void 0&&s!=null&&v(e,["requests[]","taskType"],s);const o=m(i,["title"]);e!==void 0&&o!=null&&v(e,["requests[]","title"],o);const l=m(i,["outputDimensionality"]);if(e!==void 0&&l!=null&&v(e,["requests[]","outputDimensionality"],l),m(i,["mimeType"])!==void 0)throw new Error("mimeType parameter is not supported in Gemini API.");if(m(i,["autoTruncate"])!==void 0)throw new Error("autoTruncate parameter is not supported in Gemini API.");return n}function WU(i,e,t){const n={};let s=m(t,["embeddingApiType"]);if(s===void 0&&(s="PREDICT"),s==="PREDICT"){const h=m(i,["taskType"]);e!==void 0&&h!=null&&v(e,["instances[]","task_type"],h)}else if(s==="EMBED_CONTENT"){const h=m(i,["taskType"]);e!==void 0&&h!=null&&v(e,["taskType"],h)}let o=m(t,["embeddingApiType"]);if(o===void 0&&(o="PREDICT"),o==="PREDICT"){const h=m(i,["title"]);e!==void 0&&h!=null&&v(e,["instances[]","title"],h)}else if(o==="EMBED_CONTENT"){const h=m(i,["title"]);e!==void 0&&h!=null&&v(e,["title"],h)}let l=m(t,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="PREDICT"){const h=m(i,["outputDimensionality"]);e!==void 0&&h!=null&&v(e,["parameters","outputDimensionality"],h)}else if(l==="EMBED_CONTENT"){const h=m(i,["outputDimensionality"]);e!==void 0&&h!=null&&v(e,["outputDimensionality"],h)}let c=m(t,["embeddingApiType"]);if(c===void 0&&(c="PREDICT"),c==="PREDICT"){const h=m(i,["mimeType"]);e!==void 0&&h!=null&&v(e,["instances[]","mimeType"],h)}let d=m(t,["embeddingApiType"]);if(d===void 0&&(d="PREDICT"),d==="PREDICT"){const h=m(i,["autoTruncate"]);e!==void 0&&h!=null&&v(e,["parameters","autoTruncate"],h)}else if(d==="EMBED_CONTENT"){const h=m(i,["autoTruncate"]);e!==void 0&&h!=null&&v(e,["autoTruncate"],h)}return n}function XU(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["contents"]);if(o!=null){let h=hw(i,o);Array.isArray(h)&&(h=h.map(p=>p)),v(n,["requests[]","content"],h)}const l=m(e,["content"]);l!=null&&vp(pn(l));const c=m(e,["config"]);c!=null&&KU(c,n);const d=m(e,["model"]);return d!==void 0&&v(n,["requests[]","model"],ct(i,d)),n}function QU(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));let o=m(t,["embeddingApiType"]);if(o===void 0&&(o="PREDICT"),o==="PREDICT"){const d=m(e,["contents"]);if(d!=null){let h=hw(i,d);Array.isArray(h)&&(h=h.map(p=>p)),v(n,["instances[]","content"],h)}}let l=m(t,["embeddingApiType"]);if(l===void 0&&(l="PREDICT"),l==="EMBED_CONTENT"){const d=m(e,["content"]);d!=null&&v(n,["content"],pn(d))}const c=m(e,["config"]);return c!=null&&WU(c,n,t),n}function ZU(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["embeddings"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(c=>c)),v(t,["embeddings"],l)}const o=m(i,["metadata"]);return o!=null&&v(t,["metadata"],o),t}function e4(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["predictions[]","embeddings"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(c=>DU(c))),v(t,["embeddings"],l)}const o=m(i,["metadata"]);if(o!=null&&v(t,["metadata"],o),e&&m(e,["embeddingApiType"])==="EMBED_CONTENT"){const l=m(i,["embedding"]),c=m(i,["usageMetadata"]),d=m(i,["truncated"]);if(l){const h={};c&&c.promptTokenCount&&(h.tokenCount=c.promptTokenCount),d&&(h.truncated=d),l.statistics=h,v(t,["embeddings"],[l])}}return t}function t4(i,e){const t={},n=m(i,["endpoint"]);n!=null&&v(t,["name"],n);const s=m(i,["deployedModelId"]);return s!=null&&v(t,["deployedModelId"],s),t}function n4(i,e){const t={};if(m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(i,["fileUri"]);n!=null&&v(t,["fileUri"],n);const s=m(i,["mimeType"]);return s!=null&&v(t,["mimeType"],s),t}function i4(i,e){const t={},n=m(i,["id"]);n!=null&&v(t,["id"],n);const s=m(i,["args"]);s!=null&&v(t,["args"],s);const o=m(i,["name"]);if(o!=null&&v(t,["name"],o),m(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return t}function s4(i,e){const t={},n=m(i,["allowedFunctionNames"]);n!=null&&v(t,["allowedFunctionNames"],n);const s=m(i,["mode"]);if(s!=null&&v(t,["mode"],s),m(i,["streamFunctionCallArguments"])!==void 0)throw new Error("streamFunctionCallArguments parameter is not supported in Gemini API.");return t}function r4(i,e){const t={},n=m(i,["description"]);n!=null&&v(t,["description"],n);const s=m(i,["name"]);s!=null&&v(t,["name"],s);const o=m(i,["parameters"]);o!=null&&v(t,["parameters"],o);const l=m(i,["parametersJsonSchema"]);l!=null&&v(t,["parametersJsonSchema"],l);const c=m(i,["response"]);c!=null&&v(t,["response"],c);const d=m(i,["responseJsonSchema"]);if(d!=null&&v(t,["responseJsonSchema"],d),m(i,["behavior"])!==void 0)throw new Error("behavior parameter is not supported in Vertex AI.");return t}function o4(i,e,t,n){const s={},o=m(e,["systemInstruction"]);t!==void 0&&o!=null&&v(t,["systemInstruction"],vp(pn(o)));const l=m(e,["temperature"]);l!=null&&v(s,["temperature"],l);const c=m(e,["topP"]);c!=null&&v(s,["topP"],c);const d=m(e,["topK"]);d!=null&&v(s,["topK"],d);const h=m(e,["candidateCount"]);h!=null&&v(s,["candidateCount"],h);const p=m(e,["maxOutputTokens"]);p!=null&&v(s,["maxOutputTokens"],p);const y=m(e,["stopSequences"]);y!=null&&v(s,["stopSequences"],y);const b=m(e,["responseLogprobs"]);b!=null&&v(s,["responseLogprobs"],b);const S=m(e,["logprobs"]);S!=null&&v(s,["logprobs"],S);const E=m(e,["presencePenalty"]);E!=null&&v(s,["presencePenalty"],E);const R=m(e,["frequencyPenalty"]);R!=null&&v(s,["frequencyPenalty"],R);const A=m(e,["seed"]);A!=null&&v(s,["seed"],A);const C=m(e,["responseMimeType"]);C!=null&&v(s,["responseMimeType"],C);const k=m(e,["responseSchema"]);k!=null&&v(s,["responseSchema"],fw(k));const I=m(e,["responseJsonSchema"]);if(I!=null&&v(s,["responseJsonSchema"],I),m(e,["routingConfig"])!==void 0)throw new Error("routingConfig parameter is not supported in Gemini API.");if(m(e,["modelSelectionConfig"])!==void 0)throw new Error("modelSelectionConfig parameter is not supported in Gemini API.");const O=m(e,["safetySettings"]);if(t!==void 0&&O!=null){let ce=O;Array.isArray(ce)&&(ce=ce.map(pe=>W4(pe))),v(t,["safetySettings"],ce)}const U=m(e,["tools"]);if(t!==void 0&&U!=null){let ce=id(U);Array.isArray(ce)&&(ce=ce.map(pe=>i5(nd(pe)))),v(t,["tools"],ce)}const P=m(e,["toolConfig"]);if(t!==void 0&&P!=null&&v(t,["toolConfig"],n5(P)),m(e,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const B=m(e,["cachedContent"]);t!==void 0&&B!=null&&v(t,["cachedContent"],oo(i,B));const Q=m(e,["responseModalities"]);Q!=null&&v(s,["responseModalities"],Q);const K=m(e,["mediaResolution"]);K!=null&&v(s,["mediaResolution"],K);const le=m(e,["speechConfig"]);if(le!=null&&v(s,["speechConfig"],pw(le)),m(e,["audioTimestamp"])!==void 0)throw new Error("audioTimestamp parameter is not supported in Gemini API.");const de=m(e,["thinkingConfig"]);de!=null&&v(s,["thinkingConfig"],de);const G=m(e,["imageConfig"]);G!=null&&v(s,["imageConfig"],D4(G));const fe=m(e,["enableEnhancedCivicAnswers"]);if(fe!=null&&v(s,["enableEnhancedCivicAnswers"],fe),m(e,["modelArmorConfig"])!==void 0)throw new Error("modelArmorConfig parameter is not supported in Gemini API.");return s}function a4(i,e,t,n){const s={},o=m(e,["systemInstruction"]);t!==void 0&&o!=null&&v(t,["systemInstruction"],pn(o));const l=m(e,["temperature"]);l!=null&&v(s,["temperature"],l);const c=m(e,["topP"]);c!=null&&v(s,["topP"],c);const d=m(e,["topK"]);d!=null&&v(s,["topK"],d);const h=m(e,["candidateCount"]);h!=null&&v(s,["candidateCount"],h);const p=m(e,["maxOutputTokens"]);p!=null&&v(s,["maxOutputTokens"],p);const y=m(e,["stopSequences"]);y!=null&&v(s,["stopSequences"],y);const b=m(e,["responseLogprobs"]);b!=null&&v(s,["responseLogprobs"],b);const S=m(e,["logprobs"]);S!=null&&v(s,["logprobs"],S);const E=m(e,["presencePenalty"]);E!=null&&v(s,["presencePenalty"],E);const R=m(e,["frequencyPenalty"]);R!=null&&v(s,["frequencyPenalty"],R);const A=m(e,["seed"]);A!=null&&v(s,["seed"],A);const C=m(e,["responseMimeType"]);C!=null&&v(s,["responseMimeType"],C);const k=m(e,["responseSchema"]);k!=null&&v(s,["responseSchema"],fw(k));const I=m(e,["responseJsonSchema"]);I!=null&&v(s,["responseJsonSchema"],I);const O=m(e,["routingConfig"]);O!=null&&v(s,["routingConfig"],O);const U=m(e,["modelSelectionConfig"]);U!=null&&v(s,["modelConfig"],U);const P=m(e,["safetySettings"]);if(t!==void 0&&P!=null){let te=P;Array.isArray(te)&&(te=te.map(ne=>ne)),v(t,["safetySettings"],te)}const B=m(e,["tools"]);if(t!==void 0&&B!=null){let te=id(B);Array.isArray(te)&&(te=te.map(ne=>eR(nd(ne)))),v(t,["tools"],te)}const Q=m(e,["toolConfig"]);t!==void 0&&Q!=null&&v(t,["toolConfig"],Q);const K=m(e,["labels"]);t!==void 0&&K!=null&&v(t,["labels"],K);const le=m(e,["cachedContent"]);t!==void 0&&le!=null&&v(t,["cachedContent"],oo(i,le));const de=m(e,["responseModalities"]);de!=null&&v(s,["responseModalities"],de);const G=m(e,["mediaResolution"]);G!=null&&v(s,["mediaResolution"],G);const fe=m(e,["speechConfig"]);fe!=null&&v(s,["speechConfig"],pw(fe));const ce=m(e,["audioTimestamp"]);ce!=null&&v(s,["audioTimestamp"],ce);const pe=m(e,["thinkingConfig"]);pe!=null&&v(s,["thinkingConfig"],pe);const z=m(e,["imageConfig"]);if(z!=null&&v(s,["imageConfig"],L4(z)),m(e,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");const X=m(e,["modelArmorConfig"]);return t!==void 0&&X!=null&&v(t,["modelArmorConfig"],X),s}function DC(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["contents"]);if(o!=null){let c=Pi(o);Array.isArray(c)&&(c=c.map(d=>vp(d))),v(n,["contents"],c)}const l=m(e,["config"]);return l!=null&&v(n,["generationConfig"],o4(i,l,n)),n}function LC(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["contents"]);if(o!=null){let c=Pi(o);Array.isArray(c)&&(c=c.map(d=>d)),v(n,["contents"],c)}const l=m(e,["config"]);return l!=null&&v(n,["generationConfig"],a4(i,l,n)),n}function PC(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["candidates"]);if(s!=null){let h=s;Array.isArray(h)&&(h=h.map(p=>NU(p))),v(t,["candidates"],h)}const o=m(i,["modelVersion"]);o!=null&&v(t,["modelVersion"],o);const l=m(i,["promptFeedback"]);l!=null&&v(t,["promptFeedback"],l);const c=m(i,["responseId"]);c!=null&&v(t,["responseId"],c);const d=m(i,["usageMetadata"]);return d!=null&&v(t,["usageMetadata"],d),t}function OC(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["candidates"]);if(s!=null){let p=s;Array.isArray(p)&&(p=p.map(y=>y)),v(t,["candidates"],p)}const o=m(i,["createTime"]);o!=null&&v(t,["createTime"],o);const l=m(i,["modelVersion"]);l!=null&&v(t,["modelVersion"],l);const c=m(i,["promptFeedback"]);c!=null&&v(t,["promptFeedback"],c);const d=m(i,["responseId"]);d!=null&&v(t,["responseId"],d);const h=m(i,["usageMetadata"]);return h!=null&&v(t,["usageMetadata"],h),t}function l4(i,e,t){const n={};if(m(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(i,["negativePrompt"])!==void 0)throw new Error("negativePrompt parameter is not supported in Gemini API.");const s=m(i,["numberOfImages"]);e!==void 0&&s!=null&&v(e,["parameters","sampleCount"],s);const o=m(i,["aspectRatio"]);e!==void 0&&o!=null&&v(e,["parameters","aspectRatio"],o);const l=m(i,["guidanceScale"]);if(e!==void 0&&l!=null&&v(e,["parameters","guidanceScale"],l),m(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const c=m(i,["safetyFilterLevel"]);e!==void 0&&c!=null&&v(e,["parameters","safetySetting"],c);const d=m(i,["personGeneration"]);e!==void 0&&d!=null&&v(e,["parameters","personGeneration"],d);const h=m(i,["includeSafetyAttributes"]);e!==void 0&&h!=null&&v(e,["parameters","includeSafetyAttributes"],h);const p=m(i,["includeRaiReason"]);e!==void 0&&p!=null&&v(e,["parameters","includeRaiReason"],p);const y=m(i,["language"]);e!==void 0&&y!=null&&v(e,["parameters","language"],y);const b=m(i,["outputMimeType"]);e!==void 0&&b!=null&&v(e,["parameters","outputOptions","mimeType"],b);const S=m(i,["outputCompressionQuality"]);if(e!==void 0&&S!=null&&v(e,["parameters","outputOptions","compressionQuality"],S),m(i,["addWatermark"])!==void 0)throw new Error("addWatermark parameter is not supported in Gemini API.");if(m(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");const E=m(i,["imageSize"]);if(e!==void 0&&E!=null&&v(e,["parameters","sampleImageSize"],E),m(i,["enhancePrompt"])!==void 0)throw new Error("enhancePrompt parameter is not supported in Gemini API.");return n}function c4(i,e,t){const n={},s=m(i,["outputGcsUri"]);e!==void 0&&s!=null&&v(e,["parameters","storageUri"],s);const o=m(i,["negativePrompt"]);e!==void 0&&o!=null&&v(e,["parameters","negativePrompt"],o);const l=m(i,["numberOfImages"]);e!==void 0&&l!=null&&v(e,["parameters","sampleCount"],l);const c=m(i,["aspectRatio"]);e!==void 0&&c!=null&&v(e,["parameters","aspectRatio"],c);const d=m(i,["guidanceScale"]);e!==void 0&&d!=null&&v(e,["parameters","guidanceScale"],d);const h=m(i,["seed"]);e!==void 0&&h!=null&&v(e,["parameters","seed"],h);const p=m(i,["safetyFilterLevel"]);e!==void 0&&p!=null&&v(e,["parameters","safetySetting"],p);const y=m(i,["personGeneration"]);e!==void 0&&y!=null&&v(e,["parameters","personGeneration"],y);const b=m(i,["includeSafetyAttributes"]);e!==void 0&&b!=null&&v(e,["parameters","includeSafetyAttributes"],b);const S=m(i,["includeRaiReason"]);e!==void 0&&S!=null&&v(e,["parameters","includeRaiReason"],S);const E=m(i,["language"]);e!==void 0&&E!=null&&v(e,["parameters","language"],E);const R=m(i,["outputMimeType"]);e!==void 0&&R!=null&&v(e,["parameters","outputOptions","mimeType"],R);const A=m(i,["outputCompressionQuality"]);e!==void 0&&A!=null&&v(e,["parameters","outputOptions","compressionQuality"],A);const C=m(i,["addWatermark"]);e!==void 0&&C!=null&&v(e,["parameters","addWatermark"],C);const k=m(i,["labels"]);e!==void 0&&k!=null&&v(e,["labels"],k);const I=m(i,["imageSize"]);e!==void 0&&I!=null&&v(e,["parameters","sampleImageSize"],I);const O=m(i,["enhancePrompt"]);return e!==void 0&&O!=null&&v(e,["parameters","enhancePrompt"],O),n}function u4(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["prompt"]);o!=null&&v(n,["instances[0]","prompt"],o);const l=m(e,["config"]);return l!=null&&l4(l,n),n}function d4(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["prompt"]);o!=null&&v(n,["instances[0]","prompt"],o);const l=m(e,["config"]);return l!=null&&c4(l,n),n}function h4(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["predictions"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(c=>E4(c))),v(t,["generatedImages"],l)}const o=m(i,["positivePromptSafetyAttributes"]);return o!=null&&v(t,["positivePromptSafetyAttributes"],Q1(o)),t}function f4(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["predictions"]);if(s!=null){let l=s;Array.isArray(l)&&(l=l.map(c=>g0(c))),v(t,["generatedImages"],l)}const o=m(i,["positivePromptSafetyAttributes"]);return o!=null&&v(t,["positivePromptSafetyAttributes"],Z1(o)),t}function p4(i,e,t){const n={},s=m(i,["numberOfVideos"]);if(e!==void 0&&s!=null&&v(e,["parameters","sampleCount"],s),m(i,["outputGcsUri"])!==void 0)throw new Error("outputGcsUri parameter is not supported in Gemini API.");if(m(i,["fps"])!==void 0)throw new Error("fps parameter is not supported in Gemini API.");const o=m(i,["durationSeconds"]);if(e!==void 0&&o!=null&&v(e,["parameters","durationSeconds"],o),m(i,["seed"])!==void 0)throw new Error("seed parameter is not supported in Gemini API.");const l=m(i,["aspectRatio"]);e!==void 0&&l!=null&&v(e,["parameters","aspectRatio"],l);const c=m(i,["resolution"]);e!==void 0&&c!=null&&v(e,["parameters","resolution"],c);const d=m(i,["personGeneration"]);if(e!==void 0&&d!=null&&v(e,["parameters","personGeneration"],d),m(i,["pubsubTopic"])!==void 0)throw new Error("pubsubTopic parameter is not supported in Gemini API.");const h=m(i,["negativePrompt"]);e!==void 0&&h!=null&&v(e,["parameters","negativePrompt"],h);const p=m(i,["enhancePrompt"]);if(e!==void 0&&p!=null&&v(e,["parameters","enhancePrompt"],p),m(i,["generateAudio"])!==void 0)throw new Error("generateAudio parameter is not supported in Gemini API.");const y=m(i,["lastFrame"]);e!==void 0&&y!=null&&v(e,["instances[0]","lastFrame"],v0(y));const b=m(i,["referenceImages"]);if(e!==void 0&&b!=null){let S=b;Array.isArray(S)&&(S=S.map(E=>g5(E))),v(e,["instances[0]","referenceImages"],S)}if(m(i,["mask"])!==void 0)throw new Error("mask parameter is not supported in Gemini API.");if(m(i,["compressionQuality"])!==void 0)throw new Error("compressionQuality parameter is not supported in Gemini API.");return n}function m4(i,e,t){const n={},s=m(i,["numberOfVideos"]);e!==void 0&&s!=null&&v(e,["parameters","sampleCount"],s);const o=m(i,["outputGcsUri"]);e!==void 0&&o!=null&&v(e,["parameters","storageUri"],o);const l=m(i,["fps"]);e!==void 0&&l!=null&&v(e,["parameters","fps"],l);const c=m(i,["durationSeconds"]);e!==void 0&&c!=null&&v(e,["parameters","durationSeconds"],c);const d=m(i,["seed"]);e!==void 0&&d!=null&&v(e,["parameters","seed"],d);const h=m(i,["aspectRatio"]);e!==void 0&&h!=null&&v(e,["parameters","aspectRatio"],h);const p=m(i,["resolution"]);e!==void 0&&p!=null&&v(e,["parameters","resolution"],p);const y=m(i,["personGeneration"]);e!==void 0&&y!=null&&v(e,["parameters","personGeneration"],y);const b=m(i,["pubsubTopic"]);e!==void 0&&b!=null&&v(e,["parameters","pubsubTopic"],b);const S=m(i,["negativePrompt"]);e!==void 0&&S!=null&&v(e,["parameters","negativePrompt"],S);const E=m(i,["enhancePrompt"]);e!==void 0&&E!=null&&v(e,["parameters","enhancePrompt"],E);const R=m(i,["generateAudio"]);e!==void 0&&R!=null&&v(e,["parameters","generateAudio"],R);const A=m(i,["lastFrame"]);e!==void 0&&A!=null&&v(e,["instances[0]","lastFrame"],Es(A));const C=m(i,["referenceImages"]);if(e!==void 0&&C!=null){let O=C;Array.isArray(O)&&(O=O.map(U=>v5(U))),v(e,["instances[0]","referenceImages"],O)}const k=m(i,["mask"]);e!==void 0&&k!=null&&v(e,["instances[0]","mask"],m5(k));const I=m(i,["compressionQuality"]);return e!==void 0&&I!=null&&v(e,["parameters","compressionQuality"],I),n}function g4(i,e){const t={},n=m(i,["name"]);n!=null&&v(t,["name"],n);const s=m(i,["metadata"]);s!=null&&v(t,["metadata"],s);const o=m(i,["done"]);o!=null&&v(t,["done"],o);const l=m(i,["error"]);l!=null&&v(t,["error"],l);const c=m(i,["response","generateVideoResponse"]);return c!=null&&v(t,["response"],_4(c)),t}function v4(i,e){const t={},n=m(i,["name"]);n!=null&&v(t,["name"],n);const s=m(i,["metadata"]);s!=null&&v(t,["metadata"],s);const o=m(i,["done"]);o!=null&&v(t,["done"],o);const l=m(i,["error"]);l!=null&&v(t,["error"],l);const c=m(i,["response"]);return c!=null&&v(t,["response"],w4(c)),t}function y4(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["prompt"]);o!=null&&v(n,["instances[0]","prompt"],o);const l=m(e,["image"]);l!=null&&v(n,["instances[0]","image"],v0(l));const c=m(e,["video"]);c!=null&&v(n,["instances[0]","video"],tR(c));const d=m(e,["source"]);d!=null&&x4(d,n);const h=m(e,["config"]);return h!=null&&p4(h,n),n}function b4(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["prompt"]);o!=null&&v(n,["instances[0]","prompt"],o);const l=m(e,["image"]);l!=null&&v(n,["instances[0]","image"],Es(l));const c=m(e,["video"]);c!=null&&v(n,["instances[0]","video"],nR(c));const d=m(e,["source"]);d!=null&&S4(d,n);const h=m(e,["config"]);return h!=null&&m4(h,n),n}function _4(i,e){const t={},n=m(i,["generatedSamples"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>T4(c))),v(t,["generatedVideos"],l)}const s=m(i,["raiMediaFilteredCount"]);s!=null&&v(t,["raiMediaFilteredCount"],s);const o=m(i,["raiMediaFilteredReasons"]);return o!=null&&v(t,["raiMediaFilteredReasons"],o),t}function w4(i,e){const t={},n=m(i,["videos"]);if(n!=null){let l=n;Array.isArray(l)&&(l=l.map(c=>C4(c))),v(t,["generatedVideos"],l)}const s=m(i,["raiMediaFilteredCount"]);s!=null&&v(t,["raiMediaFilteredCount"],s);const o=m(i,["raiMediaFilteredReasons"]);return o!=null&&v(t,["raiMediaFilteredReasons"],o),t}function x4(i,e,t){const n={},s=m(i,["prompt"]);e!==void 0&&s!=null&&v(e,["instances[0]","prompt"],s);const o=m(i,["image"]);e!==void 0&&o!=null&&v(e,["instances[0]","image"],v0(o));const l=m(i,["video"]);return e!==void 0&&l!=null&&v(e,["instances[0]","video"],tR(l)),n}function S4(i,e,t){const n={},s=m(i,["prompt"]);e!==void 0&&s!=null&&v(e,["instances[0]","prompt"],s);const o=m(i,["image"]);e!==void 0&&o!=null&&v(e,["instances[0]","image"],Es(o));const l=m(i,["video"]);return e!==void 0&&l!=null&&v(e,["instances[0]","video"],nR(l)),n}function E4(i,e){const t={},n=m(i,["_self"]);n!=null&&v(t,["image"],P4(n));const s=m(i,["raiFilteredReason"]);s!=null&&v(t,["raiFilteredReason"],s);const o=m(i,["_self"]);return o!=null&&v(t,["safetyAttributes"],Q1(o)),t}function g0(i,e){const t={},n=m(i,["_self"]);n!=null&&v(t,["image"],X1(n));const s=m(i,["raiFilteredReason"]);s!=null&&v(t,["raiFilteredReason"],s);const o=m(i,["_self"]);o!=null&&v(t,["safetyAttributes"],Z1(o));const l=m(i,["prompt"]);return l!=null&&v(t,["enhancedPrompt"],l),t}function A4(i,e){const t={},n=m(i,["_self"]);n!=null&&v(t,["mask"],X1(n));const s=m(i,["labels"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(t,["labels"],o)}return t}function T4(i,e){const t={},n=m(i,["video"]);return n!=null&&v(t,["video"],f5(n)),t}function C4(i,e){const t={},n=m(i,["_self"]);return n!=null&&v(t,["video"],p5(n)),t}function R4(i,e){const t={},n=m(i,["modelSelectionConfig"]);n!=null&&v(t,["modelConfig"],n);const s=m(i,["responseJsonSchema"]);s!=null&&v(t,["responseJsonSchema"],s);const o=m(i,["audioTimestamp"]);o!=null&&v(t,["audioTimestamp"],o);const l=m(i,["candidateCount"]);l!=null&&v(t,["candidateCount"],l);const c=m(i,["enableAffectiveDialog"]);c!=null&&v(t,["enableAffectiveDialog"],c);const d=m(i,["frequencyPenalty"]);d!=null&&v(t,["frequencyPenalty"],d);const h=m(i,["logprobs"]);h!=null&&v(t,["logprobs"],h);const p=m(i,["maxOutputTokens"]);p!=null&&v(t,["maxOutputTokens"],p);const y=m(i,["mediaResolution"]);y!=null&&v(t,["mediaResolution"],y);const b=m(i,["presencePenalty"]);b!=null&&v(t,["presencePenalty"],b);const S=m(i,["responseLogprobs"]);S!=null&&v(t,["responseLogprobs"],S);const E=m(i,["responseMimeType"]);E!=null&&v(t,["responseMimeType"],E);const R=m(i,["responseModalities"]);R!=null&&v(t,["responseModalities"],R);const A=m(i,["responseSchema"]);A!=null&&v(t,["responseSchema"],A);const C=m(i,["routingConfig"]);C!=null&&v(t,["routingConfig"],C);const k=m(i,["seed"]);k!=null&&v(t,["seed"],k);const I=m(i,["speechConfig"]);I!=null&&v(t,["speechConfig"],I);const O=m(i,["stopSequences"]);O!=null&&v(t,["stopSequences"],O);const U=m(i,["temperature"]);U!=null&&v(t,["temperature"],U);const P=m(i,["thinkingConfig"]);P!=null&&v(t,["thinkingConfig"],P);const B=m(i,["topK"]);B!=null&&v(t,["topK"],B);const Q=m(i,["topP"]);if(Q!=null&&v(t,["topP"],Q),m(i,["enableEnhancedCivicAnswers"])!==void 0)throw new Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}function N4(i,e,t){const n={},s=m(e,["model"]);return s!=null&&v(n,["_url","name"],ct(i,s)),n}function k4(i,e,t){const n={},s=m(e,["model"]);return s!=null&&v(n,["_url","name"],ct(i,s)),n}function I4(i,e){const t={};if(m(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const n=m(i,["enableWidget"]);return n!=null&&v(t,["enableWidget"],n),t}function M4(i,e){const t={};if(m(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const n=m(i,["timeRangeFilter"]);return n!=null&&v(t,["timeRangeFilter"],n),t}function D4(i,e){const t={},n=m(i,["aspectRatio"]);n!=null&&v(t,["aspectRatio"],n);const s=m(i,["imageSize"]);if(s!=null&&v(t,["imageSize"],s),m(i,["personGeneration"])!==void 0)throw new Error("personGeneration parameter is not supported in Gemini API.");if(m(i,["outputMimeType"])!==void 0)throw new Error("outputMimeType parameter is not supported in Gemini API.");if(m(i,["outputCompressionQuality"])!==void 0)throw new Error("outputCompressionQuality parameter is not supported in Gemini API.");return t}function L4(i,e){const t={},n=m(i,["aspectRatio"]);n!=null&&v(t,["aspectRatio"],n);const s=m(i,["imageSize"]);s!=null&&v(t,["imageSize"],s);const o=m(i,["personGeneration"]);o!=null&&v(t,["personGeneration"],o);const l=m(i,["outputMimeType"]);l!=null&&v(t,["imageOutputOptions","mimeType"],l);const c=m(i,["outputCompressionQuality"]);return c!=null&&v(t,["imageOutputOptions","compressionQuality"],c),t}function P4(i,e){const t={},n=m(i,["bytesBase64Encoded"]);n!=null&&v(t,["imageBytes"],ca(n));const s=m(i,["mimeType"]);return s!=null&&v(t,["mimeType"],s),t}function X1(i,e){const t={},n=m(i,["gcsUri"]);n!=null&&v(t,["gcsUri"],n);const s=m(i,["bytesBase64Encoded"]);s!=null&&v(t,["imageBytes"],ca(s));const o=m(i,["mimeType"]);return o!=null&&v(t,["mimeType"],o),t}function v0(i,e){const t={};if(m(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");const n=m(i,["imageBytes"]);n!=null&&v(t,["bytesBase64Encoded"],ca(n));const s=m(i,["mimeType"]);return s!=null&&v(t,["mimeType"],s),t}function Es(i,e){const t={},n=m(i,["gcsUri"]);n!=null&&v(t,["gcsUri"],n);const s=m(i,["imageBytes"]);s!=null&&v(t,["bytesBase64Encoded"],ca(s));const o=m(i,["mimeType"]);return o!=null&&v(t,["mimeType"],o),t}function O4(i,e,t,n){const s={},o=m(e,["pageSize"]);t!==void 0&&o!=null&&v(t,["_query","pageSize"],o);const l=m(e,["pageToken"]);t!==void 0&&l!=null&&v(t,["_query","pageToken"],l);const c=m(e,["filter"]);t!==void 0&&c!=null&&v(t,["_query","filter"],c);const d=m(e,["queryBase"]);return t!==void 0&&d!=null&&v(t,["_url","models_url"],V1(i,d)),s}function U4(i,e,t,n){const s={},o=m(e,["pageSize"]);t!==void 0&&o!=null&&v(t,["_query","pageSize"],o);const l=m(e,["pageToken"]);t!==void 0&&l!=null&&v(t,["_query","pageToken"],l);const c=m(e,["filter"]);t!==void 0&&c!=null&&v(t,["_query","filter"],c);const d=m(e,["queryBase"]);return t!==void 0&&d!=null&&v(t,["_url","models_url"],V1(i,d)),s}function F4(i,e,t){const n={},s=m(e,["config"]);return s!=null&&O4(i,s,n),n}function H4(i,e,t){const n={},s=m(e,["config"]);return s!=null&&U4(i,s,n),n}function B4(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["nextPageToken"]);s!=null&&v(t,["nextPageToken"],s);const o=m(i,["_self"]);if(o!=null){let l=z1(o);Array.isArray(l)&&(l=l.map(c=>Lb(c))),v(t,["models"],l)}return t}function j4(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["nextPageToken"]);s!=null&&v(t,["nextPageToken"],s);const o=m(i,["_self"]);if(o!=null){let l=z1(o);Array.isArray(l)&&(l=l.map(c=>Pb(c))),v(t,["models"],l)}return t}function q4(i,e){const t={},n=m(i,["maskMode"]);n!=null&&v(t,["maskMode"],n);const s=m(i,["segmentationClasses"]);s!=null&&v(t,["maskClasses"],s);const o=m(i,["maskDilation"]);return o!=null&&v(t,["dilation"],o),t}function Lb(i,e){const t={},n=m(i,["name"]);n!=null&&v(t,["name"],n);const s=m(i,["displayName"]);s!=null&&v(t,["displayName"],s);const o=m(i,["description"]);o!=null&&v(t,["description"],o);const l=m(i,["version"]);l!=null&&v(t,["version"],l);const c=m(i,["_self"]);c!=null&&v(t,["tunedModelInfo"],s5(c));const d=m(i,["inputTokenLimit"]);d!=null&&v(t,["inputTokenLimit"],d);const h=m(i,["outputTokenLimit"]);h!=null&&v(t,["outputTokenLimit"],h);const p=m(i,["supportedGenerationMethods"]);p!=null&&v(t,["supportedActions"],p);const y=m(i,["temperature"]);y!=null&&v(t,["temperature"],y);const b=m(i,["maxTemperature"]);b!=null&&v(t,["maxTemperature"],b);const S=m(i,["topP"]);S!=null&&v(t,["topP"],S);const E=m(i,["topK"]);E!=null&&v(t,["topK"],E);const R=m(i,["thinking"]);return R!=null&&v(t,["thinking"],R),t}function Pb(i,e){const t={},n=m(i,["name"]);n!=null&&v(t,["name"],n);const s=m(i,["displayName"]);s!=null&&v(t,["displayName"],s);const o=m(i,["description"]);o!=null&&v(t,["description"],o);const l=m(i,["versionId"]);l!=null&&v(t,["version"],l);const c=m(i,["deployedModels"]);if(c!=null){let b=c;Array.isArray(b)&&(b=b.map(S=>t4(S))),v(t,["endpoints"],b)}const d=m(i,["labels"]);d!=null&&v(t,["labels"],d);const h=m(i,["_self"]);h!=null&&v(t,["tunedModelInfo"],r5(h));const p=m(i,["defaultCheckpointId"]);p!=null&&v(t,["defaultCheckpointId"],p);const y=m(i,["checkpoints"]);if(y!=null){let b=y;Array.isArray(b)&&(b=b.map(S=>S)),v(t,["checkpoints"],b)}return t}function G4(i,e){const t={},n=m(i,["mediaResolution"]);n!=null&&v(t,["mediaResolution"],n);const s=m(i,["codeExecutionResult"]);s!=null&&v(t,["codeExecutionResult"],s);const o=m(i,["executableCode"]);o!=null&&v(t,["executableCode"],o);const l=m(i,["fileData"]);l!=null&&v(t,["fileData"],n4(l));const c=m(i,["functionCall"]);c!=null&&v(t,["functionCall"],i4(c));const d=m(i,["functionResponse"]);d!=null&&v(t,["functionResponse"],d);const h=m(i,["inlineData"]);h!=null&&v(t,["inlineData"],RU(h));const p=m(i,["text"]);p!=null&&v(t,["text"],p);const y=m(i,["thought"]);y!=null&&v(t,["thought"],y);const b=m(i,["thoughtSignature"]);b!=null&&v(t,["thoughtSignature"],b);const S=m(i,["videoMetadata"]);return S!=null&&v(t,["videoMetadata"],S),t}function V4(i,e){const t={},n=m(i,["productImage"]);return n!=null&&v(t,["image"],Es(n)),t}function z4(i,e,t){const n={},s=m(i,["numberOfImages"]);e!==void 0&&s!=null&&v(e,["parameters","sampleCount"],s);const o=m(i,["baseSteps"]);e!==void 0&&o!=null&&v(e,["parameters","baseSteps"],o);const l=m(i,["outputGcsUri"]);e!==void 0&&l!=null&&v(e,["parameters","storageUri"],l);const c=m(i,["seed"]);e!==void 0&&c!=null&&v(e,["parameters","seed"],c);const d=m(i,["safetyFilterLevel"]);e!==void 0&&d!=null&&v(e,["parameters","safetySetting"],d);const h=m(i,["personGeneration"]);e!==void 0&&h!=null&&v(e,["parameters","personGeneration"],h);const p=m(i,["addWatermark"]);e!==void 0&&p!=null&&v(e,["parameters","addWatermark"],p);const y=m(i,["outputMimeType"]);e!==void 0&&y!=null&&v(e,["parameters","outputOptions","mimeType"],y);const b=m(i,["outputCompressionQuality"]);e!==void 0&&b!=null&&v(e,["parameters","outputOptions","compressionQuality"],b);const S=m(i,["enhancePrompt"]);e!==void 0&&S!=null&&v(e,["parameters","enhancePrompt"],S);const E=m(i,["labels"]);return e!==void 0&&E!=null&&v(e,["labels"],E),n}function $4(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["source"]);o!=null&&J4(o,n);const l=m(e,["config"]);return l!=null&&z4(l,n),n}function Y4(i,e){const t={},n=m(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>g0(o))),v(t,["generatedImages"],s)}return t}function J4(i,e,t){const n={},s=m(i,["prompt"]);e!==void 0&&s!=null&&v(e,["instances[0]","prompt"],s);const o=m(i,["personImage"]);e!==void 0&&o!=null&&v(e,["instances[0]","personImage","image"],Es(o));const l=m(i,["productImages"]);if(e!==void 0&&l!=null){let c=l;Array.isArray(c)&&(c=c.map(d=>V4(d))),v(e,["instances[0]","productImages"],c)}return n}function K4(i,e){const t={},n=m(i,["referenceImage"]);n!=null&&v(t,["referenceImage"],Es(n));const s=m(i,["referenceId"]);s!=null&&v(t,["referenceId"],s);const o=m(i,["referenceType"]);o!=null&&v(t,["referenceType"],o);const l=m(i,["maskImageConfig"]);l!=null&&v(t,["maskImageConfig"],q4(l));const c=m(i,["controlImageConfig"]);c!=null&&v(t,["controlImageConfig"],PU(c));const d=m(i,["styleImageConfig"]);d!=null&&v(t,["styleImageConfig"],d);const h=m(i,["subjectImageConfig"]);return h!=null&&v(t,["subjectImageConfig"],h),t}function Q1(i,e){const t={},n=m(i,["safetyAttributes","categories"]);n!=null&&v(t,["categories"],n);const s=m(i,["safetyAttributes","scores"]);s!=null&&v(t,["scores"],s);const o=m(i,["contentType"]);return o!=null&&v(t,["contentType"],o),t}function Z1(i,e){const t={},n=m(i,["safetyAttributes","categories"]);n!=null&&v(t,["categories"],n);const s=m(i,["safetyAttributes","scores"]);s!=null&&v(t,["scores"],s);const o=m(i,["contentType"]);return o!=null&&v(t,["contentType"],o),t}function W4(i,e){const t={},n=m(i,["category"]);if(n!=null&&v(t,["category"],n),m(i,["method"])!==void 0)throw new Error("method parameter is not supported in Gemini API.");const s=m(i,["threshold"]);return s!=null&&v(t,["threshold"],s),t}function X4(i,e){const t={},n=m(i,["image"]);return n!=null&&v(t,["image"],Es(n)),t}function Q4(i,e,t){const n={},s=m(i,["mode"]);e!==void 0&&s!=null&&v(e,["parameters","mode"],s);const o=m(i,["maxPredictions"]);e!==void 0&&o!=null&&v(e,["parameters","maxPredictions"],o);const l=m(i,["confidenceThreshold"]);e!==void 0&&l!=null&&v(e,["parameters","confidenceThreshold"],l);const c=m(i,["maskDilation"]);e!==void 0&&c!=null&&v(e,["parameters","maskDilation"],c);const d=m(i,["binaryColorThreshold"]);e!==void 0&&d!=null&&v(e,["parameters","binaryColorThreshold"],d);const h=m(i,["labels"]);return e!==void 0&&h!=null&&v(e,["labels"],h),n}function Z4(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["source"]);o!=null&&t5(o,n);const l=m(e,["config"]);return l!=null&&Q4(l,n),n}function e5(i,e){const t={},n=m(i,["predictions"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>A4(o))),v(t,["generatedMasks"],s)}return t}function t5(i,e,t){const n={},s=m(i,["prompt"]);e!==void 0&&s!=null&&v(e,["instances[0]","prompt"],s);const o=m(i,["image"]);e!==void 0&&o!=null&&v(e,["instances[0]","image"],Es(o));const l=m(i,["scribbleImage"]);return e!==void 0&&l!=null&&v(e,["instances[0]","scribble"],X4(l)),n}function n5(i,e){const t={},n=m(i,["retrievalConfig"]);n!=null&&v(t,["retrievalConfig"],n);const s=m(i,["functionCallingConfig"]);return s!=null&&v(t,["functionCallingConfig"],s4(s)),t}function i5(i,e){const t={};if(m(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const n=m(i,["computerUse"]);n!=null&&v(t,["computerUse"],n);const s=m(i,["fileSearch"]);s!=null&&v(t,["fileSearch"],s);const o=m(i,["codeExecution"]);if(o!=null&&v(t,["codeExecution"],o),m(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const l=m(i,["functionDeclarations"]);if(l!=null){let y=l;Array.isArray(y)&&(y=y.map(b=>b)),v(t,["functionDeclarations"],y)}const c=m(i,["googleMaps"]);c!=null&&v(t,["googleMaps"],I4(c));const d=m(i,["googleSearch"]);d!=null&&v(t,["googleSearch"],M4(d));const h=m(i,["googleSearchRetrieval"]);h!=null&&v(t,["googleSearchRetrieval"],h);const p=m(i,["urlContext"]);return p!=null&&v(t,["urlContext"],p),t}function eR(i,e){const t={},n=m(i,["retrieval"]);n!=null&&v(t,["retrieval"],n);const s=m(i,["computerUse"]);if(s!=null&&v(t,["computerUse"],s),m(i,["fileSearch"])!==void 0)throw new Error("fileSearch parameter is not supported in Vertex AI.");const o=m(i,["codeExecution"]);o!=null&&v(t,["codeExecution"],o);const l=m(i,["enterpriseWebSearch"]);l!=null&&v(t,["enterpriseWebSearch"],l);const c=m(i,["functionDeclarations"]);if(c!=null){let b=c;Array.isArray(b)&&(b=b.map(S=>r4(S))),v(t,["functionDeclarations"],b)}const d=m(i,["googleMaps"]);d!=null&&v(t,["googleMaps"],d);const h=m(i,["googleSearch"]);h!=null&&v(t,["googleSearch"],h);const p=m(i,["googleSearchRetrieval"]);p!=null&&v(t,["googleSearchRetrieval"],p);const y=m(i,["urlContext"]);return y!=null&&v(t,["urlContext"],y),t}function s5(i,e){const t={},n=m(i,["baseModel"]);n!=null&&v(t,["baseModel"],n);const s=m(i,["createTime"]);s!=null&&v(t,["createTime"],s);const o=m(i,["updateTime"]);return o!=null&&v(t,["updateTime"],o),t}function r5(i,e){const t={},n=m(i,["labels","google-vertex-llm-tuning-base-model-id"]);n!=null&&v(t,["baseModel"],n);const s=m(i,["createTime"]);s!=null&&v(t,["createTime"],s);const o=m(i,["updateTime"]);return o!=null&&v(t,["updateTime"],o),t}function o5(i,e,t){const n={},s=m(i,["displayName"]);e!==void 0&&s!=null&&v(e,["displayName"],s);const o=m(i,["description"]);e!==void 0&&o!=null&&v(e,["description"],o);const l=m(i,["defaultCheckpointId"]);return e!==void 0&&l!=null&&v(e,["defaultCheckpointId"],l),n}function a5(i,e,t){const n={},s=m(i,["displayName"]);e!==void 0&&s!=null&&v(e,["displayName"],s);const o=m(i,["description"]);e!==void 0&&o!=null&&v(e,["description"],o);const l=m(i,["defaultCheckpointId"]);return e!==void 0&&l!=null&&v(e,["defaultCheckpointId"],l),n}function l5(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","name"],ct(i,s));const o=m(e,["config"]);return o!=null&&o5(o,n),n}function c5(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["config"]);return o!=null&&a5(o,n),n}function u5(i,e,t){const n={},s=m(i,["outputGcsUri"]);e!==void 0&&s!=null&&v(e,["parameters","storageUri"],s);const o=m(i,["safetyFilterLevel"]);e!==void 0&&o!=null&&v(e,["parameters","safetySetting"],o);const l=m(i,["personGeneration"]);e!==void 0&&l!=null&&v(e,["parameters","personGeneration"],l);const c=m(i,["includeRaiReason"]);e!==void 0&&c!=null&&v(e,["parameters","includeRaiReason"],c);const d=m(i,["outputMimeType"]);e!==void 0&&d!=null&&v(e,["parameters","outputOptions","mimeType"],d);const h=m(i,["outputCompressionQuality"]);e!==void 0&&h!=null&&v(e,["parameters","outputOptions","compressionQuality"],h);const p=m(i,["enhanceInputImage"]);e!==void 0&&p!=null&&v(e,["parameters","upscaleConfig","enhanceInputImage"],p);const y=m(i,["imagePreservationFactor"]);e!==void 0&&y!=null&&v(e,["parameters","upscaleConfig","imagePreservationFactor"],y);const b=m(i,["labels"]);e!==void 0&&b!=null&&v(e,["labels"],b);const S=m(i,["numberOfImages"]);e!==void 0&&S!=null&&v(e,["parameters","sampleCount"],S);const E=m(i,["mode"]);return e!==void 0&&E!=null&&v(e,["parameters","mode"],E),n}function d5(i,e,t){const n={},s=m(e,["model"]);s!=null&&v(n,["_url","model"],ct(i,s));const o=m(e,["image"]);o!=null&&v(n,["instances[0]","image"],Es(o));const l=m(e,["upscaleFactor"]);l!=null&&v(n,["parameters","upscaleConfig","upscaleFactor"],l);const c=m(e,["config"]);return c!=null&&u5(c,n),n}function h5(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["predictions"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>g0(l))),v(t,["generatedImages"],o)}return t}function f5(i,e){const t={},n=m(i,["uri"]);n!=null&&v(t,["uri"],n);const s=m(i,["encodedVideo"]);s!=null&&v(t,["videoBytes"],ca(s));const o=m(i,["encoding"]);return o!=null&&v(t,["mimeType"],o),t}function p5(i,e){const t={},n=m(i,["gcsUri"]);n!=null&&v(t,["uri"],n);const s=m(i,["bytesBase64Encoded"]);s!=null&&v(t,["videoBytes"],ca(s));const o=m(i,["mimeType"]);return o!=null&&v(t,["mimeType"],o),t}function m5(i,e){const t={},n=m(i,["image"]);n!=null&&v(t,["_self"],Es(n));const s=m(i,["maskMode"]);return s!=null&&v(t,["maskMode"],s),t}function g5(i,e){const t={},n=m(i,["image"]);n!=null&&v(t,["image"],v0(n));const s=m(i,["referenceType"]);return s!=null&&v(t,["referenceType"],s),t}function v5(i,e){const t={},n=m(i,["image"]);n!=null&&v(t,["image"],Es(n));const s=m(i,["referenceType"]);return s!=null&&v(t,["referenceType"],s),t}function tR(i,e){const t={},n=m(i,["uri"]);n!=null&&v(t,["uri"],n);const s=m(i,["videoBytes"]);s!=null&&v(t,["encodedVideo"],ca(s));const o=m(i,["mimeType"]);return o!=null&&v(t,["encoding"],o),t}function nR(i,e){const t={},n=m(i,["uri"]);n!=null&&v(t,["gcsUri"],n);const s=m(i,["videoBytes"]);s!=null&&v(t,["bytesBase64Encoded"],ca(s));const o=m(i,["mimeType"]);return o!=null&&v(t,["mimeType"],o),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function y5(i,e){const t={},n=m(i,["displayName"]);return e!==void 0&&n!=null&&v(e,["displayName"],n),t}function b5(i){const e={},t=m(i,["config"]);return t!=null&&y5(t,e),e}function _5(i,e){const t={},n=m(i,["force"]);return e!==void 0&&n!=null&&v(e,["_query","force"],n),t}function w5(i){const e={},t=m(i,["name"]);t!=null&&v(e,["_url","name"],t);const n=m(i,["config"]);return n!=null&&_5(n,e),e}function x5(i){const e={},t=m(i,["name"]);return t!=null&&v(e,["_url","name"],t),e}function S5(i,e){const t={},n=m(i,["customMetadata"]);if(e!==void 0&&n!=null){let o=n;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["customMetadata"],o)}const s=m(i,["chunkingConfig"]);return e!==void 0&&s!=null&&v(e,["chunkingConfig"],s),t}function E5(i){const e={},t=m(i,["name"]);t!=null&&v(e,["name"],t);const n=m(i,["metadata"]);n!=null&&v(e,["metadata"],n);const s=m(i,["done"]);s!=null&&v(e,["done"],s);const o=m(i,["error"]);o!=null&&v(e,["error"],o);const l=m(i,["response"]);return l!=null&&v(e,["response"],T5(l)),e}function A5(i){const e={},t=m(i,["fileSearchStoreName"]);t!=null&&v(e,["_url","file_search_store_name"],t);const n=m(i,["fileName"]);n!=null&&v(e,["fileName"],n);const s=m(i,["config"]);return s!=null&&S5(s,e),e}function T5(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["parent"]);n!=null&&v(e,["parent"],n);const s=m(i,["documentName"]);return s!=null&&v(e,["documentName"],s),e}function C5(i,e){const t={},n=m(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=m(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function R5(i){const e={},t=m(i,["config"]);return t!=null&&C5(t,e),e}function N5(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=m(i,["fileSearchStores"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["fileSearchStores"],o)}return e}function iR(i,e){const t={},n=m(i,["mimeType"]);e!==void 0&&n!=null&&v(e,["mimeType"],n);const s=m(i,["displayName"]);e!==void 0&&s!=null&&v(e,["displayName"],s);const o=m(i,["customMetadata"]);if(e!==void 0&&o!=null){let c=o;Array.isArray(c)&&(c=c.map(d=>d)),v(e,["customMetadata"],c)}const l=m(i,["chunkingConfig"]);return e!==void 0&&l!=null&&v(e,["chunkingConfig"],l),t}function k5(i){const e={},t=m(i,["fileSearchStoreName"]);t!=null&&v(e,["_url","file_search_store_name"],t);const n=m(i,["config"]);return n!=null&&iR(n,e),e}function I5(i){const e={},t=m(i,["sdkHttpResponse"]);return t!=null&&v(e,["sdkHttpResponse"],t),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const M5="Content-Type",D5="X-Server-Timeout",L5="User-Agent",Ob="x-goog-api-client",P5="1.42.0",O5=`google-genai-sdk/${P5}`,U5="v1beta1",F5="v1beta",H5=5,B5=[408,429,500,502,503,504];class j5{constructor(e){var t,n,s;this.clientOptions=Object.assign({},e),this.customBaseUrl=(t=e.httpOptions)===null||t===void 0?void 0:t.baseUrl,this.clientOptions.vertexai&&(this.clientOptions.project&&this.clientOptions.location?this.clientOptions.apiKey=void 0:this.clientOptions.apiKey&&(this.clientOptions.project=void 0,this.clientOptions.location=void 0));const o={};if(this.clientOptions.vertexai){if(!this.clientOptions.location&&!this.clientOptions.apiKey&&!this.customBaseUrl&&(this.clientOptions.location="global"),!(this.clientOptions.project&&this.clientOptions.location||this.clientOptions.apiKey)&&!this.customBaseUrl)throw new Error("Authentication is not set up. Please provide either a project and location, or an API key, or a custom base URL.");const c=e.project&&e.location||!!e.apiKey;this.customBaseUrl&&!c?(o.baseUrl=this.customBaseUrl,this.clientOptions.project=void 0,this.clientOptions.location=void 0):this.clientOptions.apiKey||this.clientOptions.location==="global"?o.baseUrl="https://aiplatform.googleapis.com/":this.clientOptions.project&&this.clientOptions.location&&(o.baseUrl=`https://${this.clientOptions.location}-aiplatform.googleapis.com/`),o.apiVersion=(n=this.clientOptions.apiVersion)!==null&&n!==void 0?n:U5}else{if(!this.clientOptions.apiKey)throw new Lh({message:"API key must be set when using the Gemini API.",status:403});o.apiVersion=(s=this.clientOptions.apiVersion)!==null&&s!==void 0?s:F5,o.baseUrl="https://generativelanguage.googleapis.com/"}o.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=o,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(o,e.httpOptions))}isVertexAI(){var e;return(e=this.clientOptions.vertexai)!==null&&e!==void 0?e:!1}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getCustomBaseUrl(){return this.customBaseUrl}async getAuthHeaders(){const e=new Headers;return await this.clientOptions.auth.addAuthHeaders(e),e}getApiVersion(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.apiVersion!==void 0)return this.clientOptions.httpOptions.apiVersion;throw new Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.baseUrl!==void 0)return this.clientOptions.httpOptions.baseUrl;throw new Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&this.clientOptions.httpOptions.headers!==void 0)return this.clientOptions.httpOptions.headers;throw new Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||e.baseUrl===void 0||e.apiVersion===void 0)throw new Error("HTTP options are not correctly set.");const n=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&e.apiVersion!==""&&n.push(e.apiVersion),n.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){const e=this.getBaseUrl(),t=new URL(e);return t.protocol=t.protocol=="http:"?"ws":"wss",t.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw new Error("HTTP options are not correctly set.")}constructUrl(e,t,n){const s=[this.getRequestUrlInternal(t)];return n&&s.push(this.getBaseResourcePath()),e!==""&&s.push(e),new URL(`${s.join("/")}`)}shouldPrependVertexProjectPath(e,t){return!(t.baseUrl&&t.baseUrlResourceScope===kb.COLLECTION||this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||e.httpMethod==="GET"&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e,t),s=this.constructUrl(e.path,t,n);if(e.queryParams)for(const[l,c]of Object.entries(e.queryParams))s.searchParams.append(l,String(c));let o={};if(e.httpMethod==="GET"){if(e.body&&e.body!=="{}")throw new Error("Request body should be empty for GET request, but got non empty request body")}else o.body=e.body;return o=await this.includeExtraHttpOptionsToRequestInit(o,t,s.toString(),e.abortSignal),this.unaryApiCall(s,o,e.httpMethod)}patchHttpOptions(e,t){const n=JSON.parse(JSON.stringify(e));for(const[s,o]of Object.entries(t))typeof o=="object"?n[s]=Object.assign(Object.assign({},n[s]),o):o!==void 0&&(n[s]=o);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));const n=this.shouldPrependVertexProjectPath(e,t),s=this.constructUrl(e.path,t,n);(!s.searchParams.has("alt")||s.searchParams.get("alt")!=="sse")&&s.searchParams.set("alt","sse");let o={};return o.body=e.body,o=await this.includeExtraHttpOptionsToRequestInit(o,t,s.toString(),e.abortSignal),this.streamApiCall(s,o,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,s){if(t&&t.timeout||s){const o=new AbortController,l=o.signal;if(t.timeout&&(t==null?void 0:t.timeout)>0){const c=setTimeout(()=>o.abort(),t.timeout);c&&typeof c.unref=="function"&&c.unref()}s&&s.addEventListener("abort",()=>{o.abort()}),e.signal=l}return t&&t.extraBody!==null&&q5(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await UC(s),new Ib(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async s=>(await UC(s),this.processStreamResponse(s))).catch(s=>{throw s instanceof Error?s:new Error(JSON.stringify(s))})}processStreamResponse(e){return xs(this,arguments,function*(){var n;const s=(n=e==null?void 0:e.body)===null||n===void 0?void 0:n.getReader(),o=new TextDecoder("utf-8");if(!s)throw new Error("Response body is empty");try{let l="";const c="data:",d=[`

`,"\r\r",`\r
\r
`];for(;;){const{done:h,value:p}=yield Ue(s.read());if(h){if(l.trim().length>0)throw new Error("Incomplete JSON segment at the end");break}const y=o.decode(p,{stream:!0});try{const E=JSON.parse(y);if("error"in E){const R=JSON.parse(JSON.stringify(E.error)),A=R.status,C=R.code,k=`got status: ${A}. ${JSON.stringify(E)}`;if(C>=400&&C<600)throw new Lh({message:k,status:C})}}catch(E){if(E.name==="ApiError")throw E}l+=y;let b=-1,S=0;for(;;){b=-1,S=0;for(const A of d){const C=l.indexOf(A);C!==-1&&(b===-1||C<b)&&(b=C,S=A.length)}if(b===-1)break;const E=l.substring(0,b);l=l.substring(b+S);const R=E.trim();if(R.startsWith(c)){const A=R.substring(c.length).trim();try{const C=new Response(A,{headers:e==null?void 0:e.headers,status:e==null?void 0:e.status,statusText:e==null?void 0:e.statusText});yield yield Ue(new Ib(C))}catch(C){throw new Error(`exception parsing stream chunk ${A}. ${C}`)}}}}}finally{s.releaseLock()}})}async apiCall(e,t){var n;if(!this.clientOptions.httpOptions||!this.clientOptions.httpOptions.retryOptions)return fetch(e,t);const s=this.clientOptions.httpOptions.retryOptions;return kL(async()=>{const l=await fetch(e,t);if(l.ok)return l;throw B5.includes(l.status)?new Error(`Retryable HTTP Error: ${l.statusText}`):new P1.AbortError(`Non-retryable exception ${l.statusText} sending request`)},{retries:((n=s.attempts)!==null&&n!==void 0?n:H5)-1})}getDefaultHeaders(){const e={},t=O5+" "+this.clientOptions.userAgentExtra;return e[L5]=t,e[Ob]=t,e[M5]="application/json",e}async getHeadersInternal(e,t){const n=new Headers;if(e&&e.headers){for(const[s,o]of Object.entries(e.headers))n.append(s,o);e.timeout&&e.timeout>0&&n.append(D5,String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return typeof e=="string"&&(n=e.replace(/[/\\]+$/,""),n=(t=n.split(/[/\\]/).pop())!==null&&t!==void 0?t:""),n}async uploadFile(e,t){var n;const s={};t!=null&&(s.mimeType=t.mimeType,s.name=t.name,s.displayName=t.displayName),s.name&&!s.name.startsWith("files/")&&(s.name=`files/${s.name}`);const o=this.clientOptions.uploader,l=await o.stat(e);s.sizeBytes=String(l.size);const c=(n=t==null?void 0:t.mimeType)!==null&&n!==void 0?n:l.type;if(c===void 0||c==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");s.mimeType=c;const d={file:s},h=this.getFileName(e),p=me("upload/v1beta/files",d._url),y=await this.fetchUploadUrl(p,s.sizeBytes,s.mimeType,h,d,t==null?void 0:t.httpOptions);return o.upload(e,y,this)}async uploadFileToFileSearchStore(e,t,n){var s;const o=this.clientOptions.uploader,l=await o.stat(t),c=String(l.size),d=(s=n==null?void 0:n.mimeType)!==null&&s!==void 0?s:l.type;if(d===void 0||d==="")throw new Error("Can not determine mimeType. Please provide mimeType in the config.");const h=`upload/v1beta/${e}:uploadToFileSearchStore`,p=this.getFileName(t),y={};n!=null&&iR(n,y);const b=await this.fetchUploadUrl(h,c,d,p,y,n==null?void 0:n.httpOptions);return o.uploadToFileSearchStore(t,b,this)}async downloadFile(e){await this.clientOptions.downloader.download(e,this)}async fetchUploadUrl(e,t,n,s,o,l){var c;let d={};l?d=l:d={apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},s?{"X-Goog-Upload-File-Name":s}:{})};const h=await this.request({path:e,body:JSON.stringify(o),httpMethod:"POST",httpOptions:d});if(!h||!(h!=null&&h.headers))throw new Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");const p=(c=h==null?void 0:h.headers)===null||c===void 0?void 0:c["x-goog-upload-url"];if(p===void 0)throw new Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return p}}async function UC(i){var e;if(i===void 0)throw new Error("response is undefined");if(!i.ok){const t=i.status;let n;!((e=i.headers.get("content-type"))===null||e===void 0)&&e.includes("application/json")?n=await i.json():n={error:{message:await i.text(),code:i.status,status:i.statusText}};const s=JSON.stringify(n);throw t>=400&&t<600?new Lh({message:s,status:t}):new Error(s)}}function q5(i,e){if(!e||Object.keys(e).length===0)return;if(i.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let t={};if(typeof i.body=="string"&&i.body.length>0)try{const o=JSON.parse(i.body);if(typeof o=="object"&&o!==null&&!Array.isArray(o))t=o;else{console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}}catch{console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}function n(o,l){const c=Object.assign({},o);for(const d in l)if(Object.prototype.hasOwnProperty.call(l,d)){const h=l[d],p=c[d];h&&typeof h=="object"&&!Array.isArray(h)&&p&&typeof p=="object"&&!Array.isArray(p)?c[d]=n(p,h):(p&&h&&typeof p!=typeof h&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${d}". Original type: ${typeof p}, New type: ${typeof h}. Overwriting.`),c[d]=h)}return c}const s=n(t,e);i.body=JSON.stringify(s)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const G5="mcp_used/unknown";let V5=!1;function sR(i){for(const e of i)if(z5(e)||typeof e=="object"&&"inputSchema"in e)return!0;return V5}function rR(i){var e;const t=(e=i[Ob])!==null&&e!==void 0?e:"";i[Ob]=(t+` ${G5}`).trimStart()}function z5(i){return i!==null&&typeof i=="object"&&i instanceof gw}function $5(i){return xs(this,arguments,function*(t,n=100){let s,o=0;for(;o<n;){const l=yield Ue(t.listTools({cursor:s}));for(const c of l.tools)yield yield Ue(c),o++;if(!l.nextCursor)break;s=l.nextCursor}})}class gw{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new gw(e,t)}async initialize(){var e,t,n,s;if(this.mcpTools.length>0)return;const o={},l=[];for(const p of this.mcpClients)try{for(var c=!0,d=(t=void 0,Ss($5(p))),h;h=await d.next(),e=h.done,!e;c=!0){s=h.value,c=!1;const y=s;l.push(y);const b=y.name;if(o[b])throw new Error(`Duplicate function name ${b} found in MCP tools. Please ensure function names are unique.`);o[b]=p}}catch(y){t={error:y}}finally{try{!c&&!e&&(n=d.return)&&await n.call(d)}finally{if(t)throw t.error}}this.mcpTools=l,this.functionNameToMcpClient=o}async tool(){return await this.initialize(),yP(this.mcpTools,this.config)}async callTool(e){await this.initialize();const t=[];for(const n of e)if(n.name in this.functionNameToMcpClient){const s=this.functionNameToMcpClient[n.name];let o;this.config.timeout&&(o={timeout:this.config.timeout});const l=await s.callTool({name:n.name,arguments:n.args},void 0,o);t.push({functionResponse:{name:n.name,response:l.isError?{error:l}:l}})}return t}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function Y5(i,e,t){const n=new uP;let s;t.data instanceof Blob?s=JSON.parse(await t.data.text()):s=JSON.parse(t.data),Object.assign(n,s),e(n)}class J5{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw new Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");const s=this.apiClient.getWebsocketBaseUrl(),o=this.apiClient.getApiVersion(),l=X5(this.apiClient.getDefaultHeaders()),c=this.apiClient.getApiKey(),d=`${s}/ws/google.ai.generativelanguage.${o}.GenerativeService.BidiGenerateMusic?key=${c}`;let h=()=>{};const p=new Promise(I=>{h=I}),y=e.callbacks,b=function(){h({})},S=this.apiClient,E={onopen:b,onmessage:I=>{Y5(S,y.onmessage,I)},onerror:(t=y==null?void 0:y.onerror)!==null&&t!==void 0?t:function(I){},onclose:(n=y==null?void 0:y.onclose)!==null&&n!==void 0?n:function(I){}},R=this.webSocketFactory.create(d,W5(l),E);R.connect(),await p;const k={setup:{model:ct(this.apiClient,e.model)}};return R.send(JSON.stringify(k)),new K5(R,this.apiClient)}}class K5{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||Object.keys(e.weightedPrompts).length===0)throw new Error("Weighted prompts must be set and contain at least one entry.");const t=yU(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});const t=vU(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){const t={playbackControl:e};this.conn.send(JSON.stringify(t))}play(){this.sendPlaybackControl(Xc.PLAY)}pause(){this.sendPlaybackControl(Xc.PAUSE)}stop(){this.sendPlaybackControl(Xc.STOP)}resetContext(){this.sendPlaybackControl(Xc.RESET_CONTEXT)}close(){this.conn.close()}}function W5(i){const e={};return i.forEach((t,n)=>{e[n]=t}),e}function X5(i){const e=new Headers;for(const[t,n]of Object.entries(i))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Q5="FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.";async function Z5(i,e,t){const n=new cP;let s;t.data instanceof Blob?s=await t.data.text():t.data instanceof ArrayBuffer?s=new TextDecoder().decode(t.data):s=t.data;const o=JSON.parse(s);if(i.isVertexAI()){const l=wU(o);Object.assign(n,l)}else Object.assign(n,o);e(n)}class eF{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new J5(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,s,o,l,c;if(e.config&&e.config.httpOptions)throw new Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");const d=this.apiClient.getWebsocketBaseUrl(),h=this.apiClient.getApiVersion();let p;const y=this.apiClient.getHeaders();e.config&&e.config.tools&&sR(e.config.tools)&&rR(y);const b=sF(y);if(this.apiClient.isVertexAI()){const K=this.apiClient.getProject(),le=this.apiClient.getLocation(),de=this.apiClient.getApiKey(),G=!!K&&!!le||!!de;this.apiClient.getCustomBaseUrl()&&!G?p=d:(p=`${d}/ws/google.cloud.aiplatform.${h}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(b,p))}else{const K=this.apiClient.getApiKey();let le="BidiGenerateContent",de="key";K!=null&&K.startsWith("auth_tokens/")&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),h!=="v1alpha"&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),le="BidiGenerateContentConstrained",de="access_token"),p=`${d}/ws/google.ai.generativelanguage.${h}.GenerativeService.${le}?${de}=${K}`}let S=()=>{};const E=new Promise(K=>{S=K}),R=e.callbacks,A=function(){var K;(K=R==null?void 0:R.onopen)===null||K===void 0||K.call(R),S({})},C=this.apiClient,k={onopen:A,onmessage:K=>{Z5(C,R.onmessage,K)},onerror:(t=R==null?void 0:R.onerror)!==null&&t!==void 0?t:function(K){},onclose:(n=R==null?void 0:R.onclose)!==null&&n!==void 0?n:function(K){}},I=this.webSocketFactory.create(p,iF(b),k);I.connect(),await E;let O=ct(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&O.startsWith("publishers/")){const K=this.apiClient.getProject(),le=this.apiClient.getLocation();K&&le&&(O=`projects/${K}/locations/${le}/`+O)}let U={};this.apiClient.isVertexAI()&&((s=e.config)===null||s===void 0?void 0:s.responseModalities)===void 0&&(e.config===void 0?e.config={responseModalities:[Dg.AUDIO]}:e.config.responseModalities=[Dg.AUDIO]),!((o=e.config)===null||o===void 0)&&o.generationConfig&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");const P=(c=(l=e.config)===null||l===void 0?void 0:l.tools)!==null&&c!==void 0?c:[],B=[];for(const K of P)if(this.isCallableTool(K)){const le=K;B.push(await le.tool())}else B.push(K);B.length>0&&(e.config.tools=B);const Q={model:O,config:e.config,callbacks:e.callbacks};return this.apiClient.isVertexAI()?U=gU(this.apiClient,Q):U=mU(this.apiClient,Q),delete U.config,I.send(JSON.stringify(U)),new nF(I,this.apiClient)}isCallableTool(e){return"callTool"in e&&typeof e.callTool=="function"}}const tF={turnComplete:!0};class nF{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(t.turns!==null&&t.turns!==void 0){let n=[];try{n=Pi(t.turns),e.isVertexAI()||(n=n.map(s=>vp(s)))}catch{throw new Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(t.functionResponses==null)throw new Error("functionResponses is required.");if(Array.isArray(t.functionResponses)?n=t.functionResponses:n=[t.functionResponses],n.length===0)throw new Error("functionResponses is required.");for(const o of n){if(typeof o!="object"||o===null||!("name"in o)||!("response"in o))throw new Error(`Could not parse function response, type '${typeof o}'.`);if(!e.isVertexAI()&&!("id"in o))throw new Error(Q5)}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},tF),e);const t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};this.apiClient.isVertexAI()?t={realtimeInput:_U(e)}:t={realtimeInput:bU(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(e.functionResponses==null)throw new Error("Tool response parameters are required.");const t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function iF(i){const e={};return i.forEach((t,n)=>{e[n]=t}),e}function sF(i){const e=new Headers;for(const[t,n]of Object.entries(i))e.append(t,n);return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const FC=10;function HC(i){var e,t,n;if(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.disable)return!0;let s=!1;for(const l of(t=i==null?void 0:i.tools)!==null&&t!==void 0?t:[])if(nu(l)){s=!0;break}if(!s)return!0;const o=(n=i==null?void 0:i.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls;return o&&(o<0||!Number.isInteger(o))||o==0?(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0):!1}function nu(i){return"callTool"in i&&typeof i.callTool=="function"}function rF(i){var e,t,n;return(n=(t=(e=i.config)===null||e===void 0?void 0:e.tools)===null||t===void 0?void 0:t.some(s=>nu(s)))!==null&&n!==void 0?n:!1}function BC(i){var e;const t=[];return!((e=i==null?void 0:i.config)===null||e===void 0)&&e.tools&&i.config.tools.forEach((n,s)=>{if(nu(n))return;const o=n;o.functionDeclarations&&o.functionDeclarations.length>0&&t.push(s)}),t}function jC(i){var e;return!(!((e=i==null?void 0:i.automaticFunctionCalling)===null||e===void 0)&&e.ignoreCallHistory)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class oF extends ro{constructor(e){super(),this.apiClient=e,this.embedContent=async t=>{if(!this.apiClient.isVertexAI())return await this.embedContentInternal(t);if(t.model.includes("gemini")&&t.model!=="gemini-embedding-001"||t.model.includes("maas")){const s=Pi(t.contents);if(s.length>1)throw new Error("The embedContent API for this model only supports one content at a time.");const o=Object.assign(Object.assign({},t),{content:s[0],embeddingApiType:Lg.EMBED_CONTENT});return await this.embedContentInternal(o)}else{const s=Object.assign(Object.assign({},t),{embeddingApiType:Lg.PREDICT});return await this.embedContentInternal(s)}},this.generateContent=async t=>{var n,s,o,l,c;const d=await this.processParamsMaybeAddMcpUsage(t);if(this.maybeMoveToResponseJsonSchem(t),!rF(t)||HC(t.config))return await this.generateContentInternal(d);const h=BC(t);if(h.length>0){const R=h.map(A=>`tools[${A}]`).join(", ");throw new Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${R}.`)}let p,y;const b=Pi(d.contents),S=(o=(s=(n=d.config)===null||n===void 0?void 0:n.automaticFunctionCalling)===null||s===void 0?void 0:s.maximumRemoteCalls)!==null&&o!==void 0?o:FC;let E=0;for(;E<S&&(p=await this.generateContentInternal(d),!(!p.functionCalls||p.functionCalls.length===0));){const R=p.candidates[0].content,A=[];for(const C of(c=(l=t.config)===null||l===void 0?void 0:l.tools)!==null&&c!==void 0?c:[])if(nu(C)){const I=await C.callTool(p.functionCalls);A.push(...I)}E++,y={role:"user",parts:A},d.contents=Pi(d.contents),d.contents.push(R),d.contents.push(y),jC(d.config)&&(b.push(R),b.push(y))}return jC(d.config)&&(p.automaticFunctionCallingHistory=b),p},this.generateContentStream=async t=>{var n,s,o,l,c;if(this.maybeMoveToResponseJsonSchem(t),HC(t.config)){const y=await this.processParamsMaybeAddMcpUsage(t);return await this.generateContentStreamInternal(y)}const d=BC(t);if(d.length>0){const y=d.map(b=>`tools[${b}]`).join(", ");throw new Error(`Incompatible tools found at ${y}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}const h=(o=(s=(n=t==null?void 0:t.config)===null||n===void 0?void 0:n.toolConfig)===null||s===void 0?void 0:s.functionCallingConfig)===null||o===void 0?void 0:o.streamFunctionCallArguments,p=(c=(l=t==null?void 0:t.config)===null||l===void 0?void 0:l.automaticFunctionCalling)===null||c===void 0?void 0:c.disable;if(h&&!p)throw new Error("Running in streaming mode with 'streamFunctionCallArguments' enabled, this feature is not compatible with automatic function calling (AFC). Please set 'config.automaticFunctionCalling.disable' to true to disable AFC or leave 'config.toolConfig.functionCallingConfig.streamFunctionCallArguments' to be undefined or set to false to disable streaming function call arguments feature.");return await this.processAfcStream(t)},this.generateImages=async t=>await this.generateImagesInternal(t).then(n=>{var s;let o;const l=[];if(n!=null&&n.generatedImages)for(const d of n.generatedImages)d&&(d!=null&&d.safetyAttributes)&&((s=d==null?void 0:d.safetyAttributes)===null||s===void 0?void 0:s.contentType)==="Positive Prompt"?o=d==null?void 0:d.safetyAttributes:l.push(d);let c;return o?c={generatedImages:l,positivePromptSafetyAttributes:o,sdkHttpResponse:n.sdkHttpResponse}:c={generatedImages:l,sdkHttpResponse:n.sdkHttpResponse},c}),this.list=async t=>{var n;const l={config:Object.assign(Object.assign({},{queryBase:!0}),t==null?void 0:t.config)};if(this.apiClient.isVertexAI()&&!l.config.queryBase){if(!((n=l.config)===null||n===void 0)&&n.filter)throw new Error("Filtering tuned models list for Vertex AI is not currently supported");l.config.filter="labels.tune-type:*"}return new Gl(to.PAGED_ITEM_MODELS,c=>this.listInternal(c),await this.listInternal(l),l)},this.editImage=async t=>{const n={model:t.model,prompt:t.prompt,referenceImages:[],config:t.config};return t.referenceImages&&t.referenceImages&&(n.referenceImages=t.referenceImages.map(s=>s.toReferenceImageAPI())),await this.editImageInternal(n)},this.upscaleImage=async t=>{let n={numberOfImages:1,mode:"upscale"};t.config&&(n=Object.assign(Object.assign({},n),t.config));const s={model:t.model,image:t.image,upscaleFactor:t.upscaleFactor,config:n};return await this.upscaleImageInternal(s)},this.generateVideos=async t=>{var n,s,o,l,c,d;if((t.prompt||t.image||t.video)&&t.source)throw new Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return this.apiClient.isVertexAI()||(!((n=t.video)===null||n===void 0)&&n.uri&&(!((s=t.video)===null||s===void 0)&&s.videoBytes)?t.video={uri:t.video.uri,mimeType:t.video.mimeType}:!((l=(o=t.source)===null||o===void 0?void 0:o.video)===null||l===void 0)&&l.uri&&(!((d=(c=t.source)===null||c===void 0?void 0:c.video)===null||d===void 0)&&d.videoBytes)&&(t.source.video={uri:t.source.video.uri,mimeType:t.source.video.mimeType})),await this.generateVideosInternal(t)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&(e.config.responseJsonSchema||Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema))}async processParamsMaybeAddMcpUsage(e){var t,n,s;const o=(t=e.config)===null||t===void 0?void 0:t.tools;if(!o)return e;const l=await Promise.all(o.map(async d=>nu(d)?await d.tool():d)),c={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:l})};if(c.config.tools=l,e.config&&e.config.tools&&sR(e.config.tools)){const d=(s=(n=e.config.httpOptions)===null||n===void 0?void 0:n.headers)!==null&&s!==void 0?s:{};let h=Object.assign({},d);Object.keys(h).length===0&&(h=this.apiClient.getDefaultHeaders()),rR(h),c.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:h})}return c}async initAfcToolsMap(e){var t,n,s;const o=new Map;for(const l of(n=(t=e.config)===null||t===void 0?void 0:t.tools)!==null&&n!==void 0?n:[])if(nu(l)){const c=l,d=await c.tool();for(const h of(s=d.functionDeclarations)!==null&&s!==void 0?s:[]){if(!h.name)throw new Error("Function declaration name is required.");if(o.has(h.name))throw new Error(`Duplicate tool declaration name: ${h.name}`);o.set(h.name,c)}}return o}async processAfcStream(e){var t,n,s;const o=(s=(n=(t=e.config)===null||t===void 0?void 0:t.automaticFunctionCalling)===null||n===void 0?void 0:n.maximumRemoteCalls)!==null&&s!==void 0?s:FC;let l=!1,c=0;const d=await this.initAfcToolsMap(e);return(function(h,p,y){return xs(this,arguments,function*(){for(var b,S,E,R,A,C;c<o;){l&&(c++,l=!1);const U=yield Ue(h.processParamsMaybeAddMcpUsage(y)),P=yield Ue(h.generateContentStreamInternal(U)),B=[],Q=[];try{for(var k=!0,I=(S=void 0,Ss(P)),O;O=yield Ue(I.next()),b=O.done,!b;k=!0){R=O.value,k=!1;const K=R;if(yield yield Ue(K),K.candidates&&(!((A=K.candidates[0])===null||A===void 0)&&A.content)){Q.push(K.candidates[0].content);for(const le of(C=K.candidates[0].content.parts)!==null&&C!==void 0?C:[])if(c<o&&le.functionCall){if(!le.functionCall.name)throw new Error("Function call name was not returned by the model.");if(p.has(le.functionCall.name)){const de=yield Ue(p.get(le.functionCall.name).callTool([le.functionCall]));B.push(...de)}else throw new Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${p.keys()}, mising tool: ${le.functionCall.name}`)}}}}catch(K){S={error:K}}finally{try{!k&&!b&&(E=I.return)&&(yield Ue(E.call(I)))}finally{if(S)throw S.error}}if(B.length>0){l=!0;const K=new eh;K.candidates=[{content:{role:"user",parts:B}}],yield yield Ue(K);const le=[];le.push(...Q),le.push({role:"user",parts:B});const de=Pi(y.contents).concat(le);y.contents=de}else break}})})(this,d,e)}async generateContentInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=LC(this.apiClient,e);return c=me("{model}:generateContent",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=OC(p),b=new eh;return Object.assign(b,y),b})}else{const h=DC(this.apiClient,e);return c=me("{model}:generateContent",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=PC(p),b=new eh;return Object.assign(b,y),b})}}async generateContentStreamInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=LC(this.apiClient,e);return c=me("{model}:streamGenerateContent?alt=sse",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.requestStream({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}),l.then(function(y){return xs(this,arguments,function*(){var b,S,E,R;try{for(var A=!0,C=Ss(y),k;k=yield Ue(C.next()),b=k.done,!b;A=!0){R=k.value,A=!1;const I=R,O=OC(yield Ue(I.json()),e);O.sdkHttpResponse={headers:I.headers};const U=new eh;Object.assign(U,O),yield yield Ue(U)}}catch(I){S={error:I}}finally{try{!A&&!b&&(E=C.return)&&(yield Ue(E.call(C)))}finally{if(S)throw S.error}}})})}else{const h=DC(this.apiClient,e);return c=me("{model}:streamGenerateContent?alt=sse",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.requestStream({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}),l.then(function(y){return xs(this,arguments,function*(){var b,S,E,R;try{for(var A=!0,C=Ss(y),k;k=yield Ue(C.next()),b=k.done,!b;A=!0){R=k.value,A=!1;const I=R,O=PC(yield Ue(I.json()),e);O.sdkHttpResponse={headers:I.headers};const U=new eh;Object.assign(U,O),yield yield Ue(U)}}catch(I){S={error:I}}finally{try{!A&&!b&&(E=C.return)&&(yield Ue(E.call(C)))}finally{if(S)throw S.error}}})})}}async embedContentInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=QU(this.apiClient,e,e),p=_P(e.model)?"{model}:embedContent":"{model}:predict";return c=me(p,h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(y=>y.json().then(b=>{const S=b;return S.sdkHttpResponse={headers:y.headers},S})),l.then(y=>{const b=e4(y,e),S=new gC;return Object.assign(S,b),S})}else{const h=XU(this.apiClient,e);return c=me("{model}:batchEmbedContents",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=ZU(p),b=new gC;return Object.assign(b,y),b})}}async generateImagesInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=d4(this.apiClient,e);return c=me("{model}:predict",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=f4(p),b=new vC;return Object.assign(b,y),b})}else{const h=u4(this.apiClient,e);return c=me("{model}:predict",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=h4(p),b=new vC;return Object.assign(b,y),b})}}async editImageInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const c=YU(this.apiClient,e);return o=me("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),s.then(d=>{const h=JU(d),p=new XL;return Object.assign(p,h),p})}else throw new Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const c=d5(this.apiClient,e);return o=me("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),s.then(d=>{const h=h5(d),p=new QL;return Object.assign(p,h),p})}else throw new Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const c=$4(this.apiClient,e);return o=me("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const h=Y4(d),p=new ZL;return Object.assign(p,h),p})}else throw new Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const c=Z4(this.apiClient,e);return o=me("{model}:predict",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const h=e5(d),p=new eP;return Object.assign(p,h),p})}else throw new Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=k4(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),l.then(p=>Pb(p))}else{const h=N4(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()),l.then(p=>Lb(p))}}async listInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=H4(this.apiClient,e);return c=me("{models_url}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=j4(p),b=new yC;return Object.assign(b,y),b})}else{const h=F4(this.apiClient,e);return c=me("{models_url}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=B4(p),b=new yC;return Object.assign(b,y),b})}}async update(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=c5(this.apiClient,e);return c=me("{model}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),l.then(p=>Pb(p))}else{const h=l5(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"PATCH",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()),l.then(p=>Lb(p))}}async delete(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=GU(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=zU(p),b=new bC;return Object.assign(b,y),b})}else{const h=qU(this.apiClient,e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"DELETE",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=VU(p),b=new bC;return Object.assign(b,y),b})}}async countTokens(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=HU(this.apiClient,e);return c=me("{model}:countTokens",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=jU(p),b=new _C;return Object.assign(b,y),b})}else{const h=FU(this.apiClient,e);return c=me("{model}:countTokens",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=BU(p),b=new _C;return Object.assign(b,y),b})}}async computeTokens(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const c=IU(this.apiClient,e);return o=me("{model}:computeTokens",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),s.then(d=>{const h=MU(d),p=new tP;return Object.assign(p,h),p})}else throw new Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=b4(this.apiClient,e);return c=me("{model}:predictLongRunning",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),l.then(p=>{const y=v4(p),b=new Pg;return Object.assign(b,y),b})}else{const h=y4(this.apiClient,e);return c=me("{model}:predictLongRunning",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()),l.then(p=>{const y=g4(p),b=new Pg;return Object.assign(b,y),b})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class aF extends ro{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){const t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let o;n&&"httpOptions"in n&&(o=n.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async get(e){const t=e.operation,n=e.config;if(t.name===void 0||t.name==="")throw new Error("Operation name is required.");if(this.apiClient.isVertexAI()){const s=t.name.split("/operations/")[0];let o;n&&"httpOptions"in n&&(o=n.httpOptions);const l=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:s,config:{httpOptions:o}});return t._fromAPIResponse({apiResponse:l,_isVertexAI:!0})}else{const s=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:s,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=zL(e);return c=me("{operationName}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json()),l}else{const h=VL(e);return c=me("{operationName}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json()),l}}async fetchPredictVideosOperationInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const c=UL(e);return o=me("{resourceName}:fetchPredictOperation",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s}else throw new Error("This method is only supported by the Vertex AI.")}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function lF(i){const e={},t=m(i,["data"]);if(t!=null&&v(e,["data"],t),m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const n=m(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function cF(i){const e={},t=m(i,["parts"]);if(t!=null){let s=t;Array.isArray(s)&&(s=s.map(o=>yF(o))),v(e,["parts"],s)}const n=m(i,["role"]);return n!=null&&v(e,["role"],n),e}function uF(i,e,t){const n={},s=m(e,["expireTime"]);t!==void 0&&s!=null&&v(t,["expireTime"],s);const o=m(e,["newSessionExpireTime"]);t!==void 0&&o!=null&&v(t,["newSessionExpireTime"],o);const l=m(e,["uses"]);t!==void 0&&l!=null&&v(t,["uses"],l);const c=m(e,["liveConnectConstraints"]);t!==void 0&&c!=null&&v(t,["bidiGenerateContentSetup"],vF(i,c));const d=m(e,["lockAdditionalFields"]);return t!==void 0&&d!=null&&v(t,["fieldMask"],d),n}function dF(i,e){const t={},n=m(e,["config"]);return n!=null&&v(t,["config"],uF(i,n,t)),t}function hF(i){const e={};if(m(i,["displayName"])!==void 0)throw new Error("displayName parameter is not supported in Gemini API.");const t=m(i,["fileUri"]);t!=null&&v(e,["fileUri"],t);const n=m(i,["mimeType"]);return n!=null&&v(e,["mimeType"],n),e}function fF(i){const e={},t=m(i,["id"]);t!=null&&v(e,["id"],t);const n=m(i,["args"]);n!=null&&v(e,["args"],n);const s=m(i,["name"]);if(s!=null&&v(e,["name"],s),m(i,["partialArgs"])!==void 0)throw new Error("partialArgs parameter is not supported in Gemini API.");if(m(i,["willContinue"])!==void 0)throw new Error("willContinue parameter is not supported in Gemini API.");return e}function pF(i){const e={};if(m(i,["authConfig"])!==void 0)throw new Error("authConfig parameter is not supported in Gemini API.");const t=m(i,["enableWidget"]);return t!=null&&v(e,["enableWidget"],t),e}function mF(i){const e={};if(m(i,["excludeDomains"])!==void 0)throw new Error("excludeDomains parameter is not supported in Gemini API.");if(m(i,["blockingConfidence"])!==void 0)throw new Error("blockingConfidence parameter is not supported in Gemini API.");const t=m(i,["timeRangeFilter"]);return t!=null&&v(e,["timeRangeFilter"],t),e}function gF(i,e){const t={},n=m(i,["generationConfig"]);e!==void 0&&n!=null&&v(e,["setup","generationConfig"],n);const s=m(i,["responseModalities"]);e!==void 0&&s!=null&&v(e,["setup","generationConfig","responseModalities"],s);const o=m(i,["temperature"]);e!==void 0&&o!=null&&v(e,["setup","generationConfig","temperature"],o);const l=m(i,["topP"]);e!==void 0&&l!=null&&v(e,["setup","generationConfig","topP"],l);const c=m(i,["topK"]);e!==void 0&&c!=null&&v(e,["setup","generationConfig","topK"],c);const d=m(i,["maxOutputTokens"]);e!==void 0&&d!=null&&v(e,["setup","generationConfig","maxOutputTokens"],d);const h=m(i,["mediaResolution"]);e!==void 0&&h!=null&&v(e,["setup","generationConfig","mediaResolution"],h);const p=m(i,["seed"]);e!==void 0&&p!=null&&v(e,["setup","generationConfig","seed"],p);const y=m(i,["speechConfig"]);e!==void 0&&y!=null&&v(e,["setup","generationConfig","speechConfig"],mw(y));const b=m(i,["thinkingConfig"]);e!==void 0&&b!=null&&v(e,["setup","generationConfig","thinkingConfig"],b);const S=m(i,["enableAffectiveDialog"]);e!==void 0&&S!=null&&v(e,["setup","generationConfig","enableAffectiveDialog"],S);const E=m(i,["systemInstruction"]);e!==void 0&&E!=null&&v(e,["setup","systemInstruction"],cF(pn(E)));const R=m(i,["tools"]);if(e!==void 0&&R!=null){let P=id(R);Array.isArray(P)&&(P=P.map(B=>_F(nd(B)))),v(e,["setup","tools"],P)}const A=m(i,["sessionResumption"]);e!==void 0&&A!=null&&v(e,["setup","sessionResumption"],bF(A));const C=m(i,["inputAudioTranscription"]);e!==void 0&&C!=null&&v(e,["setup","inputAudioTranscription"],C);const k=m(i,["outputAudioTranscription"]);e!==void 0&&k!=null&&v(e,["setup","outputAudioTranscription"],k);const I=m(i,["realtimeInputConfig"]);e!==void 0&&I!=null&&v(e,["setup","realtimeInputConfig"],I);const O=m(i,["contextWindowCompression"]);e!==void 0&&O!=null&&v(e,["setup","contextWindowCompression"],O);const U=m(i,["proactivity"]);if(e!==void 0&&U!=null&&v(e,["setup","proactivity"],U),m(i,["explicitVadSignal"])!==void 0)throw new Error("explicitVadSignal parameter is not supported in Gemini API.");return t}function vF(i,e){const t={},n=m(e,["model"]);n!=null&&v(t,["setup","model"],ct(i,n));const s=m(e,["config"]);return s!=null&&v(t,["config"],gF(s,t)),t}function yF(i){const e={},t=m(i,["mediaResolution"]);t!=null&&v(e,["mediaResolution"],t);const n=m(i,["codeExecutionResult"]);n!=null&&v(e,["codeExecutionResult"],n);const s=m(i,["executableCode"]);s!=null&&v(e,["executableCode"],s);const o=m(i,["fileData"]);o!=null&&v(e,["fileData"],hF(o));const l=m(i,["functionCall"]);l!=null&&v(e,["functionCall"],fF(l));const c=m(i,["functionResponse"]);c!=null&&v(e,["functionResponse"],c);const d=m(i,["inlineData"]);d!=null&&v(e,["inlineData"],lF(d));const h=m(i,["text"]);h!=null&&v(e,["text"],h);const p=m(i,["thought"]);p!=null&&v(e,["thought"],p);const y=m(i,["thoughtSignature"]);y!=null&&v(e,["thoughtSignature"],y);const b=m(i,["videoMetadata"]);return b!=null&&v(e,["videoMetadata"],b),e}function bF(i){const e={},t=m(i,["handle"]);if(t!=null&&v(e,["handle"],t),m(i,["transparent"])!==void 0)throw new Error("transparent parameter is not supported in Gemini API.");return e}function _F(i){const e={};if(m(i,["retrieval"])!==void 0)throw new Error("retrieval parameter is not supported in Gemini API.");const t=m(i,["computerUse"]);t!=null&&v(e,["computerUse"],t);const n=m(i,["fileSearch"]);n!=null&&v(e,["fileSearch"],n);const s=m(i,["codeExecution"]);if(s!=null&&v(e,["codeExecution"],s),m(i,["enterpriseWebSearch"])!==void 0)throw new Error("enterpriseWebSearch parameter is not supported in Gemini API.");const o=m(i,["functionDeclarations"]);if(o!=null){let p=o;Array.isArray(p)&&(p=p.map(y=>y)),v(e,["functionDeclarations"],p)}const l=m(i,["googleMaps"]);l!=null&&v(e,["googleMaps"],pF(l));const c=m(i,["googleSearch"]);c!=null&&v(e,["googleSearch"],mF(c));const d=m(i,["googleSearchRetrieval"]);d!=null&&v(e,["googleSearchRetrieval"],d);const h=m(i,["urlContext"]);return h!=null&&v(e,["urlContext"],h),e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wF(i){const e=[];for(const t in i)if(Object.prototype.hasOwnProperty.call(i,t)){const n=i[t];if(typeof n=="object"&&n!=null&&Object.keys(n).length>0){const s=Object.keys(n).map(o=>`${t}.${o}`);e.push(...s)}else e.push(t)}return e.join(",")}function xF(i,e){let t=null;const n=i.bidiGenerateContentSetup;if(typeof n=="object"&&n!==null&&"setup"in n){const o=n.setup;typeof o=="object"&&o!==null?(i.bidiGenerateContentSetup=o,t=o):delete i.bidiGenerateContentSetup}else n!==void 0&&delete i.bidiGenerateContentSetup;const s=i.fieldMask;if(t){const o=wF(t);if(Array.isArray(e==null?void 0:e.lockAdditionalFields)&&(e==null?void 0:e.lockAdditionalFields.length)===0)o?i.fieldMask=o:delete i.fieldMask;else if(e!=null&&e.lockAdditionalFields&&e.lockAdditionalFields.length>0&&s!==null&&Array.isArray(s)&&s.length>0){const l=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"];let c=[];s.length>0&&(c=s.map(h=>l.includes(h)?`generationConfig.${h}`:h));const d=[];o&&d.push(o),c.length>0&&d.push(...c),d.length>0?i.fieldMask=d.join(","):delete i.fieldMask}else delete i.fieldMask}else s!==null&&Array.isArray(s)&&s.length>0?i.fieldMask=s.join(","):delete i.fieldMask;return i}class SF extends ro{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("The client.tokens.create method is only supported by the Gemini Developer API.");{const c=dF(this.apiClient,e);o=me("auth_tokens",c._url),l=c._query,delete c.config,delete c._url,delete c._query;const d=xF(c,e.config);return s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(d),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(h=>h.json()),s.then(h=>h)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function EF(i,e){const t={},n=m(i,["force"]);return e!==void 0&&n!=null&&v(e,["_query","force"],n),t}function AF(i){const e={},t=m(i,["name"]);t!=null&&v(e,["_url","name"],t);const n=m(i,["config"]);return n!=null&&EF(n,e),e}function TF(i){const e={},t=m(i,["name"]);return t!=null&&v(e,["_url","name"],t),e}function CF(i,e){const t={},n=m(i,["pageSize"]);e!==void 0&&n!=null&&v(e,["_query","pageSize"],n);const s=m(i,["pageToken"]);return e!==void 0&&s!=null&&v(e,["_query","pageToken"],s),t}function RF(i){const e={},t=m(i,["parent"]);t!=null&&v(e,["_url","parent"],t);const n=m(i,["config"]);return n!=null&&CF(n,e),e}function NF(i){const e={},t=m(i,["sdkHttpResponse"]);t!=null&&v(e,["sdkHttpResponse"],t);const n=m(i,["nextPageToken"]);n!=null&&v(e,["nextPageToken"],n);const s=m(i,["documents"]);if(s!=null){let o=s;Array.isArray(o)&&(o=o.map(l=>l)),v(e,["documents"],o)}return e}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class kF extends ro{constructor(e){super(),this.apiClient=e,this.list=async t=>new Gl(to.PAGED_ITEM_DOCUMENTS,n=>this.listInternal({parent:t.parent,config:n.config}),await this.listInternal(t),t)}async get(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=TF(e);return o=me("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>d)}}async delete(e){var t,n;let s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=AF(e);s=me("{name}",l._url),o=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=RF(e);return o=me("{parent}/documents",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const h=NF(d),p=new nP;return Object.assign(p,h),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class IF extends ro{constructor(e,t=new kF(e)){super(),this.apiClient=e,this.documents=t,this.list=async(n={})=>new Gl(to.PAGED_ITEM_FILE_SEARCH_STORES,s=>this.listInternal(s),await this.listInternal(n),n)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw new Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=b5(e);return o=me("fileSearchStores",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>d)}}async get(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=x5(e);return o=me("{name}",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>d)}}async delete(e){var t,n;let s="",o={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const l=w5(e);s=me("{name}",l._url),o=l._query,delete l._url,delete l._query,await this.apiClient.request({path:s,queryParams:o,body:JSON.stringify(l),httpMethod:"DELETE",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal})}}async listInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=R5(e);return o=me("fileSearchStores",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const h=N5(d),p=new iP;return Object.assign(p,h),p})}}async uploadToFileSearchStoreInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=k5(e);return o=me("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const h=I5(d),p=new sP;return Object.assign(p,h),p})}}async importFile(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=A5(e);return o=me("{file_search_store_name}:importFile",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json()),s.then(d=>{const h=E5(d),p=new uw;return Object.assign(p,h),p})}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */let oR=function(){const{crypto:i}=globalThis;if(i!=null&&i.randomUUID)return oR=i.randomUUID.bind(i),i.randomUUID();const e=new Uint8Array(1),t=i?()=>i.getRandomValues(e)[0]:()=>Math.random()*255&255;return"10000000-1000-4000-8000-100000000000".replace(/[018]/g,n=>(+n^t()&15>>+n/4).toString(16))};const MF=()=>oR();/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function Ub(i){return typeof i=="object"&&i!==null&&("name"in i&&i.name==="AbortError"||"message"in i&&String(i.message).includes("FetchRequestCanceledException"))}const Fb=i=>{if(i instanceof Error)return i;if(typeof i=="object"&&i!==null){try{if(Object.prototype.toString.call(i)==="[object Error]"){const e=new Error(i.message,i.cause?{cause:i.cause}:{});return i.stack&&(e.stack=i.stack),i.cause&&!e.cause&&(e.cause=i.cause),i.name&&(e.name=i.name),e}}catch{}try{return new Error(JSON.stringify(i))}catch{}}return new Error(i)};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class es extends Error{}class Xn extends es{constructor(e,t,n,s){super(`${Xn.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.error=t}static makeMessage(e,t,n){const s=t!=null&&t.message?typeof t.message=="string"?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e||!s)return new y0({message:n,cause:Fb(t)});const o=t;return e===400?new lR(e,o,n,s):e===401?new cR(e,o,n,s):e===403?new uR(e,o,n,s):e===404?new dR(e,o,n,s):e===409?new hR(e,o,n,s):e===422?new fR(e,o,n,s):e===429?new pR(e,o,n,s):e>=500?new mR(e,o,n,s):new Xn(e,o,n,s)}}class Hb extends Xn{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0)}}class y0 extends Xn{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),t&&(this.cause=t)}}class aR extends y0{constructor({message:e}={}){super({message:e??"Request timed out."})}}class lR extends Xn{}class cR extends Xn{}class uR extends Xn{}class dR extends Xn{}class hR extends Xn{}class fR extends Xn{}class pR extends Xn{}class mR extends Xn{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const DF=/^[a-z][a-z0-9+.-]*:/i,LF=i=>DF.test(i);let Bb=i=>(Bb=Array.isArray,Bb(i));const PF=Bb;let OF=PF;const qC=OF;function UF(i){if(!i)return!0;for(const e in i)return!1;return!0}function FF(i,e){return Object.prototype.hasOwnProperty.call(i,e)}const HF=(i,e)=>{if(typeof e!="number"||!Number.isInteger(e))throw new es(`${i} must be an integer`);if(e<0)throw new es(`${i} must be a positive integer`);return e},BF=i=>{try{return JSON.parse(i)}catch{return}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const jF=i=>new Promise(e=>setTimeout(e,i));/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Gc="0.0.1";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function qF(){return typeof Deno<"u"&&Deno.build!=null?"deno":typeof EdgeRuntime<"u"?"edge":Object.prototype.toString.call(typeof globalThis.process<"u"?globalThis.process:0)==="[object process]"?"node":"unknown"}const GF=()=>{var i,e,t,n,s;const o=qF();if(o==="deno")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gc,"X-Stainless-OS":VC(Deno.build.os),"X-Stainless-Arch":GC(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":typeof Deno.version=="string"?Deno.version:(e=(i=Deno.version)===null||i===void 0?void 0:i.deno)!==null&&e!==void 0?e:"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":globalThis.process.version};if(o==="node")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gc,"X-Stainless-OS":VC((t=globalThis.process.platform)!==null&&t!==void 0?t:"unknown"),"X-Stainless-Arch":GC((n=globalThis.process.arch)!==null&&n!==void 0?n:"unknown"),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":(s=globalThis.process.version)!==null&&s!==void 0?s:"unknown"};const l=VF();return l?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${l.browser}`,"X-Stainless-Runtime-Version":l.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Gc,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function VF(){if(typeof navigator>"u"||!navigator)return null;const i=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of i){const n=t.exec(navigator.userAgent);if(n){const s=n[1]||0,o=n[2]||0,l=n[3]||0;return{browser:e,version:`${s}.${o}.${l}`}}}return null}const GC=i=>i==="x32"?"x32":i==="x86_64"||i==="x64"?"x64":i==="arm"?"arm":i==="aarch64"||i==="arm64"?"arm64":i?`other:${i}`:"unknown",VC=i=>(i=i.toLowerCase(),i.includes("ios")?"iOS":i==="android"?"Android":i==="darwin"?"MacOS":i==="win32"?"Windows":i==="freebsd"?"FreeBSD":i==="openbsd"?"OpenBSD":i==="linux"?"Linux":i?`Other:${i}`:"Unknown");let zm;const zF=()=>zm??(zm=GF());/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function $F(){if(typeof fetch<"u")return fetch;throw new Error("`fetch` is not defined as a global; Either pass `fetch` to the client, `new GeminiNextGenAPIClient({ fetch })` or polyfill the global, `globalThis.fetch = fetch`")}function gR(...i){const e=globalThis.ReadableStream;if(typeof e>"u")throw new Error("`ReadableStream` is not defined as a global; You will need to polyfill it, `globalThis.ReadableStream = ReadableStream`");return new e(...i)}function YF(i){let e=Symbol.asyncIterator in i?i[Symbol.asyncIterator]():i[Symbol.iterator]();return gR({start(){},async pull(t){const{done:n,value:s}=await e.next();n?t.close():t.enqueue(s)},async cancel(){var t;await((t=e.return)===null||t===void 0?void 0:t.call(e))}})}function vR(i){if(i[Symbol.asyncIterator])return i;const e=i.getReader();return{async next(){try{const t=await e.read();return t!=null&&t.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}},async return(){const t=e.cancel();return e.releaseLock(),await t,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}async function JF(i){var e,t;if(i===null||typeof i!="object")return;if(i[Symbol.asyncIterator]){await((t=(e=i[Symbol.asyncIterator]()).return)===null||t===void 0?void 0:t.call(e));return}const n=i.getReader(),s=n.cancel();n.releaseLock(),await s}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const KF=({headers:i,body:e})=>({bodyHeaders:{"content-type":"application/json"},body:JSON.stringify(e)});/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const yR=()=>{var i;if(typeof File>"u"){const{process:e}=globalThis,t=typeof((i=e==null?void 0:e.versions)===null||i===void 0?void 0:i.node)=="string"&&parseInt(e.versions.node.split("."))<20;throw new Error("`File` is not defined as a global, which is required for file uploads."+(t?" Update to Node 20 LTS or newer, or set `globalThis.File` to `import('node:buffer').File`.":""))}};function ob(i,e,t){return yR(),new File(i,e??"unknown_file",t)}function WF(i){return(typeof i=="object"&&i!==null&&("name"in i&&i.name&&String(i.name)||"url"in i&&i.url&&String(i.url)||"filename"in i&&i.filename&&String(i.filename)||"path"in i&&i.path&&String(i.path))||"").split(/[\\/]/).pop()||void 0}const XF=i=>i!=null&&typeof i=="object"&&typeof i[Symbol.asyncIterator]=="function";/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const bR=i=>i!=null&&typeof i=="object"&&typeof i.size=="number"&&typeof i.type=="string"&&typeof i.text=="function"&&typeof i.slice=="function"&&typeof i.arrayBuffer=="function",QF=i=>i!=null&&typeof i=="object"&&typeof i.name=="string"&&typeof i.lastModified=="number"&&bR(i),ZF=i=>i!=null&&typeof i=="object"&&typeof i.url=="string"&&typeof i.blob=="function";async function e3(i,e,t){if(yR(),i=await i,QF(i))return i instanceof File?i:ob([await i.arrayBuffer()],i.name);if(ZF(i)){const s=await i.blob();return e||(e=new URL(i.url).pathname.split(/[\\/]/).pop()),ob(await jb(s),e,t)}const n=await jb(i);if(e||(e=WF(i)),!(t!=null&&t.type)){const s=n.find(o=>typeof o=="object"&&"type"in o&&o.type);typeof s=="string"&&(t=Object.assign(Object.assign({},t),{type:s}))}return ob(n,e,t)}async function jb(i){var e,t,n,s,o;let l=[];if(typeof i=="string"||ArrayBuffer.isView(i)||i instanceof ArrayBuffer)l.push(i);else if(bR(i))l.push(i instanceof Blob?i:await i.arrayBuffer());else if(XF(i))try{for(var c=!0,d=Ss(i),h;h=await d.next(),e=h.done,!e;c=!0){s=h.value,c=!1;const p=s;l.push(...await jb(p))}}catch(p){t={error:p}}finally{try{!c&&!e&&(n=d.return)&&await n.call(d)}finally{if(t)throw t.error}}else{const p=(o=i==null?void 0:i.constructor)===null||o===void 0?void 0:o.name;throw new Error(`Unexpected data type: ${typeof i}${p?`; constructor: ${p}`:""}${t3(i)}`)}return l}function t3(i){return typeof i!="object"||i===null?"":`; props: [${Object.getOwnPropertyNames(i).map(t=>`"${t}"`).join(", ")}]`}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class _R{constructor(e){this._client=e}}_R._key=[];/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function wR(i){return i.replace(/[^A-Za-z0-9\-._~!$&'()*+,;=:@]+/g,encodeURIComponent)}const zC=Object.freeze(Object.create(null)),n3=(i=wR)=>(function(t,...n){if(t.length===1)return t[0];let s=!1;const o=[],l=t.reduce((p,y,b)=>{var S,E,R;/[?#]/.test(y)&&(s=!0);const A=n[b];let C=(s?encodeURIComponent:i)(""+A);return b!==n.length&&(A==null||typeof A=="object"&&A.toString===((R=Object.getPrototypeOf((E=Object.getPrototypeOf((S=A.hasOwnProperty)!==null&&S!==void 0?S:zC))!==null&&E!==void 0?E:zC))===null||R===void 0?void 0:R.toString))&&(C=A+"",o.push({start:p.length+y.length,length:C.length,error:`Value of type ${Object.prototype.toString.call(A).slice(8,-1)} is not a valid path parameter`})),p+y+(b===n.length?"":C)},""),c=l.split(/[?#]/,1)[0],d=new RegExp("(?<=^|\\/)(?:\\.|%2e){1,2}(?=\\/|$)","gi");let h;for(;(h=d.exec(c))!==null;)o.push({start:h.index,length:h[0].length,error:`Value "${h[0]}" can't be safely passed as a path parameter`});if(o.sort((p,y)=>p.start-y.start),o.length>0){let p=0;const y=o.reduce((b,S)=>{const E=" ".repeat(S.start-p),R="^".repeat(S.length);return p=S.start+S.length,b+E+R},"");throw new es(`Path parameters result in path with invalid segments:
${o.map(b=>b.error).join(`
`)}
${l}
${y}`)}return l}),$m=n3(wR);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class xR extends _R{create(e,t){var n;const{api_version:s=this._client.apiVersion}=e,o=Ug(e,["api_version"]);if("model"in o&&"agent_config"in o)throw new es("Invalid request: specified `model` and `agent_config`. If specifying `model`, use `generation_config`.");if("agent"in o&&"generation_config"in o)throw new es("Invalid request: specified `agent` and `generation_config`. If specifying `agent`, use `agent_config`.");return this._client.post($m`/${s}/interactions`,Object.assign(Object.assign({body:o},t),{stream:(n=e.stream)!==null&&n!==void 0?n:!1}))}delete(e,t={},n){const{api_version:s=this._client.apiVersion}=t??{};return this._client.delete($m`/${s}/interactions/${e}`,n)}cancel(e,t={},n){const{api_version:s=this._client.apiVersion}=t??{};return this._client.post($m`/${s}/interactions/${e}/cancel`,n)}get(e,t={},n){var s;const o=t??{},{api_version:l=this._client.apiVersion}=o,c=Ug(o,["api_version"]);return this._client.get($m`/${l}/interactions/${e}`,Object.assign(Object.assign({query:c},n),{stream:(s=t==null?void 0:t.stream)!==null&&s!==void 0?s:!1}))}}xR._key=Object.freeze(["interactions"]);class SR extends xR{}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function i3(i){let e=0;for(const s of i)e+=s.length;const t=new Uint8Array(e);let n=0;for(const s of i)t.set(s,n),n+=s.length;return t}let Ym;function vw(i){let e;return(Ym??(e=new globalThis.TextEncoder,Ym=e.encode.bind(e)))(i)}let Jm;function $C(i){let e;return(Jm??(e=new globalThis.TextDecoder,Jm=e.decode.bind(e)))(i)}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class b0{constructor(){this.buffer=new Uint8Array,this.carriageReturnIndex=null}decode(e){if(e==null)return[];const t=e instanceof ArrayBuffer?new Uint8Array(e):typeof e=="string"?vw(e):e;this.buffer=i3([this.buffer,t]);const n=[];let s;for(;(s=s3(this.buffer,this.carriageReturnIndex))!=null;){if(s.carriage&&this.carriageReturnIndex==null){this.carriageReturnIndex=s.index;continue}if(this.carriageReturnIndex!=null&&(s.index!==this.carriageReturnIndex+1||s.carriage)){n.push($C(this.buffer.subarray(0,this.carriageReturnIndex-1))),this.buffer=this.buffer.subarray(this.carriageReturnIndex),this.carriageReturnIndex=null;continue}const o=this.carriageReturnIndex!==null?s.preceding-1:s.preceding,l=$C(this.buffer.subarray(0,o));n.push(l),this.buffer=this.buffer.subarray(s.index),this.carriageReturnIndex=null}return n}flush(){return this.buffer.length?this.decode(`
`):[]}}b0.NEWLINE_CHARS=new Set([`
`,"\r"]);b0.NEWLINE_REGEXP=/\r\n|[\n\r]/g;function s3(i,e){for(let s=e??0;s<i.length;s++){if(i[s]===10)return{preceding:s,index:s+1,carriage:!1};if(i[s]===13)return{preceding:s,index:s+1,carriage:!0}}return null}function r3(i){for(let n=0;n<i.length-1;n++){if(i[n]===10&&i[n+1]===10||i[n]===13&&i[n+1]===13)return n+2;if(i[n]===13&&i[n+1]===10&&n+3<i.length&&i[n+2]===13&&i[n+3]===10)return n+4}return-1}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Fg={off:0,error:200,warn:300,info:400,debug:500},YC=(i,e,t)=>{if(i){if(FF(Fg,i))return i;Yn(t).warn(`${e} was set to ${JSON.stringify(i)}, expected one of ${JSON.stringify(Object.keys(Fg))}`)}};function oh(){}function Km(i,e,t){return!e||Fg[i]>Fg[t]?oh:e[i].bind(e)}const o3={error:oh,warn:oh,info:oh,debug:oh};let JC=new WeakMap;function Yn(i){var e;const t=i.logger,n=(e=i.logLevel)!==null&&e!==void 0?e:"off";if(!t)return o3;const s=JC.get(t);if(s&&s[0]===n)return s[1];const o={error:Km("error",t,n),warn:Km("warn",t,n),info:Km("info",t,n),debug:Km("debug",t,n)};return JC.set(t,[n,o]),o}const La=i=>(i.options&&(i.options=Object.assign({},i.options),delete i.options.headers),i.headers&&(i.headers=Object.fromEntries((i.headers instanceof Headers?[...i.headers]:Object.entries(i.headers)).map(([e,t])=>[e,e.toLowerCase()==="x-goog-api-key"||e.toLowerCase()==="authorization"||e.toLowerCase()==="cookie"||e.toLowerCase()==="set-cookie"?"***":t]))),"retryOfRequestLogID"in i&&(i.retryOfRequestLogID&&(i.retryOf=i.retryOfRequestLogID),delete i.retryOfRequestLogID),i);/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class Qc{constructor(e,t,n){this.iterator=e,this.controller=t,this.client=n}static fromSSEResponse(e,t,n){let s=!1;const o=n?Yn(n):console;function l(){return xs(this,arguments,function*(){var d,h,p,y;if(s)throw new es("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let b=!1;try{try{for(var S=!0,E=Ss(a3(e,t)),R;R=yield Ue(E.next()),d=R.done,!d;S=!0){y=R.value,S=!1;const A=y;if(!b)if(A.data.startsWith("[DONE]")){b=!0;continue}else try{yield yield Ue(JSON.parse(A.data))}catch(C){throw o.error("Could not parse message into JSON:",A.data),o.error("From chunk:",A.raw),C}}}catch(A){h={error:A}}finally{try{!S&&!d&&(p=E.return)&&(yield Ue(p.call(E)))}finally{if(h)throw h.error}}b=!0}catch(A){if(Ub(A))return yield Ue(void 0);throw A}finally{b||t.abort()}})}return new Qc(l,t,n)}static fromReadableStream(e,t,n){let s=!1;function o(){return xs(this,arguments,function*(){var d,h,p,y;const b=new b0,S=vR(e);try{for(var E=!0,R=Ss(S),A;A=yield Ue(R.next()),d=A.done,!d;E=!0){y=A.value,E=!1;const C=y;for(const k of b.decode(C))yield yield Ue(k)}}catch(C){h={error:C}}finally{try{!E&&!d&&(p=R.return)&&(yield Ue(p.call(R)))}finally{if(h)throw h.error}}for(const C of b.flush())yield yield Ue(C)})}function l(){return xs(this,arguments,function*(){var d,h,p,y;if(s)throw new es("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let b=!1;try{try{for(var S=!0,E=Ss(o()),R;R=yield Ue(E.next()),d=R.done,!d;S=!0){y=R.value,S=!1;const A=y;b||A&&(yield yield Ue(JSON.parse(A)))}}catch(A){h={error:A}}finally{try{!S&&!d&&(p=E.return)&&(yield Ue(p.call(E)))}finally{if(h)throw h.error}}b=!0}catch(A){if(Ub(A))return yield Ue(void 0);throw A}finally{b||t.abort()}})}return new Qc(l,t,n)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=o=>({next:()=>{if(o.length===0){const l=n.next();e.push(l),t.push(l)}return o.shift()}});return[new Qc(()=>s(e),this.controller,this.client),new Qc(()=>s(t),this.controller,this.client)]}toReadableStream(){const e=this;let t;return gR({async start(){t=e[Symbol.asyncIterator]()},async pull(n){try{const{value:s,done:o}=await t.next();if(o)return n.close();const l=vw(JSON.stringify(s)+`
`);n.enqueue(l)}catch(s){n.error(s)}},async cancel(){var n;await((n=t.return)===null||n===void 0?void 0:n.call(t))}})}}function a3(i,e){return xs(this,arguments,function*(){var n,s,o,l;if(!i.body)throw e.abort(),typeof globalThis.navigator<"u"&&globalThis.navigator.product==="ReactNative"?new es("The default react-native fetch implementation does not support streaming. Please use expo/fetch: https://docs.expo.dev/versions/latest/sdk/expo/#expofetch-api"):new es("Attempted to iterate over a response with no body");const c=new c3,d=new b0,h=vR(i.body);try{for(var p=!0,y=Ss(l3(h)),b;b=yield Ue(y.next()),n=b.done,!n;p=!0){l=b.value,p=!1;const S=l;for(const E of d.decode(S)){const R=c.decode(E);R&&(yield yield Ue(R))}}}catch(S){s={error:S}}finally{try{!p&&!n&&(o=y.return)&&(yield Ue(o.call(y)))}finally{if(s)throw s.error}}for(const S of d.flush()){const E=c.decode(S);E&&(yield yield Ue(E))}})}function l3(i){return xs(this,arguments,function*(){var t,n,s,o;let l=new Uint8Array;try{for(var c=!0,d=Ss(i),h;h=yield Ue(d.next()),t=h.done,!t;c=!0){o=h.value,c=!1;const p=o;if(p==null)continue;const y=p instanceof ArrayBuffer?new Uint8Array(p):typeof p=="string"?vw(p):p;let b=new Uint8Array(l.length+y.length);b.set(l),b.set(y,l.length),l=b;let S;for(;(S=r3(l))!==-1;)yield yield Ue(l.slice(0,S)),l=l.slice(S)}}catch(p){n={error:p}}finally{try{!c&&!t&&(s=d.return)&&(yield Ue(s.call(d)))}finally{if(n)throw n.error}}l.length>0&&(yield yield Ue(l))})}class c3{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const o={event:this.event,data:this.data.join(`
`),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],o}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=u3(e,":");return s.startsWith(" ")&&(s=s.substring(1)),t==="event"?this.event=s:t==="data"&&this.data.push(s),null}}function u3(i,e){const t=i.indexOf(e);return t!==-1?[i.substring(0,t),e,i.substring(t+e.length)]:[i,"",""]}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */async function d3(i,e){const{response:t,requestLogID:n,retryOfRequestLogID:s,startTime:o}=e,l=await(async()=>{var c;if(e.options.stream)return Yn(i).debug("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller,i):Qc.fromSSEResponse(t,e.controller,i);if(t.status===204)return null;if(e.options.__binaryResponse)return t;const d=t.headers.get("content-type"),h=(c=d==null?void 0:d.split(";")[0])===null||c===void 0?void 0:c.trim();return(h==null?void 0:h.includes("application/json"))||(h==null?void 0:h.endsWith("+json"))?t.headers.get("content-length")==="0"?void 0:await t.json():await t.text()})();return Yn(i).debug(`[${n}] response parsed`,La({retryOfRequestLogID:s,url:t.url,status:t.status,body:l,durationMs:Date.now()-o})),l}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class yw extends Promise{constructor(e,t,n=d3){super(s=>{s(null)}),this.responsePromise=t,this.parseResponse=n,this.client=e}_thenUnwrap(e){return new yw(this.client,this.responsePromise,async(t,n)=>e(await this.parseResponse(t,n),n))}asResponse(){return this.responsePromise.then(e=>e.response)}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(e=>this.parseResponse(this.client,e))),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ER=Symbol("brand.privateNullableHeaders");function*h3(i){if(!i)return;if(ER in i){const{values:n,nulls:s}=i;yield*n.entries();for(const o of s)yield[o,null];return}let e=!1,t;i instanceof Headers?t=i.entries():qC(i)?t=i:(e=!0,t=Object.entries(i??{}));for(let n of t){const s=n[0];if(typeof s!="string")throw new TypeError("expected header name to be a string");const o=qC(n[1])?n[1]:[n[1]];let l=!1;for(const c of o)c!==void 0&&(e&&!l&&(l=!0,yield[s,null]),yield[s,c])}}const th=i=>{const e=new Headers,t=new Set;for(const n of i){const s=new Set;for(const[o,l]of h3(n)){const c=o.toLowerCase();s.has(c)||(e.delete(o),s.add(c)),l===null?(e.delete(o),t.add(c)):(e.append(o,l),t.delete(c))}}return{[ER]:!0,values:e,nulls:t}};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const ab=i=>{var e,t,n,s,o,l;if(typeof globalThis.process<"u")return(n=(t=(e=IL)===null||e===void 0?void 0:e[i])===null||t===void 0?void 0:t.trim())!==null&&n!==void 0?n:void 0;if(typeof globalThis.Deno<"u")return(l=(o=(s=globalThis.Deno.env)===null||s===void 0?void 0:s.get)===null||o===void 0?void 0:o.call(s,i))===null||l===void 0?void 0:l.trim()};/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */var AR;class _0{constructor(e){var t,n,s,o,l,c,d,{baseURL:h=ab("GEMINI_NEXT_GEN_API_BASE_URL"),apiKey:p=(t=ab("GEMINI_API_KEY"))!==null&&t!==void 0?t:null,apiVersion:y="v1beta"}=e,b=Ug(e,["baseURL","apiKey","apiVersion"]);const S=Object.assign(Object.assign({apiKey:p,apiVersion:y},b),{baseURL:h||"https://generativelanguage.googleapis.com"});this.baseURL=S.baseURL,this.timeout=(n=S.timeout)!==null&&n!==void 0?n:_0.DEFAULT_TIMEOUT,this.logger=(s=S.logger)!==null&&s!==void 0?s:console;const E="warn";this.logLevel=E,this.logLevel=(l=(o=YC(S.logLevel,"ClientOptions.logLevel",this))!==null&&o!==void 0?o:YC(ab("GEMINI_NEXT_GEN_API_LOG"),"process.env['GEMINI_NEXT_GEN_API_LOG']",this))!==null&&l!==void 0?l:E,this.fetchOptions=S.fetchOptions,this.maxRetries=(c=S.maxRetries)!==null&&c!==void 0?c:2,this.fetch=(d=S.fetch)!==null&&d!==void 0?d:$F(),this.encoder=KF,this._options=S,this.apiKey=p,this.apiVersion=y,this.clientAdapter=S.clientAdapter}withOptions(e){return new this.constructor(Object.assign(Object.assign(Object.assign({},this._options),{baseURL:this.baseURL,maxRetries:this.maxRetries,timeout:this.timeout,logger:this.logger,logLevel:this.logLevel,fetch:this.fetch,fetchOptions:this.fetchOptions,apiKey:this.apiKey,apiVersion:this.apiVersion}),e))}baseURLOverridden(){return this.baseURL!=="https://generativelanguage.googleapis.com"}defaultQuery(){return this._options.defaultQuery}validateHeaders({values:e,nulls:t}){if(!(e.has("authorization")||e.has("x-goog-api-key"))&&!(this.apiKey&&e.get("x-goog-api-key"))&&!t.has("x-goog-api-key"))throw new Error('Could not resolve authentication method. Expected the apiKey to be set. Or for the "x-goog-api-key" headers to be explicitly omitted')}async authHeaders(e){const t=th([e.headers]);if(!(t.values.has("authorization")||t.values.has("x-goog-api-key"))){if(this.apiKey)return th([{"x-goog-api-key":this.apiKey}]);if(this.clientAdapter.isVertexAI())return th([await this.clientAdapter.getAuthHeaders()])}}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if(typeof n=="string"||typeof n=="number"||typeof n=="boolean")return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(n===null)return`${encodeURIComponent(t)}=`;throw new es(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}getUserAgent(){return`${this.constructor.name}/JS ${Gc}`}defaultIdempotencyKey(){return`stainless-node-retry-${MF()}`}makeStatusError(e,t,n,s){return Xn.generate(e,t,n,s)}buildURL(e,t,n){const s=!this.baseURLOverridden()&&n||this.baseURL,o=LF(e)?new URL(e):new URL(s+(s.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),l=this.defaultQuery();return UF(l)||(t=Object.assign(Object.assign({},l),t)),typeof t=="object"&&t&&!Array.isArray(t)&&(o.search=this.stringifyQuery(t)),o.toString()}async prepareOptions(e){if(this.clientAdapter&&this.clientAdapter.isVertexAI()&&!e.path.startsWith(`/${this.apiVersion}/projects/`)){const t=e.path.slice(this.apiVersion.length+1);e.path=`/${this.apiVersion}/projects/${this.clientAdapter.getProject()}/locations/${this.clientAdapter.getLocation()}${t}`}}async prepareRequest(e,{url:t,options:n}){}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(s=>Object.assign({method:e,path:t},s)))}request(e,t=null){return new yw(this,this.makeRequest(e,t,void 0))}async makeRequest(e,t,n){var s,o,l;const c=await e,d=(s=c.maxRetries)!==null&&s!==void 0?s:this.maxRetries;t==null&&(t=d),await this.prepareOptions(c);const{req:h,url:p,timeout:y}=await this.buildRequest(c,{retryCount:d-t});await this.prepareRequest(h,{url:p,options:c});const b="log_"+(Math.random()*(1<<24)|0).toString(16).padStart(6,"0"),S=n===void 0?"":`, retryOf: ${n}`,E=Date.now();if(Yn(this).debug(`[${b}] sending request`,La({retryOfRequestLogID:n,method:c.method,url:p,options:c,headers:h.headers})),!((o=c.signal)===null||o===void 0)&&o.aborted)throw new Hb;const R=new AbortController,A=await this.fetchWithTimeout(p,h,y,R).catch(Fb),C=Date.now();if(A instanceof globalThis.Error){const I=`retrying, ${t} attempts remaining`;if(!((l=c.signal)===null||l===void 0)&&l.aborted)throw new Hb;const O=Ub(A)||/timed? ?out/i.test(String(A)+("cause"in A?String(A.cause):""));if(t)return Yn(this).info(`[${b}] connection ${O?"timed out":"failed"} - ${I}`),Yn(this).debug(`[${b}] connection ${O?"timed out":"failed"} (${I})`,La({retryOfRequestLogID:n,url:p,durationMs:C-E,message:A.message})),this.retryRequest(c,t,n??b);throw Yn(this).info(`[${b}] connection ${O?"timed out":"failed"} - error; no more retries left`),Yn(this).debug(`[${b}] connection ${O?"timed out":"failed"} (error; no more retries left)`,La({retryOfRequestLogID:n,url:p,durationMs:C-E,message:A.message})),O?new aR:new y0({cause:A})}const k=`[${b}${S}] ${h.method} ${p} ${A.ok?"succeeded":"failed"} with status ${A.status} in ${C-E}ms`;if(!A.ok){const I=await this.shouldRetry(A);if(t&&I){const K=`retrying, ${t} attempts remaining`;return await JF(A.body),Yn(this).info(`${k} - ${K}`),Yn(this).debug(`[${b}] response error (${K})`,La({retryOfRequestLogID:n,url:A.url,status:A.status,headers:A.headers,durationMs:C-E})),this.retryRequest(c,t,n??b,A.headers)}const O=I?"error; no more retries left":"error; not retryable";Yn(this).info(`${k} - ${O}`);const U=await A.text().catch(K=>Fb(K).message),P=BF(U),B=P?void 0:U;throw Yn(this).debug(`[${b}] response error (${O})`,La({retryOfRequestLogID:n,url:A.url,status:A.status,headers:A.headers,message:B,durationMs:Date.now()-E})),this.makeStatusError(A.status,P,B,A.headers)}return Yn(this).info(k),Yn(this).debug(`[${b}] response start`,La({retryOfRequestLogID:n,url:A.url,status:A.status,headers:A.headers,durationMs:C-E})),{response:A,options:c,controller:R,requestLogID:b,retryOfRequestLogID:n,startTime:E}}async fetchWithTimeout(e,t,n,s){const o=t||{},{signal:l,method:c}=o,d=Ug(o,["signal","method"]),h=this._makeAbort(s);l&&l.addEventListener("abort",h,{once:!0});const p=setTimeout(h,n),y=globalThis.ReadableStream&&d.body instanceof globalThis.ReadableStream||typeof d.body=="object"&&d.body!==null&&Symbol.asyncIterator in d.body,b=Object.assign(Object.assign(Object.assign({signal:s.signal},y?{duplex:"half"}:{}),{method:"GET"}),d);c&&(b.method=c.toUpperCase());try{return await this.fetch.call(void 0,e,b)}finally{clearTimeout(p)}}async shouldRetry(e){const t=e.headers.get("x-should-retry");return t==="true"?!0:t==="false"?!1:e.status===408||e.status===409||e.status===429||e.status>=500}async retryRequest(e,t,n,s){var o;let l;const c=s==null?void 0:s.get("retry-after-ms");if(c){const h=parseFloat(c);Number.isNaN(h)||(l=h)}const d=s==null?void 0:s.get("retry-after");if(d&&!l){const h=parseFloat(d);Number.isNaN(h)?l=Date.parse(d)-Date.now():l=h*1e3}if(!(l&&0<=l&&l<60*1e3)){const h=(o=e.maxRetries)!==null&&o!==void 0?o:this.maxRetries;l=this.calculateDefaultRetryTimeoutMillis(t,h)}return await jF(l),this.makeRequest(e,t-1,n)}calculateDefaultRetryTimeoutMillis(e,t){const o=t-e,l=Math.min(.5*Math.pow(2,o),8),c=1-Math.random()*.25;return l*c*1e3}async buildRequest(e,{retryCount:t=0}={}){var n,s,o;const l=Object.assign({},e),{method:c,path:d,query:h,defaultBaseURL:p}=l,y=this.buildURL(d,h,p);"timeout"in l&&HF("timeout",l.timeout),l.timeout=(n=l.timeout)!==null&&n!==void 0?n:this.timeout;const{bodyHeaders:b,body:S}=this.buildBody({options:l}),E=await this.buildHeaders({options:e,method:c,bodyHeaders:b,retryCount:t});return{req:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({method:c,headers:E},l.signal&&{signal:l.signal}),globalThis.ReadableStream&&S instanceof globalThis.ReadableStream&&{duplex:"half"}),S&&{body:S}),(s=this.fetchOptions)!==null&&s!==void 0?s:{}),(o=l.fetchOptions)!==null&&o!==void 0?o:{}),url:y,timeout:l.timeout}}async buildHeaders({options:e,method:t,bodyHeaders:n,retryCount:s}){let o={};this.idempotencyHeader&&t!=="get"&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey);const l=await this.authHeaders(e);let c=th([o,Object.assign(Object.assign({Accept:"application/json","User-Agent":this.getUserAgent(),"X-Stainless-Retry-Count":String(s)},e.timeout?{"X-Stainless-Timeout":String(Math.trunc(e.timeout/1e3))}:{}),zF()),this._options.defaultHeaders,n,e.headers,l]);return this.validateHeaders(c),c.values}_makeAbort(e){return()=>e.abort()}buildBody({options:{body:e,headers:t}}){if(!e)return{bodyHeaders:void 0,body:void 0};const n=th([t]);return ArrayBuffer.isView(e)||e instanceof ArrayBuffer||e instanceof DataView||typeof e=="string"&&n.values.has("content-type")||globalThis.Blob&&e instanceof globalThis.Blob||e instanceof FormData||e instanceof URLSearchParams||globalThis.ReadableStream&&e instanceof globalThis.ReadableStream?{bodyHeaders:void 0,body:e}:typeof e=="object"&&(Symbol.asyncIterator in e||Symbol.iterator in e&&"next"in e&&typeof e.next=="function")?{bodyHeaders:void 0,body:YF(e)}:typeof e=="object"&&n.values.get("content-type")==="application/x-www-form-urlencoded"?{bodyHeaders:{"content-type":"application/x-www-form-urlencoded"},body:this.stringifyQuery(e)}:this.encoder({body:e,headers:n})}}_0.DEFAULT_TIMEOUT=6e4;class mn extends _0{constructor(){super(...arguments),this.interactions=new SR(this)}}AR=mn;mn.GeminiNextGenAPIClient=AR;mn.GeminiNextGenAPIClientError=es;mn.APIError=Xn;mn.APIConnectionError=y0;mn.APIConnectionTimeoutError=aR;mn.APIUserAbortError=Hb;mn.NotFoundError=dR;mn.ConflictError=hR;mn.RateLimitError=pR;mn.BadRequestError=lR;mn.AuthenticationError=cR;mn.InternalServerError=mR;mn.PermissionDeniedError=uR;mn.UnprocessableEntityError=fR;mn.toFile=e3;mn.Interactions=SR;/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */function f3(i,e){const t={},n=m(i,["name"]);return n!=null&&v(t,["_url","name"],n),t}function p3(i,e){const t={},n=m(i,["name"]);return n!=null&&v(t,["_url","name"],n),t}function m3(i,e){const t={},n=m(i,["sdkHttpResponse"]);return n!=null&&v(t,["sdkHttpResponse"],n),t}function g3(i,e){const t={},n=m(i,["sdkHttpResponse"]);return n!=null&&v(t,["sdkHttpResponse"],n),t}function v3(i,e,t){const n={};if(m(i,["validationDataset"])!==void 0)throw new Error("validationDataset parameter is not supported in Gemini API.");const s=m(i,["tunedModelDisplayName"]);if(e!==void 0&&s!=null&&v(e,["displayName"],s),m(i,["description"])!==void 0)throw new Error("description parameter is not supported in Gemini API.");const o=m(i,["epochCount"]);e!==void 0&&o!=null&&v(e,["tuningTask","hyperparameters","epochCount"],o);const l=m(i,["learningRateMultiplier"]);if(l!=null&&v(n,["tuningTask","hyperparameters","learningRateMultiplier"],l),m(i,["exportLastCheckpointOnly"])!==void 0)throw new Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(m(i,["preTunedModelCheckpointId"])!==void 0)throw new Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(m(i,["adapterSize"])!==void 0)throw new Error("adapterSize parameter is not supported in Gemini API.");if(m(i,["tuningMode"])!==void 0)throw new Error("tuningMode parameter is not supported in Gemini API.");if(m(i,["customBaseModel"])!==void 0)throw new Error("customBaseModel parameter is not supported in Gemini API.");const c=m(i,["batchSize"]);e!==void 0&&c!=null&&v(e,["tuningTask","hyperparameters","batchSize"],c);const d=m(i,["learningRate"]);if(e!==void 0&&d!=null&&v(e,["tuningTask","hyperparameters","learningRate"],d),m(i,["labels"])!==void 0)throw new Error("labels parameter is not supported in Gemini API.");if(m(i,["beta"])!==void 0)throw new Error("beta parameter is not supported in Gemini API.");if(m(i,["baseTeacherModel"])!==void 0)throw new Error("baseTeacherModel parameter is not supported in Gemini API.");if(m(i,["tunedTeacherModelSource"])!==void 0)throw new Error("tunedTeacherModelSource parameter is not supported in Gemini API.");if(m(i,["sftLossWeightMultiplier"])!==void 0)throw new Error("sftLossWeightMultiplier parameter is not supported in Gemini API.");if(m(i,["outputUri"])!==void 0)throw new Error("outputUri parameter is not supported in Gemini API.");if(m(i,["encryptionSpec"])!==void 0)throw new Error("encryptionSpec parameter is not supported in Gemini API.");return n}function y3(i,e,t){const n={};let s=m(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const P=m(i,["validationDataset"]);e!==void 0&&P!=null&&v(e,["supervisedTuningSpec"],lb(P))}else if(s==="PREFERENCE_TUNING"){const P=m(i,["validationDataset"]);e!==void 0&&P!=null&&v(e,["preferenceOptimizationSpec"],lb(P))}else if(s==="DISTILLATION"){const P=m(i,["validationDataset"]);e!==void 0&&P!=null&&v(e,["distillationSpec"],lb(P))}const o=m(i,["tunedModelDisplayName"]);e!==void 0&&o!=null&&v(e,["tunedModelDisplayName"],o);const l=m(i,["description"]);e!==void 0&&l!=null&&v(e,["description"],l);let c=m(t,["config","method"]);if(c===void 0&&(c="SUPERVISED_FINE_TUNING"),c==="SUPERVISED_FINE_TUNING"){const P=m(i,["epochCount"]);e!==void 0&&P!=null&&v(e,["supervisedTuningSpec","hyperParameters","epochCount"],P)}else if(c==="PREFERENCE_TUNING"){const P=m(i,["epochCount"]);e!==void 0&&P!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","epochCount"],P)}else if(c==="DISTILLATION"){const P=m(i,["epochCount"]);e!==void 0&&P!=null&&v(e,["distillationSpec","hyperParameters","epochCount"],P)}let d=m(t,["config","method"]);if(d===void 0&&(d="SUPERVISED_FINE_TUNING"),d==="SUPERVISED_FINE_TUNING"){const P=m(i,["learningRateMultiplier"]);e!==void 0&&P!=null&&v(e,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],P)}else if(d==="PREFERENCE_TUNING"){const P=m(i,["learningRateMultiplier"]);e!==void 0&&P!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],P)}else if(d==="DISTILLATION"){const P=m(i,["learningRateMultiplier"]);e!==void 0&&P!=null&&v(e,["distillationSpec","hyperParameters","learningRateMultiplier"],P)}let h=m(t,["config","method"]);if(h===void 0&&(h="SUPERVISED_FINE_TUNING"),h==="SUPERVISED_FINE_TUNING"){const P=m(i,["exportLastCheckpointOnly"]);e!==void 0&&P!=null&&v(e,["supervisedTuningSpec","exportLastCheckpointOnly"],P)}else if(h==="PREFERENCE_TUNING"){const P=m(i,["exportLastCheckpointOnly"]);e!==void 0&&P!=null&&v(e,["preferenceOptimizationSpec","exportLastCheckpointOnly"],P)}else if(h==="DISTILLATION"){const P=m(i,["exportLastCheckpointOnly"]);e!==void 0&&P!=null&&v(e,["distillationSpec","exportLastCheckpointOnly"],P)}let p=m(t,["config","method"]);if(p===void 0&&(p="SUPERVISED_FINE_TUNING"),p==="SUPERVISED_FINE_TUNING"){const P=m(i,["adapterSize"]);e!==void 0&&P!=null&&v(e,["supervisedTuningSpec","hyperParameters","adapterSize"],P)}else if(p==="PREFERENCE_TUNING"){const P=m(i,["adapterSize"]);e!==void 0&&P!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","adapterSize"],P)}else if(p==="DISTILLATION"){const P=m(i,["adapterSize"]);e!==void 0&&P!=null&&v(e,["distillationSpec","hyperParameters","adapterSize"],P)}let y=m(t,["config","method"]);if(y===void 0&&(y="SUPERVISED_FINE_TUNING"),y==="SUPERVISED_FINE_TUNING"){const P=m(i,["tuningMode"]);e!==void 0&&P!=null&&v(e,["supervisedTuningSpec","tuningMode"],P)}const b=m(i,["customBaseModel"]);e!==void 0&&b!=null&&v(e,["customBaseModel"],b);let S=m(t,["config","method"]);if(S===void 0&&(S="SUPERVISED_FINE_TUNING"),S==="SUPERVISED_FINE_TUNING"){const P=m(i,["batchSize"]);e!==void 0&&P!=null&&v(e,["supervisedTuningSpec","hyperParameters","batchSize"],P)}let E=m(t,["config","method"]);if(E===void 0&&(E="SUPERVISED_FINE_TUNING"),E==="SUPERVISED_FINE_TUNING"){const P=m(i,["learningRate"]);e!==void 0&&P!=null&&v(e,["supervisedTuningSpec","hyperParameters","learningRate"],P)}const R=m(i,["labels"]);e!==void 0&&R!=null&&v(e,["labels"],R);const A=m(i,["beta"]);e!==void 0&&A!=null&&v(e,["preferenceOptimizationSpec","hyperParameters","beta"],A);const C=m(i,["baseTeacherModel"]);e!==void 0&&C!=null&&v(e,["distillationSpec","baseTeacherModel"],C);const k=m(i,["tunedTeacherModelSource"]);e!==void 0&&k!=null&&v(e,["distillationSpec","tunedTeacherModelSource"],k);const I=m(i,["sftLossWeightMultiplier"]);e!==void 0&&I!=null&&v(e,["distillationSpec","hyperParameters","sftLossWeightMultiplier"],I);const O=m(i,["outputUri"]);e!==void 0&&O!=null&&v(e,["outputUri"],O);const U=m(i,["encryptionSpec"]);return e!==void 0&&U!=null&&v(e,["encryptionSpec"],U),n}function b3(i,e){const t={},n=m(i,["baseModel"]);n!=null&&v(t,["baseModel"],n);const s=m(i,["preTunedModel"]);s!=null&&v(t,["preTunedModel"],s);const o=m(i,["trainingDataset"]);o!=null&&k3(o);const l=m(i,["config"]);return l!=null&&v3(l,t),t}function _3(i,e){const t={},n=m(i,["baseModel"]);n!=null&&v(t,["baseModel"],n);const s=m(i,["preTunedModel"]);s!=null&&v(t,["preTunedModel"],s);const o=m(i,["trainingDataset"]);o!=null&&I3(o,t,e);const l=m(i,["config"]);return l!=null&&y3(l,t,e),t}function w3(i,e){const t={},n=m(i,["name"]);return n!=null&&v(t,["_url","name"],n),t}function x3(i,e){const t={},n=m(i,["name"]);return n!=null&&v(t,["_url","name"],n),t}function S3(i,e,t){const n={},s=m(i,["pageSize"]);e!==void 0&&s!=null&&v(e,["_query","pageSize"],s);const o=m(i,["pageToken"]);e!==void 0&&o!=null&&v(e,["_query","pageToken"],o);const l=m(i,["filter"]);return e!==void 0&&l!=null&&v(e,["_query","filter"],l),n}function E3(i,e,t){const n={},s=m(i,["pageSize"]);e!==void 0&&s!=null&&v(e,["_query","pageSize"],s);const o=m(i,["pageToken"]);e!==void 0&&o!=null&&v(e,["_query","pageToken"],o);const l=m(i,["filter"]);return e!==void 0&&l!=null&&v(e,["_query","filter"],l),n}function A3(i,e){const t={},n=m(i,["config"]);return n!=null&&S3(n,t),t}function T3(i,e){const t={},n=m(i,["config"]);return n!=null&&E3(n,t),t}function C3(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["nextPageToken"]);s!=null&&v(t,["nextPageToken"],s);const o=m(i,["tunedModels"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(c=>TR(c))),v(t,["tuningJobs"],l)}return t}function R3(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["nextPageToken"]);s!=null&&v(t,["nextPageToken"],s);const o=m(i,["tuningJobs"]);if(o!=null){let l=o;Array.isArray(l)&&(l=l.map(c=>qb(c))),v(t,["tuningJobs"],l)}return t}function N3(i,e){const t={},n=m(i,["name"]);n!=null&&v(t,["model"],n);const s=m(i,["name"]);return s!=null&&v(t,["endpoint"],s),t}function k3(i,e){const t={};if(m(i,["gcsUri"])!==void 0)throw new Error("gcsUri parameter is not supported in Gemini API.");if(m(i,["vertexDatasetResource"])!==void 0)throw new Error("vertexDatasetResource parameter is not supported in Gemini API.");const n=m(i,["examples"]);if(n!=null){let s=n;Array.isArray(s)&&(s=s.map(o=>o)),v(t,["examples","examples"],s)}return t}function I3(i,e,t){const n={};let s=m(t,["config","method"]);if(s===void 0&&(s="SUPERVISED_FINE_TUNING"),s==="SUPERVISED_FINE_TUNING"){const l=m(i,["gcsUri"]);e!==void 0&&l!=null&&v(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(s==="PREFERENCE_TUNING"){const l=m(i,["gcsUri"]);e!==void 0&&l!=null&&v(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}else if(s==="DISTILLATION"){const l=m(i,["gcsUri"]);e!==void 0&&l!=null&&v(e,["distillationSpec","promptDatasetUri"],l)}let o=m(t,["config","method"]);if(o===void 0&&(o="SUPERVISED_FINE_TUNING"),o==="SUPERVISED_FINE_TUNING"){const l=m(i,["vertexDatasetResource"]);e!==void 0&&l!=null&&v(e,["supervisedTuningSpec","trainingDatasetUri"],l)}else if(o==="PREFERENCE_TUNING"){const l=m(i,["vertexDatasetResource"]);e!==void 0&&l!=null&&v(e,["preferenceOptimizationSpec","trainingDatasetUri"],l)}else if(o==="DISTILLATION"){const l=m(i,["vertexDatasetResource"]);e!==void 0&&l!=null&&v(e,["distillationSpec","promptDatasetUri"],l)}if(m(i,["examples"])!==void 0)throw new Error("examples parameter is not supported in Vertex AI.");return n}function TR(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["name"]);s!=null&&v(t,["name"],s);const o=m(i,["state"]);o!=null&&v(t,["state"],q1(o));const l=m(i,["createTime"]);l!=null&&v(t,["createTime"],l);const c=m(i,["tuningTask","startTime"]);c!=null&&v(t,["startTime"],c);const d=m(i,["tuningTask","completeTime"]);d!=null&&v(t,["endTime"],d);const h=m(i,["updateTime"]);h!=null&&v(t,["updateTime"],h);const p=m(i,["description"]);p!=null&&v(t,["description"],p);const y=m(i,["baseModel"]);y!=null&&v(t,["baseModel"],y);const b=m(i,["_self"]);return b!=null&&v(t,["tunedModel"],N3(b)),t}function qb(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["name"]);s!=null&&v(t,["name"],s);const o=m(i,["state"]);o!=null&&v(t,["state"],q1(o));const l=m(i,["createTime"]);l!=null&&v(t,["createTime"],l);const c=m(i,["startTime"]);c!=null&&v(t,["startTime"],c);const d=m(i,["endTime"]);d!=null&&v(t,["endTime"],d);const h=m(i,["updateTime"]);h!=null&&v(t,["updateTime"],h);const p=m(i,["error"]);p!=null&&v(t,["error"],p);const y=m(i,["description"]);y!=null&&v(t,["description"],y);const b=m(i,["baseModel"]);b!=null&&v(t,["baseModel"],b);const S=m(i,["tunedModel"]);S!=null&&v(t,["tunedModel"],S);const E=m(i,["preTunedModel"]);E!=null&&v(t,["preTunedModel"],E);const R=m(i,["supervisedTuningSpec"]);R!=null&&v(t,["supervisedTuningSpec"],R);const A=m(i,["preferenceOptimizationSpec"]);A!=null&&v(t,["preferenceOptimizationSpec"],A);const C=m(i,["distillationSpec"]);C!=null&&v(t,["distillationSpec"],C);const k=m(i,["tuningDataStats"]);k!=null&&v(t,["tuningDataStats"],k);const I=m(i,["encryptionSpec"]);I!=null&&v(t,["encryptionSpec"],I);const O=m(i,["partnerModelTuningSpec"]);O!=null&&v(t,["partnerModelTuningSpec"],O);const U=m(i,["customBaseModel"]);U!=null&&v(t,["customBaseModel"],U);const P=m(i,["experiment"]);P!=null&&v(t,["experiment"],P);const B=m(i,["labels"]);B!=null&&v(t,["labels"],B);const Q=m(i,["outputUri"]);Q!=null&&v(t,["outputUri"],Q);const K=m(i,["pipelineJob"]);K!=null&&v(t,["pipelineJob"],K);const le=m(i,["serviceAccount"]);le!=null&&v(t,["serviceAccount"],le);const de=m(i,["tunedModelDisplayName"]);de!=null&&v(t,["tunedModelDisplayName"],de);const G=m(i,["veoTuningSpec"]);return G!=null&&v(t,["veoTuningSpec"],G),t}function M3(i,e){const t={},n=m(i,["sdkHttpResponse"]);n!=null&&v(t,["sdkHttpResponse"],n);const s=m(i,["name"]);s!=null&&v(t,["name"],s);const o=m(i,["metadata"]);o!=null&&v(t,["metadata"],o);const l=m(i,["done"]);l!=null&&v(t,["done"],l);const c=m(i,["error"]);return c!=null&&v(t,["error"],c),t}function lb(i,e){const t={},n=m(i,["gcsUri"]);n!=null&&v(t,["validationDatasetUri"],n);const s=m(i,["vertexDatasetResource"]);return s!=null&&v(t,["validationDatasetUri"],s),t}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class D3 extends ro{constructor(e){super(),this.apiClient=e,this.list=async(t={})=>new Gl(to.PAGED_ITEM_TUNING_JOBS,n=>this.listInternal(n),await this.listInternal(t),t),this.get=async t=>await this.getInternal(t),this.tune=async t=>{var n;if(this.apiClient.isVertexAI())if(t.baseModel.startsWith("projects/")){const s={tunedModelName:t.baseModel};!((n=t.config)===null||n===void 0)&&n.preTunedModelCheckpointId&&(s.checkpointId=t.config.preTunedModelCheckpointId);const o=Object.assign(Object.assign({},t),{preTunedModel:s});return o.baseModel=void 0,await this.tuneInternal(o)}else{const s=Object.assign({},t);return await this.tuneInternal(s)}else{const s=Object.assign({},t),o=await this.tuneMldevInternal(s);let l="";return o.metadata!==void 0&&o.metadata.tunedModel!==void 0?l=o.metadata.tunedModel:o.name!==void 0&&o.name.includes("/operations/")&&(l=o.name.split("/operations/")[0]),{name:l,state:Nb.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=x3(e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>qb(p))}else{const h=w3(e);return c=me("{name}",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>TR(p))}}async listInternal(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=T3(e);return c=me("tuningJobs",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=R3(p),b=new wC;return Object.assign(b,y),b})}else{const h=A3(e);return c=me("tunedModels",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"GET",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=C3(p),b=new wC;return Object.assign(b,y),b})}}async cancel(e){var t,n,s,o;let l,c="",d={};if(this.apiClient.isVertexAI()){const h=p3(e);return c=me("{name}:cancel",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=g3(p),b=new xC;return Object.assign(b,y),b})}else{const h=f3(e);return c=me("{name}:cancel",h._url),d=h._query,delete h._url,delete h._query,l=this.apiClient.request({path:c,queryParams:d,body:JSON.stringify(h),httpMethod:"POST",httpOptions:(s=e.config)===null||s===void 0?void 0:s.httpOptions,abortSignal:(o=e.config)===null||o===void 0?void 0:o.abortSignal}).then(p=>p.json().then(y=>{const b=y;return b.sdkHttpResponse={headers:p.headers},b})),l.then(p=>{const y=m3(p),b=new xC;return Object.assign(b,y),b})}}async tuneInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI()){const c=_3(e,e);return o=me("tuningJobs",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),s.then(d=>qb(d))}else throw new Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let s,o="",l={};if(this.apiClient.isVertexAI())throw new Error("This method is only supported by the Gemini Developer API.");{const c=b3(e);return o=me("tunedModels",c._url),l=c._query,delete c._url,delete c._query,s=this.apiClient.request({path:o,queryParams:l,body:JSON.stringify(c),httpMethod:"POST",httpOptions:(t=e.config)===null||t===void 0?void 0:t.httpOptions,abortSignal:(n=e.config)===null||n===void 0?void 0:n.abortSignal}).then(d=>d.json().then(h=>{const p=h;return p.sdkHttpResponse={headers:d.headers},p})),s.then(d=>M3(d))}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class L3{async download(e,t){throw new Error("Download to file is not supported in the browser, please use a browser compliant download like an <a> tag.")}}const P3=1024*1024*8,O3=3,U3=1e3,F3=2,Hg="x-goog-upload-status";async function H3(i,e,t){var n;const s=await CR(i,e,t),o=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Hg])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");return o.file}async function B3(i,e,t){var n;const s=await CR(i,e,t),o=await(s==null?void 0:s.json());if(((n=s==null?void 0:s.headers)===null||n===void 0?void 0:n[Hg])!=="final")throw new Error("Failed to upload file: Upload status is not finalized.");const l=O1(o),c=new dw;return Object.assign(c,l),c}async function CR(i,e,t){var n,s;let o=0,l=0,c=new Ib(new Response),d="upload";for(o=i.size;l<o;){const h=Math.min(P3,o-l),p=i.slice(l,l+h);l+h>=o&&(d+=", finalize");let y=0,b=U3;for(;y<O3&&(c=await t.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:e,headers:{"X-Goog-Upload-Command":d,"X-Goog-Upload-Offset":String(l),"Content-Length":String(h)}}}),!(!((n=c==null?void 0:c.headers)===null||n===void 0)&&n[Hg]));)y++,await q3(b),b=b*F3;if(l+=h,((s=c==null?void 0:c.headers)===null||s===void 0?void 0:s[Hg])!=="active")break;if(o<=l)throw new Error("All content has been uploaded, but the upload status is not finalized.")}return c}async function j3(i){return{size:i.size,type:i.type}}function q3(i){return new Promise(e=>setTimeout(e,i))}class G3{async upload(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await H3(e,t,n)}async uploadToFileSearchStore(e,t,n){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await B3(e,t,n)}async stat(e){if(typeof e=="string")throw new Error("File path is not supported in browser uploader.");return await j3(e)}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */class V3{create(e,t,n){return new z3(e,t,n)}}class z3{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new WebSocket(this.url),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.send(e)}close(){if(this.ws===void 0)throw new Error("WebSocket is not connected");this.ws.close()}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const KC="x-goog-api-key";class $3{constructor(e){this.apiKey=e}async addAuthHeaders(e,t){if(e.get(KC)===null){if(this.apiKey.startsWith("auth_tokens/"))throw new Error("Ephemeral tokens are only supported by the live API.");if(!this.apiKey)throw new Error("API key is missing. Please provide a valid API key.");e.append(KC,this.apiKey)}}}/**
 * @license
 * Copyright 2025 Google LLC
 * SPDX-License-Identifier: Apache-2.0
 */const Y3="gl-node/";class J3{get interactions(){var e;if(this._interactions!==void 0)return this._interactions;console.warn("GoogleGenAI.interactions: Interactions usage is experimental and may change in future versions.");const t=this.httpOptions;t!=null&&t.extraBody&&console.warn("GoogleGenAI.interactions: Client level httpOptions.extraBody is not supported by the interactions client and will be ignored.");const n=new mn({baseURL:this.apiClient.getBaseUrl(),apiKey:this.apiKey,apiVersion:this.apiClient.getApiVersion(),clientAdapter:this.apiClient,defaultHeaders:this.apiClient.getDefaultHeaders(),timeout:t==null?void 0:t.timeout,maxRetries:(e=t==null?void 0:t.retryOptions)===null||e===void 0?void 0:e.attempts});return this._interactions=n.interactions,this._interactions}constructor(e){var t;if(e.apiKey==null)throw new Error("An API Key must be set when running in a browser");if(e.project||e.location)throw new Error("Vertex AI project based authentication is not supported on browser runtimes. Please do not provide a project or location.");this.vertexai=(t=e.vertexai)!==null&&t!==void 0?t:!1,this.apiKey=e.apiKey;const n=PL(e.httpOptions,e.vertexai,void 0,void 0);n&&(e.httpOptions?e.httpOptions.baseUrl=n:e.httpOptions={baseUrl:n}),this.apiVersion=e.apiVersion,this.httpOptions=e.httpOptions;const s=new $3(this.apiKey);this.apiClient=new j5({auth:s,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:this.httpOptions,userAgentExtra:Y3+"web",uploader:new G3,downloader:new L3}),this.models=new oF(this.apiClient),this.live=new eF(this.apiClient,s,new V3),this.batches=new hO(this.apiClient),this.chats=new YO(this.models,this.apiClient),this.caches=new VO(this.apiClient),this.files=new rU(this.apiClient),this.operations=new aF(this.apiClient),this.authTokens=new SF(this.apiClient),this.tunings=new D3(this.apiClient),this.fileSearchStores=new IF(this.apiClient)}}const K3=async i=>{var n;const e=gp("API_KEY");if(!e||e==="undefined")throw new Error("API_KEY_MISSING: Please connect your Gemini API key using the button in the dashboard.");const t=new J3({apiKey:e});try{const s=typeof i!="string",o=`Extract structured locate ticket metadata from the provided ${s?"document":"text"}.
    
    LOCATE TICKET ANALYSIS RULES:
    1. TICKET NUMBER: Look for "Ticket:", "Ticket No:", "Tkt #", or similar.
    2. JOB NUMBER: Look for "Job:", "Job #", "Project:", or "Reference".
    3. ADDRESS: Extract the primary "Street" and "Cross Street" (Intersection).
    4. LOCATION: Identify "City", "State", "County", and "Place/Township".
    5. DATES: Extract "Work Start Date" (or "Legal Date") and "Expiration Date". 
       - Convert all dates to YYYY-MM-DD format.
    6. CUSTOMER: Identify the client or contractor (labels: "Done For", "Contractor", "Customer").
    7. SITE CONTACT: Identify the person to contact on site.
    
    If a field is missing or illegible, return null for that field.
    Return a clean JSON object according to the requested schema.`,l=s?[{inlineData:{data:i.data,mimeType:i.mimeType}},{text:o}]:[{text:o}],d=(await t.models.generateContent({model:"gemini-3-flash-preview",contents:{parts:l},config:{systemInstruction:"You are a professional construction document analyzer. Convert locate tickets into precise JSON data. If a field is illegible, leave it blank. Never hallucinate ticket numbers.",responseMimeType:"application/json",responseSchema:{type:Ft.OBJECT,properties:{jobNumber:{type:Ft.STRING},ticketNo:{type:Ft.STRING},street:{type:Ft.STRING},crossStreet:{type:Ft.STRING},place:{type:Ft.STRING},extent:{type:Ft.STRING},county:{type:Ft.STRING},city:{type:Ft.STRING},state:{type:Ft.STRING},callInDate:{type:Ft.STRING},workDate:{type:Ft.STRING},expires:{type:Ft.STRING},siteContact:{type:Ft.STRING}}},temperature:0}})).text;if(!d)throw new Error("The AI returned an empty response. Please try a clearer image or document.");const h=d.trim(),p=h.replace(/^```json\n?/,"").replace(/\n?```$/,"");try{const y=JSON.parse(p);if(!y.ticketNo&&!y.street)throw new Error("Could not identify key ticket information. Please ensure the ticket number and address are visible.");return y}catch(y){throw console.error("Gemini returned malformed response:",h),new Error(y.message.includes("Could not identify")?y.message:"Analysis failed: The AI response was malformed. Please ensure the image is clear.")}}catch(s){console.error("[Gemini] OCR Extraction Failure:",s);const o=((n=s.message)==null?void 0:n.toLowerCase())||"";throw o.includes("403")||o.includes("404")||o.includes("entity was not found")||o.includes("permission")?new Error("ACCESS_DENIED: Your current project does not have permission for the Gemini 3 model. Ensure billing is enabled in the Google Cloud Console."):new Error(s.message||"AI Analysis failed. Check your internet connection or API project status.")}},WC=i=>i?i.replace(/\//g,"-").split("-").map(e=>e.trim().padStart(2,"0")).join("-"):"",W3=i=>{var t;if(i.type)return i.type;switch((t=i.name.split(".").pop())==null?void 0:t.toLowerCase()){case"pdf":return"application/pdf";case"jpg":case"jpeg":return"image/jpeg";case"png":return"image/png";default:return"application/octet-stream"}},X3=({onSave:i,onClose:e,initialData:t,isDarkMode:n,existingTickets:s})=>{const[o,l]=ee.useState(!1),[c,d]=ee.useState(!1),[h,p]=ee.useState(!1),[y,b]=ee.useState({jobNumber:"",ticketNo:"",street:"",crossStreet:"",place:"",extent:"",county:"",city:"",state:"",callInDate:"",workDate:"",expires:"",siteContact:"",documentUrl:""}),[S,E]=ee.useState([]),[R,A]=ee.useState(0),[C,k]=ee.useState(!1),I=ee.useRef(null);ee.useEffect(()=>{const G=()=>{const ce=gp("API_KEY");p(ce.length>20&&ce!=="undefined")};G();const fe=setInterval(G,2e3);return()=>clearInterval(fe)},[]),ee.useEffect(()=>{t&&(b({jobNumber:t.jobNumber,ticketNo:t.ticketNo,street:t.street,crossStreet:t.crossStreet||"",place:t.place||"",extent:t.extent||"",county:t.county,city:t.city,state:t.state,callInDate:t.callInDate,workDate:t.workDate,expires:t.expires,siteContact:t.siteContact,documentUrl:t.documentUrl||""}),l(!1))},[t]),ee.useEffect(()=>{if(o){const G=S[R];((G==null?void 0:G.status)==="ready"||(G==null?void 0:G.status)==="duplicate")&&G.extractedData&&b({jobNumber:G.extractedData.jobNumber||"",ticketNo:G.extractedData.ticketNo||"",street:G.extractedData.street||"",crossStreet:G.extractedData.crossStreet||"",place:G.extractedData.place||"",extent:G.extractedData.extent||"",county:G.extractedData.county||"",city:G.extractedData.city||"",state:G.extractedData.state||"",callInDate:G.extractedData.callInDate||"",workDate:G.extractedData.workDate||"",expires:G.extractedData.expires||"",siteContact:G.extractedData.siteContact||"",documentUrl:G.documentUrl||""})}},[R,S,o]);const O=async()=>{var G;(G=window.aistudio)!=null&&G.openSelectKey&&(await window.aistudio.openSelectKey(),p(!0))},U=async(G,fe)=>{try{E(F=>F.map(V=>V.id===G?{...V,status:"analyzing"}:V));const ce=new FileReader,z=await new Promise((F,V)=>{ce.onload=()=>F(ce.result.split(",")[1]),ce.onerror=()=>V(new Error("File read error")),ce.readAsDataURL(fe)}),X=W3(fe),te=await K3({data:z,mimeType:X});if(s&&te.ticketNo){const F=s.find(V=>!V.isArchived&&V.ticketNo.trim().toUpperCase()===(te.ticketNo||"").trim().toUpperCase()&&V.jobNumber.trim().toUpperCase()===(te.jobNumber||"").trim().toUpperCase()&&WC(V.workDate)===WC(te.workDate));if(F){E(V=>V.map(se=>se.id===G?{...se,status:"duplicate",matchedTicket:F,extractedData:te}:se));return}}E(F=>F.map(V=>V.id===G?{...V,status:"uploading"}:V));const ne=te.jobNumber||"unassigned",ue=await at.addTicketFile(ne,fe);E(F=>F.map(V=>V.id===G?{...V,status:"ready",extractedData:te,documentUrl:ue}:V))}catch(ce){console.error("Process error:",ce),E(pe=>pe.map(z=>z.id===G?{...z,status:"error",error:ce.message}:z))}},P=G=>{let fe=[];if("files"in G.target&&G.target.files?fe=Array.from(G.target.files):"dataTransfer"in G&&G.dataTransfer.files&&(fe=Array.from(G.dataTransfer.files)),fe.length===0)return;o||l(!0);const ce=fe.map(pe=>({id:Math.random().toString(36).substring(7),file:pe,status:"pending"}));E(pe=>[...pe,...ce]),ce.forEach(pe=>U(pe.id,pe.file)),I.current&&(I.current.value="")},B=()=>{const G=S.findIndex((fe,ce)=>ce>R&&fe.status!=="saved");if(G!==-1)A(G);else{const fe=S.findIndex(ce=>ce.status!=="saved"&&(ce.status==="ready"||ce.status==="duplicate"||ce.status==="error"));fe!==-1?A(fe):S.every(pe=>pe.status==="saved")&&e()}},Q=async G=>{var fe;if(G.preventDefault(),o){const ce=(fe=S[R])==null?void 0:fe.id;await i(y),ce&&E(pe=>pe.map(z=>z.id===ce?{...z,status:"saved"}:z)),B()}else{d(!0);try{await i(y),e()}catch(ce){alert(ce.message)}finally{d(!1)}}},K=G=>{const fe=S.filter((ce,pe)=>pe!==G);fe.length===0?(l(!1),E([])):(E(fe),R>=G&&A(ce=>Math.max(0,ce-1)))},le=S[R],de=S.filter(G=>G.status==="analyzing"||G.status==="uploading"||G.status==="pending").length;return w.jsxs("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-md z-[160] flex items-center justify-center p-4",children:[w.jsxs("div",{onDragOver:G=>{G.preventDefault(),k(!0)},onDragLeave:()=>k(!1),onDrop:G=>{G.preventDefault(),k(!1),P(G)},className:`w-full max-w-2xl rounded-[2.5rem] shadow-2xl overflow-hidden border transition-all duration-300 ${C?"scale-105 ring-4 ring-brand/50":""} ${n?"bg-[#1e293b] border-white/10":"bg-white border-slate-200"}`,children:[w.jsxs("div",{className:"px-10 py-6 border-b flex justify-between items-center bg-black/5",children:[w.jsxs("div",{className:"flex-1",children:[w.jsx("h2",{className:"text-base font-black uppercase tracking-[0.2em] text-brand",children:t?"Update Record":o?"Review & Confirm":"Ticket Entry"}),!t&&w.jsxs("div",{className:"flex gap-4 mt-2",children:[w.jsx("button",{onClick:()=>l(!1),className:`text-[9px] font-black uppercase tracking-widest transition-colors ${o?"text-slate-500 hover:text-slate-400":"text-brand underline underline-offset-4"}`,children:"Manual Entry"}),w.jsx("button",{onClick:()=>{var G;l(!0),S.length===0&&((G=I.current)==null||G.click())},className:`text-[9px] font-black uppercase tracking-widest transition-colors ${o?"text-brand underline underline-offset-4":"text-slate-500 hover:text-slate-400"}`,children:"AI Batch Scan"})]})]}),w.jsxs("div",{className:"flex items-center gap-3",children:[o&&de>0&&w.jsxs("div",{className:"hidden sm:flex items-center gap-2 px-3 py-1 bg-brand/10 rounded-full border border-brand/20",children:[w.jsx("div",{className:"w-2 h-2 bg-brand rounded-full animate-ping"}),w.jsxs("span",{className:"text-[8px] font-black uppercase tracking-widest text-brand",children:[de," Processing"]})]}),w.jsx("button",{onClick:e,className:"p-3 bg-black/10 rounded-2xl opacity-50 hover:opacity-100 transition-all",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M6 18L18 6M6 6l12 12"})})})]})]}),o&&S.length>0&&w.jsxs("div",{className:"px-10 py-4 bg-black/20 border-b border-white/5 flex items-center gap-3 overflow-x-auto no-scrollbar",children:[S.map((G,fe)=>w.jsxs("div",{onClick:()=>A(fe),className:`flex-shrink-0 w-10 h-10 rounded-xl flex items-center justify-center transition-all cursor-pointer group relative ${fe===R?"bg-brand text-slate-900 ring-2 ring-brand/50 scale-110":G.status==="saved"?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20 opacity-60":G.status==="duplicate"?"bg-amber-500/10 text-amber-500 border border-amber-500/20":G.status==="error"?"bg-rose-500/10 text-rose-500 border border-rose-500/20":n?"bg-white/5 text-slate-500":"bg-slate-100 text-slate-400"}`,children:[G.status==="analyzing"||G.status==="uploading"?w.jsx("div",{className:"w-4 h-4 border-2 border-current border-t-transparent rounded-full animate-spin"}):G.status==="saved"?w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})}):G.status==="duplicate"?w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4"})}):G.status==="error"?w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}):w.jsx("span",{className:"text-[9px] font-black",children:fe+1}),w.jsx("button",{onClick:ce=>{ce.stopPropagation(),K(fe)},className:"absolute -top-1 -right-1 w-4 h-4 bg-rose-500 rounded-full text-white flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-lg",children:w.jsx("svg",{className:"w-2.5 h-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M6 18L18 6"})})})]},G.id)),w.jsx("button",{onClick:()=>{var G;return(G=I.current)==null?void 0:G.click()},className:`flex-shrink-0 w-10 h-10 rounded-xl border-2 border-dashed flex items-center justify-center transition-all ${n?"border-white/10 text-slate-500 hover:border-brand hover:text-brand":"border-slate-200 text-slate-400 hover:border-brand hover:text-brand"}`,children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M12 4v16m8-8H4"})})})]}),w.jsx("div",{className:"max-h-[70vh] overflow-y-auto no-scrollbar",children:o&&S.length===0?w.jsxs("div",{onClick:()=>{var G;return(G=I.current)==null?void 0:G.click()},className:"p-24 flex flex-col items-center justify-center text-center cursor-pointer group",children:[w.jsx("div",{className:"w-24 h-24 bg-brand/5 border-2 border-dashed border-brand/20 rounded-[3rem] flex items-center justify-center mb-8 group-hover:scale-110 transition-transform",children:w.jsx("svg",{className:"w-12 h-12 text-brand/40",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),w.jsx("h3",{className:"text-lg font-black uppercase tracking-[0.1em]",children:"AI Batch Processing"}),w.jsx("p",{className:"text-[11px] font-bold text-slate-500 uppercase tracking-widest mt-3 max-w-xs leading-relaxed",children:"Drag & drop PDFs here. Gemini AI will handle the extraction while you review and confirm each record."}),!h&&w.jsx("button",{onClick:G=>{G.stopPropagation(),O()},className:"mt-10 px-8 py-4 bg-brand text-slate-900 rounded-2xl font-black text-xs uppercase tracking-widest shadow-xl shadow-brand/20 animate-pulse active:scale-95",children:" Connect AI Service to Begin"})]}):o&&((le==null?void 0:le.status)==="analyzing"||(le==null?void 0:le.status)==="uploading")?w.jsxs("div",{className:"p-32 flex flex-col items-center justify-center text-center",children:[w.jsx("div",{className:"w-20 h-20 border-4 border-brand border-t-transparent rounded-full animate-spin mb-8"}),w.jsx("h3",{className:"text-base font-black uppercase tracking-widest",children:"AI Document Scan"}),w.jsxs("p",{className:"text-[11px] font-bold text-slate-400 uppercase tracking-widest mt-2 animate-pulse",children:["Processing ",le.file.name,"..."]})]}):o&&(le==null?void 0:le.status)==="error"?w.jsxs("div",{className:"p-20 flex flex-col items-center justify-center text-center",children:[w.jsx("div",{className:"w-24 h-24 bg-rose-500/10 text-rose-500 rounded-[3rem] flex items-center justify-center mb-8 border-2 border-rose-500/20 shadow-xl",children:w.jsx("svg",{className:"w-12 h-12",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),w.jsx("h3",{className:"text-lg font-black uppercase tracking-widest text-rose-500",children:"Scan Failed"}),w.jsx("p",{className:"text-xs font-bold text-slate-400 mt-2",children:le.error}),w.jsx("button",{onClick:O,className:"mt-6 px-8 py-3 bg-brand text-slate-900 rounded-xl font-black text-[10px] uppercase tracking-widest shadow-lg active:scale-95",children:"Reconnect AI Service"}),w.jsxs("div",{className:"flex gap-3 mt-10 w-full max-w-sm",children:[w.jsx("button",{onClick:()=>K(R),className:"flex-1 py-5 bg-rose-500 text-white rounded-2xl text-[10px] font-black uppercase tracking-widest",children:"Discard"}),w.jsx("button",{onClick:B,className:"flex-1 py-5 bg-white/5 text-slate-500 border border-white/10 rounded-2xl text-[10px] font-black uppercase tracking-widest",children:"Retry Next"})]})]}):w.jsxs("form",{onSubmit:Q,className:"p-10 space-y-5",children:[w.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"Job Reference"}),w.jsx("input",{required:!0,className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.jobNumber,onChange:G=>b({...y,jobNumber:G.target.value}),placeholder:"e.g. 25-001"})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"Locate Ticket #"}),w.jsx("input",{required:!0,className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold font-mono outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.ticketNo,onChange:G=>b({...y,ticketNo:G.target.value})})]})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"Primary Street"}),w.jsx("input",{required:!0,className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.street,onChange:G=>b({...y,street:G.target.value})})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"Cross Street"}),w.jsx("input",{className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.crossStreet,onChange:G=>b({...y,crossStreet:G.target.value})})]})]}),w.jsxs("div",{className:"grid grid-cols-3 gap-5",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"City"}),w.jsx("input",{className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.city,onChange:G=>b({...y,city:G.target.value})})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"ST"}),w.jsx("input",{maxLength:2,className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold text-center uppercase outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.state,onChange:G=>b({...y,state:G.target.value.toUpperCase()})})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"County"}),w.jsx("input",{className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.county,onChange:G=>b({...y,county:G.target.value})})]})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-5",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"Work Start Date"}),w.jsx("input",{type:"date",required:!0,className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.workDate,onChange:G=>b({...y,workDate:G.target.value})})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"Expires Date"}),w.jsx("input",{type:"date",required:!0,className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.expires,onChange:G=>b({...y,expires:G.target.value})})]})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[10px] font-black uppercase tracking-widest ml-1 text-slate-500",children:"Site Contact / Client"}),w.jsx("input",{className:`w-full px-5 py-4 border rounded-2xl text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-300 text-black"}`,value:y.siteContact,onChange:G=>b({...y,siteContact:G.target.value}),placeholder:"e.g. John Doe (555-0123)"})]}),w.jsx("div",{className:"pt-6",children:w.jsxs("button",{type:"submit",disabled:c,className:"w-full bg-brand text-slate-900 py-6 rounded-2xl font-black text-xs uppercase tracking-[0.2em] shadow-2xl shadow-brand/20 transition-all hover:scale-[1.01] active:scale-95 flex items-center justify-center gap-3",children:[c?w.jsx("div",{className:"w-5 h-5 border-2 border-slate-900 border-t-transparent rounded-full animate-spin"}):w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})}),t?"Commit Record Changes":o?"Confirm & Sync Vault":"Finalize Ticket Entry"]})})]})})]}),w.jsx("input",{type:"file",ref:I,className:"hidden",accept:"application/pdf,image/*",multiple:!0,onChange:P})]})},Q3=({onSave:i,onClose:e,initialData:t,isDarkMode:n})=>{const[s,o]=ee.useState({jobNumber:"",customer:"",address:"",city:"",state:"",county:""}),[l,c]=ee.useState(!1);ee.useEffect(()=>{t&&o({jobNumber:t.jobNumber,customer:t.customer,address:t.address,city:t.city,state:t.state,county:t.county})},[t]);const d=async h=>{h.preventDefault(),c(!0);try{await i(s)}finally{c(!1)}};return w.jsx("div",{className:"fixed inset-0 bg-slate-950/70 backdrop-blur-sm z-[160] flex items-center justify-center p-4",children:w.jsxs("div",{className:`w-full max-w-lg rounded-2xl shadow-2xl overflow-hidden border animate-in ${n?"bg-[#1e293b] border-white/10":"bg-white border-slate-200"}`,children:[w.jsxs("div",{className:"px-6 py-4 border-b flex justify-between items-center bg-black/5",children:[w.jsx("h2",{className:"text-sm font-black uppercase tracking-widest",children:t?"Update Job Profile":"Register New Job"}),w.jsx("button",{onClick:e,className:"p-1 opacity-50 hover:opacity-100 transition-opacity",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M6 18L18 6M6 6l12 12"})})})]}),w.jsxs("form",{onSubmit:d,className:"p-6 space-y-4",children:[w.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400",children:"Job #"}),w.jsx("input",{required:!0,className:`w-full px-3 py-2 border rounded-lg text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-200 text-slate-900"}`,value:s.jobNumber,onChange:h=>o({...s,jobNumber:h.target.value}),placeholder:"e.g. 25-001"})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400",children:"Customer"}),w.jsx("input",{required:!0,className:`w-full px-3 py-2 border rounded-lg text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-200 text-slate-900"}`,value:s.customer,onChange:h=>o({...s,customer:h.target.value}),placeholder:"Client Name"})]})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400",children:"Base Address"}),w.jsx("input",{required:!0,className:`w-full px-3 py-2 border rounded-lg text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-200 text-slate-900"}`,value:s.address,onChange:h=>o({...s,address:h.target.value})})]}),w.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400",children:"City"}),w.jsx("input",{required:!0,className:`w-full px-3 py-2 border rounded-lg text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-200 text-slate-900"}`,value:s.city,onChange:h=>o({...s,city:h.target.value})})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400",children:"ST"}),w.jsx("input",{required:!0,maxLength:2,className:`w-full px-3 py-2 border rounded-lg text-xs font-bold text-center uppercase outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-200 text-slate-900"}`,value:s.state,onChange:h=>o({...s,state:h.target.value.toUpperCase()})})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black uppercase text-slate-400",children:"County"}),w.jsx("input",{required:!0,className:`w-full px-3 py-2 border rounded-lg text-xs font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${n?"bg-white/5 border-white/10 text-white":"bg-slate-50 border-slate-200 text-slate-900"}`,value:s.county,onChange:h=>o({...s,county:h.target.value})})]})]}),w.jsx("button",{type:"submit",disabled:l,className:"w-full bg-brand text-[#0f172a] py-3 rounded-xl font-black text-[10px] uppercase tracking-widest shadow-lg shadow-brand/10 mt-2 transition-all hover:scale-[1.01] active:scale-95 disabled:opacity-50",children:l?"Syncing Vault...":t?"Commit Changes":"Finalize Job Profile"})]})]})})},Z3=({job:i,onClose:e,onEdit:t,onDelete:n,onToggleComplete:s,onViewMedia:o,onViewMarkup:l,isDarkMode:c})=>{const[d,h]=ee.useState(null),p=y=>y==null?void 0:y.toLowerCase().split("?")[0].endsWith(".pdf");return ee.useEffect(()=>{at.getJobPrints(i.jobNumber).then(y=>{h(y.find(b=>b.isPinned)||null)})},[i.jobNumber]),w.jsx("div",{className:"fixed inset-0 bg-slate-950/80 backdrop-blur-md z-[170] overflow-y-auto pt-10 pb-20 px-4",children:w.jsxs("div",{className:`w-full max-w-md mx-auto rounded-[2.5rem] shadow-2xl overflow-hidden border animate-in ${c?"bg-[#1e293b] border-white/10":"bg-white border-slate-200"}`,children:[w.jsxs("div",{className:"px-8 py-6 border-b flex justify-between items-center bg-black/5",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-sm font-black uppercase tracking-[0.2em] text-brand",children:"Project Brief"}),w.jsxs("p",{className:"text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-0.5",children:["Job #",i.jobNumber]})]}),w.jsx("button",{onClick:e,className:"p-2 opacity-50 hover:opacity-100 transition-opacity",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M6 18L18 6M6 6l12 12"})})})]}),w.jsxs("div",{className:"p-8 space-y-8",children:[w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:"Customer / Entity"}),w.jsx("p",{className:`text-base font-black uppercase tracking-tight ${c?"text-white":"text-slate-950"}`,children:i.customer})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:"Base Location"}),w.jsx("p",{className:`text-[11px] font-bold ${c?"text-slate-300":"text-slate-950"}`,children:i.address})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:"Jurisdiction"}),w.jsxs("p",{className:`text-[11px] font-bold ${c?"text-slate-300":"text-slate-950"}`,children:[i.city,", ",i.state]})]})]})]}),w.jsxs("div",{className:`p-5 rounded-[2rem] border relative group overflow-hidden ${c?"bg-white/5 border-white/10":"bg-slate-50 border-slate-100"}`,children:[w.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400 mb-4",children:"Project Blueprint"}),d?w.jsxs("div",{className:"relative aspect-video rounded-xl overflow-hidden border border-black/10 bg-slate-900 flex items-center justify-center",children:[p(d.url)?w.jsxs("div",{className:"flex flex-col items-center gap-2 text-rose-500",children:[w.jsxs("svg",{className:"w-10 h-10",fill:"currentColor",viewBox:"0 0 24 24",children:[w.jsx("path",{d:"M11.363 2c4.155 0 2.637 6 2.637 6s6-1.518 6 2.638v11.362c0 .552-.448 1-1 1H5c-.552 0-1-.448-1-1V3c0-.552.448-1 1-1h6.363zM12 2H5c-1.103 0-2 .897-2 2v16c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2V9l-7-7z"}),w.jsx("path",{d:"M19 9h-7V2l7 7z"})]}),w.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest opacity-60",children:"PDF Blueprint"})]}):w.jsx("img",{src:d.url,className:"w-full h-full object-cover",alt:"Blueprint"}),w.jsx("div",{className:"absolute inset-0 bg-black/40 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center",children:w.jsx("button",{onClick:l,className:"px-6 py-2 bg-brand text-slate-900 rounded-full font-black text-[9px] uppercase tracking-widest transform translate-y-2 group-hover:translate-y-0 transition-all",children:"Launch Markup"})})]}):w.jsxs("button",{onClick:l,className:"w-full aspect-video rounded-xl border-2 border-dashed border-black/10 flex flex-col items-center justify-center gap-2 hover:border-brand/40 hover:bg-brand/5 transition-all",children:[w.jsx("svg",{className:"w-6 h-6 text-slate-300",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 4v16m8-8H4"})}),w.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400",children:"Add Blueprint"})]})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[w.jsxs("button",{onClick:t,className:`flex flex-col items-center justify-center p-4 rounded-3xl border transition-all hover:scale-105 active:scale-95 ${c?"bg-white/5 border-white/10 hover:bg-white/10":"bg-white border-slate-200 hover:border-brand/40 shadow-sm"}`,children:[w.jsx("svg",{className:"w-5 h-5 mb-2 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})}),w.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Edit Details"})]}),w.jsxs("button",{onClick:o,className:`flex flex-col items-center justify-center p-4 rounded-3xl border transition-all hover:scale-105 active:scale-95 ${c?"bg-white/5 border-white/10 hover:bg-white/10":"bg-white border-slate-200 hover:border-brand/40 shadow-sm"}`,children:[w.jsx("svg",{className:"w-5 h-5 mb-2 text-slate-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})}),w.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Job Media"})]}),w.jsxs("button",{onClick:n,className:`col-span-2 flex items-center justify-center gap-3 p-4 rounded-3xl border transition-all hover:scale-105 active:scale-95 ${c?"bg-rose-500/10 border-rose-500/20 text-rose-500 hover:bg-rose-500 hover:text-white":"bg-rose-50 border-rose-100 text-rose-600 hover:bg-rose-600 hover:text-white shadow-sm"}`,children:[w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),w.jsx("span",{className:"text-[9px] font-black uppercase tracking-widest",children:"Delete Project Folder"})]})]}),w.jsx("div",{className:"pt-4 border-t border-black/5",children:w.jsx("button",{onClick:s,className:`w-full py-5 rounded-[2rem] font-black text-[10px] uppercase tracking-[0.2em] transition-all shadow-xl flex items-center justify-center gap-3 ${i.isComplete?"bg-emerald-500 text-white shadow-emerald-500/20":c?"bg-white text-slate-950 shadow-white/10":"bg-slate-900 text-white shadow-slate-900/20"}`,children:i.isComplete?w.jsxs(w.Fragment,{children:[w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})}),"Re-Open Project"]}):w.jsxs(w.Fragment,{children:[w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Mark Job Complete"]})})})]})]})})},eH="modulepreload",tH=function(i){return"/"+i},XC={},Wm=function(e,t,n){let s=Promise.resolve();if(t&&t.length>0){let l=function(h){return Promise.all(h.map(p=>Promise.resolve(p).then(y=>({status:"fulfilled",value:y}),y=>({status:"rejected",reason:y}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),d=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));s=l(t.map(h=>{if(h=tH(h),h in XC)return;XC[h]=!0;const p=h.endsWith(".css"),y=p?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${y}`))return;const b=document.createElement("link");if(b.rel=p?"stylesheet":eH,p||(b.as="script"),b.crossOrigin="",b.href=h,d&&b.setAttribute("nonce",d),document.head.appendChild(b),p)return new Promise((S,E)=>{b.addEventListener("load",S),b.addEventListener("error",()=>E(new Error(`Unable to preload CSS for ${h}`)))})}))}function o(l){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=l,window.dispatchEvent(c),!c.defaultPrevented)throw l}return s.then(l=>{for(const c of l||[])c.status==="rejected"&&o(c.reason);return e().catch(o)})};var Eh={};Eh.d=(i,e)=>{for(var t in e)Eh.o(e,t)&&!Eh.o(i,t)&&Object.defineProperty(i,t,{enumerable:!0,get:e[t]})};Eh.o=(i,e)=>Object.prototype.hasOwnProperty.call(i,e);var Pe=globalThis.pdfjsLib={};Eh.d(Pe,{AbortException:()=>zl,AnnotationEditorLayer:()=>Q_,AnnotationEditorParamsType:()=>Fe,AnnotationEditorType:()=>it,AnnotationEditorUIManager:()=>Hl,AnnotationLayer:()=>ZB,AnnotationMode:()=>Fo,CMapCompressionType:()=>Vb,ColorPicker:()=>zg,DOMSVGFactory:()=>ww,DrawLayer:()=>nw,FeatureTest:()=>ci,GlobalWorkerOptions:()=>Xr,ImageKind:()=>sg,InvalidPDFException:()=>NR,MissingPDFException:()=>Vl,OPS:()=>as,Outliner:()=>D_,PDFDataRangeTransport:()=>EN,PDFDateString:()=>OR,PDFWorker:()=>su,PasswordResponses:()=>rH,PermissionFlag:()=>sH,PixelsPerInch:()=>oa,RenderingCancelledException:()=>xw,TextLayer:()=>ed,UnexpectedResponseException:()=>E0,Util:()=>Ee,VerbosityLevel:()=>w0,XfaLayer:()=>TN,build:()=>DB,createValidAbsoluteUrl:()=>cH,fetchData:()=>N0,getDocument:()=>EB,getFilenameFromUrl:()=>bH,getPdfFilenameFromUrl:()=>_H,getXfaPageViewport:()=>wH,isDataScheme:()=>Sw,isPdfFile:()=>Ew,noContextMenu:()=>di,normalizeUnicode:()=>mH,renderTextLayer:()=>mB,setLayerDimensions:()=>Fl,shadow:()=>st,updateTextLayer:()=>gB,version:()=>MB});const Hn=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),RR=[1,0,0,1,0,0],Gb=[.001,0,0,.001,0,0],nH=1e7,cb=1.35,Xi={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,OPLIST:256},Fo={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},iH="pdfjs_internal_editor_",it={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15},Fe={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_DEFAULT_COLOR:32,HIGHLIGHT_THICKNESS:33,HIGHLIGHT_FREE:34,HIGHLIGHT_SHOW_ALL:35},sH={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Ln={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},sg={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},nn={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,WIDGET:20},nh={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},w0={ERRORS:0,WARNINGS:1,INFOS:5},Vb={NONE:0,BINARY:1},as={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91},rH={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let x0=w0.WARNINGS;function oH(i){Number.isInteger(i)&&(x0=i)}function aH(){return x0}function S0(i){x0>=w0.INFOS&&console.log(`Info: ${i}`)}function Je(i){x0>=w0.WARNINGS&&console.log(`Warning: ${i}`)}function xt(i){throw new Error(i)}function cn(i,e){i||xt(e)}function lH(i){switch(i==null?void 0:i.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function cH(i,e=null,t=null){if(!i)return null;try{if(t&&typeof i=="string"){if(t.addDefaultProtocol&&i.startsWith("www.")){const s=i.match(/\./g);(s==null?void 0:s.length)>=2&&(i=`http://${i}`)}if(t.tryConvertEncoding)try{i=pH(i)}catch{}}const n=e?new URL(i,e):new URL(i);if(lH(n))return n}catch{}return null}function st(i,e,t,n=!1){return Object.defineProperty(i,e,{value:t,enumerable:!n,configurable:!0,writable:!1}),t}const ua=(function(){function e(t,n){this.constructor===e&&xt("Cannot initialize BaseException."),this.message=t,this.name=n}return e.prototype=new Error,e.constructor=e,e})();class zb extends ua{constructor(e,t){super(e,"PasswordException"),this.code=t}}class $b extends ua{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class NR extends ua{constructor(e){super(e,"InvalidPDFException")}}class Vl extends ua{constructor(e){super(e,"MissingPDFException")}}class E0 extends ua{constructor(e,t){super(e,"UnexpectedResponseException"),this.status=t}}class uH extends ua{constructor(e){super(e,"FormatError")}}class zl extends ua{constructor(e){super(e,"AbortException")}}function kR(i){(typeof i!="object"||(i==null?void 0:i.length)===void 0)&&xt("Invalid argument for bytesToString");const e=i.length,t=8192;if(e<t)return String.fromCharCode.apply(null,i);const n=[];for(let s=0;s<e;s+=t){const o=Math.min(s+t,e),l=i.subarray(s,o);n.push(String.fromCharCode.apply(null,l))}return n.join("")}function A0(i){typeof i!="string"&&xt("Invalid argument for stringToBytes");const e=i.length,t=new Uint8Array(e);for(let n=0;n<e;++n)t[n]=i.charCodeAt(n)&255;return t}function dH(i){return String.fromCharCode(i>>24&255,i>>16&255,i>>8&255,i&255)}function bw(i){const e=Object.create(null);for(const[t,n]of i)e[t]=n;return e}function hH(){const i=new Uint8Array(4);return i[0]=1,new Uint32Array(i.buffer,0,1)[0]===1}function fH(){try{return new Function(""),!0}catch{return!1}}class ci{static get isLittleEndian(){return st(this,"isLittleEndian",hH())}static get isEvalSupported(){return st(this,"isEvalSupported",fH())}static get isOffscreenCanvasSupported(){return st(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get platform(){return typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.platform)=="string"?st(this,"platform",{isMac:navigator.platform.includes("Mac")}):st(this,"platform",{isMac:!1})}static get isCSSRoundSupported(){var e,t;return st(this,"isCSSRoundSupported",(t=(e=globalThis.CSS)==null?void 0:e.supports)==null?void 0:t.call(e,"width: round(1.5px, 1px)"))}}const ub=Array.from(Array(256).keys(),i=>i.toString(16).padStart(2,"0"));var Zr,rg,Yb;class Ee{static makeHexColor(e,t,n){return`#${ub[e]}${ub[t]}${ub[n]}`}static scaleMinMax(e,t){let n;e[0]?(e[0]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[3],t[3]*=e[3]):(n=t[0],t[0]=t[1],t[1]=n,n=t[2],t[2]=t[3],t[3]=n,e[1]<0&&(n=t[1],t[1]=t[3],t[3]=n),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(n=t[0],t[0]=t[2],t[2]=n),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static applyTransform(e,t){const n=e[0]*t[0]+e[1]*t[2]+t[4],s=e[0]*t[1]+e[1]*t[3]+t[5];return[n,s]}static applyInverseTransform(e,t){const n=t[0]*t[3]-t[1]*t[2],s=(e[0]*t[3]-e[1]*t[2]+t[2]*t[5]-t[4]*t[3])/n,o=(-e[0]*t[1]+e[1]*t[0]+t[4]*t[1]-t[5]*t[0])/n;return[s,o]}static getAxialAlignedBoundingBox(e,t){const n=this.applyTransform(e,t),s=this.applyTransform(e.slice(2,4),t),o=this.applyTransform([e[0],e[3]],t),l=this.applyTransform([e[2],e[1]],t);return[Math.min(n[0],s[0],o[0],l[0]),Math.min(n[1],s[1],o[1],l[1]),Math.max(n[0],s[0],o[0],l[0]),Math.max(n[1],s[1],o[1],l[1])]}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e){const t=[e[0],e[2],e[1],e[3]],n=e[0]*t[0]+e[1]*t[2],s=e[0]*t[1]+e[1]*t[3],o=e[2]*t[0]+e[3]*t[2],l=e[2]*t[1]+e[3]*t[3],c=(n+l)/2,d=Math.sqrt((n+l)**2-4*(n*l-o*s))/2,h=c+d||1,p=c-d||1;return[Math.sqrt(h),Math.sqrt(p)]}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const n=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),s=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(n>s)return null;const o=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),l=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return o>l?null:[n,o,s,l]}static bezierBoundingBox(e,t,n,s,o,l,c,d,h){return h?(h[0]=Math.min(h[0],e,c),h[1]=Math.min(h[1],t,d),h[2]=Math.max(h[2],e,c),h[3]=Math.max(h[3],t,d)):h=[Math.min(e,c),Math.min(t,d),Math.max(e,c),Math.max(t,d)],D(this,Zr,Yb).call(this,e,n,o,c,t,s,l,d,3*(-e+3*(n-o)+c),6*(e-2*n+o),3*(n-e),h),D(this,Zr,Yb).call(this,e,n,o,c,t,s,l,d,3*(-t+3*(s-l)+d),6*(t-2*s+l),3*(s-t),h),h}}Zr=new WeakSet,rg=function(e,t,n,s,o,l,c,d,h,p){if(h<=0||h>=1)return;const y=1-h,b=h*h,S=b*h,E=y*(y*(y*e+3*h*t)+3*b*n)+S*s,R=y*(y*(y*o+3*h*l)+3*b*c)+S*d;p[0]=Math.min(p[0],E),p[1]=Math.min(p[1],R),p[2]=Math.max(p[2],E),p[3]=Math.max(p[3],R)},Yb=function(e,t,n,s,o,l,c,d,h,p,y,b){if(Math.abs(h)<1e-12){Math.abs(p)>=1e-12&&D(this,Zr,rg).call(this,e,t,n,s,o,l,c,d,-y/p,b);return}const S=p**2-4*y*h;if(S<0)return;const E=Math.sqrt(S),R=2*h;D(this,Zr,rg).call(this,e,t,n,s,o,l,c,d,(-p+E)/R,b),D(this,Zr,rg).call(this,e,t,n,s,o,l,c,d,(-p-E)/R,b)},L(Ee,Zr);function pH(i){return decodeURIComponent(escape(i))}let db=null,QC=null;function mH(i){return db||(db=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,QC=new Map([["","t"]])),i.replaceAll(db,(e,t,n)=>t?t.normalize("NFKC"):QC.get(n))}function gH(){if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.randomUUID)=="function")return crypto.randomUUID();const i=new Uint8Array(32);if(typeof crypto<"u"&&typeof(crypto==null?void 0:crypto.getRandomValues)=="function")crypto.getRandomValues(i);else for(let e=0;e<32;e++)i[e]=Math.floor(Math.random()*255);return kR(i)}const IR="pdfjs_internal_id_",br={BEZIER_CURVE_TO:0,MOVE_TO:1,LINE_TO:2,QUADRATIC_CURVE_TO:3,RESTORE:4,SAVE:5,SCALE:6,TRANSFORM:7,TRANSLATE:8};class T0{constructor(){this.constructor===T0&&xt("Cannot initialize BaseFilterFactory.")}addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,n,s,o){return"none"}destroy(e=!1){}}var Oh;const Nw=class Nw{constructor({enableHWA:e=!1}={}){L(this,Oh,!1);this.constructor===Nw&&xt("Cannot initialize BaseCanvasFactory."),N(this,Oh,e)}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const n=this._createCanvas(e,t);return{canvas:n,context:n.getContext("2d",{willReadFrequently:!g(this,Oh)})}}reset(e,t,n){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||n<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=n}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){xt("Abstract method `_createCanvas` called.")}};Oh=new WeakMap;let Bg=Nw;class C0{constructor({baseUrl:e=null,isCompressed:t=!0}){this.constructor===C0&&xt("Cannot initialize BaseCMapReaderFactory."),this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error('The CMap "baseUrl" parameter must be specified, ensure that the "cMapUrl" and "cMapPacked" API parameters are provided.');if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":""),n=this.isCompressed?Vb.BINARY:Vb.NONE;return this._fetchData(t,n).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}_fetchData(e,t){xt("Abstract method `_fetchData` called.")}}class R0{constructor({baseUrl:e=null}){this.constructor===R0&&xt("Cannot initialize BaseStandardFontDataFactory."),this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error('The standard font "baseUrl" parameter must be specified, ensure that the "standardFontDataUrl" API parameter is provided.');if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetchData(t).catch(n=>{throw new Error(`Unable to load font data at: ${t}`)})}_fetchData(e){xt("Abstract method `_fetchData` called.")}}class _w{constructor(){this.constructor===_w&&xt("Cannot initialize BaseSVGFactory.")}create(e,t,n=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const s=this._createSVG("svg:svg");return s.setAttribute("version","1.1"),n||(s.setAttribute("width",`${e}px`),s.setAttribute("height",`${t}px`)),s.setAttribute("preserveAspectRatio","none"),s.setAttribute("viewBox",`0 0 ${e} ${t}`),s}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){xt("Abstract method `_createSVG` called.")}}const wr="http://www.w3.org/2000/svg",Ba=class Ba{};qe(Ba,"CSS",96),qe(Ba,"PDF",72),qe(Ba,"PDF_TO_CSS_UNITS",Ba.CSS/Ba.PDF);let oa=Ba;var Ga,Ds,Cr,oi,Yg,Va,_e,Pn,Vc,zc,og,MR,Jb,$c,ah,lh,Kb,ch;class vH extends T0{constructor({docId:t,ownerDocument:n=globalThis.document}={}){super();L(this,_e);L(this,Ga);L(this,Ds);L(this,Cr);L(this,oi);L(this,Yg);L(this,Va,0);N(this,Cr,t),N(this,oi,n)}addFilter(t){if(!t)return"none";let n=g(this,_e,Pn).get(t);if(n)return n;const[s,o,l]=D(this,_e,og).call(this,t),c=t.length===1?s:`${s}${o}${l}`;if(n=g(this,_e,Pn).get(c),n)return g(this,_e,Pn).set(t,n),n;const d=`g_${g(this,Cr)}_transfer_map_${_i(this,Va)._++}`,h=`url(#${d})`;g(this,_e,Pn).set(t,h),g(this,_e,Pn).set(c,h);const p=D(this,_e,$c).call(this,d);return D(this,_e,lh).call(this,s,o,l,p),h}addHCMFilter(t,n){var E;const s=`${t}-${n}`,o="base";let l=g(this,_e,Vc).get(o);if((l==null?void 0:l.key)===s||(l?((E=l.filter)==null||E.remove(),l.key=s,l.url="none",l.filter=null):(l={key:s,url:"none",filter:null},g(this,_e,Vc).set(o,l)),!t||!n))return l.url;const c=D(this,_e,ch).call(this,t);t=Ee.makeHexColor(...c);const d=D(this,_e,ch).call(this,n);if(n=Ee.makeHexColor(...d),g(this,_e,zc).style.color="",t==="#000000"&&n==="#ffffff"||t===n)return l.url;const h=new Array(256);for(let R=0;R<=255;R++){const A=R/255;h[R]=A<=.03928?A/12.92:((A+.055)/1.055)**2.4}const p=h.join(","),y=`g_${g(this,Cr)}_hcm_filter`,b=l.filter=D(this,_e,$c).call(this,y);D(this,_e,lh).call(this,p,p,p,b),D(this,_e,Jb).call(this,b);const S=(R,A)=>{const C=c[R]/255,k=d[R]/255,I=new Array(A+1);for(let O=0;O<=A;O++)I[O]=C+O/A*(k-C);return I.join(",")};return D(this,_e,lh).call(this,S(0,5),S(1,5),S(2,5),b),l.url=`url(#${y})`,l.url}addAlphaFilter(t){let n=g(this,_e,Pn).get(t);if(n)return n;const[s]=D(this,_e,og).call(this,[t]),o=`alpha_${s}`;if(n=g(this,_e,Pn).get(o),n)return g(this,_e,Pn).set(t,n),n;const l=`g_${g(this,Cr)}_alpha_map_${_i(this,Va)._++}`,c=`url(#${l})`;g(this,_e,Pn).set(t,c),g(this,_e,Pn).set(o,c);const d=D(this,_e,$c).call(this,l);return D(this,_e,Kb).call(this,s,d),c}addLuminosityFilter(t){let n=g(this,_e,Pn).get(t||"luminosity");if(n)return n;let s,o;if(t?([s]=D(this,_e,og).call(this,[t]),o=`luminosity_${s}`):o="luminosity",n=g(this,_e,Pn).get(o),n)return g(this,_e,Pn).set(t,n),n;const l=`g_${g(this,Cr)}_luminosity_map_${_i(this,Va)._++}`,c=`url(#${l})`;g(this,_e,Pn).set(t,c),g(this,_e,Pn).set(o,c);const d=D(this,_e,$c).call(this,l);return D(this,_e,MR).call(this,d),t&&D(this,_e,Kb).call(this,s,d),c}addHighlightHCMFilter(t,n,s,o,l){var k;const c=`${n}-${s}-${o}-${l}`;let d=g(this,_e,Vc).get(t);if((d==null?void 0:d.key)===c||(d?((k=d.filter)==null||k.remove(),d.key=c,d.url="none",d.filter=null):(d={key:c,url:"none",filter:null},g(this,_e,Vc).set(t,d)),!n||!s))return d.url;const[h,p]=[n,s].map(D(this,_e,ch).bind(this));let y=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),b=Math.round(.2126*p[0]+.7152*p[1]+.0722*p[2]),[S,E]=[o,l].map(D(this,_e,ch).bind(this));b<y&&([y,b,S,E]=[b,y,E,S]),g(this,_e,zc).style.color="";const R=(I,O,U)=>{const P=new Array(256),B=(b-y)/U,Q=I/255,K=(O-I)/(255*U);let le=0;for(let de=0;de<=U;de++){const G=Math.round(y+de*B),fe=Q+de*K;for(let ce=le;ce<=G;ce++)P[ce]=fe;le=G+1}for(let de=le;de<256;de++)P[de]=P[le-1];return P.join(",")},A=`g_${g(this,Cr)}_hcm_${t}_filter`,C=d.filter=D(this,_e,$c).call(this,A);return D(this,_e,Jb).call(this,C),D(this,_e,lh).call(this,R(S[0],E[0],5),R(S[1],E[1],5),R(S[2],E[2],5),C),d.url=`url(#${A})`,d.url}destroy(t=!1){t&&g(this,_e,Vc).size!==0||(g(this,Ds)&&(g(this,Ds).parentNode.parentNode.remove(),N(this,Ds,null)),g(this,Ga)&&(g(this,Ga).clear(),N(this,Ga,null)),N(this,Va,0))}}Ga=new WeakMap,Ds=new WeakMap,Cr=new WeakMap,oi=new WeakMap,Yg=new WeakMap,Va=new WeakMap,_e=new WeakSet,Pn=function(){return g(this,Ga)||N(this,Ga,new Map)},Vc=function(){return g(this,Yg)||N(this,Yg,new Map)},zc=function(){if(!g(this,Ds)){const t=g(this,oi).createElement("div"),{style:n}=t;n.visibility="hidden",n.contain="strict",n.width=n.height=0,n.position="absolute",n.top=n.left=0,n.zIndex=-1;const s=g(this,oi).createElementNS(wr,"svg");s.setAttribute("width",0),s.setAttribute("height",0),N(this,Ds,g(this,oi).createElementNS(wr,"defs")),t.append(s),s.append(g(this,Ds)),g(this,oi).body.append(t)}return g(this,Ds)},og=function(t){if(t.length===1){const h=t[0],p=new Array(256);for(let b=0;b<256;b++)p[b]=h[b]/255;const y=p.join(",");return[y,y,y]}const[n,s,o]=t,l=new Array(256),c=new Array(256),d=new Array(256);for(let h=0;h<256;h++)l[h]=n[h]/255,c[h]=s[h]/255,d[h]=o[h]/255;return[l.join(","),c.join(","),d.join(",")]},MR=function(t){const n=g(this,oi).createElementNS(wr,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),t.append(n)},Jb=function(t){const n=g(this,oi).createElementNS(wr,"feColorMatrix");n.setAttribute("type","matrix"),n.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),t.append(n)},$c=function(t){const n=g(this,oi).createElementNS(wr,"filter");return n.setAttribute("color-interpolation-filters","sRGB"),n.setAttribute("id",t),g(this,_e,zc).append(n),n},ah=function(t,n,s){const o=g(this,oi).createElementNS(wr,n);o.setAttribute("type","discrete"),o.setAttribute("tableValues",s),t.append(o)},lh=function(t,n,s,o){const l=g(this,oi).createElementNS(wr,"feComponentTransfer");o.append(l),D(this,_e,ah).call(this,l,"feFuncR",t),D(this,_e,ah).call(this,l,"feFuncG",n),D(this,_e,ah).call(this,l,"feFuncB",s)},Kb=function(t,n){const s=g(this,oi).createElementNS(wr,"feComponentTransfer");n.append(s),D(this,_e,ah).call(this,s,"feFuncA",t)},ch=function(t){return g(this,_e,zc).style.color=t,Aw(getComputedStyle(g(this,_e,zc)).getPropertyValue("color"))};class yH extends Bg{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}={}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const n=this._document.createElement("canvas");return n.width=e,n.height=t,n}}async function N0(i,e="text"){if(uh(i,document.baseURI)){const t=await fetch(i);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,n)=>{const s=new XMLHttpRequest;s.open("GET",i,!0),s.responseType=e,s.onreadystatechange=()=>{if(s.readyState===XMLHttpRequest.DONE){if(s.status===200||s.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(s.response);return}t(s.responseText);return}n(new Error(s.statusText))}},s.send(null)})}class DR extends C0{_fetchData(e,t){return N0(e,this.isCompressed?"arraybuffer":"text").then(n=>({cMapData:n instanceof ArrayBuffer?new Uint8Array(n):A0(n),compressionType:t}))}}class LR extends R0{_fetchData(e){return N0(e,"arraybuffer").then(t=>new Uint8Array(t))}}class ww extends _w{_createSVG(e){return document.createElementNS(wr,e)}}class yp{constructor({viewBox:e,scale:t,rotation:n,offsetX:s=0,offsetY:o=0,dontFlip:l=!1}){this.viewBox=e,this.scale=t,this.rotation=n,this.offsetX=s,this.offsetY=o;const c=(e[2]+e[0])/2,d=(e[3]+e[1])/2;let h,p,y,b;switch(n%=360,n<0&&(n+=360),n){case 180:h=-1,p=0,y=0,b=1;break;case 90:h=0,p=1,y=1,b=0;break;case 270:h=0,p=-1,y=-1,b=0;break;case 0:h=1,p=0,y=0,b=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}l&&(y=-y,b=-b);let S,E,R,A;h===0?(S=Math.abs(d-e[1])*t+s,E=Math.abs(c-e[0])*t+o,R=(e[3]-e[1])*t,A=(e[2]-e[0])*t):(S=Math.abs(c-e[0])*t+s,E=Math.abs(d-e[1])*t+o,R=(e[2]-e[0])*t,A=(e[3]-e[1])*t),this.transform=[h*t,p*t,y*t,b*t,S-h*t*c-y*t*d,E-p*t*c-b*t*d],this.width=R,this.height=A}get rawDims(){const{viewBox:e}=this;return st(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:n=this.offsetX,offsetY:s=this.offsetY,dontFlip:o=!1}={}){return new yp({viewBox:this.viewBox.slice(),scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:o})}convertToViewportPoint(e,t){return Ee.applyTransform([e,t],this.transform)}convertToViewportRectangle(e){const t=Ee.applyTransform([e[0],e[1]],this.transform),n=Ee.applyTransform([e[2],e[3]],this.transform);return[t[0],t[1],n[0],n[1]]}convertToPdfPoint(e,t){return Ee.applyInverseTransform([e,t],this.transform)}}class xw extends ua{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function Sw(i){const e=i.length;let t=0;for(;t<e&&i[t].trim()==="";)t++;return i.substring(t,t+5).toLowerCase()==="data:"}function Ew(i){return typeof i=="string"&&/\.pdf$/i.test(i)}function bH(i){return[i]=i.split(/[#?]/,1),i.substring(i.lastIndexOf("/")+1)}function _H(i,e="document.pdf"){if(typeof i!="string")return e;if(Sw(i))return Je('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const t=/^(?:(?:[^:]+:)?\/\/[^/]+)?([^?#]*)(\?[^#]*)?(#.*)?$/,n=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i,s=t.exec(i);let o=n.exec(s[1])||n.exec(s[2])||n.exec(s[3]);if(o&&(o=o[0],o.includes("%")))try{o=n.exec(decodeURIComponent(o))[0]}catch{}return o||e}class ZC{constructor(){qe(this,"started",Object.create(null));qe(this,"times",[])}time(e){e in this.started&&Je(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Je(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:n}of this.times)t=Math.max(n.length,t);for(const{name:n,start:s,end:o}of this.times)e.push(`${n.padEnd(t)} ${o-s}ms
`);return e.join("")}}function uh(i,e){try{const{protocol:t}=e?new URL(i,e):new URL(i);return t==="http:"||t==="https:"}catch{return!1}}function di(i){i.preventDefault()}function PR(i){console.log("Deprecated API usage: "+i)}let e1;class OR{static toDateObject(e){if(!e||typeof e!="string")return null;e1||(e1=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const t=e1.exec(e);if(!t)return null;const n=parseInt(t[1],10);let s=parseInt(t[2],10);s=s>=1&&s<=12?s-1:0;let o=parseInt(t[3],10);o=o>=1&&o<=31?o:1;let l=parseInt(t[4],10);l=l>=0&&l<=23?l:0;let c=parseInt(t[5],10);c=c>=0&&c<=59?c:0;let d=parseInt(t[6],10);d=d>=0&&d<=59?d:0;const h=t[7]||"Z";let p=parseInt(t[8],10);p=p>=0&&p<=23?p:0;let y=parseInt(t[9],10)||0;return y=y>=0&&y<=59?y:0,h==="-"?(l+=p,c+=y):h==="+"&&(l-=p,c-=y),new Date(Date.UTC(n,s,o,l,c,d))}}function wH(i,{scale:e=1,rotation:t=0}){const{width:n,height:s}=i.attributes.style,o=[0,0,parseInt(n),parseInt(s)];return new yp({viewBox:o,scale:e,rotation:t})}function Aw(i){if(i.startsWith("#")){const e=parseInt(i.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return i.startsWith("rgb(")?i.slice(4,-1).split(",").map(e=>parseInt(e)):i.startsWith("rgba(")?i.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Je(`Not a valid color format: "${i}"`),[0,0,0])}function xH(i){const e=document.createElement("span");e.style.visibility="hidden",document.body.append(e);for(const t of i.keys()){e.style.color=t;const n=window.getComputedStyle(e).color;i.set(t,Aw(n))}e.remove()}function Lt(i){const{a:e,b:t,c:n,d:s,e:o,f:l}=i.getTransform();return[e,t,n,s,o,l]}function _r(i){const{a:e,b:t,c:n,d:s,e:o,f:l}=i.getTransform().invertSelf();return[e,t,n,s,o,l]}function Fl(i,e,t=!1,n=!0){if(e instanceof yp){const{pageWidth:s,pageHeight:o}=e.rawDims,{style:l}=i,c=ci.isCSSRoundSupported,d=`var(--scale-factor) * ${s}px`,h=`var(--scale-factor) * ${o}px`,p=c?`round(${d}, 1px)`:`calc(${d})`,y=c?`round(${h}, 1px)`:`calc(${h})`;!t||e.rotation%180===0?(l.width=p,l.height=y):(l.width=y,l.height=p)}n&&i.setAttribute("data-main-rotation",e.rotation)}var za,$a,Ei,Ya,Jg,UR,Kn,FR,HR,ag,BR,Xb;const Kg=class Kg{constructor(e){L(this,Kn);L(this,za,null);L(this,$a,null);L(this,Ei);L(this,Ya,null);N(this,Ei,e)}render(){const e=N(this,za,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar");const t=g(this,Ei)._uiManager._signal;e.addEventListener("contextmenu",di,{signal:t}),e.addEventListener("pointerdown",D(Kg,Jg,UR),{signal:t});const n=N(this,Ya,document.createElement("div"));n.className="buttons",e.append(n);const s=g(this,Ei).toolbarPosition;if(s){const{style:o}=e,l=g(this,Ei)._uiManager.direction==="ltr"?1-s[0]:s[0];o.insetInlineEnd=`${100*l}%`,o.top=`calc(${100*s[1]}% + var(--editor-toolbar-vert-offset))`}return D(this,Kn,BR).call(this),e}hide(){var e;g(this,za).classList.add("hidden"),(e=g(this,$a))==null||e.hideDropdown()}show(){g(this,za).classList.remove("hidden")}addAltTextButton(e){D(this,Kn,ag).call(this,e),g(this,Ya).prepend(e,g(this,Kn,Xb))}addColorPicker(e){N(this,$a,e);const t=e.renderButton();D(this,Kn,ag).call(this,t),g(this,Ya).prepend(t,g(this,Kn,Xb))}remove(){var e;g(this,za).remove(),(e=g(this,$a))==null||e.destroy(),N(this,$a,null)}};za=new WeakMap,$a=new WeakMap,Ei=new WeakMap,Ya=new WeakMap,Jg=new WeakSet,UR=function(e){e.stopPropagation()},Kn=new WeakSet,FR=function(e){g(this,Ei)._focusEventsAllowed=!1,e.preventDefault(),e.stopPropagation()},HR=function(e){g(this,Ei)._focusEventsAllowed=!0,e.preventDefault(),e.stopPropagation()},ag=function(e){const t=g(this,Ei)._uiManager._signal;e.addEventListener("focusin",D(this,Kn,FR).bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",D(this,Kn,HR).bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",di,{signal:t})},BR=function(){const e=document.createElement("button");e.className="delete",e.tabIndex=0,e.setAttribute("data-l10n-id",`pdfjs-editor-remove-${g(this,Ei).editorType}-button`),D(this,Kn,ag).call(this,e),e.addEventListener("click",t=>{g(this,Ei)._uiManager.delete()},{signal:g(this,Ei)._uiManager._signal}),g(this,Ya).append(e)},Xb=function(){const e=document.createElement("div");return e.className="divider",e},L(Kg,Jg);let Wb=Kg;var Uh,Ja,Ka,aa,jR,qR,GR;class SH{constructor(e){L(this,aa);L(this,Uh,null);L(this,Ja,null);L(this,Ka);N(this,Ka,e)}show(e,t,n){const[s,o]=D(this,aa,qR).call(this,t,n),{style:l}=g(this,Ja)||N(this,Ja,D(this,aa,jR).call(this));e.append(g(this,Ja)),l.insetInlineEnd=`${100*s}%`,l.top=`calc(${100*o}% + var(--editor-toolbar-vert-offset))`}hide(){g(this,Ja).remove()}}Uh=new WeakMap,Ja=new WeakMap,Ka=new WeakMap,aa=new WeakSet,jR=function(){const e=N(this,Ja,document.createElement("div"));e.className="editToolbar",e.setAttribute("role","toolbar"),e.addEventListener("contextmenu",di,{signal:g(this,Ka)._signal});const t=N(this,Uh,document.createElement("div"));return t.className="buttons",e.append(t),D(this,aa,GR).call(this),e},qR=function(e,t){let n=0,s=0;for(const o of e){const l=o.y+o.height;if(l<n)continue;const c=o.x+(t?o.width:0);if(l>n){s=c,n=l;continue}t?c>s&&(s=c):c<s&&(s=c)}return[t?1-s:s,n]},GR=function(){const e=document.createElement("button");e.className="highlightButton",e.tabIndex=0,e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const t=document.createElement("span");e.append(t),t.className="visuallyHidden",t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const n=g(this,Ka)._signal;e.addEventListener("contextmenu",di,{signal:n}),e.addEventListener("click",()=>{g(this,Ka).highlightSelection("floating_button")},{signal:n}),g(this,Uh).append(e)};function jg(i,e,t){for(const n of t)e.addEventListener(n,i[n].bind(i))}function EH(i){return Math.round(Math.min(255,Math.max(1,255*i))).toString(16).padStart(2,"0")}var Wg;class AH{constructor(){L(this,Wg,0)}get id(){return`${iH}${_i(this,Wg)._++}`}}Wg=new WeakMap;var Fh,Xg,Yi,Hh,Zb;const kw=class kw{constructor(){L(this,Hh);L(this,Fh,gH());L(this,Xg,0);L(this,Yi,null)}static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',n=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),s=new Image;s.src=e;const o=s.decode().then(()=>(n.drawImage(s,0,0,1,1,0,0,1,3),new Uint32Array(n.getImageData(0,0,1,1).data.buffer)[0]===0));return st(this,"_isSVGFittingCanvas",o)}async getFromFile(e){const{lastModified:t,name:n,size:s,type:o}=e;return D(this,Hh,Zb).call(this,`${t}_${n}_${s}_${o}`,e)}async getFromUrl(e){return D(this,Hh,Zb).call(this,e,e)}async getFromId(e){g(this,Yi)||N(this,Yi,new Map);const t=g(this,Yi).get(e);return t?t.bitmap?(t.refCounter+=1,t):t.file?this.getFromFile(t.file):this.getFromUrl(t.url):null}getSvgUrl(e){const t=g(this,Yi).get(e);return t!=null&&t.isSvg?t.svgUrl:null}deleteId(e){g(this,Yi)||N(this,Yi,new Map);const t=g(this,Yi).get(e);t&&(t.refCounter-=1,t.refCounter===0&&(t.bitmap=null))}isValidId(e){return e.startsWith(`image_${g(this,Fh)}_`)}};Fh=new WeakMap,Xg=new WeakMap,Yi=new WeakMap,Hh=new WeakSet,Zb=async function(e,t){g(this,Yi)||N(this,Yi,new Map);let n=g(this,Yi).get(e);if(n===null)return null;if(n!=null&&n.bitmap)return n.refCounter+=1,n;try{n||(n={bitmap:null,id:`image_${g(this,Fh)}_${_i(this,Xg)._++}`,refCounter:0,isSvg:!1});let s;if(typeof t=="string"?(n.url=t,s=await N0(t,"blob")):s=n.file=t,s.type==="image/svg+xml"){const o=kw._isSVGFittingCanvas,l=new FileReader,c=new Image,d=new Promise((h,p)=>{c.onload=()=>{n.bitmap=c,n.isSvg=!0,h()},l.onload=async()=>{const y=n.svgUrl=l.result;c.src=await o?`${y}#svgView(preserveAspectRatio(none))`:y},c.onerror=l.onerror=p});l.readAsDataURL(s),await d}else n.bitmap=await createImageBitmap(s);n.refCounter=1}catch(s){console.error(s),n=null}return g(this,Yi).set(e,n),n&&g(this,Yi).set(n.id,n),n};let Qb=kw;var hn,Ho,Bh,fn;class TH{constructor(e=128){L(this,hn,[]);L(this,Ho,!1);L(this,Bh);L(this,fn,-1);N(this,Bh,e)}add({cmd:e,undo:t,post:n,mustExec:s,type:o=NaN,overwriteIfSameType:l=!1,keepUndo:c=!1}){if(s&&e(),g(this,Ho))return;const d={cmd:e,undo:t,post:n,type:o};if(g(this,fn)===-1){g(this,hn).length>0&&(g(this,hn).length=0),N(this,fn,0),g(this,hn).push(d);return}if(l&&g(this,hn)[g(this,fn)].type===o){c&&(d.undo=g(this,hn)[g(this,fn)].undo),g(this,hn)[g(this,fn)]=d;return}const h=g(this,fn)+1;h===g(this,Bh)?g(this,hn).splice(0,1):(N(this,fn,h),h<g(this,hn).length&&g(this,hn).splice(h)),g(this,hn).push(d)}undo(){if(g(this,fn)===-1)return;N(this,Ho,!0);const{undo:e,post:t}=g(this,hn)[g(this,fn)];e(),t==null||t(),N(this,Ho,!1),N(this,fn,g(this,fn)-1)}redo(){if(g(this,fn)<g(this,hn).length-1){N(this,fn,g(this,fn)+1),N(this,Ho,!0);const{cmd:e,post:t}=g(this,hn)[g(this,fn)];e(),t==null||t(),N(this,Ho,!1)}}hasSomethingToUndo(){return g(this,fn)!==-1}hasSomethingToRedo(){return g(this,fn)<g(this,hn).length-1}destroy(){N(this,hn,null)}}hn=new WeakMap,Ho=new WeakMap,Bh=new WeakMap,fn=new WeakMap;var Qg,VR;class bp{constructor(e){L(this,Qg);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=ci.platform;for(const[n,s,o={}]of e)for(const l of n){const c=l.startsWith("mac+");t&&c?(this.callbacks.set(l.slice(4),{callback:s,options:o}),this.allKeys.add(l.split("+").at(-1))):!t&&!c&&(this.callbacks.set(l,{callback:s,options:o}),this.allKeys.add(l.split("+").at(-1)))}}exec(e,t){if(!this.allKeys.has(t.key))return;const n=this.callbacks.get(D(this,Qg,VR).call(this,t));if(!n)return;const{callback:s,options:{bubbles:o=!1,args:l=[],checker:c=null}}=n;c&&!c(e,t)||(s.bind(e,...l,t)(),o||(t.stopPropagation(),t.preventDefault()))}}Qg=new WeakSet,VR=function(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t};const Zg=class Zg{get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return xH(e),st(this,"_colors",e)}convert(e){const t=Aw(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[n,s]of this._colors)if(s.every((o,l)=>o===t[l]))return Zg._colorsMapping.get(n);return t}getHexCode(e){const t=this._colors.get(e);return t?Ee.makeHexColor(...t):e}};qe(Zg,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let e_=Zg;var ru,Ai,rn,An,ou,Rr,au,ls,lu,Wa,Ls,cs,Xa,jh,qh,Ps,cu,Bo,Os,e0,jo,Gh,Qa,Vh,uu,Tn,gt,Nr,Za,zh,$h,Yh,Jh,Kh,Wh,Xh,Qh,Zh,ef,tf,nf,sf,qo,Us,kr,rf,ge,lg,zR,$R,cg,YR,JR,KR,t_,WR,n_,i_,XR,Vn,Do,QR,ZR,s_,eN,dh,r_;const Zc=class Zc{constructor(e,t,n,s,o,l,c,d,h){L(this,ge);L(this,ru,new AbortController);L(this,Ai,null);L(this,rn,new Map);L(this,An,new Map);L(this,ou,null);L(this,Rr,null);L(this,au,null);L(this,ls,new TH);L(this,lu,0);L(this,Wa,new Set);L(this,Ls,null);L(this,cs,null);L(this,Xa,new Set);L(this,jh,!1);L(this,qh,null);L(this,Ps,null);L(this,cu,null);L(this,Bo,!1);L(this,Os,null);L(this,e0,new AH);L(this,jo,!1);L(this,Gh,!1);L(this,Qa,null);L(this,Vh,null);L(this,uu,null);L(this,Tn,it.NONE);L(this,gt,new Set);L(this,Nr,null);L(this,Za,null);L(this,zh,null);L(this,$h,this.blur.bind(this));L(this,Yh,this.focus.bind(this));L(this,Jh,this.copy.bind(this));L(this,Kh,this.cut.bind(this));L(this,Wh,this.paste.bind(this));L(this,Xh,this.keydown.bind(this));L(this,Qh,this.keyup.bind(this));L(this,Zh,this.onEditingAction.bind(this));L(this,ef,this.onPageChanging.bind(this));L(this,tf,this.onScaleChanging.bind(this));L(this,nf,this.onRotationChanging.bind(this));L(this,sf,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});L(this,qo,[0,0]);L(this,Us,null);L(this,kr,null);L(this,rf,null);this._signal=g(this,ru).signal,N(this,kr,e),N(this,rf,t),N(this,ou,n),this._eventBus=s,this._eventBus._on("editingaction",g(this,Zh)),this._eventBus._on("pagechanging",g(this,ef)),this._eventBus._on("scalechanging",g(this,tf)),this._eventBus._on("rotationchanging",g(this,nf)),D(this,ge,YR).call(this),D(this,ge,XR).call(this),D(this,ge,t_).call(this),N(this,Rr,o.annotationStorage),N(this,qh,o.filterFactory),N(this,Za,l),N(this,cu,c||null),N(this,jh,d),N(this,uu,h||null),this.viewParameters={realScale:oa.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1}static get _keyboardManager(){const e=Zc.prototype,t=l=>g(l,kr).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&l.hasSomethingToControl(),n=(l,{target:c})=>{if(c instanceof HTMLInputElement){const{type:d}=c;return d!=="text"&&d!=="number"}return!0},s=this.TRANSLATE_SMALL,o=this.TRANSLATE_BIG;return st(this,"_keyboardManager",new bp([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:n}],[["ctrl+z","mac+meta+z"],e.undo,{checker:n}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:n}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:n}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(l,{target:c})=>!(c instanceof HTMLButtonElement)&&g(l,kr).contains(c)&&!l.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(l,{target:c})=>!(c instanceof HTMLButtonElement)&&g(l,kr).contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-s,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-o,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[s,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[o,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-s],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-o],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,s],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,o],checker:t}]]))}destroy(){var e,t,n;(e=g(this,ru))==null||e.abort(),N(this,ru,null),this._signal=null,this._eventBus._off("editingaction",g(this,Zh)),this._eventBus._off("pagechanging",g(this,ef)),this._eventBus._off("scalechanging",g(this,tf)),this._eventBus._off("rotationchanging",g(this,nf));for(const s of g(this,An).values())s.destroy();g(this,An).clear(),g(this,rn).clear(),g(this,Xa).clear(),N(this,Ai,null),g(this,gt).clear(),g(this,ls).destroy(),(t=g(this,ou))==null||t.destroy(),(n=g(this,Os))==null||n.hide(),N(this,Os,null),g(this,Ps)&&(clearTimeout(g(this,Ps)),N(this,Ps,null)),g(this,Us)&&(clearTimeout(g(this,Us)),N(this,Us,null))}async mlGuess(e){var t;return((t=g(this,uu))==null?void 0:t.guess(e))||null}get hasMLManager(){return!!g(this,uu)}get hcmFilter(){return st(this,"hcmFilter",g(this,Za)?g(this,qh).addHCMFilter(g(this,Za).foreground,g(this,Za).background):"none")}get direction(){return st(this,"direction",getComputedStyle(g(this,kr)).direction)}get highlightColors(){return st(this,"highlightColors",g(this,cu)?new Map(g(this,cu).split(",").map(e=>e.split("=").map(t=>t.trim()))):null)}get highlightColorNames(){return st(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}setMainHighlightColorPicker(e){N(this,Vh,e)}editAltText(e){var t;(t=g(this,ou))==null||t.editAltText(this,e)}onPageChanging({pageNumber:e}){N(this,lu,e-1)}focusMainContainer(){g(this,kr).focus()}findParent(e,t){for(const n of g(this,An).values()){const{x:s,y:o,width:l,height:c}=n.div.getBoundingClientRect();if(e>=s&&e<=s+l&&t>=o&&t<=o+c)return n}return null}disableUserSelect(e=!1){g(this,rf).classList.toggle("noUserSelect",e)}addShouldRescale(e){g(this,Xa).add(e)}removeShouldRescale(e){g(this,Xa).delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*oa.PDF_TO_CSS_UNITS;for(const t of g(this,Xa))t.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}highlightSelection(e=""){const t=document.getSelection();if(!t||t.isCollapsed)return;const{anchorNode:n,anchorOffset:s,focusNode:o,focusOffset:l}=t,c=t.toString(),h=D(this,ge,lg).call(this,t).closest(".textLayer"),p=this.getSelectionBoxes(h);if(p){t.empty(),g(this,Tn)===it.NONE&&(this._eventBus.dispatch("showannotationeditorui",{source:this,mode:it.HIGHLIGHT}),this.showAllEditors("highlight",!0,!0));for(const y of g(this,An).values())if(y.hasTextLayer(h)){y.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:p,anchorNode:n,anchorOffset:s,focusNode:o,focusOffset:l,text:c});break}}}addToAnnotationStorage(e){!e.isEmpty()&&g(this,Rr)&&!g(this,Rr).has(e.id)&&g(this,Rr).setValue(e.id,e)}blur(){if(this.isShiftKeyDown=!1,g(this,Bo)&&(N(this,Bo,!1),D(this,ge,cg).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of g(this,gt))if(t.div.contains(e)){N(this,Qa,[t,e]),t._focusEventsAllowed=!1;break}}focus(){if(!g(this,Qa))return;const[e,t]=g(this,Qa);N(this,Qa,null),t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}addEditListeners(){D(this,ge,t_).call(this),D(this,ge,n_).call(this)}removeEditListeners(){D(this,ge,WR).call(this),D(this,ge,i_).call(this)}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const n of g(this,cs))if(n.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const n of g(this,cs))if(n.isHandlingMimeForPasting(t.type)){n.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){var n;if(e.preventDefault(),(n=g(this,Ai))==null||n.commitOrRemove(),!this.hasSelection)return;const t=[];for(const s of g(this,gt)){const o=s.serialize(!0);o&&t.push(o)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}paste(e){e.preventDefault();const{clipboardData:t}=e;for(const o of t.items)for(const l of g(this,cs))if(l.isHandlingMimeForPasting(o.type)){l.paste(o,this.currentLayer);return}let n=t.getData("application/pdfjs");if(!n)return;try{n=JSON.parse(n)}catch(o){Je(`paste: "${o.message}".`);return}if(!Array.isArray(n))return;this.unselectAll();const s=this.currentLayer;try{const o=[];for(const d of n){const h=s.deserialize(d);if(!h)return;o.push(h)}const l=()=>{for(const d of o)D(this,ge,s_).call(this,d);D(this,ge,r_).call(this,o)},c=()=>{for(const d of o)d.remove()};this.addCommands({cmd:l,undo:c,mustExec:!0})}catch(o){Je(`paste: "${o.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),g(this,Tn)!==it.NONE&&!this.isEditorHandlingKeyboard&&Zc._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,g(this,Bo)&&(N(this,Bo,!1),D(this,ge,cg).call(this,"main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(e){e?(D(this,ge,JR).call(this),D(this,ge,n_).call(this),D(this,ge,Vn).call(this,{isEditing:g(this,Tn)!==it.NONE,isEmpty:D(this,ge,dh).call(this),hasSomethingToUndo:g(this,ls).hasSomethingToUndo(),hasSomethingToRedo:g(this,ls).hasSomethingToRedo(),hasSelectedEditor:!1})):(D(this,ge,KR).call(this),D(this,ge,i_).call(this),D(this,ge,Vn).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!g(this,cs)){N(this,cs,e);for(const t of g(this,cs))D(this,ge,Do).call(this,t.defaultPropertiesToUpdate)}}getId(){return g(this,e0).id}get currentLayer(){return g(this,An).get(g(this,lu))}getLayer(e){return g(this,An).get(e)}get currentPageIndex(){return g(this,lu)}addLayer(e){g(this,An).set(e.pageIndex,e),g(this,jo)?e.enable():e.disable()}removeLayer(e){g(this,An).delete(e.pageIndex)}updateMode(e,t=null,n=!1){if(g(this,Tn)!==e){if(N(this,Tn,e),e===it.NONE){this.setEditingState(!1),D(this,ge,ZR).call(this);return}this.setEditingState(!0),D(this,ge,QR).call(this),this.unselectAll();for(const s of g(this,An).values())s.updateMode(e);if(!t&&n){this.addNewEditorFromKeyboard();return}if(t){for(const s of g(this,rn).values())if(s.annotationElementId===t){this.setSelected(s),s.enterInEditMode();break}}}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e!==g(this,Tn)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,mode:e})}updateParams(e,t){var n;if(g(this,cs)){switch(e){case Fe.CREATE:this.currentLayer.addNewEditor();return;case Fe.HIGHLIGHT_DEFAULT_COLOR:(n=g(this,Vh))==null||n.updateColor(t);break;case Fe.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(g(this,zh)||N(this,zh,new Map)).set(e,t),this.showAllEditors("highlight",t);break}for(const s of g(this,gt))s.updateParams(e,t);for(const s of g(this,cs))s.updateDefaultParams(e,t)}}showAllEditors(e,t,n=!1){var o;for(const l of g(this,rn).values())l.editorType===e&&l.show(t);(((o=g(this,zh))==null?void 0:o.get(Fe.HIGHLIGHT_SHOW_ALL))??!0)!==t&&D(this,ge,Do).call(this,[[Fe.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(g(this,Gh)!==e){N(this,Gh,e);for(const t of g(this,An).values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}getEditors(e){const t=[];for(const n of g(this,rn).values())n.pageIndex===e&&t.push(n);return t}getEditor(e){return g(this,rn).get(e)}addEditor(e){g(this,rn).set(e.id,e)}removeEditor(e){var t;e.div.contains(document.activeElement)&&(g(this,Ps)&&clearTimeout(g(this,Ps)),N(this,Ps,setTimeout(()=>{this.focusMainContainer(),N(this,Ps,null)},0))),g(this,rn).delete(e.id),this.unselect(e),(!e.annotationElementId||!g(this,Wa).has(e.annotationElementId))&&((t=g(this,Rr))==null||t.remove(e.id))}addDeletedAnnotationElement(e){g(this,Wa).add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return g(this,Wa).has(e)}removeDeletedAnnotationElement(e){g(this,Wa).delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}setActiveEditor(e){g(this,Ai)!==e&&(N(this,Ai,e),e&&D(this,ge,Do).call(this,e.propertiesToUpdate))}updateUI(e){g(this,ge,eN)===e&&D(this,ge,Do).call(this,e.propertiesToUpdate)}toggleSelected(e){if(g(this,gt).has(e)){g(this,gt).delete(e),e.unselect(),D(this,ge,Vn).call(this,{hasSelectedEditor:this.hasSelection});return}g(this,gt).add(e),e.select(),D(this,ge,Do).call(this,e.propertiesToUpdate),D(this,ge,Vn).call(this,{hasSelectedEditor:!0})}setSelected(e){for(const t of g(this,gt))t!==e&&t.unselect();g(this,gt).clear(),g(this,gt).add(e),e.select(),D(this,ge,Do).call(this,e.propertiesToUpdate),D(this,ge,Vn).call(this,{hasSelectedEditor:!0})}isSelected(e){return g(this,gt).has(e)}get firstSelectedEditor(){return g(this,gt).values().next().value}unselect(e){e.unselect(),g(this,gt).delete(e),D(this,ge,Vn).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return g(this,gt).size!==0}get isEnterHandled(){return g(this,gt).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){g(this,ls).undo(),D(this,ge,Vn).call(this,{hasSomethingToUndo:g(this,ls).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:D(this,ge,dh).call(this)})}redo(){g(this,ls).redo(),D(this,ge,Vn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:g(this,ls).hasSomethingToRedo(),isEmpty:D(this,ge,dh).call(this)})}addCommands(e){g(this,ls).add(e),D(this,ge,Vn).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:D(this,ge,dh).call(this)})}delete(){if(this.commitOrRemove(),!this.hasSelection)return;const e=[...g(this,gt)],t=()=>{for(const s of e)s.remove()},n=()=>{for(const s of e)D(this,ge,s_).call(this,s)};this.addCommands({cmd:t,undo:n,mustExec:!0})}commitOrRemove(){var e;(e=g(this,Ai))==null||e.commitOrRemove()}hasSomethingToControl(){return g(this,Ai)||this.hasSelection}selectAll(){for(const e of g(this,gt))e.commit();D(this,ge,r_).call(this,g(this,rn).values())}unselectAll(){if(!(g(this,Ai)&&(g(this,Ai).commitOrRemove(),g(this,Tn)!==it.NONE))&&this.hasSelection){for(const e of g(this,gt))e.unselect();g(this,gt).clear(),D(this,ge,Vn).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(e,t,n=!1){if(n||this.commitOrRemove(),!this.hasSelection)return;g(this,qo)[0]+=e,g(this,qo)[1]+=t;const[s,o]=g(this,qo),l=[...g(this,gt)],c=1e3;g(this,Us)&&clearTimeout(g(this,Us)),N(this,Us,setTimeout(()=>{N(this,Us,null),g(this,qo)[0]=g(this,qo)[1]=0,this.addCommands({cmd:()=>{for(const d of l)g(this,rn).has(d.id)&&d.translateInPage(s,o)},undo:()=>{for(const d of l)g(this,rn).has(d.id)&&d.translateInPage(-s,-o)},mustExec:!1})},c));for(const d of l)d.translateInPage(e,t)}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),N(this,Ls,new Map);for(const e of g(this,gt))g(this,Ls).set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!g(this,Ls))return!1;this.disableUserSelect(!1);const e=g(this,Ls);N(this,Ls,null);let t=!1;for(const[{x:s,y:o,pageIndex:l},c]of e)c.newX=s,c.newY=o,c.newPageIndex=l,t||(t=s!==c.savedX||o!==c.savedY||l!==c.savedPageIndex);if(!t)return!1;const n=(s,o,l,c)=>{if(g(this,rn).has(s.id)){const d=g(this,An).get(c);d?s._setParentAndPosition(d,o,l):(s.pageIndex=c,s.x=o,s.y=l)}};return this.addCommands({cmd:()=>{for(const[s,{newX:o,newY:l,newPageIndex:c}]of e)n(s,o,l,c)},undo:()=>{for(const[s,{savedX:o,savedY:l,savedPageIndex:c}]of e)n(s,o,l,c)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(g(this,Ls))for(const n of g(this,Ls).keys())n.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){var e;return((e=this.getActive())==null?void 0:e.shouldGetKeyboardEvents())||g(this,gt).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return g(this,Ai)===e}getActive(){return g(this,Ai)}getMode(){return g(this,Tn)}get imageManager(){return st(this,"imageManager",new Qb)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let h=0,p=t.rangeCount;h<p;h++)if(!e.contains(t.getRangeAt(h).commonAncestorContainer))return null;const{x:n,y:s,width:o,height:l}=e.getBoundingClientRect();let c;switch(e.getAttribute("data-main-rotation")){case"90":c=(h,p,y,b)=>({x:(p-s)/l,y:1-(h+y-n)/o,width:b/l,height:y/o});break;case"180":c=(h,p,y,b)=>({x:1-(h+y-n)/o,y:1-(p+b-s)/l,width:y/o,height:b/l});break;case"270":c=(h,p,y,b)=>({x:1-(p+b-s)/l,y:(h-n)/o,width:b/l,height:y/o});break;default:c=(h,p,y,b)=>({x:(h-n)/o,y:(p-s)/l,width:y/o,height:b/l});break}const d=[];for(let h=0,p=t.rangeCount;h<p;h++){const y=t.getRangeAt(h);if(!y.collapsed)for(const{x:b,y:S,width:E,height:R}of y.getClientRects())E===0||R===0||d.push(c(b,S,E,R))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:e,id:t}){(g(this,au)||N(this,au,new Map)).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){var t;(t=g(this,au))==null||t.delete(e)}renderAnnotationElement(e){var s;const t=(s=g(this,au))==null?void 0:s.get(e.data.id);if(!t)return;const n=g(this,Rr).getRawValue(t);n&&(g(this,Tn)===it.NONE&&!n.hasBeenModified||n.renderAnnotationElement(e))}};ru=new WeakMap,Ai=new WeakMap,rn=new WeakMap,An=new WeakMap,ou=new WeakMap,Rr=new WeakMap,au=new WeakMap,ls=new WeakMap,lu=new WeakMap,Wa=new WeakMap,Ls=new WeakMap,cs=new WeakMap,Xa=new WeakMap,jh=new WeakMap,qh=new WeakMap,Ps=new WeakMap,cu=new WeakMap,Bo=new WeakMap,Os=new WeakMap,e0=new WeakMap,jo=new WeakMap,Gh=new WeakMap,Qa=new WeakMap,Vh=new WeakMap,uu=new WeakMap,Tn=new WeakMap,gt=new WeakMap,Nr=new WeakMap,Za=new WeakMap,zh=new WeakMap,$h=new WeakMap,Yh=new WeakMap,Jh=new WeakMap,Kh=new WeakMap,Wh=new WeakMap,Xh=new WeakMap,Qh=new WeakMap,Zh=new WeakMap,ef=new WeakMap,tf=new WeakMap,nf=new WeakMap,sf=new WeakMap,qo=new WeakMap,Us=new WeakMap,kr=new WeakMap,rf=new WeakMap,ge=new WeakSet,lg=function({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e},zR=function(){const e=document.getSelection();if(!e||e.isCollapsed)return;const n=D(this,ge,lg).call(this,e).closest(".textLayer"),s=this.getSelectionBoxes(n);s&&(g(this,Os)||N(this,Os,new SH(this)),g(this,Os).show(n,s,this.direction==="ltr"))},$R=function(){var o,l,c;const e=document.getSelection();if(!e||e.isCollapsed){g(this,Nr)&&((o=g(this,Os))==null||o.hide(),N(this,Nr,null),D(this,ge,Vn).call(this,{hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===g(this,Nr))return;if(!D(this,ge,lg).call(this,e).closest(".textLayer")){g(this,Nr)&&((l=g(this,Os))==null||l.hide(),N(this,Nr,null),D(this,ge,Vn).call(this,{hasSelectedText:!1}));return}if((c=g(this,Os))==null||c.hide(),N(this,Nr,t),D(this,ge,Vn).call(this,{hasSelectedText:!0}),!(g(this,Tn)!==it.HIGHLIGHT&&g(this,Tn)!==it.NONE)&&(g(this,Tn)===it.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),N(this,Bo,this.isShiftKeyDown),!this.isShiftKeyDown)){const d=this._signal,h=p=>{p.type==="pointerup"&&p.button!==0||(window.removeEventListener("pointerup",h),window.removeEventListener("blur",h),p.type==="pointerup"&&D(this,ge,cg).call(this,"main_toolbar"))};window.addEventListener("pointerup",h,{signal:d}),window.addEventListener("blur",h,{signal:d})}},cg=function(e=""){g(this,Tn)===it.HIGHLIGHT?this.highlightSelection(e):g(this,jh)&&D(this,ge,zR).call(this)},YR=function(){document.addEventListener("selectionchange",D(this,ge,$R).bind(this),{signal:this._signal})},JR=function(){const e=this._signal;window.addEventListener("focus",g(this,Yh),{signal:e}),window.addEventListener("blur",g(this,$h),{signal:e})},KR=function(){window.removeEventListener("focus",g(this,Yh)),window.removeEventListener("blur",g(this,$h))},t_=function(){const e=this._signal;window.addEventListener("keydown",g(this,Xh),{signal:e}),window.addEventListener("keyup",g(this,Qh),{signal:e})},WR=function(){window.removeEventListener("keydown",g(this,Xh)),window.removeEventListener("keyup",g(this,Qh))},n_=function(){const e=this._signal;document.addEventListener("copy",g(this,Jh),{signal:e}),document.addEventListener("cut",g(this,Kh),{signal:e}),document.addEventListener("paste",g(this,Wh),{signal:e})},i_=function(){document.removeEventListener("copy",g(this,Jh)),document.removeEventListener("cut",g(this,Kh)),document.removeEventListener("paste",g(this,Wh))},XR=function(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})},Vn=function(e){Object.entries(e).some(([n,s])=>g(this,sf)[n]!==s)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(g(this,sf),e)}),g(this,Tn)===it.HIGHLIGHT&&e.hasSelectedEditor===!1&&D(this,ge,Do).call(this,[[Fe.HIGHLIGHT_FREE,!0]]))},Do=function(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})},QR=function(){if(!g(this,jo)){N(this,jo,!0);for(const e of g(this,An).values())e.enable();for(const e of g(this,rn).values())e.enable()}},ZR=function(){if(this.unselectAll(),g(this,jo)){N(this,jo,!1);for(const e of g(this,An).values())e.disable();for(const e of g(this,rn).values())e.disable()}},s_=function(e){const t=g(this,An).get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))},eN=function(){let e=null;for(e of g(this,gt));return e},dh=function(){if(g(this,rn).size===0)return!0;if(g(this,rn).size===1)for(const e of g(this,rn).values())return e.isEmpty();return!1},r_=function(e){for(const t of g(this,gt))t.unselect();g(this,gt).clear();for(const t of e)t.isEmpty()||(g(this,gt).add(t),t.select());D(this,ge,Vn).call(this,{hasSelectedEditor:this.hasSelection})},qe(Zc,"TRANSLATE_SMALL",1),qe(Zc,"TRANSLATE_BIG",10);let Hl=Zc;var Ir,Mr,us,Dr,Ti,du,ds,of,o_;const Sr=class Sr{constructor(e){L(this,of);L(this,Ir,"");L(this,Mr,!1);L(this,us,null);L(this,Dr,null);L(this,Ti,null);L(this,du,!1);L(this,ds,null);N(this,ds,e)}static initialize(e){Sr._l10nPromise||(Sr._l10nPromise=e)}async render(){const e=N(this,us,document.createElement("button"));e.className="altText";const t=await Sr._l10nPromise.get("pdfjs-editor-alt-text-button-label");e.textContent=t,e.setAttribute("aria-label",t),e.tabIndex="0";const n=g(this,ds)._uiManager._signal;e.addEventListener("contextmenu",di,{signal:n}),e.addEventListener("pointerdown",o=>o.stopPropagation(),{signal:n});const s=o=>{o.preventDefault(),g(this,ds)._uiManager.editAltText(g(this,ds))};return e.addEventListener("click",s,{capture:!0,signal:n}),e.addEventListener("keydown",o=>{o.target===e&&o.key==="Enter"&&(N(this,du,!0),s(o))},{signal:n}),await D(this,of,o_).call(this),e}finish(){g(this,us)&&(g(this,us).focus({focusVisible:g(this,du)}),N(this,du,!1))}isEmpty(){return!g(this,Ir)&&!g(this,Mr)}get data(){return{altText:g(this,Ir),decorative:g(this,Mr)}}set data({altText:e,decorative:t}){g(this,Ir)===e&&g(this,Mr)===t||(N(this,Ir,e),N(this,Mr,t),D(this,of,o_).call(this))}toggle(e=!1){g(this,us)&&(!e&&g(this,Ti)&&(clearTimeout(g(this,Ti)),N(this,Ti,null)),g(this,us).disabled=!e)}destroy(){var e;(e=g(this,us))==null||e.remove(),N(this,us,null),N(this,Dr,null)}};Ir=new WeakMap,Mr=new WeakMap,us=new WeakMap,Dr=new WeakMap,Ti=new WeakMap,du=new WeakMap,ds=new WeakMap,of=new WeakSet,o_=async function(){var s;const e=g(this,us);if(!e)return;if(!g(this,Ir)&&!g(this,Mr)){e.classList.remove("done"),(s=g(this,Dr))==null||s.remove();return}e.classList.add("done"),Sr._l10nPromise.get("pdfjs-editor-alt-text-edit-button-label").then(o=>{e.setAttribute("aria-label",o)});let t=g(this,Dr);if(!t){N(this,Dr,t=document.createElement("span")),t.className="tooltip",t.setAttribute("role","tooltip");const o=t.id=`alt-text-tooltip-${g(this,ds).id}`;e.setAttribute("aria-describedby",o);const l=100,c=g(this,ds)._uiManager._signal;c.addEventListener("abort",()=>{clearTimeout(g(this,Ti)),N(this,Ti,null)},{once:!0}),e.addEventListener("mouseenter",()=>{N(this,Ti,setTimeout(()=>{N(this,Ti,null),g(this,Dr).classList.add("show"),g(this,ds)._reportTelemetry({action:"alt_text_tooltip"})},l))},{signal:c}),e.addEventListener("mouseleave",()=>{var d;g(this,Ti)&&(clearTimeout(g(this,Ti)),N(this,Ti,null)),(d=g(this,Dr))==null||d.classList.remove("show")},{signal:c})}t.innerText=g(this,Mr)?await Sr._l10nPromise.get("pdfjs-editor-alt-text-decorative-tooltip"):g(this,Ir),t.parentNode||e.append(t);const n=g(this,ds).getImageForAltText();n==null||n.setAttribute("aria-describedby",t.id)},qe(Sr,"_l10nPromise",null);let qg=Sr;var el,hs,Un,hu,tl,Cn,nl,fu,pu,Fn,af,il,Go,lf,sl,Lr,Fs,mu,gu,Ji,cf,t0,Xe,a_,uf,l_,c_,tN,nN,u_,d_,h_,iN,sN,rN,oN,f_,hh;const At=class At{constructor(e){L(this,Xe);L(this,el,null);L(this,hs,null);L(this,Un,null);L(this,hu,!1);L(this,tl,!1);L(this,Cn,null);L(this,nl,null);L(this,fu,this.focusin.bind(this));L(this,pu,this.focusout.bind(this));L(this,Fn,null);L(this,af,"");L(this,il,!1);L(this,Go,null);L(this,lf,!1);L(this,sl,!1);L(this,Lr,!1);L(this,Fs,null);L(this,mu,0);L(this,gu,0);L(this,Ji,null);qe(this,"_initialOptions",Object.create(null));qe(this,"_isVisible",!0);qe(this,"_uiManager",null);qe(this,"_focusEventsAllowed",!0);qe(this,"_l10nPromise",null);L(this,cf,!1);L(this,t0,At._zIndex++);this.constructor===At&&xt("Cannot initialize AnnotationEditor."),this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null;const{rotation:t,rawDims:{pageWidth:n,pageHeight:s,pageX:o,pageY:l}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[n,s],this.pageTranslation=[o,l];const[c,d]=this.parentDimensions;this.x=e.x/c,this.y=e.y/d,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const e=At.prototype._resizeWithKeyboard,t=Hl.TRANSLATE_SMALL,n=Hl.TRANSLATE_BIG;return st(this,"_resizerKeyboardManager",new bp([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-n,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[n,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-n]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,n]}],[["Escape","mac+Escape"],At.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}static get _defaultLineColor(){return st(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new CH({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t,n){if(At._l10nPromise||(At._l10nPromise=new Map(["pdfjs-editor-alt-text-button-label","pdfjs-editor-alt-text-edit-button-label","pdfjs-editor-alt-text-decorative-tooltip","pdfjs-editor-resizer-label-topLeft","pdfjs-editor-resizer-label-topMiddle","pdfjs-editor-resizer-label-topRight","pdfjs-editor-resizer-label-middleRight","pdfjs-editor-resizer-label-bottomRight","pdfjs-editor-resizer-label-bottomMiddle","pdfjs-editor-resizer-label-bottomLeft","pdfjs-editor-resizer-label-middleLeft"].map(o=>[o,e.get(o.replaceAll(/([A-Z])/g,l=>`-${l.toLowerCase()}`))]))),n!=null&&n.strings)for(const o of n.strings)At._l10nPromise.set(o,e.get(o));if(At._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);At._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){xt("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return g(this,cf)}set _isDraggable(e){var t;N(this,cf,e),(t=this.div)==null||t.classList.toggle("draggable",e)}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=g(this,t0)}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):D(this,Xe,hh).call(this),this.parent=e}focusin(e){this._focusEventsAllowed&&(g(this,il)?N(this,il,!1):this.parent.setSelected(this))}focusout(e){var n;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const t=e.relatedTarget;t!=null&&t.closest(`#${this.id}`)||(e.preventDefault(),(n=this.parent)!=null&&n.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,n,s){const[o,l]=this.parentDimensions;[n,s]=this.screenToPageTranslation(n,s),this.x=(e+n)/o,this.y=(t+s)/l,this.fixAndSetPosition()}translate(e,t){D(this,Xe,a_).call(this,this.parentDimensions,e,t)}translateInPage(e,t){g(this,Go)||N(this,Go,[this.x,this.y]),D(this,Xe,a_).call(this,this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}drag(e,t){g(this,Go)||N(this,Go,[this.x,this.y]);const[n,s]=this.parentDimensions;if(this.x+=e/n,this.y+=t/s,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:h,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,h,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:l}=this;const[c,d]=this.getBaseTranslation();o+=c,l+=d,this.div.style.left=`${(100*o).toFixed(2)}%`,this.div.style.top=`${(100*l).toFixed(2)}%`,this.div.scrollIntoView({block:"nearest"})}get _hasBeenMoved(){return!!g(this,Go)&&(g(this,Go)[0]!==this.x||g(this,Go)[1]!==this.y)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:n}=At,s=n/e,o=n/t;switch(this.rotation){case 90:return[-s,o];case 180:return[s,o];case 270:return[s,-o];default:return[-s,-o]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const[t,n]=this.pageDimensions;let{x:s,y:o,width:l,height:c}=this;if(l*=t,c*=n,s*=t,o*=n,this._mustFixPosition)switch(e){case 0:s=Math.max(0,Math.min(t-l,s)),o=Math.max(0,Math.min(n-c,o));break;case 90:s=Math.max(0,Math.min(t-c,s)),o=Math.min(n,Math.max(l,o));break;case 180:s=Math.min(t,Math.max(l,s)),o=Math.min(n,Math.max(c,o));break;case 270:s=Math.min(t,Math.max(c,s)),o=Math.max(0,Math.min(n-l,o));break}this.x=s/=t,this.y=o/=n;const[d,h]=this.getBaseTranslation();s+=d,o+=h;const{style:p}=this.div;p.left=`${(100*s).toFixed(2)}%`,p.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(e,t){var n;return D(n=At,uf,l_).call(n,e,t,this.parentRotation)}pageTranslationToScreen(e,t){var n;return D(n=At,uf,l_).call(n,e,t,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,n]}=this,s=t*e,o=n*e;return ci.isCSSRoundSupported?[Math.round(s),Math.round(o)]:[s,o]}setDims(e,t){const[n,s]=this.parentDimensions;this.div.style.width=`${(100*e/n).toFixed(2)}%`,g(this,tl)||(this.div.style.height=`${(100*t/s).toFixed(2)}%`)}fixDims(){const{style:e}=this.div,{height:t,width:n}=e,s=n.endsWith("%"),o=!g(this,tl)&&t.endsWith("%");if(s&&o)return;const[l,c]=this.parentDimensions;s||(e.width=`${(100*parseFloat(n)/l).toFixed(2)}%`),!g(this,tl)&&!o&&(e.height=`${(100*parseFloat(t)/c).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}altTextFinish(){var e;(e=g(this,Un))==null||e.finish()}async addEditToolbar(){return g(this,Fn)||g(this,sl)?g(this,Fn):(N(this,Fn,new Wb(this)),this.div.append(g(this,Fn).render()),g(this,Un)&&g(this,Fn).addAltTextButton(await g(this,Un).render()),g(this,Fn))}removeEditToolbar(){var e;g(this,Fn)&&(g(this,Fn).remove(),N(this,Fn,null),(e=g(this,Un))==null||e.destroy())}getClientDimensions(){return this.div.getBoundingClientRect()}async addAltTextButton(){g(this,Un)||(qg.initialize(At._l10nPromise),N(this,Un,new qg(this)),g(this,el)&&(g(this,Un).data=g(this,el),N(this,el,null)),await this.addEditToolbar())}get altTextData(){var e;return(e=g(this,Un))==null?void 0:e.data}set altTextData(e){g(this,Un)&&(g(this,Un).data=e)}hasAltText(){var e;return!((e=g(this,Un))!=null&&e.isEmpty())}render(){this.div=document.createElement("div"),this.div.setAttribute("data-editor-rotation",(360-this.rotation)%360),this.div.className=this.name,this.div.setAttribute("id",this.id),this.div.tabIndex=g(this,hu)?-1:0,this._isVisible||this.div.classList.add("hidden"),this.setInForeground();const e=this._uiManager._signal;this.div.addEventListener("focusin",g(this,fu),{signal:e}),this.div.addEventListener("focusout",g(this,pu),{signal:e});const[t,n]=this.parentDimensions;this.parentRotation%180!==0&&(this.div.style.maxWidth=`${(100*n/t).toFixed(2)}%`,this.div.style.maxHeight=`${(100*t/n).toFixed(2)}%`);const[s,o]=this.getInitialTranslation();return this.translate(s,o),jg(this,this.div,["pointerdown"]),this.div}pointerdown(e){const{isMac:t}=ci.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(N(this,il,!0),this._isDraggable){D(this,Xe,iN).call(this,e);return}D(this,Xe,h_).call(this,e)}moveInDOM(){g(this,Fs)&&clearTimeout(g(this,Fs)),N(this,Fs,setTimeout(()=>{var e;N(this,Fs,null),(e=this.parent)==null||e.moveEditorInDOM(this)},0))}_setParentAndPosition(e,t,n){e.changeParent(this),this.x=t,this.y=n,this.fixAndSetPosition()}getRect(e,t,n=this.rotation){const s=this.parentScale,[o,l]=this.pageDimensions,[c,d]=this.pageTranslation,h=e/s,p=t/s,y=this.x*o,b=this.y*l,S=this.width*o,E=this.height*l;switch(n){case 0:return[y+h+c,l-b-p-E+d,y+h+S+c,l-b-p+d];case 90:return[y+p+c,l-b+h+d,y+p+E+c,l-b+h+S+d];case 180:return[y-h-S+c,l-b+p+d,y-h+c,l-b+p+E+d];case 270:return[y-p-E+c,l-b-h-S+d,y-p+c,l-b-h+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[n,s,o,l]=e,c=o-n,d=l-s;switch(this.rotation){case 0:return[n,t-l,c,d];case 90:return[n,t-s,d,c];case 180:return[o,t-s,c,d];case 270:return[o,t-l,d,c];default:throw new Error("Invalid rotation")}}onceAdded(){}isEmpty(){return!1}enableEditMode(){N(this,sl,!0)}disableEditMode(){N(this,sl,!1)}isInEditMode(){return g(this,sl)}shouldGetKeyboardEvents(){return g(this,Lr)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}rebuild(){var t,n;const e=this._uiManager._signal;(t=this.div)==null||t.addEventListener("focusin",g(this,fu),{signal:e}),(n=this.div)==null||n.addEventListener("focusout",g(this,pu),{signal:e})}rotate(e){}serialize(e=!1,t=null){xt("An editor must be serializable")}static deserialize(e,t,n){const s=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:n});s.rotation=e.rotation,N(s,el,e.accessibilityData);const[o,l]=s.pageDimensions,[c,d,h,p]=s.getRectInCurrentCoords(e.rect,l);return s.x=c/o,s.y=d/l,s.width=h/o,s.height=p/l,s}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.div.removeEventListener("focusin",g(this,fu)),this.div.removeEventListener("focusout",g(this,pu)),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),g(this,Fs)&&(clearTimeout(g(this,Fs)),N(this,Fs,null)),D(this,Xe,hh).call(this),this.removeEditToolbar(),g(this,Ji)){for(const e of g(this,Ji).values())clearTimeout(e);N(this,Ji,null)}this.parent=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(D(this,Xe,tN).call(this),g(this,Cn).classList.remove("hidden"),jg(this,this.div,["keydown"]))}get toolbarPosition(){return null}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),N(this,nl,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const t=g(this,Cn).children;if(!g(this,hs)){N(this,hs,Array.from(t));const l=D(this,Xe,sN).bind(this),c=D(this,Xe,rN).bind(this),d=this._uiManager._signal;for(const h of g(this,hs)){const p=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",l,{signal:d}),h.addEventListener("blur",c,{signal:d}),h.addEventListener("focus",D(this,Xe,oN).bind(this,p),{signal:d}),At._l10nPromise.get(`pdfjs-editor-resizer-label-${p}`).then(y=>h.setAttribute("aria-label",y))}}const n=g(this,hs)[0];let s=0;for(const l of t){if(l===n)break;s++}const o=(360-this.rotation+this.parentRotation)%360/90*(g(this,hs).length/4);if(o!==s){if(o<s)for(let c=0;c<s-o;c++)g(this,Cn).append(g(this,Cn).firstChild);else if(o>s)for(let c=0;c<o-s;c++)g(this,Cn).firstChild.before(g(this,Cn).lastChild);let l=0;for(const c of t){const h=g(this,hs)[l++].getAttribute("data-resizer-name");At._l10nPromise.get(`pdfjs-editor-resizer-label-${h}`).then(p=>c.setAttribute("aria-label",p))}}D(this,Xe,f_).call(this,0),N(this,Lr,!0),g(this,Cn).firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}_resizeWithKeyboard(e,t){g(this,Lr)&&D(this,Xe,d_).call(this,g(this,af),{movementX:e,movementY:t})}_stopResizingWithKeyboard(){D(this,Xe,hh).call(this),this.div.focus()}select(){var e,t;if(this.makeResizable(),(e=this.div)==null||e.classList.add("selectedEditor"),!g(this,Fn)){this.addEditToolbar().then(()=>{var n,s;(n=this.div)!=null&&n.classList.contains("selectedEditor")&&((s=g(this,Fn))==null||s.show())});return}(t=g(this,Fn))==null||t.show()}unselect(){var e,t,n,s;(e=g(this,Cn))==null||e.classList.add("hidden"),(t=this.div)==null||t.classList.remove("selectedEditor"),(n=this.div)!=null&&n.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(s=g(this,Fn))==null||s.hide()}updateParams(e,t){}disableEditing(){}enableEditing(){}enterInEditMode(){}getImageForAltText(){return null}get contentDiv(){return this.div}get isEditing(){return g(this,lf)}set isEditing(e){N(this,lf,e),this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(e,t){N(this,tl,!0);const n=e/t,{style:s}=this.div;s.aspectRatio=n,s.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){g(this,Ji)||N(this,Ji,new Map);const{action:n}=e;let s=g(this,Ji).get(n);s&&clearTimeout(s),s=setTimeout(()=>{this._reportTelemetry(e),g(this,Ji).delete(n),g(this,Ji).size===0&&N(this,Ji,null)},At._telemetryTimeout),g(this,Ji).set(n,s);return}e.type||(e.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),N(this,hu,!1)}disable(){this.div&&(this.div.tabIndex=-1),N(this,hu,!0)}renderAnnotationElement(e){let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const n=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),n.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;t.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}};el=new WeakMap,hs=new WeakMap,Un=new WeakMap,hu=new WeakMap,tl=new WeakMap,Cn=new WeakMap,nl=new WeakMap,fu=new WeakMap,pu=new WeakMap,Fn=new WeakMap,af=new WeakMap,il=new WeakMap,Go=new WeakMap,lf=new WeakMap,sl=new WeakMap,Lr=new WeakMap,Fs=new WeakMap,mu=new WeakMap,gu=new WeakMap,Ji=new WeakMap,cf=new WeakMap,t0=new WeakMap,Xe=new WeakSet,a_=function([e,t],n,s){[n,s]=this.screenToPageTranslation(n,s),this.x+=n/e,this.y+=s/t,this.fixAndSetPosition()},uf=new WeakSet,l_=function(e,t,n){switch(n){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}},c_=function(e){switch(e){case 90:{const[t,n]=this.pageDimensions;return[0,-t/n,n/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,n]=this.pageDimensions;return[0,t/n,-n/t,0]}default:return[1,0,0,1]}},tN=function(){if(g(this,Cn))return;N(this,Cn,document.createElement("div")),g(this,Cn).classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const n of e){const s=document.createElement("div");g(this,Cn).append(s),s.classList.add("resizer",n),s.setAttribute("data-resizer-name",n),s.addEventListener("pointerdown",D(this,Xe,nN).bind(this,n),{signal:t}),s.addEventListener("contextmenu",di,{signal:t}),s.tabIndex=-1}this.div.prepend(g(this,Cn))},nN=function(e,t){var R;t.preventDefault();const{isMac:n}=ci.platform;if(t.button!==0||t.ctrlKey&&n)return;(R=g(this,Un))==null||R.toggle(!1);const s=D(this,Xe,d_).bind(this,e),o=this._isDraggable;this._isDraggable=!1;const l=this._uiManager._signal,c={passive:!0,capture:!0,signal:l};this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",s,c),window.addEventListener("contextmenu",di,{signal:l});const d=this.x,h=this.y,p=this.width,y=this.height,b=this.parent.div.style.cursor,S=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const E=()=>{var A;this.parent.togglePointerEvents(!0),(A=g(this,Un))==null||A.toggle(!0),this._isDraggable=o,window.removeEventListener("pointerup",E),window.removeEventListener("blur",E),window.removeEventListener("pointermove",s,c),window.removeEventListener("contextmenu",di),this.parent.div.style.cursor=b,this.div.style.cursor=S,D(this,Xe,u_).call(this,d,h,p,y)};window.addEventListener("pointerup",E,{signal:l}),window.addEventListener("blur",E,{signal:l})},u_=function(e,t,n,s){const o=this.x,l=this.y,c=this.width,d=this.height;o===e&&l===t&&c===n&&d===s||this.addCommands({cmd:()=>{this.width=c,this.height=d,this.x=o,this.y=l;const[h,p]=this.parentDimensions;this.setDims(h*c,p*d),this.fixAndSetPosition()},undo:()=>{this.width=n,this.height=s,this.x=e,this.y=t;const[h,p]=this.parentDimensions;this.setDims(h*n,p*s),this.fixAndSetPosition()},mustExec:!0})},d_=function(e,t){const[n,s]=this.parentDimensions,o=this.x,l=this.y,c=this.width,d=this.height,h=At.MIN_SIZE/n,p=At.MIN_SIZE/s,y=X=>Math.round(X*1e4)/1e4,b=D(this,Xe,c_).call(this,this.rotation),S=(X,te)=>[b[0]*X+b[2]*te,b[1]*X+b[3]*te],E=D(this,Xe,c_).call(this,360-this.rotation),R=(X,te)=>[E[0]*X+E[2]*te,E[1]*X+E[3]*te];let A,C,k=!1,I=!1;switch(e){case"topLeft":k=!0,A=(X,te)=>[0,0],C=(X,te)=>[X,te];break;case"topMiddle":A=(X,te)=>[X/2,0],C=(X,te)=>[X/2,te];break;case"topRight":k=!0,A=(X,te)=>[X,0],C=(X,te)=>[0,te];break;case"middleRight":I=!0,A=(X,te)=>[X,te/2],C=(X,te)=>[0,te/2];break;case"bottomRight":k=!0,A=(X,te)=>[X,te],C=(X,te)=>[0,0];break;case"bottomMiddle":A=(X,te)=>[X/2,te],C=(X,te)=>[X/2,0];break;case"bottomLeft":k=!0,A=(X,te)=>[0,te],C=(X,te)=>[X,0];break;case"middleLeft":I=!0,A=(X,te)=>[0,te/2],C=(X,te)=>[X,te/2];break}const O=A(c,d),U=C(c,d);let P=S(...U);const B=y(o+P[0]),Q=y(l+P[1]);let K=1,le=1,[de,G]=this.screenToPageTranslation(t.movementX,t.movementY);if([de,G]=R(de/n,G/s),k){const X=Math.hypot(c,d);K=le=Math.max(Math.min(Math.hypot(U[0]-O[0]-de,U[1]-O[1]-G)/X,1/c,1/d),h/c,p/d)}else I?K=Math.max(h,Math.min(1,Math.abs(U[0]-O[0]-de)))/c:le=Math.max(p,Math.min(1,Math.abs(U[1]-O[1]-G)))/d;const fe=y(c*K),ce=y(d*le);P=S(...C(fe,ce));const pe=B-P[0],z=Q-P[1];this.width=fe,this.height=ce,this.x=pe,this.y=z,this.setDims(n*fe,s*ce),this.fixAndSetPosition()},h_=function(e){const{isMac:t}=ci.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)},iN=function(e){const t=this._uiManager.isSelected(this);this._uiManager.setUpDragSession();let n,s;const o=this._uiManager._signal;t&&(this.div.classList.add("moving"),n={passive:!0,capture:!0,signal:o},N(this,mu,e.clientX),N(this,gu,e.clientY),s=c=>{const{clientX:d,clientY:h}=c,[p,y]=this.screenToPageTranslation(d-g(this,mu),h-g(this,gu));N(this,mu,d),N(this,gu,h),this._uiManager.dragSelectedEditors(p,y)},window.addEventListener("pointermove",s,n));const l=()=>{window.removeEventListener("pointerup",l),window.removeEventListener("blur",l),t&&(this.div.classList.remove("moving"),window.removeEventListener("pointermove",s,n)),N(this,il,!1),this._uiManager.endDragSession()||D(this,Xe,h_).call(this,e)};window.addEventListener("pointerup",l,{signal:o}),window.addEventListener("blur",l,{signal:o})},sN=function(e){At._resizerKeyboardManager.exec(this,e)},rN=function(e){var t;g(this,Lr)&&((t=e.relatedTarget)==null?void 0:t.parentNode)!==g(this,Cn)&&D(this,Xe,hh).call(this)},oN=function(e){N(this,af,g(this,Lr)?e:"")},f_=function(e){if(g(this,hs))for(const t of g(this,hs))t.tabIndex=e},hh=function(){if(N(this,Lr,!1),D(this,Xe,f_).call(this,-1),g(this,nl)){const{savedX:e,savedY:t,savedWidth:n,savedHeight:s}=g(this,nl);D(this,Xe,u_).call(this,e,t,n,s),N(this,nl,null)}},L(At,uf),qe(At,"_borderLineWidth",-1),qe(At,"_colorManager",new e_),qe(At,"_zIndex",1),qe(At,"_telemetryTimeout",1e3);let vt=At;class CH extends vt{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex}}}const t1=3285377520,$i=4294901760,Ms=65535;class aN{constructor(e){this.h1=e?e&4294967295:t1,this.h2=e?e&4294967295:t1}update(e){let t,n;if(typeof e=="string"){t=new Uint8Array(e.length*2),n=0;for(let R=0,A=e.length;R<A;R++){const C=e.charCodeAt(R);C<=255?t[n++]=C:(t[n++]=C>>>8,t[n++]=C&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),n=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const s=n>>2,o=n-s*4,l=new Uint32Array(t.buffer,0,s);let c=0,d=0,h=this.h1,p=this.h2;const y=3432918353,b=461845907,S=y&Ms,E=b&Ms;for(let R=0;R<s;R++)R&1?(c=l[R],c=c*y&$i|c*S&Ms,c=c<<15|c>>>17,c=c*b&$i|c*E&Ms,h^=c,h=h<<13|h>>>19,h=h*5+3864292196):(d=l[R],d=d*y&$i|d*S&Ms,d=d<<15|d>>>17,d=d*b&$i|d*E&Ms,p^=d,p=p<<13|p>>>19,p=p*5+3864292196);switch(c=0,o){case 3:c^=t[s*4+2]<<16;case 2:c^=t[s*4+1]<<8;case 1:c^=t[s*4],c=c*y&$i|c*S&Ms,c=c<<15|c>>>17,c=c*b&$i|c*E&Ms,s&1?h^=c:p^=c}this.h1=h,this.h2=p}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&$i|e*36045&Ms,t=t*4283543511&$i|((t<<16|e>>>16)*2950163797&$i)>>>16,e^=t>>>1,e=e*444984403&$i|e*60499&Ms,t=t*3301882366&$i|((t<<16|e>>>16)*3120437893&$i)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const p_=Object.freeze({map:null,hash:"",transfer:void 0});var rl,Rn,n0,lN;class Tw{constructor(){L(this,n0);L(this,rl,!1);L(this,Rn,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const n=g(this,Rn).get(e);return n===void 0?t:Object.assign(t,n)}getRawValue(e){return g(this,Rn).get(e)}remove(e){if(g(this,Rn).delete(e),g(this,Rn).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const t of g(this,Rn).values())if(t instanceof vt)return;this.onAnnotationEditor(null)}}setValue(e,t){const n=g(this,Rn).get(e);let s=!1;if(n!==void 0)for(const[o,l]of Object.entries(t))n[o]!==l&&(s=!0,n[o]=l);else s=!0,g(this,Rn).set(e,t);s&&D(this,n0,lN).call(this),t instanceof vt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type)}has(e){return g(this,Rn).has(e)}getAll(){return g(this,Rn).size>0?bw(g(this,Rn)):null}setAll(e){for(const[t,n]of Object.entries(e))this.setValue(t,n)}get size(){return g(this,Rn).size}resetModified(){g(this,rl)&&(N(this,rl,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new cN(this)}get serializable(){if(g(this,Rn).size===0)return p_;const e=new Map,t=new aN,n=[],s=Object.create(null);let o=!1;for(const[l,c]of g(this,Rn)){const d=c instanceof vt?c.serialize(!1,s):c;d&&(e.set(l,d),t.update(`${l}:${JSON.stringify(d)}`),o||(o=!!d.bitmap))}if(o)for(const l of e.values())l.bitmap&&n.push(l.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:n}:p_}get editorStats(){let e=null;const t=new Map;for(const n of g(this,Rn).values()){if(!(n instanceof vt))continue;const s=n.telemetryFinalData;if(!s)continue;const{type:o}=s;t.has(o)||t.set(o,Object.getPrototypeOf(n).constructor),e||(e=Object.create(null));const l=e[o]||(e[o]=new Map);for(const[c,d]of Object.entries(s)){if(c==="type")continue;let h=l.get(c);h||(h=new Map,l.set(c,h));const p=h.get(d)??0;h.set(d,p+1)}}for(const[n,s]of t)e[n]=s.computeTelemetryFinalData(e[n]);return e}}rl=new WeakMap,Rn=new WeakMap,n0=new WeakSet,lN=function(){g(this,rl)||(N(this,rl,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var df;class cN extends Tw{constructor(t){super();L(this,df);const{map:n,hash:s,transfer:o}=t.serializable,l=structuredClone(n,o?{transfer:o}:null);N(this,df,{map:l,hash:s,transfer:o})}get print(){xt("Should not call PrintAnnotationStorage.print")}get serializable(){return g(this,df)}}df=new WeakMap;var vu;class RH{constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){L(this,vu,new Set);this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),g(this,vu).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,_inspectFont:t}){if(!(!e||g(this,vu).has(e.loadedName))){if(cn(!this.disableFontFace,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:n,src:s,style:o}=e,l=new FontFace(n,s,o);this.addNativeFontFace(l);try{await l.load(),g(this,vu).add(n),t==null||t(e)}catch{Je(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(l)}return}xt("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const n=e.createNativeFontFace();if(n){this.addNativeFontFace(n);try{await n.loaded}catch(s){throw Je(`Failed to load font '${n.family}': '${s}'.`),e.disableFontFace=!0,s}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(n=>{const s=this._queueLoadingCallback(n);this._prepareFontLoadEvent(e,s)})}}get isFontLoadingAPISupported(){var t;const e=!!((t=this._document)!=null&&t.fonts);return st(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){let e=!1;return(Hn||typeof navigator<"u"&&typeof(navigator==null?void 0:navigator.userAgent)=="string"&&/Mozilla\/5.0.*?rv:\d+.*? Gecko/.test(navigator.userAgent))&&(e=!0),st(this,"isSyncFontLoadingSupported",e)}_queueLoadingCallback(e){function t(){for(cn(!s.done,"completeRequest() cannot be called twice."),s.done=!0;n.length>0&&n[0].done;){const o=n.shift();setTimeout(o.callback,0)}}const{loadingRequests:n}=this,s={done:!1,complete:t,callback:e};return n.push(s),s}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return st(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function n(O,U){return O.charCodeAt(U)<<24|O.charCodeAt(U+1)<<16|O.charCodeAt(U+2)<<8|O.charCodeAt(U+3)&255}function s(O,U,P,B){const Q=O.substring(0,U),K=O.substring(U+P);return Q+B+K}let o,l;const c=this._document.createElement("canvas");c.width=1,c.height=1;const d=c.getContext("2d");let h=0;function p(O,U){if(++h>30){Je("Load test font never loaded."),U();return}if(d.font="30px "+O,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){U();return}setTimeout(p.bind(null,O,U))}const y=`lt${Date.now()}${this.loadTestFontId++}`;let b=this._loadTestFont;b=s(b,976,y.length,y);const E=16,R=1482184792;let A=n(b,E);for(o=0,l=y.length-3;o<l;o+=4)A=A-R+n(y,o)|0;o<y.length&&(A=A-R+n(y+"XXX",o)|0),b=s(b,E,4,dH(A));const C=`url(data:font/opentype;base64,${btoa(b)});`,k=`@font-face {font-family:"${y}";src:${C}}`;this.insertRule(k);const I=this._document.createElement("div");I.style.visibility="hidden",I.style.width=I.style.height="10px",I.style.position="absolute",I.style.top=I.style.left="0px";for(const O of[e.loadedName,y]){const U=this._document.createElement("span");U.textContent="Hi",U.style.fontFamily=O,I.append(U)}this._document.body.append(I),p(y,()=>{I.remove(),t.complete()})}}vu=new WeakMap;class NH{constructor(e,{disableFontFace:t=!1,inspectFont:n=null}){this.compiledGlyphs=Object.create(null);for(const s in e)this[s]=e[s];this.disableFontFace=t===!0,this._inspectFont=n}createNativeFontFace(){var t;if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const n={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(n.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,n)}return(t=this._inspectFont)==null||t.call(this,this),e}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const e=kR(this.data),t=`url(data:${this.mimetype};base64,${btoa(e)});`;let n;if(!this.cssFontInfo)n=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let o=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(o+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),n=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${o}src:${t}}`}return(s=this._inspectFont)==null||s.call(this,this,t),n}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];let n;try{n=e.get(this.loadedName+"_path_"+t)}catch(o){Je(`getPathGenerator - ignoring character: "${o}".`)}if(!Array.isArray(n)||n.length===0)return this.compiledGlyphs[t]=function(o,l){};const s=[];for(let o=0,l=n.length;o<l;)switch(n[o++]){case br.BEZIER_CURVE_TO:{const[c,d,h,p,y,b]=n.slice(o,o+6);s.push(S=>S.bezierCurveTo(c,d,h,p,y,b)),o+=6}break;case br.MOVE_TO:{const[c,d]=n.slice(o,o+2);s.push(h=>h.moveTo(c,d)),o+=2}break;case br.LINE_TO:{const[c,d]=n.slice(o,o+2);s.push(h=>h.lineTo(c,d)),o+=2}break;case br.QUADRATIC_CURVE_TO:{const[c,d,h,p]=n.slice(o,o+4);s.push(y=>y.quadraticCurveTo(c,d,h,p)),o+=4}break;case br.RESTORE:s.push(c=>c.restore());break;case br.SAVE:s.push(c=>c.save());break;case br.SCALE:cn(s.length===2,"Scale command is only valid at the third position.");break;case br.TRANSFORM:{const[c,d,h,p,y,b]=n.slice(o,o+6);s.push(S=>S.transform(c,d,h,p,y,b)),o+=6}break;case br.TRANSLATE:{const[c,d]=n.slice(o,o+2);s.push(h=>h.translate(c,d)),o+=2}break}return this.compiledGlyphs[t]=function(l,c){s[0](l),s[1](l),l.scale(c,-c);for(let d=2,h=s.length;d<h;d++)s[d](l)}}}if(Hn){var m_=Promise.withResolvers(),Ah=null;(async()=>{const e=await Wm(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),t=await Wm(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),n=await Wm(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]),s=await Wm(()=>import("./__vite-browser-external-BIHI7g3E.js"),[]);let o,l;return new Map(Object.entries({fs:e,http:t,https:n,url:s,canvas:o,path2d:l}))})().then(e=>{Ah=e,m_.resolve()},e=>{Je(`loadPackages: ${e}`),Ah=new Map,m_.resolve()})}class Qs{static get promise(){return m_.promise}static get(e){return Ah==null?void 0:Ah.get(e)}}const uN=function(i){return Qs.get("fs").promises.readFile(i).then(t=>new Uint8Array(t))};class kH extends T0{}class IH extends Bg{_createCanvas(e,t){return Qs.get("canvas").createCanvas(e,t)}}class MH extends C0{_fetchData(e,t){return uN(e).then(n=>({cMapData:n,compressionType:t}))}}class DH extends R0{_fetchData(e){return uN(e)}}const Jn={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function g_(i,e){if(!e)return;const t=e[2]-e[0],n=e[3]-e[1],s=new Path2D;s.rect(e[0],e[1],t,n),i.clip(s)}class _p{constructor(){this.constructor===_p&&xt("Cannot initialize BaseShadingPattern.")}getPattern(){xt("Abstract method `getPattern` called.")}}class LH extends _p{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const n of this._colorStops)t.addColorStop(n[0],n[1]);return t}getPattern(e,t,n,s){let o;if(s===Jn.STROKE||s===Jn.FILL){const l=t.current.getClippedPathBoundingBox(s,Lt(e))||[0,0,0,0],c=Math.ceil(l[2]-l[0])||1,d=Math.ceil(l[3]-l[1])||1,h=t.cachedCanvases.getCanvas("pattern",c,d,!0),p=h.context;p.clearRect(0,0,p.canvas.width,p.canvas.height),p.beginPath(),p.rect(0,0,p.canvas.width,p.canvas.height),p.translate(-l[0],-l[1]),n=Ee.transform(n,[1,0,0,1,l[0],l[1]]),p.transform(...t.baseTransform),this.matrix&&p.transform(...this.matrix),g_(p,this._bbox),p.fillStyle=this._createGradient(p),p.fill(),o=e.createPattern(h.canvas,"no-repeat");const y=new DOMMatrix(n);o.setTransform(y)}else g_(e,this._bbox),o=this._createGradient(e);return o}}function hb(i,e,t,n,s,o,l,c){const d=e.coords,h=e.colors,p=i.data,y=i.width*4;let b;d[t+1]>d[n+1]&&(b=t,t=n,n=b,b=o,o=l,l=b),d[n+1]>d[s+1]&&(b=n,n=s,s=b,b=l,l=c,c=b),d[t+1]>d[n+1]&&(b=t,t=n,n=b,b=o,o=l,l=b);const S=(d[t]+e.offsetX)*e.scaleX,E=(d[t+1]+e.offsetY)*e.scaleY,R=(d[n]+e.offsetX)*e.scaleX,A=(d[n+1]+e.offsetY)*e.scaleY,C=(d[s]+e.offsetX)*e.scaleX,k=(d[s+1]+e.offsetY)*e.scaleY;if(E>=k)return;const I=h[o],O=h[o+1],U=h[o+2],P=h[l],B=h[l+1],Q=h[l+2],K=h[c],le=h[c+1],de=h[c+2],G=Math.round(E),fe=Math.round(k);let ce,pe,z,X,te,ne,ue,F;for(let V=G;V<=fe;V++){if(V<A){const xe=V<E?0:(E-V)/(E-A);ce=S-(S-R)*xe,pe=I-(I-P)*xe,z=O-(O-B)*xe,X=U-(U-Q)*xe}else{let xe;V>k?xe=1:A===k?xe=0:xe=(A-V)/(A-k),ce=R-(R-C)*xe,pe=P-(P-K)*xe,z=B-(B-le)*xe,X=Q-(Q-de)*xe}let se;V<E?se=0:V>k?se=1:se=(E-V)/(E-k),te=S-(S-C)*se,ne=I-(I-K)*se,ue=O-(O-le)*se,F=U-(U-de)*se;const he=Math.round(Math.min(ce,te)),Te=Math.round(Math.max(ce,te));let ke=y*V+he*4;for(let xe=he;xe<=Te;xe++)se=(ce-xe)/(ce-te),se<0?se=0:se>1&&(se=1),p[ke++]=pe-(pe-ne)*se|0,p[ke++]=z-(z-ue)*se|0,p[ke++]=X-(X-F)*se|0,p[ke++]=255}}function PH(i,e,t){const n=e.coords,s=e.colors;let o,l;switch(e.type){case"lattice":const c=e.verticesPerRow,d=Math.floor(n.length/c)-1,h=c-1;for(o=0;o<d;o++){let p=o*c;for(let y=0;y<h;y++,p++)hb(i,t,n[p],n[p+1],n[p+c],s[p],s[p+1],s[p+c]),hb(i,t,n[p+c+1],n[p+1],n[p+c],s[p+c+1],s[p+1],s[p+c])}break;case"triangles":for(o=0,l=n.length;o<l;o+=3)hb(i,t,n[o],n[o+1],n[o+2],s[o],s[o+1],s[o+2]);break;default:throw new Error("illegal figure")}}class OH extends _p{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[7],this._background=e[8],this.matrix=null}_createMeshCanvas(e,t,n){const c=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-c,p=Math.ceil(this._bounds[3])-d,y=Math.min(Math.ceil(Math.abs(h*e[0]*1.1)),3e3),b=Math.min(Math.ceil(Math.abs(p*e[1]*1.1)),3e3),S=h/y,E=p/b,R={coords:this._coords,colors:this._colors,offsetX:-c,offsetY:-d,scaleX:1/S,scaleY:1/E},A=y+4,C=b+4,k=n.getCanvas("mesh",A,C,!1),I=k.context,O=I.createImageData(y,b);if(t){const P=O.data;for(let B=0,Q=P.length;B<Q;B+=4)P[B]=t[0],P[B+1]=t[1],P[B+2]=t[2],P[B+3]=255}for(const P of this._figures)PH(O,P,R);return I.putImageData(O,2,2),{canvas:k.canvas,offsetX:c-2*S,offsetY:d-2*E,scaleX:S,scaleY:E}}getPattern(e,t,n,s){g_(e,this._bbox);let o;if(s===Jn.SHADING)o=Ee.singularValueDecompose2dScale(Lt(e));else if(o=Ee.singularValueDecompose2dScale(t.baseTransform),this.matrix){const c=Ee.singularValueDecompose2dScale(this.matrix);o=[o[0]*c[0],o[1]*c[1]]}const l=this._createMeshCanvas(o,s===Jn.SHADING?null:this._background,t.cachedCanvases);return s!==Jn.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(l.offsetX,l.offsetY),e.scale(l.scaleX,l.scaleY),e.createPattern(l.canvas,"no-repeat")}}class UH extends _p{getPattern(){return"hotpink"}}function FH(i){switch(i[0]){case"RadialAxial":return new LH(i);case"Mesh":return new OH(i);case"Dummy":return new UH}throw new Error(`Unknown IR type: ${i[0]}`)}const n1={COLORED:1,UNCOLORED:2},i0=class i0{constructor(e,t,n,s,o){this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.color=t,this.ctx=n,this.canvasGraphicsFactory=s,this.baseTransform=o}createPatternCanvas(e){const t=this.operatorList,n=this.bbox,s=this.xstep,o=this.ystep,l=this.paintType,c=this.tilingType,d=this.color,h=this.canvasGraphicsFactory;S0("TilingType: "+c);const p=n[0],y=n[1],b=n[2],S=n[3],E=Ee.singularValueDecompose2dScale(this.matrix),R=Ee.singularValueDecompose2dScale(this.baseTransform),A=[E[0]*R[0],E[1]*R[1]],C=this.getSizeAndScale(s,this.ctx.canvas.width,A[0]),k=this.getSizeAndScale(o,this.ctx.canvas.height,A[1]),I=e.cachedCanvases.getCanvas("pattern",C.size,k.size,!0),O=I.context,U=h.createCanvasGraphics(O);U.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(U,l,d);let P=p,B=y,Q=b,K=S;return p<0&&(P=0,Q+=Math.abs(p)),y<0&&(B=0,K+=Math.abs(y)),O.translate(-(C.scale*P),-(k.scale*B)),U.transform(C.scale,0,0,k.scale,0,0),O.save(),this.clipBbox(U,P,B,Q,K),U.baseTransform=Lt(U.ctx),U.executeOperatorList(t),U.endDrawing(),{canvas:I.canvas,scaleX:C.scale,scaleY:k.scale,offsetX:P,offsetY:B}}getSizeAndScale(e,t,n){e=Math.abs(e);const s=Math.max(i0.MAX_PATTERN_SIZE,t);let o=Math.ceil(e*n);return o>=s?o=s:n=o/e,{scale:n,size:o}}clipBbox(e,t,n,s,o){const l=s-t,c=o-n;e.ctx.rect(t,n,l,c),e.current.updateRectMinMax(Lt(e.ctx),[t,n,s,o]),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,n){const s=e.ctx,o=e.current;switch(t){case n1.COLORED:const l=this.ctx;s.fillStyle=l.fillStyle,s.strokeStyle=l.strokeStyle,o.fillColor=l.fillStyle,o.strokeColor=l.strokeStyle;break;case n1.UNCOLORED:const c=Ee.makeHexColor(n[0],n[1],n[2]);s.fillStyle=c,s.strokeStyle=c,o.fillColor=c,o.strokeColor=c;break;default:throw new uH(`Unsupported paint type: ${t}`)}}getPattern(e,t,n,s){let o=n;s!==Jn.SHADING&&(o=Ee.transform(o,t.baseTransform),this.matrix&&(o=Ee.transform(o,this.matrix)));const l=this.createPatternCanvas(t);let c=new DOMMatrix(o);c=c.translate(l.offsetX,l.offsetY),c=c.scale(1/l.scaleX,1/l.scaleY);const d=e.createPattern(l.canvas,"repeat");return d.setTransform(c),d}};qe(i0,"MAX_PATTERN_SIZE",3e3);let v_=i0;function HH({src:i,srcPos:e=0,dest:t,width:n,height:s,nonBlackColor:o=4294967295,inverseDecode:l=!1}){const c=ci.isLittleEndian?4278190080:255,[d,h]=l?[o,c]:[c,o],p=n>>3,y=n&7,b=i.length;t=new Uint32Array(t.buffer);let S=0;for(let E=0;E<s;E++){for(const A=e+p;e<A;e++){const C=e<b?i[e]:255;t[S++]=C&128?h:d,t[S++]=C&64?h:d,t[S++]=C&32?h:d,t[S++]=C&16?h:d,t[S++]=C&8?h:d,t[S++]=C&4?h:d,t[S++]=C&2?h:d,t[S++]=C&1?h:d}if(y===0)continue;const R=e<b?i[e++]:255;for(let A=0;A<y;A++)t[S++]=R&1<<7-A?h:d}return{srcPos:e,destPos:S}}const i1=16,s1=100,BH=15,r1=10,o1=1e3,li=16;function jH(i,e){if(i._removeMirroring)throw new Error("Context is already forwarding operations.");i.__originalSave=i.save,i.__originalRestore=i.restore,i.__originalRotate=i.rotate,i.__originalScale=i.scale,i.__originalTranslate=i.translate,i.__originalTransform=i.transform,i.__originalSetTransform=i.setTransform,i.__originalResetTransform=i.resetTransform,i.__originalClip=i.clip,i.__originalMoveTo=i.moveTo,i.__originalLineTo=i.lineTo,i.__originalBezierCurveTo=i.bezierCurveTo,i.__originalRect=i.rect,i.__originalClosePath=i.closePath,i.__originalBeginPath=i.beginPath,i._removeMirroring=()=>{i.save=i.__originalSave,i.restore=i.__originalRestore,i.rotate=i.__originalRotate,i.scale=i.__originalScale,i.translate=i.__originalTranslate,i.transform=i.__originalTransform,i.setTransform=i.__originalSetTransform,i.resetTransform=i.__originalResetTransform,i.clip=i.__originalClip,i.moveTo=i.__originalMoveTo,i.lineTo=i.__originalLineTo,i.bezierCurveTo=i.__originalBezierCurveTo,i.rect=i.__originalRect,i.closePath=i.__originalClosePath,i.beginPath=i.__originalBeginPath,delete i._removeMirroring},i.save=function(){e.save(),this.__originalSave()},i.restore=function(){e.restore(),this.__originalRestore()},i.translate=function(n,s){e.translate(n,s),this.__originalTranslate(n,s)},i.scale=function(n,s){e.scale(n,s),this.__originalScale(n,s)},i.transform=function(n,s,o,l,c,d){e.transform(n,s,o,l,c,d),this.__originalTransform(n,s,o,l,c,d)},i.setTransform=function(n,s,o,l,c,d){e.setTransform(n,s,o,l,c,d),this.__originalSetTransform(n,s,o,l,c,d)},i.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},i.rotate=function(n){e.rotate(n),this.__originalRotate(n)},i.clip=function(n){e.clip(n),this.__originalClip(n)},i.moveTo=function(t,n){e.moveTo(t,n),this.__originalMoveTo(t,n)},i.lineTo=function(t,n){e.lineTo(t,n),this.__originalLineTo(t,n)},i.bezierCurveTo=function(t,n,s,o,l,c){e.bezierCurveTo(t,n,s,o,l,c),this.__originalBezierCurveTo(t,n,s,o,l,c)},i.rect=function(t,n,s,o){e.rect(t,n,s,o),this.__originalRect(t,n,s,o)},i.closePath=function(){e.closePath(),this.__originalClosePath()},i.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class qH{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,n){let s;return this.cache[e]!==void 0?(s=this.cache[e],this.canvasFactory.reset(s,t,n)):(s=this.canvasFactory.create(t,n),this.cache[e]=s),s}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Xm(i,e,t,n,s,o,l,c,d,h){const[p,y,b,S,E,R]=Lt(i);if(y===0&&b===0){const k=l*p+E,I=Math.round(k),O=c*S+R,U=Math.round(O),P=(l+d)*p+E,B=Math.abs(Math.round(P)-I)||1,Q=(c+h)*S+R,K=Math.abs(Math.round(Q)-U)||1;return i.setTransform(Math.sign(p),0,0,Math.sign(S),I,U),i.drawImage(e,t,n,s,o,0,0,B,K),i.setTransform(p,y,b,S,E,R),[B,K]}if(p===0&&S===0){const k=c*b+E,I=Math.round(k),O=l*y+R,U=Math.round(O),P=(c+h)*b+E,B=Math.abs(Math.round(P)-I)||1,Q=(l+d)*y+R,K=Math.abs(Math.round(Q)-U)||1;return i.setTransform(0,Math.sign(y),Math.sign(b),0,I,U),i.drawImage(e,t,n,s,o,0,0,K,B),i.setTransform(p,y,b,S,E,R),[K,B]}i.drawImage(e,t,n,s,o,l,c,d,h);const A=Math.hypot(p,y),C=Math.hypot(b,S);return[A*d,C*h]}function GH(i){const{width:e,height:t}=i;if(e>o1||t>o1)return null;const n=1e3,s=new Uint8Array([0,2,4,0,1,0,5,4,8,10,0,8,0,2,1,0]),o=e+1;let l=new Uint8Array(o*(t+1)),c,d,h;const p=e+7&-8;let y=new Uint8Array(p*t),b=0;for(const C of i.data){let k=128;for(;k>0;)y[b++]=C&k?0:255,k>>=1}let S=0;for(b=0,y[b]!==0&&(l[0]=1,++S),d=1;d<e;d++)y[b]!==y[b+1]&&(l[d]=y[b]?2:1,++S),b++;for(y[b]!==0&&(l[d]=2,++S),c=1;c<t;c++){b=c*p,h=c*o,y[b-p]!==y[b]&&(l[h]=y[b]?1:8,++S);let C=(y[b]?4:0)+(y[b-p]?8:0);for(d=1;d<e;d++)C=(C>>2)+(y[b+1]?4:0)+(y[b-p+1]?8:0),s[C]&&(l[h+d]=s[C],++S),b++;if(y[b-p]!==y[b]&&(l[h+d]=y[b]?2:4,++S),S>n)return null}for(b=p*(t-1),h=c*o,y[b]!==0&&(l[h]=8,++S),d=1;d<e;d++)y[b]!==y[b+1]&&(l[h+d]=y[b]?4:8,++S),b++;if(y[b]!==0&&(l[h+d]=4,++S),S>n)return null;const E=new Int32Array([0,o,-1,0,-o,0,0,0,1]),R=new Path2D;for(c=0;S&&c<=t;c++){let C=c*o;const k=C+e;for(;C<k&&!l[C];)C++;if(C===k)continue;R.moveTo(C%o,c);const I=C;let O=l[C];do{const U=E[O];do C+=U;while(!l[C]);const P=l[C];P!==5&&P!==10?(O=P,l[C]=0):(O=P&51*O>>4,l[C]&=O>>2|O<<2),R.lineTo(C%o,C/o|0),l[C]||--S}while(I!==C);--c}return y=null,l=null,function(C){C.save(),C.scale(1/e,-1/t),C.translate(0,-t),C.fill(R),C.beginPath(),C.restore()}}class a1{constructor(e,t){this.alphaIsShape=!1,this.fontSize=0,this.fontSizeScale=1,this.textMatrix=RR,this.textMatrixScale=1,this.fontMatrix=Gb,this.leading=0,this.x=0,this.y=0,this.lineX=0,this.lineY=0,this.charSpacing=0,this.wordSpacing=0,this.textHScale=1,this.textRenderingMode=Ln.FILL,this.textRise=0,this.fillColor="#000000",this.strokeColor="#000000",this.patternFill=!1,this.fillAlpha=1,this.strokeAlpha=1,this.lineWidth=1,this.activeSMask=null,this.transferMaps="none",this.startNewPathAndClipBox([0,0,e,t])}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e}setCurrentPoint(e,t){this.x=e,this.y=t}updatePathMinMax(e,t,n){[t,n]=Ee.applyTransform([t,n],e),this.minX=Math.min(this.minX,t),this.minY=Math.min(this.minY,n),this.maxX=Math.max(this.maxX,t),this.maxY=Math.max(this.maxY,n)}updateRectMinMax(e,t){const n=Ee.applyTransform(t,e),s=Ee.applyTransform(t.slice(2),e),o=Ee.applyTransform([t[0],t[3]],e),l=Ee.applyTransform([t[2],t[1]],e);this.minX=Math.min(this.minX,n[0],s[0],o[0],l[0]),this.minY=Math.min(this.minY,n[1],s[1],o[1],l[1]),this.maxX=Math.max(this.maxX,n[0],s[0],o[0],l[0]),this.maxY=Math.max(this.maxY,n[1],s[1],o[1],l[1])}updateScalingPathMinMax(e,t){Ee.scaleMinMax(e,t),this.minX=Math.min(this.minX,t[0]),this.minY=Math.min(this.minY,t[1]),this.maxX=Math.max(this.maxX,t[2]),this.maxY=Math.max(this.maxY,t[3])}updateCurvePathMinMax(e,t,n,s,o,l,c,d,h,p){const y=Ee.bezierBoundingBox(t,n,s,o,l,c,d,h,p);p||this.updateRectMinMax(e,y)}getPathBoundingBox(e=Jn.FILL,t=null){const n=[this.minX,this.minY,this.maxX,this.maxY];if(e===Jn.STROKE){t||xt("Stroke bounding box must include transform.");const s=Ee.singularValueDecompose2dScale(t),o=s[0]*this.lineWidth/2,l=s[1]*this.lineWidth/2;n[0]-=o,n[1]-=l,n[2]+=o,n[3]+=l}return n}updateClipFromPath(){const e=Ee.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minX===1/0}startNewPathAndClipBox(e){this.clipBox=e,this.minX=1/0,this.minY=1/0,this.maxX=0,this.maxY=0}getClippedPathBoundingBox(e=Jn.FILL,t=null){return Ee.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function l1(i,e){if(typeof ImageData<"u"&&e instanceof ImageData){i.putImageData(e,0,0);return}const t=e.height,n=e.width,s=t%li,o=(t-s)/li,l=s===0?o:o+1,c=i.createImageData(n,li);let d=0,h;const p=e.data,y=c.data;let b,S,E,R;if(e.kind===sg.GRAYSCALE_1BPP){const A=p.byteLength,C=new Uint32Array(y.buffer,0,y.byteLength>>2),k=C.length,I=n+7>>3,O=4294967295,U=ci.isLittleEndian?4278190080:255;for(b=0;b<l;b++){for(E=b<o?li:s,h=0,S=0;S<E;S++){const P=A-d;let B=0;const Q=P>I?n:P*8-7,K=Q&-8;let le=0,de=0;for(;B<K;B+=8)de=p[d++],C[h++]=de&128?O:U,C[h++]=de&64?O:U,C[h++]=de&32?O:U,C[h++]=de&16?O:U,C[h++]=de&8?O:U,C[h++]=de&4?O:U,C[h++]=de&2?O:U,C[h++]=de&1?O:U;for(;B<Q;B++)le===0&&(de=p[d++],le=128),C[h++]=de&le?O:U,le>>=1}for(;h<k;)C[h++]=0;i.putImageData(c,0,b*li)}}else if(e.kind===sg.RGBA_32BPP){for(S=0,R=n*li*4,b=0;b<o;b++)y.set(p.subarray(d,d+R)),d+=R,i.putImageData(c,0,S),S+=li;b<l&&(R=n*s*4,y.set(p.subarray(d,d+R)),i.putImageData(c,0,S))}else if(e.kind===sg.RGB_24BPP)for(E=li,R=n*E,b=0;b<l;b++){for(b>=o&&(E=s,R=n*E),h=0,S=R;S--;)y[h++]=p[d++],y[h++]=p[d++],y[h++]=p[d++],y[h++]=255;i.putImageData(c,0,b*li)}else throw new Error(`bad image kind: ${e.kind}`)}function c1(i,e){if(e.bitmap){i.drawImage(e.bitmap,0,0);return}const t=e.height,n=e.width,s=t%li,o=(t-s)/li,l=s===0?o:o+1,c=i.createImageData(n,li);let d=0;const h=e.data,p=c.data;for(let y=0;y<l;y++){const b=y<o?li:s;({srcPos:d}=HH({src:h,srcPos:d,dest:p,width:n,height:b,nonBlackColor:0})),i.putImageData(c,0,y*li)}}function ih(i,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const n of t)i[n]!==void 0&&(e[n]=i[n]);i.setLineDash!==void 0&&(e.setLineDash(i.getLineDash()),e.lineDashOffset=i.lineDashOffset)}function Qm(i){if(i.strokeStyle=i.fillStyle="#000000",i.fillRule="nonzero",i.globalAlpha=1,i.lineWidth=1,i.lineCap="butt",i.lineJoin="miter",i.miterLimit=10,i.globalCompositeOperation="source-over",i.font="10px sans-serif",i.setLineDash!==void 0&&(i.setLineDash([]),i.lineDashOffset=0),!Hn){const{filter:e}=i;e!=="none"&&e!==""&&(i.filter="none")}}function u1(i,e){if(e)return!0;const t=Ee.singularValueDecompose2dScale(i);t[0]=Math.fround(t[0]),t[1]=Math.fround(t[1]);const n=Math.fround((globalThis.devicePixelRatio||1)*oa.PDF_TO_CSS_UNITS);return t[0]<=n&&t[1]<=n}const VH=["butt","round","square"],zH=["miter","round","bevel"],$H={},d1={};var la,y_,b_;const Iw=class Iw{constructor(e,t,n,s,o,{optionalContentConfig:l,markedContentStack:c=null},d,h){L(this,la);this.ctx=e,this.current=new a1(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=n,this.canvasFactory=s,this.filterFactory=o,this.groupStack=[],this.processingType3=null,this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=l,this.cachedCanvases=new qH(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(e,t=null){return typeof e=="string"?e.startsWith("g_")?this.commonObjs.get(e):this.objs.get(e):t}beginDrawing({transform:e,viewport:t,transparency:n=!1,background:s=null}){const o=this.ctx.canvas.width,l=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=s||"#ffffff",this.ctx.fillRect(0,0,o,l),this.ctx.fillStyle=c,n){const d=this.cachedCanvases.getCanvas("transparent",o,l);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...Lt(this.compositeCtx))}this.ctx.save(),Qm(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=Lt(this.ctx)}executeOperatorList(e,t,n,s){const o=e.argsArray,l=e.fnArray;let c=t||0;const d=o.length;if(d===c)return c;const h=d-c>r1&&typeof n=="function",p=h?Date.now()+BH:0;let y=0;const b=this.commonObjs,S=this.objs;let E;for(;;){if(s!==void 0&&c===s.nextBreakPoint)return s.breakIt(c,n),c;if(E=l[c],E!==as.dependency)this[E].apply(this,o[c]);else for(const R of o[c]){const A=R.startsWith("g_")?b:S;if(!A.has(R))return A.get(R,n),c}if(c++,c===d)return c;if(h&&++y>r1){if(Date.now()>p)return n(),c;y=0}}}endDrawing(){D(this,la,y_).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),D(this,la,b_).call(this)}_scaleImage(e,t){const n=e.width,s=e.height;let o=Math.max(Math.hypot(t[0],t[1]),1),l=Math.max(Math.hypot(t[2],t[3]),1),c=n,d=s,h="prescale1",p,y;for(;o>2&&c>1||l>2&&d>1;){let b=c,S=d;o>2&&c>1&&(b=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c/2),o/=c/b),l>2&&d>1&&(S=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,l/=d/S),p=this.cachedCanvases.getCanvas(h,b,S),y=p.context,y.clearRect(0,0,b,S),y.drawImage(e,0,0,c,d,0,0,b,S),e=p.canvas,c=b,d=S,h=h==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:c,paintHeight:d}}_createMaskCanvas(e){const t=this.ctx,{width:n,height:s}=e,o=this.current.fillColor,l=this.current.patternFill,c=Lt(t);let d,h,p,y;if((e.bitmap||e.data)&&e.count>1){const Q=e.bitmap||e.data.buffer;h=JSON.stringify(l?c:[c.slice(0,4),o]),d=this._cachedBitmapsMap.get(Q),d||(d=new Map,this._cachedBitmapsMap.set(Q,d));const K=d.get(h);if(K&&!l){const le=Math.round(Math.min(c[0],c[2])+c[4]),de=Math.round(Math.min(c[1],c[3])+c[5]);return{canvas:K,offsetX:le,offsetY:de}}p=K}p||(y=this.cachedCanvases.getCanvas("maskCanvas",n,s),c1(y.context,e));let b=Ee.transform(c,[1/n,0,0,-1/s,0,0]);b=Ee.transform(b,[1,0,0,1,0,-s]);const[S,E,R,A]=Ee.getAxialAlignedBoundingBox([0,0,n,s],b),C=Math.round(R-S)||1,k=Math.round(A-E)||1,I=this.cachedCanvases.getCanvas("fillCanvas",C,k),O=I.context,U=S,P=E;O.translate(-U,-P),O.transform(...b),p||(p=this._scaleImage(y.canvas,_r(O)),p=p.img,d&&l&&d.set(h,p)),O.imageSmoothingEnabled=u1(Lt(O),e.interpolate),Xm(O,p,0,0,p.width,p.height,0,0,n,s),O.globalCompositeOperation="source-in";const B=Ee.transform(_r(O),[1,0,0,1,-U,-P]);return O.fillStyle=l?o.getPattern(t,this,B,Jn.FILL):o,O.fillRect(0,0,n,s),d&&!l&&(this.cachedCanvases.delete("fillCanvas"),d.set(h,I.canvas)),{canvas:I.canvas,offsetX:Math.round(U),offsetY:Math.round(P)}}setLineWidth(e){e!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=e,this.ctx.lineWidth=e}setLineCap(e){this.ctx.lineCap=VH[e]}setLineJoin(e){this.ctx.lineJoin=zH[e]}setMiterLimit(e){this.ctx.miterLimit=e}setDash(e,t){const n=this.ctx;n.setLineDash!==void 0&&(n.setLineDash(e),n.lineDashOffset=t)}setRenderingIntent(e){}setFlatness(e){}setGState(e){for(const[t,n]of e)switch(t){case"LW":this.setLineWidth(n);break;case"LC":this.setLineCap(n);break;case"LJ":this.setLineJoin(n);break;case"ML":this.setMiterLimit(n);break;case"D":this.setDash(n[0],n[1]);break;case"RI":this.setRenderingIntent(n);break;case"FL":this.setFlatness(n);break;case"Font":this.setFont(n[0],n[1]);break;case"CA":this.current.strokeAlpha=n;break;case"ca":this.current.fillAlpha=n,this.ctx.globalAlpha=n;break;case"BM":this.ctx.globalCompositeOperation=n;break;case"SMask":this.current.activeSMask=n?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(n);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const e=this.ctx.canvas.width,t=this.ctx.canvas.height,n="smaskGroupAt"+this.groupLevel,s=this.cachedCanvases.getCanvas(n,e,t);this.suspendedCtx=this.ctx,this.ctx=s.context;const o=this.ctx;o.setTransform(...Lt(this.suspendedCtx)),ih(this.suspendedCtx,o),jH(o,this.suspendedCtx),this.setGState([["BM","source-over"],["ca",1],["CA",1]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),ih(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,n=this.suspendedCtx;this.composeSMask(n,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,n,s){const o=s[0],l=s[1],c=s[2]-o,d=s[3]-l;c===0||d===0||(this.genericComposeSMask(t.context,n,c,d,t.subtype,t.backdrop,t.transferMap,o,l,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(n.canvas,0,0),e.restore())}genericComposeSMask(e,t,n,s,o,l,c,d,h,p,y){let b=e.canvas,S=d-p,E=h-y;if(l){if(S<0||E<0||S+n>b.width||E+s>b.height){const A=this.cachedCanvases.getCanvas("maskExtension",n,s),C=A.context;C.drawImage(b,-S,-E),l.some(k=>k!==0)&&(C.globalCompositeOperation="destination-atop",C.fillStyle=Ee.makeHexColor(...l),C.fillRect(0,0,n,s),C.globalCompositeOperation="source-over"),b=A.canvas,S=E=0}else if(l.some(A=>A!==0)){e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const A=new Path2D;A.rect(S,E,n,s),e.clip(A),e.globalCompositeOperation="destination-atop",e.fillStyle=Ee.makeHexColor(...l),e.fillRect(S,E,n,s),e.restore()}}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),o==="Alpha"&&c?t.filter=this.filterFactory.addAlphaFilter(c):o==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(c));const R=new Path2D;R.rect(d,h,n,s),t.clip(R),t.globalCompositeOperation="destination-in",t.drawImage(b,S,E,n,s,d,h,n,s),t.restore()}save(){this.inSMaskMode?(ih(this.ctx,this.suspendedCtx),this.suspendedCtx.save()):this.ctx.save();const e=this.current;this.stateStack.push(e),this.current=e.clone()}restore(){this.stateStack.length===0&&this.inSMaskMode&&this.endSMaskMode(),this.stateStack.length!==0&&(this.current=this.stateStack.pop(),this.inSMaskMode?(this.suspendedCtx.restore(),ih(this.suspendedCtx,this.ctx)):this.ctx.restore(),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null)}transform(e,t,n,s,o,l){this.ctx.transform(e,t,n,s,o,l),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,n){const s=this.ctx,o=this.current;let l=o.x,c=o.y,d,h;const p=Lt(s),y=p[0]===0&&p[3]===0||p[1]===0&&p[2]===0,b=y?n.slice(0):null;for(let S=0,E=0,R=e.length;S<R;S++)switch(e[S]|0){case as.rectangle:l=t[E++],c=t[E++];const A=t[E++],C=t[E++],k=l+A,I=c+C;s.moveTo(l,c),A===0||C===0?s.lineTo(k,I):(s.lineTo(k,c),s.lineTo(k,I),s.lineTo(l,I)),y||o.updateRectMinMax(p,[l,c,k,I]),s.closePath();break;case as.moveTo:l=t[E++],c=t[E++],s.moveTo(l,c),y||o.updatePathMinMax(p,l,c);break;case as.lineTo:l=t[E++],c=t[E++],s.lineTo(l,c),y||o.updatePathMinMax(p,l,c);break;case as.curveTo:d=l,h=c,l=t[E+4],c=t[E+5],s.bezierCurveTo(t[E],t[E+1],t[E+2],t[E+3],l,c),o.updateCurvePathMinMax(p,d,h,t[E],t[E+1],t[E+2],t[E+3],l,c,b),E+=6;break;case as.curveTo2:d=l,h=c,s.bezierCurveTo(l,c,t[E],t[E+1],t[E+2],t[E+3]),o.updateCurvePathMinMax(p,d,h,l,c,t[E],t[E+1],t[E+2],t[E+3],b),l=t[E+2],c=t[E+3],E+=4;break;case as.curveTo3:d=l,h=c,l=t[E+2],c=t[E+3],s.bezierCurveTo(t[E],t[E+1],l,c,l,c),o.updateCurvePathMinMax(p,d,h,t[E],t[E+1],l,c,l,c,b),E+=4;break;case as.closePath:s.closePath();break}y&&o.updateScalingPathMinMax(p,b),o.setCurrentPoint(l,c)}closePath(){this.ctx.closePath()}stroke(e=!0){const t=this.ctx,n=this.current.strokeColor;t.globalAlpha=this.current.strokeAlpha,this.contentVisible&&(typeof n=="object"&&(n!=null&&n.getPattern)?(t.save(),t.strokeStyle=n.getPattern(t,this,_r(t),Jn.STROKE),this.rescaleAndStroke(!1),t.restore()):this.rescaleAndStroke(!0)),e&&this.consumePath(this.current.getClippedPathBoundingBox()),t.globalAlpha=this.current.fillAlpha}closeStroke(){this.closePath(),this.stroke()}fill(e=!0){const t=this.ctx,n=this.current.fillColor,s=this.current.patternFill;let o=!1;s&&(t.save(),t.fillStyle=n.getPattern(t,this,_r(t),Jn.FILL),o=!0);const l=this.current.getClippedPathBoundingBox();this.contentVisible&&l!==null&&(this.pendingEOFill?(t.fill("evenodd"),this.pendingEOFill=!1):t.fill()),o&&t.restore(),e&&this.consumePath(l)}eoFill(){this.pendingEOFill=!0,this.fill()}fillStroke(){this.fill(!1),this.stroke(!1),this.consumePath()}eoFillStroke(){this.pendingEOFill=!0,this.fillStroke()}closeFillStroke(){this.closePath(),this.fillStroke()}closeEOFillStroke(){this.pendingEOFill=!0,this.closePath(),this.fillStroke()}endPath(){this.consumePath()}clip(){this.pendingClip=$H}eoClip(){this.pendingClip=d1}beginText(){this.current.textMatrix=RR,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const e=this.pendingTextPaths,t=this.ctx;if(e===void 0){t.beginPath();return}t.save(),t.beginPath();for(const n of e)t.setTransform(...n.transform),t.translate(n.x,n.y),n.addToPath(t,n.fontSize);t.restore(),t.clip(),t.beginPath(),delete this.pendingTextPaths}setCharSpacing(e){this.current.charSpacing=e}setWordSpacing(e){this.current.wordSpacing=e}setHScale(e){this.current.textHScale=e/100}setLeading(e){this.current.leading=-e}setFont(e,t){var p;const n=this.commonObjs.get(e),s=this.current;if(!n)throw new Error(`Can't find font for ${e}`);if(s.fontMatrix=n.fontMatrix||Gb,(s.fontMatrix[0]===0||s.fontMatrix[3]===0)&&Je("Invalid font matrix for font "+e),t<0?(t=-t,s.fontDirection=-1):s.fontDirection=1,this.current.font=n,this.current.fontSize=t,n.isType3Font)return;const o=n.loadedName||"sans-serif",l=((p=n.systemFontInfo)==null?void 0:p.css)||`"${o}", ${n.fallbackName}`;let c="normal";n.black?c="900":n.bold&&(c="bold");const d=n.italic?"italic":"normal";let h=t;t<i1?h=i1:t>s1&&(h=s1),this.current.fontSizeScale=t/h,this.ctx.font=`${d} ${c} ${h}px ${l}`}setTextRenderingMode(e){this.current.textRenderingMode=e}setTextRise(e){this.current.textRise=e}moveText(e,t){this.current.x=this.current.lineX+=e,this.current.y=this.current.lineY+=t}setLeadingMoveText(e,t){this.setLeading(-t),this.moveText(e,t)}setTextMatrix(e,t,n,s,o,l){this.current.textMatrix=[e,t,n,s,o,l],this.current.textMatrixScale=Math.hypot(e,t),this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(e,t,n,s){const o=this.ctx,l=this.current,c=l.font,d=l.textRenderingMode,h=l.fontSize/l.fontSizeScale,p=d&Ln.FILL_STROKE_MASK,y=!!(d&Ln.ADD_TO_PATH_FLAG),b=l.patternFill&&!c.missingFile;let S;(c.disableFontFace||y||b)&&(S=c.getPathGenerator(this.commonObjs,e)),c.disableFontFace||b?(o.save(),o.translate(t,n),o.beginPath(),S(o,h),s&&o.setTransform(...s),(p===Ln.FILL||p===Ln.FILL_STROKE)&&o.fill(),(p===Ln.STROKE||p===Ln.FILL_STROKE)&&o.stroke(),o.restore()):((p===Ln.FILL||p===Ln.FILL_STROKE)&&o.fillText(e,t,n),(p===Ln.STROKE||p===Ln.FILL_STROKE)&&o.strokeText(e,t,n)),y&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:Lt(o),x:t,y:n,fontSize:h,addToPath:S})}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let n=!1;for(let s=3;s<t.length;s+=4)if(t[s]>0&&t[s]<255){n=!0;break}return st(this,"isFontSubpixelAAEnabled",n)}showText(e){const t=this.current,n=t.font;if(n.isType3Font)return this.showType3Text(e);const s=t.fontSize;if(s===0)return;const o=this.ctx,l=t.fontSizeScale,c=t.charSpacing,d=t.wordSpacing,h=t.fontDirection,p=t.textHScale*h,y=e.length,b=n.vertical,S=b?1:-1,E=n.defaultVMetrics,R=s*t.fontMatrix[0],A=t.textRenderingMode===Ln.FILL&&!n.disableFontFace&&!t.patternFill;o.save(),o.transform(...t.textMatrix),o.translate(t.x,t.y+t.textRise),h>0?o.scale(p,-1):o.scale(p,1);let C;if(t.patternFill){o.save();const P=t.fillColor.getPattern(o,this,_r(o),Jn.FILL);C=Lt(o),o.restore(),o.fillStyle=P}let k=t.lineWidth;const I=t.textMatrixScale;if(I===0||k===0){const P=t.textRenderingMode&Ln.FILL_STROKE_MASK;(P===Ln.STROKE||P===Ln.FILL_STROKE)&&(k=this.getSinglePixelWidth())}else k/=I;if(l!==1&&(o.scale(l,l),k/=l),o.lineWidth=k,n.isInvalidPDFjsFont){const P=[];let B=0;for(const Q of e)P.push(Q.unicode),B+=Q.width;o.fillText(P.join(""),0,0),t.x+=B*R*p,o.restore(),this.compose();return}let O=0,U;for(U=0;U<y;++U){const P=e[U];if(typeof P=="number"){O+=S*P*s/1e3;continue}let B=!1;const Q=(P.isSpace?d:0)+c,K=P.fontChar,le=P.accent;let de,G,fe=P.width;if(b){const pe=P.vmetric||E,z=-(P.vmetric?pe[1]:fe*.5)*R,X=pe[2]*R;fe=pe?-pe[0]:fe,de=z/l,G=(O+X)/l}else de=O/l,G=0;if(n.remeasure&&fe>0){const pe=o.measureText(K).width*1e3/s*l;if(fe<pe&&this.isFontSubpixelAAEnabled){const z=fe/pe;B=!0,o.save(),o.scale(z,1),de/=z}else fe!==pe&&(de+=(fe-pe)/2e3*s/l)}if(this.contentVisible&&(P.isInFont||n.missingFile)){if(A&&!le)o.fillText(K,de,G);else if(this.paintChar(K,de,G,C),le){const pe=de+s*le.offset.x/l,z=G-s*le.offset.y/l;this.paintChar(le.fontChar,pe,z,C)}}const ce=b?fe*R-Q*h:fe*R+Q*h;O+=ce,B&&o.restore()}b?t.y-=O:t.x+=O*p,o.restore(),this.compose()}showType3Text(e){const t=this.ctx,n=this.current,s=n.font,o=n.fontSize,l=n.fontDirection,c=s.vertical?1:-1,d=n.charSpacing,h=n.wordSpacing,p=n.textHScale*l,y=n.fontMatrix||Gb,b=e.length,S=n.textRenderingMode===Ln.INVISIBLE;let E,R,A,C;if(!(S||o===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,t.save(),t.transform(...n.textMatrix),t.translate(n.x,n.y),t.scale(p,l),E=0;E<b;++E){if(R=e[E],typeof R=="number"){C=c*R*o/1e3,this.ctx.translate(C,0),n.x+=C*p;continue}const k=(R.isSpace?h:0)+d,I=s.charProcOperatorList[R.operatorListId];if(!I){Je(`Type3 character "${R.operatorListId}" is not available.`);continue}this.contentVisible&&(this.processingType3=R,this.save(),t.scale(o,o),t.transform(...y),this.executeOperatorList(I),this.restore()),A=Ee.applyTransform([R.width,0],y)[0]*o+k,t.translate(A,0),n.x+=A*p}t.restore(),this.processingType3=null}}setCharWidth(e,t){}setCharWidthAndBounds(e,t,n,s,o,l){this.ctx.rect(n,s,o-n,l-s),this.ctx.clip(),this.endPath()}getColorN_Pattern(e){let t;if(e[0]==="TilingPattern"){const n=e[1],s=this.baseTransform||Lt(this.ctx),o={createCanvasGraphics:l=>new Iw(l,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};t=new v_(e,n,this.ctx,o,s)}else t=this._getPattern(e[1],e[2]);return t}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments)}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(e,t,n){const s=Ee.makeHexColor(e,t,n);this.ctx.strokeStyle=s,this.current.strokeColor=s}setFillRGBColor(e,t,n){const s=Ee.makeHexColor(e,t,n);this.ctx.fillStyle=s,this.current.fillColor=s,this.current.patternFill=!1}_getPattern(e,t=null){let n;return this.cachedPatterns.has(e)?n=this.cachedPatterns.get(e):(n=FH(this.getObject(e)),this.cachedPatterns.set(e,n)),t&&(n.matrix=t),n}shadingFill(e){if(!this.contentVisible)return;const t=this.ctx;this.save();const n=this._getPattern(e);t.fillStyle=n.getPattern(t,this,_r(t),Jn.SHADING);const s=_r(t);if(s){const{width:o,height:l}=t.canvas,[c,d,h,p]=Ee.getAxialAlignedBoundingBox([0,0,o,l],s);this.ctx.fillRect(c,d,h-c,p-d)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){xt("Should not call beginInlineImage")}beginImageData(){xt("Should not call beginImageData")}paintFormXObjectBegin(e,t){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),e&&this.transform(...e),this.baseTransform=Lt(this.ctx),t)){const n=t[2]-t[0],s=t[3]-t[1];this.ctx.rect(t[0],t[1],n,s),this.current.updateRectMinMax(Lt(this.ctx),t),this.clip(),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const t=this.ctx;e.isolated||S0("TODO: Support non-isolated groups."),e.knockout&&Je("Knockout groups not supported.");const n=Lt(t);if(e.matrix&&t.transform(...e.matrix),!e.bbox)throw new Error("Bounding box is required.");let s=Ee.getAxialAlignedBoundingBox(e.bbox,Lt(t));const o=[0,0,t.canvas.width,t.canvas.height];s=Ee.intersect(s,o)||[0,0,0,0];const l=Math.floor(s[0]),c=Math.floor(s[1]),d=Math.max(Math.ceil(s[2])-l,1),h=Math.max(Math.ceil(s[3])-c,1);this.current.startNewPathAndClipBox([0,0,d,h]);let p="groupAt"+this.groupLevel;e.smask&&(p+="_smask_"+this.smaskCounter++%2);const y=this.cachedCanvases.getCanvas(p,d,h),b=y.context;b.translate(-l,-c),b.transform(...n),e.smask?this.smaskStack.push({canvas:y.canvas,context:b,offsetX:l,offsetY:c,subtype:e.smask.subtype,backdrop:e.smask.backdrop,transferMap:e.smask.transferMap||null,startTransformInverse:null}):(t.setTransform(1,0,0,1,0,0),t.translate(l,c),t.save()),ih(t,b),this.ctx=b,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(t),this.groupLevel++}endGroup(e){if(!this.contentVisible)return;this.groupLevel--;const t=this.ctx,n=this.groupStack.pop();if(this.ctx=n,this.ctx.imageSmoothingEnabled=!1,e.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const s=Lt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...s);const o=Ee.getAxialAlignedBoundingBox([0,0,t.canvas.width,t.canvas.height],s);this.ctx.drawImage(t.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,n,s,o){if(D(this,la,y_).call(this),Qm(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),t){const l=t[2]-t[0],c=t[3]-t[1];if(o&&this.annotationCanvasMap){n=n.slice(),n[4]-=t[0],n[5]-=t[1],t=t.slice(),t[0]=t[1]=0,t[2]=l,t[3]=c;const[d,h]=Ee.singularValueDecompose2dScale(Lt(this.ctx)),{viewportScale:p}=this,y=Math.ceil(l*this.outputScaleX*p),b=Math.ceil(c*this.outputScaleY*p);this.annotationCanvas=this.canvasFactory.create(y,b);const{canvas:S,context:E}=this.annotationCanvas;this.annotationCanvasMap.set(e,S),this.annotationCanvas.savedCtx=this.ctx,this.ctx=E,this.ctx.save(),this.ctx.setTransform(d,0,0,-h,0,c*h),Qm(this.ctx)}else Qm(this.ctx),this.ctx.rect(t[0],t[1],l,c),this.ctx.clip(),this.endPath()}this.current=new a1(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...n),this.transform(...s)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),D(this,la,b_).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e){if(!this.contentVisible)return;const t=e.count;e=this.getObject(e.data,e),e.count=t;const n=this.ctx,s=this.processingType3;if(s&&(s.compiled===void 0&&(s.compiled=GH(e)),s.compiled)){s.compiled(n);return}const o=this._createMaskCanvas(e),l=o.canvas;n.save(),n.setTransform(1,0,0,1,0,0),n.drawImage(l,o.offsetX,o.offsetY),n.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,n=0,s=0,o,l){if(!this.contentVisible)return;e=this.getObject(e.data,e);const c=this.ctx;c.save();const d=Lt(c);c.transform(t,n,s,o,0,0);const h=this._createMaskCanvas(e);c.setTransform(1,0,0,1,h.offsetX-d[4],h.offsetY-d[5]);for(let p=0,y=l.length;p<y;p+=2){const b=Ee.transform(d,[t,n,s,o,l[p],l[p+1]]),[S,E]=Ee.applyTransform([0,0],b);c.drawImage(h.canvas,S,E)}c.restore(),this.compose()}paintImageMaskXObjectGroup(e){if(!this.contentVisible)return;const t=this.ctx,n=this.current.fillColor,s=this.current.patternFill;for(const o of e){const{data:l,width:c,height:d,transform:h}=o,p=this.cachedCanvases.getCanvas("maskCanvas",c,d),y=p.context;y.save();const b=this.getObject(l,o);c1(y,b),y.globalCompositeOperation="source-in",y.fillStyle=s?n.getPattern(y,this,_r(t),Jn.FILL):n,y.fillRect(0,0,c,d),y.restore(),t.save(),t.transform(...h),t.scale(1,-1),Xm(t,p.canvas,0,0,c,d,0,-1,1,1),t.restore()}this.compose()}paintImageXObject(e){if(!this.contentVisible)return;const t=this.getObject(e);if(!t){Je("Dependent image isn't ready yet");return}this.paintInlineImageXObject(t)}paintImageXObjectRepeat(e,t,n,s){if(!this.contentVisible)return;const o=this.getObject(e);if(!o){Je("Dependent image isn't ready yet");return}const l=o.width,c=o.height,d=[];for(let h=0,p=s.length;h<p;h+=2)d.push({transform:[t,0,0,n,s[h],s[h+1]],x:0,y:0,w:l,h:c});this.paintInlineImageXObjectGroup(o,d)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:n,height:s}=e,o=this.cachedCanvases.getCanvas("inlineImage",n,s),l=o.context;return l.filter=this.current.transferMaps,l.drawImage(t,0,0),l.filter="none",o.canvas}paintInlineImageXObject(e){if(!this.contentVisible)return;const t=e.width,n=e.height,s=this.ctx;if(this.save(),!Hn){const{filter:c}=s;c!=="none"&&c!==""&&(s.filter="none")}s.scale(1/t,-1/n);let o;if(e.bitmap)o=this.applyTransferMapsToBitmap(e);else if(typeof HTMLElement=="function"&&e instanceof HTMLElement||!e.data)o=e;else{const d=this.cachedCanvases.getCanvas("inlineImage",t,n).context;l1(d,e),o=this.applyTransferMapsToCanvas(d)}const l=this._scaleImage(o,_r(s));s.imageSmoothingEnabled=u1(Lt(s),e.interpolate),Xm(s,l.img,0,0,l.paintWidth,l.paintHeight,0,-n,t,n),this.compose(),this.restore()}paintInlineImageXObjectGroup(e,t){if(!this.contentVisible)return;const n=this.ctx;let s;if(e.bitmap)s=e.bitmap;else{const o=e.width,l=e.height,d=this.cachedCanvases.getCanvas("inlineImage",o,l).context;l1(d,e),s=this.applyTransferMapsToCanvas(d)}for(const o of t)n.save(),n.transform(...o.transform),n.scale(1,-1),Xm(n,s,o.x,o.y,o.w,o.h,0,-1,1,1),n.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e){}markPointProps(e,t){}beginMarkedContent(e){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t){e==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(t)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(e){const t=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const n=this.ctx;this.pendingClip&&(t||(this.pendingClip===d1?n.clip("evenodd"):n.clip()),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox),n.beginPath()}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=Lt(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),n=Math.hypot(e[0],e[2]),s=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(n,s)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:n,c:s,d:o}=this.ctx.getTransform();let l,c;if(n===0&&s===0){const d=Math.abs(t),h=Math.abs(o);if(d===h)if(e===0)l=c=1/d;else{const p=d*e;l=c=p<1?1/p:1}else if(e===0)l=1/d,c=1/h;else{const p=d*e,y=h*e;l=p<1?1/p:1,c=y<1?1/y:1}}else{const d=Math.abs(t*o-n*s),h=Math.hypot(t,n),p=Math.hypot(s,o);if(e===0)l=p/d,c=h/d;else{const y=e*d;l=p>y?p/y:1,c=h>y?h/y:1}}this._cachedScaleForStroking[0]=l,this._cachedScaleForStroking[1]=c}return this._cachedScaleForStroking}rescaleAndStroke(e){const{ctx:t}=this,{lineWidth:n}=this.current,[s,o]=this.getScaleForStroking();if(t.lineWidth=n||1,s===1&&o===1){t.stroke();return}const l=t.getLineDash();if(e&&t.save(),t.scale(s,o),l.length>0){const c=Math.max(s,o);t.setLineDash(l.map(d=>d/c)),t.lineDashOffset/=c}t.stroke(),e&&t.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}};la=new WeakSet,y_=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},b_=function(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}};let iu=Iw;for(const i in as)iu.prototype[i]!==void 0&&(iu.prototype[as[i]]=iu.prototype[i]);var hf,ff;class Xr{static get workerPort(){return g(this,hf)}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");N(this,hf,e)}static get workerSrc(){return g(this,ff)}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");N(this,ff,e)}}hf=new WeakMap,ff=new WeakMap,L(Xr,hf,null),L(Xr,ff,"");const Zm={DATA:1,ERROR:2},Xt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function wi(i){switch(i instanceof Error||typeof i=="object"&&i!==null||xt('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),i.name){case"AbortException":return new zl(i.message);case"MissingPDFException":return new Vl(i.message);case"PasswordException":return new zb(i.message,i.code);case"UnexpectedResponseException":return new E0(i.message,i.status);case"UnknownErrorException":return new $b(i.message,i.details);default:return new $b(i.message,i.toString())}}var Ws,dN,hN,ug;class fh{constructor(e,t,n){L(this,Ws);this.sourceName=e,this.targetName=t,this.comObj=n,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),this._onComObjOnMessage=s=>{const o=s.data;if(o.targetName!==this.sourceName)return;if(o.stream){D(this,Ws,hN).call(this,o);return}if(o.callback){const c=o.callbackId,d=this.callbackCapabilities[c];if(!d)throw new Error(`Cannot resolve callback ${c}`);if(delete this.callbackCapabilities[c],o.callback===Zm.DATA)d.resolve(o.data);else if(o.callback===Zm.ERROR)d.reject(wi(o.reason));else throw new Error("Unexpected callback case");return}const l=this.actionHandler[o.action];if(!l)throw new Error(`Unknown action from worker: ${o.action}`);if(o.callbackId){const c=this.sourceName,d=o.sourceName;new Promise(function(h){h(l(o.data))}).then(function(h){n.postMessage({sourceName:c,targetName:d,callback:Zm.DATA,callbackId:o.callbackId,data:h})},function(h){n.postMessage({sourceName:c,targetName:d,callback:Zm.ERROR,callbackId:o.callbackId,reason:wi(h)})});return}if(o.streamId){D(this,Ws,dN).call(this,o);return}l(o.data)},n.addEventListener("message",this._onComObjOnMessage)}on(e,t){const n=this.actionHandler;if(n[e])throw new Error(`There is already an actionName called "${e}"`);n[e]=t}send(e,t,n){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},n)}sendWithPromise(e,t,n){const s=this.callbackId++,o=Promise.withResolvers();this.callbackCapabilities[s]=o;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:s,data:t},n)}catch(l){o.reject(l)}return o.promise}sendWithStream(e,t,n,s){const o=this.streamId++,l=this.sourceName,c=this.targetName,d=this.comObj;return new ReadableStream({start:h=>{const p=Promise.withResolvers();return this.streamControllers[o]={controller:h,startCall:p,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:l,targetName:c,action:e,streamId:o,data:t,desiredSize:h.desiredSize},s),p.promise},pull:h=>{const p=Promise.withResolvers();return this.streamControllers[o].pullCall=p,d.postMessage({sourceName:l,targetName:c,stream:Xt.PULL,streamId:o,desiredSize:h.desiredSize}),p.promise},cancel:h=>{cn(h instanceof Error,"cancel must have a valid reason");const p=Promise.withResolvers();return this.streamControllers[o].cancelCall=p,this.streamControllers[o].isClosed=!0,d.postMessage({sourceName:l,targetName:c,stream:Xt.CANCEL,streamId:o,reason:wi(h)}),p.promise}},n)}destroy(){this.comObj.removeEventListener("message",this._onComObjOnMessage)}}Ws=new WeakSet,dN=function(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,o=this.comObj,l=this,c=this.actionHandler[e.action],d={enqueue(h,p=1,y){if(this.isCancelled)return;const b=this.desiredSize;this.desiredSize-=p,b>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),o.postMessage({sourceName:n,targetName:s,stream:Xt.ENQUEUE,streamId:t,chunk:h},y)},close(){this.isCancelled||(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:Xt.CLOSE,streamId:t}),delete l.streamSinks[t])},error(h){cn(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,o.postMessage({sourceName:n,targetName:s,stream:Xt.ERROR,streamId:t,reason:wi(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[t]=d,new Promise(function(h){h(c(e.data,d))}).then(function(){o.postMessage({sourceName:n,targetName:s,stream:Xt.START_COMPLETE,streamId:t,success:!0})},function(h){o.postMessage({sourceName:n,targetName:s,stream:Xt.START_COMPLETE,streamId:t,reason:wi(h)})})},hN=function(e){const t=e.streamId,n=this.sourceName,s=e.sourceName,o=this.comObj,l=this.streamControllers[t],c=this.streamSinks[t];switch(e.stream){case Xt.START_COMPLETE:e.success?l.startCall.resolve():l.startCall.reject(wi(e.reason));break;case Xt.PULL_COMPLETE:e.success?l.pullCall.resolve():l.pullCall.reject(wi(e.reason));break;case Xt.PULL:if(!c){o.postMessage({sourceName:n,targetName:s,stream:Xt.PULL_COMPLETE,streamId:t,success:!0});break}c.desiredSize<=0&&e.desiredSize>0&&c.sinkCapability.resolve(),c.desiredSize=e.desiredSize,new Promise(function(d){var h;d((h=c.onPull)==null?void 0:h.call(c))}).then(function(){o.postMessage({sourceName:n,targetName:s,stream:Xt.PULL_COMPLETE,streamId:t,success:!0})},function(d){o.postMessage({sourceName:n,targetName:s,stream:Xt.PULL_COMPLETE,streamId:t,reason:wi(d)})});break;case Xt.ENQUEUE:if(cn(l,"enqueue should have stream controller"),l.isClosed)break;l.controller.enqueue(e.chunk);break;case Xt.CLOSE:if(cn(l,"close should have stream controller"),l.isClosed)break;l.isClosed=!0,l.controller.close(),D(this,Ws,ug).call(this,l,t);break;case Xt.ERROR:cn(l,"error should have stream controller"),l.controller.error(wi(e.reason)),D(this,Ws,ug).call(this,l,t);break;case Xt.CANCEL_COMPLETE:e.success?l.cancelCall.resolve():l.cancelCall.reject(wi(e.reason)),D(this,Ws,ug).call(this,l,t);break;case Xt.CANCEL:if(!c)break;new Promise(function(d){var h;d((h=c.onCancel)==null?void 0:h.call(c,wi(e.reason)))}).then(function(){o.postMessage({sourceName:n,targetName:s,stream:Xt.CANCEL_COMPLETE,streamId:t,success:!0})},function(d){o.postMessage({sourceName:n,targetName:s,stream:Xt.CANCEL_COMPLETE,streamId:t,reason:wi(d)})}),c.sinkCapability.reject(wi(e.reason)),c.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}},ug=async function(e,t){var n,s,o;await Promise.allSettled([(n=e.startCall)==null?void 0:n.promise,(s=e.pullCall)==null?void 0:s.promise,(o=e.cancelCall)==null?void 0:o.promise]),delete this.streamControllers[t]};var ol,pf;class YH{constructor({parsedData:e,rawData:t}){L(this,ol);L(this,pf);N(this,ol,e),N(this,pf,t)}getRaw(){return g(this,pf)}get(e){return g(this,ol).get(e)??null}getAll(){return bw(g(this,ol))}has(e){return g(this,ol).has(e)}}ol=new WeakMap,pf=new WeakMap;const Lo=Symbol("INTERNAL");var mf,gf,vf,yu;class JH{constructor(e,{name:t,intent:n,usage:s}){L(this,mf,!1);L(this,gf,!1);L(this,vf,!1);L(this,yu,!0);N(this,mf,!!(e&Xi.DISPLAY)),N(this,gf,!!(e&Xi.PRINT)),this.name=t,this.intent=n,this.usage=s}get visible(){if(g(this,vf))return g(this,yu);if(!g(this,yu))return!1;const{print:e,view:t}=this.usage;return g(this,mf)?(t==null?void 0:t.viewState)!=="OFF":g(this,gf)?(e==null?void 0:e.printState)!=="OFF":!0}_setVisible(e,t,n=!1){e!==Lo&&xt("Internal method `_setVisible` called."),N(this,vf,n),N(this,yu,t)}}mf=new WeakMap,gf=new WeakMap,vf=new WeakMap,yu=new WeakMap;var Vo,wt,bu,_u,yf,__;class KH{constructor(e,t=Xi.DISPLAY){L(this,yf);L(this,Vo,null);L(this,wt,new Map);L(this,bu,null);L(this,_u,null);if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,N(this,_u,e.order);for(const n of e.groups)g(this,wt).set(n.id,new JH(t,n));if(e.baseState==="OFF")for(const n of g(this,wt).values())n._setVisible(Lo,!1);for(const n of e.on)g(this,wt).get(n)._setVisible(Lo,!0);for(const n of e.off)g(this,wt).get(n)._setVisible(Lo,!1);N(this,bu,this.getHash())}}isVisible(e){if(g(this,wt).size===0)return!0;if(!e)return S0("Optional content group not defined."),!0;if(e.type==="OCG")return g(this,wt).has(e.id)?g(this,wt).get(e.id).visible:(Je(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return D(this,yf,__).call(this,e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!g(this,wt).has(t))return Je(`Optional content group not found: ${t}`),!0;if(g(this,wt).get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!g(this,wt).has(t))return Je(`Optional content group not found: ${t}`),!0;if(!g(this,wt).get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!g(this,wt).has(t))return Je(`Optional content group not found: ${t}`),!0;if(!g(this,wt).get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!g(this,wt).has(t))return Je(`Optional content group not found: ${t}`),!0;if(g(this,wt).get(t).visible)return!1}return!0}return Je(`Unknown optional content policy ${e.policy}.`),!0}return Je(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0){const n=g(this,wt).get(e);if(!n){Je(`Optional content group not found: ${e}`);return}n._setVisible(Lo,!!t,!0),N(this,Vo,null)}setOCGState({state:e,preserveRB:t}){let n;for(const s of e){switch(s){case"ON":case"OFF":case"Toggle":n=s;continue}const o=g(this,wt).get(s);if(o)switch(n){case"ON":o._setVisible(Lo,!0);break;case"OFF":o._setVisible(Lo,!1);break;case"Toggle":o._setVisible(Lo,!o.visible);break}}N(this,Vo,null)}get hasInitialVisibility(){return g(this,bu)===null||this.getHash()===g(this,bu)}getOrder(){return g(this,wt).size?g(this,_u)?g(this,_u).slice():[...g(this,wt).keys()]:null}getGroups(){return g(this,wt).size>0?bw(g(this,wt)):null}getGroup(e){return g(this,wt).get(e)||null}getHash(){if(g(this,Vo)!==null)return g(this,Vo);const e=new aN;for(const[t,n]of g(this,wt))e.update(`${t}:${n.visible}`);return N(this,Vo,e.hexdigest())}}Vo=new WeakMap,wt=new WeakMap,bu=new WeakMap,_u=new WeakMap,yf=new WeakSet,__=function(e){const t=e.length;if(t<2)return!0;const n=e[0];for(let s=1;s<t;s++){const o=e[s];let l;if(Array.isArray(o))l=D(this,yf,__).call(this,o);else if(g(this,wt).has(o))l=g(this,wt).get(o).visible;else return Je(`Optional content group not found: ${o}`),!0;switch(n){case"And":if(!l)return!1;break;case"Or":if(l)return!0;break;case"Not":return!l;default:return!0}}return n==="And"};class WH{constructor(e,{disableRange:t=!1,disableStream:n=!1}){cn(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:s,initialData:o,progressiveDone:l,contentDispositionFilename:c}=e;if(this._queuedChunks=[],this._progressiveDone=l,this._contentDispositionFilename=c,(o==null?void 0:o.length)>0){const d=o instanceof Uint8Array&&o.byteLength===o.buffer.byteLength?o.buffer:new Uint8Array(o).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!n,this._isRangeSupported=!t,this._contentLength=s,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((d,h)=>{this._onReceiveData({begin:d,chunk:h})}),e.addProgressListener((d,h)=>{this._onProgress({loaded:d,total:h})}),e.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const n=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(n):this._queuedChunks.push(n);else{const s=this._rangeReaders.some(function(o){return o._begin!==e?!1:(o._enqueue(n),!0)});cn(s,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}_onProgress(e){var t,n,s,o;e.total===void 0?(n=(t=this._rangeReaders[0])==null?void 0:t.onProgress)==null||n.call(t,{loaded:e.loaded}):(o=(s=this._fullRequestReader)==null?void 0:s.onProgress)==null||o.call(s,{loaded:e.loaded,total:e.total})}_onProgressiveDone(){var e;(e=this._fullRequestReader)==null||e.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){cn(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new XH(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new QH(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeReaders.slice(0))n.cancel(e);this._pdfDataRangeTransport.abort()}}class XH{constructor(e,t,n=!1,s=null){this._stream=e,this._done=n||!1,this._filename=Ew(s)?s:null,this._queuedChunks=t||[],this._loaded=0;for(const o of this._queuedChunks)this._loaded+=o.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class QH{constructor(e,t,n){this._stream=e,this._begin=t,this._end=n,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function ZH(i){let e=!0,t=n("filename\\*","i").exec(i);if(t){t=t[1];let p=c(t);return p=unescape(p),p=d(p),p=h(p),o(p)}if(t=l(i),t){const p=h(t);return o(p)}if(t=n("filename","i").exec(i),t){t=t[1];let p=c(t);return p=h(p),o(p)}function n(p,y){return new RegExp("(?:^|;)\\s*"+p+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',y)}function s(p,y){if(p){if(!/^[\x00-\xFF]+$/.test(y))return y;try{const b=new TextDecoder(p,{fatal:!0}),S=A0(y);y=b.decode(S),e=!1}catch{}}return y}function o(p){return e&&/[\x80-\xff]/.test(p)&&(p=s("utf-8",p),e&&(p=s("iso-8859-1",p))),p}function l(p){const y=[];let b;const S=n("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(b=S.exec(p))!==null;){let[,R,A,C]=b;if(R=parseInt(R,10),R in y){if(R===0)break;continue}y[R]=[A,C]}const E=[];for(let R=0;R<y.length&&R in y;++R){let[A,C]=y[R];C=c(C),A&&(C=unescape(C),R===0&&(C=d(C))),E.push(C)}return E.join("")}function c(p){if(p.startsWith('"')){const y=p.slice(1).split('\\"');for(let b=0;b<y.length;++b){const S=y[b].indexOf('"');S!==-1&&(y[b]=y[b].slice(0,S),y.length=b+1),y[b]=y[b].replaceAll(/\\(.)/g,"$1")}p=y.join('"')}return p}function d(p){const y=p.indexOf("'");if(y===-1)return p;const b=p.slice(0,y),E=p.slice(y+1).replace(/^[^']*'/,"");return s(b,E)}function h(p){return!p.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(p)?p:p.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(y,b,S,E){if(S==="q"||S==="Q")return E=E.replaceAll("_"," "),E=E.replaceAll(/=([0-9a-fA-F]{2})/g,function(R,A){return String.fromCharCode(parseInt(A,16))}),s(b,E);try{E=atob(E)}catch{}return s(b,E)})}return""}function Cw({getResponseHeader:i,isHttp:e,rangeChunkSize:t,disableRange:n}){const s={allowRangeRequests:!1,suggestedLength:void 0},o=parseInt(i("Content-Length"),10);return!Number.isInteger(o)||(s.suggestedLength=o,o<=2*t)||n||!e||i("Accept-Ranges")!=="bytes"||(i("Content-Encoding")||"identity")!=="identity"||(s.allowRangeRequests=!0),s}function Rw(i){const e=i("Content-Disposition");if(e){let t=ZH(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Ew(t))return t}return null}function k0(i,e){return i===404||i===0&&e.startsWith("file:")?new Vl('Missing PDF "'+e+'".'):new E0(`Unexpected server response (${i}) while retrieving PDF "${e}".`,i)}function fN(i){return i===200||i===206}function pN(i,e,t){return{method:"GET",headers:i,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function mN(i){const e=new Headers;for(const t in i){const n=i[t];n!==void 0&&e.append(t,n)}return e}function gN(i){return i instanceof Uint8Array?i.buffer:i instanceof ArrayBuffer?i:(Je(`getArrayBuffer - unexpected data format: ${i}`),new Uint8Array(i).buffer)}class h1{constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return cn(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new eB(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=new tB(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class eB{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._headers=mN(this._stream.httpHeaders);const n=t.url;fetch(n,pN(this._headers,this._withCredentials,this._abortController)).then(s=>{if(!fN(s.status))throw k0(s.status,n);this._reader=s.body.getReader(),this._headersCapability.resolve();const o=d=>s.headers.get(d),{allowRangeRequests:l,suggestedLength:c}=Cw({getResponseHeader:o,isHttp:this._stream.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=l,this._contentLength=c||this._contentLength,this._filename=Rw(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new zl("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:gN(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}class tB{constructor(e,t,n){this._stream=e,this._reader=null,this._loaded=0;const s=e.source;this._withCredentials=s.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!s.disableStream,this._abortController=new AbortController,this._headers=mN(this._stream.httpHeaders),this._headers.append("Range",`bytes=${t}-${n-1}`);const o=s.url;fetch(o,pN(this._headers,this._withCredentials,this._abortController)).then(l=>{if(!fN(l.status))throw k0(l.status,o);this._readCapability.resolve(),this._reader=l.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:gN(e),done:!1})}cancel(e){var t;(t=this._reader)==null||t.cancel(e),this._abortController.abort()}}const fb=200,pb=206;function nB(i){const e=i.response;return typeof e!="string"?e:A0(e).buffer}class iB{constructor(e,t={}){this.url=e,this.isHttp=/^https?:/i.test(e),this.httpHeaders=this.isHttp&&t.httpHeaders||Object.create(null),this.withCredentials=t.withCredentials||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}requestRange(e,t,n){const s={begin:e,end:t};for(const o in n)s[o]=n[o];return this.request(s)}requestFull(e){return this.request(e)}request(e){const t=new XMLHttpRequest,n=this.currXhrId++,s=this.pendingRequests[n]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const o in this.httpHeaders){const l=this.httpHeaders[o];l!==void 0&&t.setRequestHeader(o,l)}return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),s.expectedStatus=pb):s.expectedStatus=fb,t.responseType="arraybuffer",e.onError&&(t.onerror=function(o){e.onError(t.status)}),t.onreadystatechange=this.onStateChange.bind(this,n),t.onprogress=this.onProgress.bind(this,n),s.onHeadersReceived=e.onHeadersReceived,s.onDone=e.onDone,s.onError=e.onError,s.onProgress=e.onProgress,t.send(null),n}onProgress(e,t){var s;const n=this.pendingRequests[e];n&&((s=n.onProgress)==null||s.call(n,t))}onStateChange(e,t){var d,h,p;const n=this.pendingRequests[e];if(!n)return;const s=n.xhr;if(s.readyState>=2&&n.onHeadersReceived&&(n.onHeadersReceived(),delete n.onHeadersReceived),s.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],s.status===0&&this.isHttp){(d=n.onError)==null||d.call(n,s.status);return}const o=s.status||fb;if(!(o===fb&&n.expectedStatus===pb)&&o!==n.expectedStatus){(h=n.onError)==null||h.call(n,s.status);return}const c=nB(s);if(o===pb){const y=s.getResponseHeader("Content-Range"),b=/bytes (\d+)-(\d+)\/(\d+)/.exec(y);n.onDone({begin:parseInt(b[1],10),chunk:c})}else c?n.onDone({begin:0,chunk:c}):(p=n.onError)==null||p.call(n,s.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class sB{constructor(e){this._source=e,this._manager=new iB(e.url,{httpHeaders:e.httpHeaders,withCredentials:e.withCredentials}),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return cn(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new rB(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const n=new oB(this._manager,e,t);return n.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class rB{constructor(e,t){this._manager=e;const n={onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=t.url,this._fullRequestId=e.requestFull(n),this._headersReceivedCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e),n=l=>t.getResponseHeader(l),{allowRangeRequests:s,suggestedLength:o}=Cw({getResponseHeader:n,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});s&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=Rw(n),this._isRangeSupported&&this._manager.abortRequest(e),this._headersReceivedCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=k0(e,this._url),this._headersReceivedCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){var t;(t=this.onProgress)==null||t.call(this,{loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersReceivedCapability.promise}async read(){if(this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersReceivedCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class oB{constructor(e,t,n){this._manager=e;const s={onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)};this._url=e.url,this._requestId=e.requestRange(t,n,s),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_close(){var e;(e=this.onClosed)==null||e.call(this,this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const n of this._requests)n.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError=k0(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){var t;this.isStreamingSupported||(t=this.onProgress)==null||t.call(this,{loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const vN=/^file:\/\/\/[a-zA-Z]:\//;function aB(i){const e=Qs.get("url"),t=e.parse(i);return t.protocol==="file:"||t.host?t:/^[a-z]:[/\\]/i.test(i)?e.parse(`file:///${i}`):(t.host||(t.protocol="file:"),t)}class lB{constructor(e){this.source=e,this.url=aB(e.url),this.isHttp=this.url.protocol==="http:"||this.url.protocol==="https:",this.isFsUrl=this.url.protocol==="file:",this.httpHeaders=this.isHttp&&e.httpHeaders||{},this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var e;return((e=this._fullRequestReader)==null?void 0:e._loaded)??0}getFullReader(){return cn(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=this.isFsUrl?new dB(this):new cB(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const n=this.isFsUrl?new hB(this,e,t):new uB(this,e,t);return this._rangeRequestReaders.push(n),n}cancelAllRequests(e){var t;(t=this._fullRequestReader)==null||t.cancel(e);for(const n of this._rangeRequestReaders.slice(0))n.cancel(e)}}class yN{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers()}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new zl("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class bN{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const t=e.source;this._isStreamingSupported=!t.disableStream}get isStreamingSupported(){return this._isStreamingSupported}async read(){var n;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,(n=this.onProgress)==null||n.call(this,{loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}function Gg(i,e){return{protocol:i.protocol,auth:i.auth,host:i.hostname,port:i.port,path:i.path,method:"GET",headers:e}}class cB extends yN{constructor(e){super(e);const t=n=>{if(n.statusCode===404){const c=new Vl(`Missing PDF "${this._url}".`);this._storedError=c,this._headersCapability.reject(c);return}this._headersCapability.resolve(),this._setReadableStream(n);const s=c=>this._readableStream.headers[c.toLowerCase()],{allowRangeRequests:o,suggestedLength:l}=Cw({getResponseHeader:s,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=Rw(s)};if(this._request=null,this._url.protocol==="http:"){const n=Qs.get("http");this._request=n.request(Gg(this._url,e.httpHeaders),t)}else{const n=Qs.get("https");this._request=n.request(Gg(this._url,e.httpHeaders),t)}this._request.on("error",n=>{this._storedError=n,this._headersCapability.reject(n)}),this._request.end()}}class uB extends bN{constructor(e,t,n){super(e),this._httpHeaders={};for(const o in e.httpHeaders){const l=e.httpHeaders[o];l!==void 0&&(this._httpHeaders[o]=l)}this._httpHeaders.Range=`bytes=${t}-${n-1}`;const s=o=>{if(o.statusCode===404){const l=new Vl(`Missing PDF "${this._url}".`);this._storedError=l;return}this._setReadableStream(o)};if(this._request=null,this._url.protocol==="http:"){const o=Qs.get("http");this._request=o.request(Gg(this._url,this._httpHeaders),s)}else{const o=Qs.get("https");this._request=o.request(Gg(this._url,this._httpHeaders),s)}this._request.on("error",o=>{this._storedError=o}),this._request.end()}}class dB extends yN{constructor(e){super(e);let t=decodeURIComponent(this._url.path);vN.test(this._url.href)&&(t=t.replace(/^\//,""));const n=Qs.get("fs");n.promises.lstat(t).then(s=>{this._contentLength=s.size,this._setReadableStream(n.createReadStream(t)),this._headersCapability.resolve()},s=>{s.code==="ENOENT"&&(s=new Vl(`Missing PDF "${t}".`)),this._storedError=s,this._headersCapability.reject(s)})}}class hB extends bN{constructor(e,t,n){super(e);let s=decodeURIComponent(this._url.path);vN.test(this._url.href)&&(s=s.replace(/^\//,""));const o=Qs.get("fs");this._setReadableStream(o.createReadStream(s,{start:t,end:n-1}))}}const fB=1e5,ri=30,pB=.8;var g1,zo,ai,bf,_f,al,Pr,wf,xf,ll,wu,xu,$o,Su,Sf,Eu,cl,Ef,Af,ul,dl,Yo,Au,no,_N,wN,w_,Xs,dg,xN,SN;const On=class On{constructor({textContentSource:e,container:t,viewport:n}){L(this,no);L(this,zo,Promise.withResolvers());L(this,ai,null);L(this,bf,!1);L(this,_f,!!((g1=globalThis.FontInspector)!=null&&g1.enabled));L(this,al,null);L(this,Pr,null);L(this,wf,0);L(this,xf,0);L(this,ll,null);L(this,wu,null);L(this,xu,0);L(this,$o,0);L(this,Su,Object.create(null));L(this,Sf,[]);L(this,Eu,null);L(this,cl,[]);L(this,Ef,new WeakMap);L(this,Af,null);var d;if(e instanceof ReadableStream)N(this,Eu,e);else if(typeof e=="object")N(this,Eu,new ReadableStream({start(h){h.enqueue(e),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');N(this,ai,N(this,wu,t)),N(this,$o,n.scale*(globalThis.devicePixelRatio||1)),N(this,xu,n.rotation),N(this,Pr,{prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:null});const{pageWidth:s,pageHeight:o,pageX:l,pageY:c}=n.rawDims;N(this,Af,[1,0,0,-1,-l,c+o]),N(this,xf,s),N(this,wf,o),D(d=On,Xs,xN).call(d),Fl(t,n),g(this,zo).promise.catch(()=>{}).then(()=>{g(On,Au).delete(this),N(this,Pr,null),N(this,Su,null)})}render(){const e=()=>{g(this,ll).read().then(({value:t,done:n})=>{if(n){g(this,zo).resolve();return}g(this,al)??N(this,al,t.lang),Object.assign(g(this,Su),t.styles),D(this,no,_N).call(this,t.items),e()},g(this,zo).reject)};return N(this,ll,g(this,Eu).getReader()),g(On,Au).add(this),e(),g(this,zo).promise}update({viewport:e,onBefore:t=null}){var o;const n=e.scale*(globalThis.devicePixelRatio||1),s=e.rotation;if(s!==g(this,xu)&&(t==null||t(),N(this,xu,s),Fl(g(this,wu),{rotation:s})),n!==g(this,$o)){t==null||t(),N(this,$o,n);const l={prevFontSize:null,prevFontFamily:null,div:null,properties:null,ctx:D(o=On,Xs,dg).call(o,g(this,al))};for(const c of g(this,cl))l.properties=g(this,Ef).get(c),l.div=c,D(this,no,w_).call(this,l)}}cancel(){var t;const e=new zl("TextLayer task cancelled.");(t=g(this,ll))==null||t.cancel(e).catch(()=>{}),N(this,ll,null),g(this,zo).reject(e)}get textDivs(){return g(this,cl)}get textContentItemsStr(){return g(this,Sf)}static cleanup(){if(!(g(this,Au).size>0)){g(this,ul).clear();for(const{canvas:e}of g(this,dl).values())e.remove();g(this,dl).clear()}}};zo=new WeakMap,ai=new WeakMap,bf=new WeakMap,_f=new WeakMap,al=new WeakMap,Pr=new WeakMap,wf=new WeakMap,xf=new WeakMap,ll=new WeakMap,wu=new WeakMap,xu=new WeakMap,$o=new WeakMap,Su=new WeakMap,Sf=new WeakMap,Eu=new WeakMap,cl=new WeakMap,Ef=new WeakMap,Af=new WeakMap,ul=new WeakMap,dl=new WeakMap,Yo=new WeakMap,Au=new WeakMap,no=new WeakSet,_N=function(e){var s,o;if(g(this,bf))return;(o=g(this,Pr)).ctx??(o.ctx=D(s=On,Xs,dg).call(s,g(this,al)));const t=g(this,cl),n=g(this,Sf);for(const l of e){if(t.length>fB){Je("Ignoring additional textDivs for performance reasons."),N(this,bf,!0);return}if(l.str===void 0){if(l.type==="beginMarkedContentProps"||l.type==="beginMarkedContent"){const c=g(this,ai);N(this,ai,document.createElement("span")),g(this,ai).classList.add("markedContent"),l.id!==null&&g(this,ai).setAttribute("id",`${l.id}`),c.append(g(this,ai))}else l.type==="endMarkedContent"&&N(this,ai,g(this,ai).parentNode);continue}n.push(l.str),D(this,no,wN).call(this,l)}},wN=function(e){var R;const t=document.createElement("span"),n={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};g(this,cl).push(t);const s=Ee.transform(g(this,Af),e.transform);let o=Math.atan2(s[1],s[0]);const l=g(this,Su)[e.fontName];l.vertical&&(o+=Math.PI/2);const c=g(this,_f)&&l.fontSubstitution||l.fontFamily,d=Math.hypot(s[2],s[3]),h=d*D(R=On,Xs,SN).call(R,c,g(this,al));let p,y;o===0?(p=s[4],y=s[5]-h):(p=s[4]+h*Math.sin(o),y=s[5]-h*Math.cos(o));const b="calc(var(--scale-factor)*",S=t.style;g(this,ai)===g(this,wu)?(S.left=`${(100*p/g(this,xf)).toFixed(2)}%`,S.top=`${(100*y/g(this,wf)).toFixed(2)}%`):(S.left=`${b}${p.toFixed(2)}px)`,S.top=`${b}${y.toFixed(2)}px)`),S.fontSize=`${b}${(g(On,Yo)*d).toFixed(2)}px)`,S.fontFamily=c,n.fontSize=d,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,g(this,_f)&&(t.dataset.fontName=l.fontSubstitutionLoadedName||e.fontName),o!==0&&(n.angle=o*(180/Math.PI));let E=!1;if(e.str.length>1)E=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const A=Math.abs(e.transform[0]),C=Math.abs(e.transform[3]);A!==C&&Math.max(A,C)/Math.min(A,C)>1.5&&(E=!0)}if(E&&(n.canvasWidth=l.vertical?e.height:e.width),g(this,Ef).set(t,n),g(this,Pr).div=t,g(this,Pr).properties=n,D(this,no,w_).call(this,g(this,Pr)),n.hasText&&g(this,ai).append(t),n.hasEOL){const A=document.createElement("br");A.setAttribute("role","presentation"),g(this,ai).append(A)}},w_=function(e){const{div:t,properties:n,ctx:s,prevFontSize:o,prevFontFamily:l}=e,{style:c}=t;let d="";if(g(On,Yo)>1&&(d=`scale(${1/g(On,Yo)})`),n.canvasWidth!==0&&n.hasText){const{fontFamily:h}=c,{canvasWidth:p,fontSize:y}=n;(o!==y||l!==h)&&(s.font=`${y*g(this,$o)}px ${h}`,e.prevFontSize=y,e.prevFontFamily=h);const{width:b}=s.measureText(t.textContent);b>0&&(d=`scaleX(${p*g(this,$o)/b}) ${d}`)}n.angle!==0&&(d=`rotate(${n.angle}deg) ${d}`),d.length>0&&(c.transform=d)},Xs=new WeakSet,dg=function(e=null){let t=g(this,dl).get(e||(e=""));if(!t){const n=document.createElement("canvas");n.className="hiddenCanvasElement",n.lang=e,document.body.append(n),t=n.getContext("2d",{alpha:!1,willReadFrequently:!0}),g(this,dl).set(e,t)}return t},xN=function(){if(g(this,Yo)!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.textContent="X",document.body.append(e),N(this,Yo,e.getBoundingClientRect().height),e.remove()},SN=function(e,t){const n=g(this,ul).get(e);if(n)return n;const s=D(this,Xs,dg).call(this,t),o=s.font;s.canvas.width=s.canvas.height=ri,s.font=`${ri}px ${e}`;const l=s.measureText("");let c=l.fontBoundingBoxAscent,d=Math.abs(l.fontBoundingBoxDescent);if(c){const y=c/(c+d);return g(this,ul).set(e,y),s.canvas.width=s.canvas.height=0,s.font=o,y}s.strokeStyle="red",s.clearRect(0,0,ri,ri),s.strokeText("g",0,0);let h=s.getImageData(0,0,ri,ri).data;d=0;for(let y=h.length-1-3;y>=0;y-=4)if(h[y]>0){d=Math.ceil(y/4/ri);break}s.clearRect(0,0,ri,ri),s.strokeText("A",0,ri),h=s.getImageData(0,0,ri,ri).data,c=0;for(let y=0,b=h.length;y<b;y+=4)if(h[y]>0){c=ri-Math.floor(y/4/ri);break}s.canvas.width=s.canvas.height=0,s.font=o;const p=c?c/(c+d):pB;return g(this,ul).set(e,p),p},L(On,Xs),L(On,ul,new Map),L(On,dl,new Map),L(On,Yo,null),L(On,Au,new Set);let ed=On;function mB(){PR("`renderTextLayer`, please use `TextLayer` instead.");const{textContentSource:i,container:e,viewport:t,...n}=arguments[0],s=Object.keys(n);s.length>0&&Je("Ignoring `renderTextLayer` parameters: "+s.join(", "));const o=new ed({textContentSource:i,container:e,viewport:t}),{textDivs:l,textContentItemsStr:c}=o;return{promise:o.render(),textDivs:l,textContentItemsStr:c}}function gB(){PR("`updateTextLayer`, please use `TextLayer` instead.")}class Ph{static textContent(e){const t=[],n={items:t,styles:Object.create(null)};function s(o){var d;if(!o)return;let l=null;const c=o.name;if(c==="#text")l=o.value;else if(Ph.shouldBuildText(c))(d=o==null?void 0:o.attributes)!=null&&d.textContent?l=o.attributes.textContent:o.value&&(l=o.value);else return;if(l!==null&&t.push({str:l}),!!o.children)for(const h of o.children)s(h)}return s(e),n}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}const vB=65536,yB=100,bB=5e3,_B=Hn?IH:yH,wB=Hn?MH:DR,xB=Hn?kH:vH,SB=Hn?DH:LR;function EB(i={}){typeof i=="string"||i instanceof URL?i={url:i}:(i instanceof ArrayBuffer||ArrayBuffer.isView(i))&&(i={data:i});const e=new x_,{docId:t}=e,n=i.url?AB(i.url):null,s=i.data?TB(i.data):null,o=i.httpHeaders||null,l=i.withCredentials===!0,c=i.password??null,d=i.range instanceof EN?i.range:null,h=Number.isInteger(i.rangeChunkSize)&&i.rangeChunkSize>0?i.rangeChunkSize:vB;let p=i.worker instanceof su?i.worker:null;const y=i.verbosity,b=typeof i.docBaseUrl=="string"&&!Sw(i.docBaseUrl)?i.docBaseUrl:null,S=typeof i.cMapUrl=="string"?i.cMapUrl:null,E=i.cMapPacked!==!1,R=i.CMapReaderFactory||wB,A=typeof i.standardFontDataUrl=="string"?i.standardFontDataUrl:null,C=i.StandardFontDataFactory||SB,k=i.stopAtErrors!==!0,I=Number.isInteger(i.maxImageSize)&&i.maxImageSize>-1?i.maxImageSize:-1,O=i.isEvalSupported!==!1,U=typeof i.isOffscreenCanvasSupported=="boolean"?i.isOffscreenCanvasSupported:!Hn,P=Number.isInteger(i.canvasMaxAreaInBytes)?i.canvasMaxAreaInBytes:-1,B=typeof i.disableFontFace=="boolean"?i.disableFontFace:Hn,Q=i.fontExtraProperties===!0,K=i.enableXfa===!0,le=i.ownerDocument||globalThis.document,de=i.disableRange===!0,G=i.disableStream===!0,fe=i.disableAutoFetch===!0,ce=i.pdfBug===!0,pe=i.enableHWA===!0,z=d?d.length:i.length??NaN,X=typeof i.useSystemFonts=="boolean"?i.useSystemFonts:!Hn&&!B,te=typeof i.useWorkerFetch=="boolean"?i.useWorkerFetch:R===DR&&C===LR&&S&&A&&uh(S,document.baseURI)&&uh(A,document.baseURI),ne=i.canvasFactory||new _B({ownerDocument:le,enableHWA:pe}),ue=i.filterFactory||new xB({docId:t,ownerDocument:le}),F=null;oH(y);const V={canvasFactory:ne,filterFactory:ue};if(te||(V.cMapReaderFactory=new R({baseUrl:S,isCompressed:E}),V.standardFontDataFactory=new C({baseUrl:A})),!p){const Te={verbosity:y,port:Xr.workerPort};p=Te.port?su.fromPort(Te):new su(Te),e._worker=p}const se={docId:t,apiVersion:"4.4.168",data:s,password:c,disableAutoFetch:fe,rangeChunkSize:h,length:z,docBaseUrl:b,enableXfa:K,evaluatorOptions:{maxImageSize:I,disableFontFace:B,ignoreErrors:k,isEvalSupported:O,isOffscreenCanvasSupported:U,canvasMaxAreaInBytes:P,fontExtraProperties:Q,useSystemFonts:X,cMapUrl:te?S:null,standardFontDataUrl:te?A:null}},he={disableFontFace:B,fontExtraProperties:Q,ownerDocument:le,pdfBug:ce,styleElement:F,loadingParams:{disableAutoFetch:fe,enableXfa:K}};return p.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const Te=p.messageHandler.sendWithPromise("GetDocRequest",se,s?[s.buffer]:null);let ke;if(d)ke=new WH(d,{disableRange:de,disableStream:G});else if(!s){if(!n)throw new Error("getDocument - no `url` parameter provided.");ke=(ft=>Hn?function(){return typeof fetch<"u"&&typeof Response<"u"&&"body"in Response.prototype}()&&uh(ft.url)?new h1(ft):new lB(ft):uh(ft.url)?new h1(ft):new sB(ft))({url:n,length:z,httpHeaders:o,withCredentials:l,rangeChunkSize:h,disableRange:de,disableStream:G})}return Te.then(xe=>{if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const ft=new fh(t,xe,p.port),Ye=new kB(ft,e,ke,he,V);e._transport=Ye,ft.send("Ready",null)})}).catch(e._capability.reject),e}function AB(i){if(i instanceof URL)return i.href;try{return new URL(i,window.location).href}catch{if(Hn&&typeof i=="string")return i}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function TB(i){if(Hn&&typeof Buffer<"u"&&i instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(i instanceof Uint8Array&&i.byteLength===i.buffer.byteLength)return i;if(typeof i=="string")return A0(i);if(i instanceof ArrayBuffer||ArrayBuffer.isView(i)||typeof i=="object"&&!isNaN(i==null?void 0:i.length))return new Uint8Array(i);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function f1(i){return typeof i=="object"&&Number.isInteger(i==null?void 0:i.num)&&i.num>=0&&Number.isInteger(i==null?void 0:i.gen)&&i.gen>=0}var s0;const r0=class r0{constructor(){this._capability=Promise.withResolvers(),this._transport=null,this._worker=null,this.docId=`d${_i(r0,s0)._++}`,this.destroyed=!1,this.onPassword=null,this.onProgress=null}get promise(){return this._capability.promise}async destroy(){var e,t,n;this.destroyed=!0;try{(e=this._worker)!=null&&e.port&&(this._worker._pendingDestroy=!0),await((t=this._transport)==null?void 0:t.destroy())}catch(s){throw(n=this._worker)!=null&&n.port&&delete this._worker._pendingDestroy,s}this._transport=null,this._worker&&(this._worker.destroy(),this._worker=null)}};s0=new WeakMap,L(r0,s0,0);let x_=r0;class EN{constructor(e,t,n=!1,s=null){this.length=e,this.initialData=t,this.progressiveDone=n,this.contentDispositionFilename=s,this._rangeListeners=[],this._progressListeners=[],this._progressiveReadListeners=[],this._progressiveDoneListeners=[],this._readyCapability=Promise.withResolvers()}addRangeListener(e){this._rangeListeners.push(e)}addProgressListener(e){this._progressListeners.push(e)}addProgressiveReadListener(e){this._progressiveReadListeners.push(e)}addProgressiveDoneListener(e){this._progressiveDoneListeners.push(e)}onDataRange(e,t){for(const n of this._rangeListeners)n(e,t)}onDataProgress(e,t){this._readyCapability.promise.then(()=>{for(const n of this._progressListeners)n(e,t)})}onDataProgressiveRead(e){this._readyCapability.promise.then(()=>{for(const t of this._progressiveReadListeners)t(e)})}onDataProgressiveDone(){this._readyCapability.promise.then(()=>{for(const e of this._progressiveDoneListeners)e()})}transportReady(){this._readyCapability.resolve()}requestDataRange(e,t){xt("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}class CB{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return st(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var Jo,Or,Qi,Yc,hg;class RB{constructor(e,t,n,s=!1){L(this,Qi);L(this,Jo,null);L(this,Or,!1);this._pageIndex=e,this._pageInfo=t,this._transport=n,this._stats=s?new ZC:null,this._pdfBug=s,this.commonObjs=n.commonObjs,this.objs=new AN,this._maybeCleanupAfterRender=!1,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:n=0,offsetY:s=0,dontFlip:o=!1}={}){return new yp({viewBox:this.view,scale:e,rotation:t,offsetX:n,offsetY:s,dontFlip:o})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return st(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var e;return((e=this._transport._htmlForXfa)==null?void 0:e.children[this._pageIndex])||null}render({canvasContext:e,viewport:t,intent:n="display",annotationMode:s=Fo.ENABLE,transform:o=null,background:l=null,optionalContentConfigPromise:c=null,annotationCanvasMap:d=null,pageColors:h=null,printAnnotationStorage:p=null}){var I,O;(I=this._stats)==null||I.time("Overall");const y=this._transport.getRenderingIntent(n,s,p),{renderingIntent:b,cacheKey:S}=y;N(this,Or,!1),D(this,Qi,hg).call(this),c||(c=this._transport.getOptionalContentConfig(b));let E=this._intentStates.get(S);E||(E=Object.create(null),this._intentStates.set(S,E)),E.streamReaderCancelTimeout&&(clearTimeout(E.streamReaderCancelTimeout),E.streamReaderCancelTimeout=null);const R=!!(b&Xi.PRINT);E.displayReadyCapability||(E.displayReadyCapability=Promise.withResolvers(),E.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(O=this._stats)==null||O.time("Page Request"),this._pumpOperatorList(y));const A=U=>{var P;E.renderTasks.delete(C),(this._maybeCleanupAfterRender||R)&&N(this,Or,!0),D(this,Qi,Yc).call(this,!R),U?(C.capability.reject(U),this._abortOperatorList({intentState:E,reason:U instanceof Error?U:new Error(U)})):C.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(P=globalThis.Stats)!=null&&P.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},C=new E_({callback:A,params:{canvasContext:e,viewport:t,transform:o,background:l},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:d,operatorList:E.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!R,pdfBug:this._pdfBug,pageColors:h});(E.renderTasks||(E.renderTasks=new Set)).add(C);const k=C.task;return Promise.all([E.displayReadyCapability.promise,c]).then(([U,P])=>{var B;if(this.destroyed){A();return}if((B=this._stats)==null||B.time("Rendering"),!(P.renderingIntent&b))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");C.initializeGraphics({transparency:U,optionalContentConfig:P}),C.operatorListChanged()}).catch(A),k}getOperatorList({intent:e="display",annotationMode:t=Fo.ENABLE,printAnnotationStorage:n=null}={}){var d;function s(){l.operatorList.lastChunk&&(l.opListReadCapability.resolve(l.operatorList),l.renderTasks.delete(c))}const o=this._transport.getRenderingIntent(e,t,n,!0);let l=this._intentStates.get(o.cacheKey);l||(l=Object.create(null),this._intentStates.set(o.cacheKey,l));let c;return l.opListReadCapability||(c=Object.create(null),c.operatorListChanged=s,l.opListReadCapability=Promise.withResolvers(),(l.renderTasks||(l.renderTasks=new Set)).add(c),l.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(d=this._stats)==null||d.time("Page Request"),this._pumpOperatorList(o)),l.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(s){return s.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(n=>Ph.textContent(n));const t=this.streamTextContent(e);return new Promise(function(n,s){function o(){l.read().then(function({value:d,done:h}){if(h){n(c);return}c.lang??(c.lang=d.lang),Object.assign(c.styles,d.styles),c.items.push(...d.items),o()},s)}const l=t.getReader(),c={items:[],styles:Object.create(null),lang:null};o()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const n of t.renderTasks)e.push(n.completed),n.cancel();return this.objs.clear(),N(this,Or,!1),D(this,Qi,hg).call(this),Promise.all(e)}cleanup(e=!1){N(this,Or,!0);const t=D(this,Qi,Yc).call(this,!1);return e&&t&&this._stats&&(this._stats=new ZC),t}_startRenderPage(e,t){var s,o;const n=this._intentStates.get(t);n&&((s=this._stats)==null||s.timeEnd("Page Request"),(o=n.displayReadyCapability)==null||o.resolve(e))}_renderPageChunk(e,t){for(let n=0,s=e.length;n<s;n++)t.operatorList.fnArray.push(e.fnArray[n]),t.operatorList.argsArray.push(e.argsArray[n]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const n of t.renderTasks)n.operatorListChanged();e.lastChunk&&D(this,Qi,Yc).call(this,!0)}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:n}){const{map:s,transfer:o}=n,c=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:s},o).getReader(),d=this._intentStates.get(t);d.streamReader=c;const h=()=>{c.read().then(({value:p,done:y})=>{if(y){d.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(p,d),h())},p=>{if(d.streamReader=null,!this._transport.destroyed){if(d.operatorList){d.operatorList.lastChunk=!0;for(const y of d.renderTasks)y.operatorListChanged();D(this,Qi,Yc).call(this,!0)}if(d.displayReadyCapability)d.displayReadyCapability.reject(p);else if(d.opListReadCapability)d.opListReadCapability.reject(p);else throw p}})};h()}_abortOperatorList({intentState:e,reason:t,force:n=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!n){if(e.renderTasks.size>0)return;if(t instanceof xw){let s=yB;t.extraDelay>0&&t.extraDelay<1e3&&(s+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},s);return}}if(e.streamReader.cancel(new zl(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[s,o]of this._intentStates)if(o===e){this._intentStates.delete(s);break}this.cleanup()}}}get stats(){return this._stats}}Jo=new WeakMap,Or=new WeakMap,Qi=new WeakSet,Yc=function(e=!1){if(D(this,Qi,hg).call(this),!g(this,Or)||this.destroyed)return!1;if(e)return N(this,Jo,setTimeout(()=>{N(this,Jo,null),D(this,Qi,Yc).call(this,!1)},bB)),!1;for(const{renderTasks:t,operatorList:n}of this._intentStates.values())if(t.size>0||!n.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),N(this,Or,!1),!0},hg=function(){g(this,Jo)&&(clearTimeout(g(this,Jo)),N(this,Jo,null))};var hl,o0;class NB{constructor(){L(this,hl,new Set);L(this,o0,Promise.resolve())}postMessage(e,t){const n={data:structuredClone(e,t?{transfer:t}:null)};g(this,o0).then(()=>{for(const s of g(this,hl))s.call(this,n)})}addEventListener(e,t){g(this,hl).add(t)}removeEventListener(e,t){g(this,hl).delete(t)}terminate(){g(this,hl).clear()}}hl=new WeakMap,o0=new WeakMap;const Tr={isWorkerDisabled:!1,fakeWorkerId:0};Hn&&(Tr.isWorkerDisabled=!0,Xr.workerSrc||(Xr.workerSrc="./pdf.worker.mjs")),Tr.isSameOrigin=function(i,e){let t;try{if(t=new URL(i),!t.origin||t.origin==="null")return!1}catch{return!1}const n=new URL(e,t);return t.origin===n.origin},Tr.createCDNWrapper=function(i){const e=`await import("${i}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))};var fl,Tu,fg,Cu,pg;const Si=class Si{constructor({name:e=null,port:t=null,verbosity:n=aH()}={}){L(this,Tu);var s;if(this.name=e,this.destroyed=!1,this.verbosity=n,this._readyCapability=Promise.withResolvers(),this._port=null,this._webWorker=null,this._messageHandler=null,t){if((s=g(Si,fl))!=null&&s.has(t))throw new Error("Cannot use more than one PDFWorker per port.");(g(Si,fl)||N(Si,fl,new WeakMap)).set(t,this),this._initializeFromPort(t);return}this._initialize()}get promise(){return Hn?Promise.all([Qs.promise,this._readyCapability.promise]):this._readyCapability.promise}get port(){return this._port}get messageHandler(){return this._messageHandler}_initializeFromPort(e){this._port=e,this._messageHandler=new fh("main","worker",e),this._messageHandler.on("ready",function(){}),D(this,Tu,fg).call(this)}_initialize(){if(Tr.isWorkerDisabled||g(Si,Cu,pg)){this._setupFakeWorker();return}let{workerSrc:e}=Si;try{Tr.isSameOrigin(window.location.href,e)||(e=Tr.createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),n=new fh("main","worker",t),s=()=>{o.abort(),n.destroy(),t.terminate(),this.destroyed?this._readyCapability.reject(new Error("Worker was destroyed")):this._setupFakeWorker()},o=new AbortController;t.addEventListener("error",()=>{this._webWorker||s()},{signal:o.signal}),n.on("test",c=>{if(o.abort(),this.destroyed||!c){s();return}this._messageHandler=n,this._port=t,this._webWorker=t,D(this,Tu,fg).call(this)}),n.on("ready",c=>{if(o.abort(),this.destroyed){s();return}try{l()}catch{this._setupFakeWorker()}});const l=()=>{const c=new Uint8Array;n.send("test",c,[c.buffer])};l();return}catch{S0("The worker has been disabled.")}this._setupFakeWorker()}_setupFakeWorker(){Tr.isWorkerDisabled||(Je("Setting up fake worker."),Tr.isWorkerDisabled=!0),Si._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){this._readyCapability.reject(new Error("Worker was destroyed"));return}const t=new NB;this._port=t;const n=`fake${Tr.fakeWorkerId++}`,s=new fh(n+"_worker",n,t);e.setup(s,t),this._messageHandler=new fh(n,n+"_worker",t),D(this,Tu,fg).call(this)}).catch(e=>{this._readyCapability.reject(new Error(`Setting up fake worker failed: "${e.message}".`))})}destroy(){var e;this.destroyed=!0,this._webWorker&&(this._webWorker.terminate(),this._webWorker=null),(e=g(Si,fl))==null||e.delete(this._port),this._port=null,this._messageHandler&&(this._messageHandler.destroy(),this._messageHandler=null)}static fromPort(e){var n;if(!(e!=null&&e.port))throw new Error("PDFWorker.fromPort - invalid method signature.");const t=(n=g(this,fl))==null?void 0:n.get(e.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.fromPort - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new Si(e)}static get workerSrc(){if(Xr.workerSrc)return Xr.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return st(this,"_setupFakeWorkerGlobal",(async()=>g(this,Cu,pg)?g(this,Cu,pg):(await import(this.workerSrc)).WorkerMessageHandler)())}};fl=new WeakMap,Tu=new WeakSet,fg=function(){this._readyCapability.resolve(),this._messageHandler.send("configure",{verbosity:this.verbosity})},Cu=new WeakSet,pg=function(){var e;try{return((e=globalThis.pdfjsWorker)==null?void 0:e.WorkerMessageHandler)||null}catch{return null}},L(Si,Cu),L(Si,fl);let su=Si;var Ur,Hs,Ru,Nu,Bs,pl,ph;class kB{constructor(e,t,n,s,o){L(this,pl);L(this,Ur,new Map);L(this,Hs,new Map);L(this,Ru,new Map);L(this,Nu,new Map);L(this,Bs,null);this.messageHandler=e,this.loadingTask=t,this.commonObjs=new AN,this.fontLoader=new RH({ownerDocument:s.ownerDocument,styleElement:s.styleElement}),this.loadingParams=s.loadingParams,this._params=s,this.canvasFactory=o.canvasFactory,this.filterFactory=o.filterFactory,this.cMapReaderFactory=o.cMapReaderFactory,this.standardFontDataFactory=o.standardFontDataFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=n,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.setupMessageHandler()}get annotationStorage(){return st(this,"annotationStorage",new Tw)}getRenderingIntent(e,t=Fo.ENABLE,n=null,s=!1){let o=Xi.DISPLAY,l=p_;switch(e){case"any":o=Xi.ANY;break;case"display":break;case"print":o=Xi.PRINT;break;default:Je(`getRenderingIntent - invalid intent: ${e}`)}switch(t){case Fo.DISABLE:o+=Xi.ANNOTATIONS_DISABLE;break;case Fo.ENABLE:break;case Fo.ENABLE_FORMS:o+=Xi.ANNOTATIONS_FORMS;break;case Fo.ENABLE_STORAGE:o+=Xi.ANNOTATIONS_STORAGE,l=(o&Xi.PRINT&&n instanceof cN?n:this.annotationStorage).serializable;break;default:Je(`getRenderingIntent - invalid annotationMode: ${t}`)}return s&&(o+=Xi.OPLIST),{renderingIntent:o,cacheKey:`${o}_${l.hash}`,annotationStorageSerializable:l}}destroy(){var n;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(n=g(this,Bs))==null||n.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const s of g(this,Hs).values())e.push(s._destroy());g(this,Hs).clear(),g(this,Ru).clear(),g(this,Nu).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{var s;this.commonObjs.clear(),this.fontLoader.clear(),g(this,Ur).clear(),this.filterFactory.destroy(),ed.cleanup(),(s=this._networkStream)==null||s.cancelAllRequests(new zl("Worker was terminated.")),this.messageHandler&&(this.messageHandler.destroy(),this.messageHandler=null),this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(n,s)=>{cn(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=o=>{this._lastProgress={loaded:o.loaded,total:o.total}},s.onPull=()=>{this._fullReader.read().then(function({value:o,done:l}){if(l){s.close();return}cn(o instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{s.error(o)})},s.onCancel=o=>{this._fullReader.cancel(o),s.ready.catch(l=>{if(!this.destroyed)throw l})}}),e.on("ReaderHeadersReady",n=>{const s=Promise.withResolvers(),o=this._fullReader;return o.headersReady.then(()=>{var l;(!o.isStreamingSupported||!o.isRangeSupported)&&(this._lastProgress&&((l=t.onProgress)==null||l.call(t,this._lastProgress)),o.onProgress=c=>{var d;(d=t.onProgress)==null||d.call(t,{loaded:c.loaded,total:c.total})}),s.resolve({isStreamingSupported:o.isStreamingSupported,isRangeSupported:o.isRangeSupported,contentLength:o.contentLength})},s.reject),s.promise}),e.on("GetRangeReader",(n,s)=>{cn(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const o=this._networkStream.getRangeReader(n.begin,n.end);if(!o){s.close();return}s.onPull=()=>{o.read().then(function({value:l,done:c}){if(c){s.close();return}cn(l instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),s.enqueue(new Uint8Array(l),1,[l])}).catch(l=>{s.error(l)})},s.onCancel=l=>{o.cancel(l),s.ready.catch(c=>{if(!this.destroyed)throw c})}}),e.on("GetDoc",({pdfInfo:n})=>{this._numPages=n.numPages,this._htmlForXfa=n.htmlForXfa,delete n.htmlForXfa,t._capability.resolve(new CB(n,this))}),e.on("DocException",function(n){let s;switch(n.name){case"PasswordException":s=new zb(n.message,n.code);break;case"InvalidPDFException":s=new NR(n.message);break;case"MissingPDFException":s=new Vl(n.message);break;case"UnexpectedResponseException":s=new E0(n.message,n.status);break;case"UnknownErrorException":s=new $b(n.message,n.details);break;default:xt("DocException - expected a valid Error.")}t._capability.reject(s)}),e.on("PasswordRequest",n=>{if(N(this,Bs,Promise.withResolvers()),t.onPassword){const s=o=>{o instanceof Error?g(this,Bs).reject(o):g(this,Bs).resolve({password:o})};try{t.onPassword(s,n.code)}catch(o){g(this,Bs).reject(o)}}else g(this,Bs).reject(new zb(n.message,n.code));return g(this,Bs).promise}),e.on("DataLoaded",n=>{var s;(s=t.onProgress)==null||s.call(t,{loaded:n.length,total:n.length}),this.downloadInfoCapability.resolve(n)}),e.on("StartRenderPage",n=>{if(this.destroyed)return;g(this,Hs).get(n.pageIndex)._startRenderPage(n.transparency,n.cacheKey)}),e.on("commonobj",([n,s,o])=>{var l;if(this.destroyed||this.commonObjs.has(n))return null;switch(s){case"Font":const{disableFontFace:c,fontExtraProperties:d,pdfBug:h}=this._params;if("error"in o){const S=o.error;Je(`Error during font loading: ${S}`),this.commonObjs.resolve(n,S);break}const p=h&&((l=globalThis.FontInspector)!=null&&l.enabled)?(S,E)=>globalThis.FontInspector.fontAdded(S,E):null,y=new NH(o,{disableFontFace:c,inspectFont:p});this.fontLoader.bind(y).catch(()=>e.sendWithPromise("FontFallback",{id:n})).finally(()=>{!d&&y.data&&(y.data=null),this.commonObjs.resolve(n,y)});break;case"CopyLocalImage":const{imageRef:b}=o;cn(b,"The imageRef must be defined.");for(const S of g(this,Hs).values())for(const[,E]of S.objs)if((E==null?void 0:E.ref)===b)return E.dataLen?(this.commonObjs.resolve(n,structuredClone(E)),E.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(n,o);break;default:throw new Error(`Got unknown common object type ${s}`)}return null}),e.on("obj",([n,s,o,l])=>{var d;if(this.destroyed)return;const c=g(this,Hs).get(s);if(!c.objs.has(n)){if(c._intentStates.size===0){(d=l==null?void 0:l.bitmap)==null||d.close();return}switch(o){case"Image":c.objs.resolve(n,l),(l==null?void 0:l.dataLen)>nH&&(c._maybeCleanupAfterRender=!0);break;case"Pattern":c.objs.resolve(n,l);break;default:throw new Error(`Got unknown object type ${o}`)}}}),e.on("DocProgress",n=>{var s;this.destroyed||(s=t.onProgress)==null||s.call(t,{loaded:n.loaded,total:n.total})}),e.on("FetchBuiltInCMap",n=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.cMapReaderFactory?this.cMapReaderFactory.fetch(n):Promise.reject(new Error("CMapReaderFactory not initialized, see the `useWorkerFetch` parameter."))),e.on("FetchStandardFontData",n=>this.destroyed?Promise.reject(new Error("Worker was destroyed.")):this.standardFontDataFactory?this.standardFontDataFactory.fetch(n):Promise.reject(new Error("StandardFontDataFactory not initialized, see the `useWorkerFetch` parameter.")))}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var n;this.annotationStorage.size<=0&&Je("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:((n=this._fullReader)==null?void 0:n.filename)??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,n=g(this,Ru).get(t);if(n)return n;const s=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(o=>{if(this.destroyed)throw new Error("Transport destroyed");o.refStr&&g(this,Nu).set(o.refStr,e);const l=new RB(t,o,this,this._params.pdfBug);return g(this,Hs).set(t,l),l});return g(this,Ru).set(t,s),s}getPageIndex(e){return f1(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return D(this,pl,ph).call(this,"GetFieldObjects")}hasJSActions(){return D(this,pl,ph).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return D(this,pl,ph).call(this,"GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return D(this,pl,ph).call(this,"GetOptionalContentConfig").then(t=>new KH(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=g(this,Ur).get(e);if(t)return t;const n=this.messageHandler.sendWithPromise(e,null).then(s=>{var o,l;return{info:s[0],metadata:s[1]?new YH(s[1]):null,contentDispositionFilename:((o=this._fullReader)==null?void 0:o.filename)??null,contentLength:((l=this._fullReader)==null?void 0:l.contentLength)??null}});return g(this,Ur).set(e,n),n}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of g(this,Hs).values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),g(this,Ur).clear(),this.filterFactory.destroy(!0),ed.cleanup()}}cachedPageNumber(e){if(!f1(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return g(this,Nu).get(t)??null}}Ur=new WeakMap,Hs=new WeakMap,Ru=new WeakMap,Nu=new WeakMap,Bs=new WeakMap,pl=new WeakSet,ph=function(e,t=null){const n=g(this,Ur).get(e);if(n)return n;const s=this.messageHandler.sendWithPromise(e,t);return g(this,Ur).set(e,s),s};const eg=Symbol("INITIAL_DATA");var fs,Tf,S_;class AN{constructor(){L(this,Tf);L(this,fs,Object.create(null))}get(e,t=null){if(t){const s=D(this,Tf,S_).call(this,e);return s.promise.then(()=>t(s.data)),null}const n=g(this,fs)[e];if(!n||n.data===eg)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return n.data}has(e){const t=g(this,fs)[e];return!!t&&t.data!==eg}resolve(e,t=null){const n=D(this,Tf,S_).call(this,e);n.data=t,n.resolve()}clear(){var e;for(const t in g(this,fs)){const{data:n}=g(this,fs)[t];(e=n==null?void 0:n.bitmap)==null||e.close()}N(this,fs,Object.create(null))}*[Symbol.iterator](){for(const e in g(this,fs)){const{data:t}=g(this,fs)[e];t!==eg&&(yield[e,t])}}}fs=new WeakMap,Tf=new WeakSet,S_=function(e){var t;return(t=g(this,fs))[e]||(t[e]={...Promise.withResolvers(),data:eg})};var Ko;class IB{constructor(e){L(this,Ko,null);N(this,Ko,e),this.onContinue=null}get promise(){return g(this,Ko).capability.promise}cancel(e=0){g(this,Ko).cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=g(this,Ko).operatorList;if(!e)return!1;const{annotationCanvasMap:t}=g(this,Ko);return e.form||e.canvas&&(t==null?void 0:t.size)>0}}Ko=new WeakMap;var Wo,ml;const ja=class ja{constructor({callback:e,params:t,objs:n,commonObjs:s,annotationCanvasMap:o,operatorList:l,pageIndex:c,canvasFactory:d,filterFactory:h,useRequestAnimationFrame:p=!1,pdfBug:y=!1,pageColors:b=null}){L(this,Wo,null);this.callback=e,this.params=t,this.objs=n,this.commonObjs=s,this.annotationCanvasMap=o,this.operatorListIdx=null,this.operatorList=l,this._pageIndex=c,this.canvasFactory=d,this.filterFactory=h,this._pdfBug=y,this.pageColors=b,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=p===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new IB(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvasContext.canvas}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){var c,d;if(this.cancelled)return;if(this._canvas){if(g(ja,ml).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");g(ja,ml).add(this._canvas)}this._pdfBug&&((c=globalThis.StepperManager)!=null&&c.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{canvasContext:n,viewport:s,transform:o,background:l}=this.params;this.gfx=new iu(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:o,viewport:s,transparency:e,background:l}),this.operatorListIdx=0,this.graphicsReady=!0,(d=this.graphicsReadyCallback)==null||d.call(this)}cancel(e=null,t=0){var n;this.running=!1,this.cancelled=!0,(n=this.gfx)==null||n.endDrawing(),g(this,Wo)&&(window.cancelAnimationFrame(g(this,Wo)),N(this,Wo,null)),g(ja,ml).delete(this._canvas),this.callback(e||new xw(`Rendering cancelled, page ${this._pageIndex+1}`,t))}operatorListChanged(){var e;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(e=this.stepper)==null||e.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?N(this,Wo,window.requestAnimationFrame(()=>{N(this,Wo,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),g(ja,ml).delete(this._canvas),this.callback())))}};Wo=new WeakMap,ml=new WeakMap,L(ja,ml,new WeakSet);let E_=ja;const MB="4.4.168",DB="19fbc8998";function p1(i){return Math.floor(Math.max(0,Math.min(1,i))*255).toString(16).padStart(2,"0")}function sh(i){return Math.max(0,Math.min(255,255*i))}class m1{static CMYK_G([e,t,n,s]){return["G",1-Math.min(1,.3*e+.59*n+.11*t+s)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=sh(e),[e,e,e]}static G_HTML([e]){const t=p1(e);return`#${t}${t}${t}`}static RGB_G([e,t,n]){return["G",.3*e+.59*t+.11*n]}static RGB_rgb(e){return e.map(sh)}static RGB_HTML(e){return`#${e.map(p1).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,n,s]){return["RGB",1-Math.min(1,e+s),1-Math.min(1,n+s),1-Math.min(1,t+s)]}static CMYK_rgb([e,t,n,s]){return[sh(1-Math.min(1,e+s)),sh(1-Math.min(1,n+s)),sh(1-Math.min(1,t+s))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,n]){const s=1-e,o=1-t,l=1-n,c=Math.min(s,o,l);return["CMYK",s,o,l,c]}}class TN{static setupStorage(e,t,n,s,o){const l=s.getValue(t,{value:null});switch(n.name){case"textarea":if(l.value!==null&&(e.textContent=l.value),o==="print")break;e.addEventListener("input",c=>{s.setValue(t,{value:c.target.value})});break;case"input":if(n.attributes.type==="radio"||n.attributes.type==="checkbox"){if(l.value===n.attributes.xfaOn?e.setAttribute("checked",!0):l.value===n.attributes.xfaOff&&e.removeAttribute("checked"),o==="print")break;e.addEventListener("change",c=>{s.setValue(t,{value:c.target.checked?c.target.getAttribute("xfaOn"):c.target.getAttribute("xfaOff")})})}else{if(l.value!==null&&e.setAttribute("value",l.value),o==="print")break;e.addEventListener("input",c=>{s.setValue(t,{value:c.target.value})})}break;case"select":if(l.value!==null){e.setAttribute("value",l.value);for(const c of n.children)c.attributes.value===l.value?c.attributes.selected=!0:c.attributes.hasOwnProperty("selected")&&delete c.attributes.selected}e.addEventListener("input",c=>{const d=c.target.options,h=d.selectedIndex===-1?"":d[d.selectedIndex].value;s.setValue(t,{value:h})});break}}static setAttributes({html:e,element:t,storage:n=null,intent:s,linkService:o}){const{attributes:l}=t,c=e instanceof HTMLAnchorElement;l.type==="radio"&&(l.name=`${l.name}-${s}`);for(const[d,h]of Object.entries(l))if(h!=null)switch(d){case"class":h.length&&e.setAttribute(d,h.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",h);break;case"style":Object.assign(e.style,h);break;case"textContent":e.textContent=h;break;default:(!c||d!=="href"&&d!=="newWindow")&&e.setAttribute(d,h)}c&&o.addLinkAttributes(e,l.href,l.newWindow),n&&l.dataId&&this.setupStorage(e,l.dataId,t,n)}static render(e){var y,b;const t=e.annotationStorage,n=e.linkService,s=e.xfaHtml,o=e.intent||"display",l=document.createElement(s.name);s.attributes&&this.setAttributes({html:l,element:s,intent:o,linkService:n});const c=o!=="richText",d=e.div;if(d.append(l),e.viewport){const S=`matrix(${e.viewport.transform.join(",")})`;d.style.transform=S}c&&d.setAttribute("class","xfaLayer xfaFont");const h=[];if(s.children.length===0){if(s.value){const S=document.createTextNode(s.value);l.append(S),c&&Ph.shouldBuildText(s.name)&&h.push(S)}return{textDivs:h}}const p=[[s,-1,l]];for(;p.length>0;){const[S,E,R]=p.at(-1);if(E+1===S.children.length){p.pop();continue}const A=S.children[++p.at(-1)[1]];if(A===null)continue;const{name:C}=A;if(C==="#text"){const I=document.createTextNode(A.value);h.push(I),R.append(I);continue}const k=(y=A==null?void 0:A.attributes)!=null&&y.xmlns?document.createElementNS(A.attributes.xmlns,C):document.createElement(C);if(R.append(k),A.attributes&&this.setAttributes({html:k,element:A,storage:t,intent:o,linkService:n}),((b=A.children)==null?void 0:b.length)>0)p.push([A,-1,k]);else if(A.value){const I=document.createTextNode(A.value);c&&Ph.shouldBuildText(C)&&h.push(I),k.append(I)}}for(const S of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))S.setAttribute("readOnly",!0);return{textDivs:h}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const wp=1e3,LB=9,Bl=new WeakSet;function Qr(i){return{width:i[2]-i[0],height:i[3]-i[1]}}class PB{static create(e){switch(e.data.annotationType){case nn.LINK:return new CN(e);case nn.TEXT:return new OB(e);case nn.WIDGET:switch(e.data.fieldType){case"Tx":return new UB(e);case"Btn":return e.data.radioButton?new kN(e):e.data.checkBox?new HB(e):new BB(e);case"Ch":return new jB(e);case"Sig":return new FB(e)}return new $l(e);case nn.POPUP:return new T_(e);case nn.FREETEXT:return new PN(e);case nn.LINE:return new GB(e);case nn.SQUARE:return new VB(e);case nn.CIRCLE:return new zB(e);case nn.POLYLINE:return new ON(e);case nn.CARET:return new YB(e);case nn.INK:return new UN(e);case nn.POLYGON:return new $B(e);case nn.HIGHLIGHT:return new JB(e);case nn.UNDERLINE:return new KB(e);case nn.SQUIGGLY:return new WB(e);case nn.STRIKEOUT:return new XB(e);case nn.STAMP:return new FN(e);case nn.FILEATTACHMENT:return new QB(e);default:return new Vt(e)}}}var gl,ku,Iu,Cf,A_;const Mw=class Mw{constructor(e,{isRenderable:t=!1,ignoreBorder:n=!1,createQuadrilaterals:s=!1}={}){L(this,Cf);L(this,gl,null);L(this,ku,!1);L(this,Iu,null);this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(n)),s&&this._createQuadrilaterals()}static _hasPopupData({titleObj:e,contentsObj:t,richText:n}){return!!(e!=null&&e.str||t!=null&&t.str||n!=null&&n.str)}get hasPopupData(){return Mw._hasPopupData(this.data)}updateEdited(e){var n;if(!this.container)return;g(this,gl)||N(this,gl,{rect:this.data.rect.slice(0)});const{rect:t}=e;t&&D(this,Cf,A_).call(this,t),(n=g(this,Iu))==null||n.popup.updateEdited(e)}resetEdited(){var e;g(this,gl)&&(D(this,Cf,A_).call(this,g(this,gl).rect),(e=g(this,Iu))==null||e.popup.resetEdited(),N(this,gl,null))}_createContainer(e){const{data:t,parent:{page:n,viewport:s}}=this,o=document.createElement("section");o.setAttribute("data-annotation-id",t.id),this instanceof $l||(o.tabIndex=wp);const{style:l}=o;if(l.zIndex=this.parent.zIndex++,t.popupRef&&o.setAttribute("aria-haspopup","dialog"),t.alternativeText&&(o.title=t.alternativeText),t.noRotate&&o.classList.add("norotate"),!t.rect||this instanceof T_){const{rotation:R}=t;return!t.hasOwnCanvas&&R!==0&&this.setRotation(R,o),o}const{width:c,height:d}=Qr(t.rect);if(!e&&t.borderStyle.width>0){l.borderWidth=`${t.borderStyle.width}px`;const R=t.borderStyle.horizontalCornerRadius,A=t.borderStyle.verticalCornerRadius;if(R>0||A>0){const k=`calc(${R}px * var(--scale-factor)) / calc(${A}px * var(--scale-factor))`;l.borderRadius=k}else if(this instanceof kN){const k=`calc(${c}px * var(--scale-factor)) / calc(${d}px * var(--scale-factor))`;l.borderRadius=k}switch(t.borderStyle.style){case nh.SOLID:l.borderStyle="solid";break;case nh.DASHED:l.borderStyle="dashed";break;case nh.BEVELED:Je("Unimplemented border style: beveled");break;case nh.INSET:Je("Unimplemented border style: inset");break;case nh.UNDERLINE:l.borderBottomStyle="solid";break}const C=t.borderColor||null;C?(N(this,ku,!0),l.borderColor=Ee.makeHexColor(C[0]|0,C[1]|0,C[2]|0)):l.borderWidth=0}const h=Ee.normalizeRect([t.rect[0],n.view[3]-t.rect[1]+n.view[1],t.rect[2],n.view[3]-t.rect[3]+n.view[1]]),{pageWidth:p,pageHeight:y,pageX:b,pageY:S}=s.rawDims;l.left=`${100*(h[0]-b)/p}%`,l.top=`${100*(h[1]-S)/y}%`;const{rotation:E}=t;return t.hasOwnCanvas||E===0?(l.width=`${100*c/p}%`,l.height=`${100*d/y}%`):this.setRotation(E,o),o}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:n,pageHeight:s}=this.parent.viewport.rawDims,{width:o,height:l}=Qr(this.data.rect);let c,d;e%180===0?(c=100*o/n,d=100*l/s):(c=100*l/n,d=100*o/s),t.style.width=`${c}%`,t.style.height=`${d}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,n,s)=>{const o=s.detail[t],l=o[0],c=o.slice(1);s.target.style[n]=m1[`${l}_HTML`](c),this.annotationStorage.setValue(this.data.id,{[n]:m1[`${l}_rgb`](c)})};return st(this,"_commonActions",{display:t=>{const{display:n}=t.detail,s=n%2===1;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:s,noPrint:n===1||n===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:n}=t.detail;this.container.style.visibility=n?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:n,noView:n})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const n=t.detail.rotation;this.setRotation(n),this.annotationStorage.setValue(this.data.id,{rotation:n})}})}_dispatchEventFromSandbox(e,t){const n=this._commonActions;for(const s of Object.keys(t.detail)){const o=e[s]||n[s];o==null||o(t)}}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const n=this._commonActions;for(const[s,o]of Object.entries(t)){const l=n[s];if(l){const c={detail:{[s]:o},target:e};l(c),delete t[s]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,n,s,o]=this.data.rect.map(R=>Math.fround(R));if(e.length===8){const[R,A,C,k]=e.subarray(2,6);if(s===R&&o===A&&t===C&&n===k)return}const{style:l}=this.container;let c;if(g(this,ku)){const{borderColor:R,borderWidth:A}=l;l.borderWidth=0,c=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${R}" stroke-width="${A}">`],this.container.classList.add("hasBorder")}const d=s-t,h=o-n,{svgFactory:p}=this,y=p.createElement("svg");y.classList.add("quadrilateralsContainer"),y.setAttribute("width",0),y.setAttribute("height",0);const b=p.createElement("defs");y.append(b);const S=p.createElement("clipPath"),E=`clippath_${this.data.id}`;S.setAttribute("id",E),S.setAttribute("clipPathUnits","objectBoundingBox"),b.append(S);for(let R=2,A=e.length;R<A;R+=8){const C=e[R],k=e[R+1],I=e[R+2],O=e[R+3],U=p.createElement("rect"),P=(I-t)/d,B=(o-k)/h,Q=(C-I)/d,K=(k-O)/h;U.setAttribute("x",P),U.setAttribute("y",B),U.setAttribute("width",Q),U.setAttribute("height",K),S.append(U),c==null||c.push(`<rect vector-effect="non-scaling-stroke" x="${P}" y="${B}" width="${Q}" height="${K}"/>`)}g(this,ku)&&(c.push("</g></svg>')"),l.backgroundImage=c.join("")),this.container.append(y),this.container.style.clipPath=`url(#${E})`}_createPopup(){const{container:e,data:t}=this;e.setAttribute("aria-haspopup","dialog");const n=N(this,Iu,new T_({data:{color:t.color,titleObj:t.titleObj,modificationDate:t.modificationDate,contentsObj:t.contentsObj,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation},parent:this.parent,elements:[this]}));this.parent.div.append(n.render())}render(){xt("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const n=[];if(this._fieldObjects){const s=this._fieldObjects[e];if(s)for(const{page:o,id:l,exportValues:c}of s){if(o===-1||l===t)continue;const d=typeof c=="string"?c:null,h=document.querySelector(`[data-element-id="${l}"]`);if(h&&!Bl.has(h)){Je(`_getElementsByName - element not allowed: ${l}`);continue}n.push({id:l,exportValue:d,domElement:h})}return n}for(const s of document.getElementsByName(e)){const{exportValue:o}=s,l=s.getAttribute("data-element-id");l!==t&&Bl.has(s)&&n.push({id:l,exportValue:o,domElement:s})}return n}show(){var e;this.container&&(this.container.hidden=!1),(e=this.popup)==null||e.maybeShow()}hide(){var e;this.container&&(this.container.hidden=!0),(e=this.popup)==null||e.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}get _isEditable(){return!1}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{var n;(n=this.linkService.eventBus)==null||n.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t})})}};gl=new WeakMap,ku=new WeakMap,Iu=new WeakMap,Cf=new WeakSet,A_=function(e){const{container:{style:t},data:{rect:n,rotation:s},parent:{viewport:{rawDims:{pageWidth:o,pageHeight:l,pageX:c,pageY:d}}}}=this;n==null||n.splice(0,4,...e);const{width:h,height:p}=Qr(e);t.left=`${100*(e[0]-c)/o}%`,t.top=`${100*(l-e[3]+d)/l}%`,s===0?(t.width=`${100*h/o}%`,t.height=`${100*p/l}%`):this.setRotation(s)};let Vt=Mw;var Mi,Pa,RN,NN;class CN extends Vt{constructor(t,n=null){super(t,{isRenderable:!0,ignoreBorder:!!(n!=null&&n.ignoreBorder),createQuadrilaterals:!0});L(this,Mi);this.isTooltipOnly=t.data.isTooltipOnly}render(){const{data:t,linkService:n}=this,s=document.createElement("a");s.setAttribute("data-element-id",t.id);let o=!1;return t.url?(n.addLinkAttributes(s,t.url,t.newWindow),o=!0):t.action?(this._bindNamedAction(s,t.action),o=!0):t.attachment?(D(this,Mi,RN).call(this,s,t.attachment,t.attachmentDest),o=!0):t.setOCGState?(D(this,Mi,NN).call(this,s,t.setOCGState),o=!0):t.dest?(this._bindLink(s,t.dest),o=!0):(t.actions&&(t.actions.Action||t.actions["Mouse Up"]||t.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(s,t),o=!0),t.resetForm?(this._bindResetFormAction(s,t.resetForm),o=!0):this.isTooltipOnly&&!o&&(this._bindLink(s,""),o=!0)),this.container.classList.add("linkAnnotation"),o&&this.container.append(s),this.container}_bindLink(t,n){t.href=this.linkService.getDestinationHash(n),t.onclick=()=>(n&&this.linkService.goToDestination(n),!1),(n||n==="")&&D(this,Mi,Pa).call(this)}_bindNamedAction(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeNamedAction(n),!1),D(this,Mi,Pa).call(this)}_bindJSAction(t,n){t.href=this.linkService.getAnchorUrl("");const s=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const o of Object.keys(n.actions)){const l=s.get(o);l&&(t[l]=()=>{var c;return(c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:n.id,name:o}}),!1})}t.onclick||(t.onclick=()=>!1),D(this,Mi,Pa).call(this)}_bindResetFormAction(t,n){const s=t.onclick;if(s||(t.href=this.linkService.getAnchorUrl("")),D(this,Mi,Pa).call(this),!this._fieldObjects){Je('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),s||(t.onclick=()=>!1);return}t.onclick=()=>{var y;s==null||s();const{fields:o,refs:l,include:c}=n,d=[];if(o.length!==0||l.length!==0){const b=new Set(l);for(const S of o){const E=this._fieldObjects[S]||[];for(const{id:R}of E)b.add(R)}for(const S of Object.values(this._fieldObjects))for(const E of S)b.has(E.id)===c&&d.push(E)}else for(const b of Object.values(this._fieldObjects))d.push(...b);const h=this.annotationStorage,p=[];for(const b of d){const{id:S}=b;switch(p.push(S),b.type){case"text":{const R=b.defaultValue||"";h.setValue(S,{value:R});break}case"checkbox":case"radiobutton":{const R=b.defaultValue===b.exportValues;h.setValue(S,{value:R});break}case"combobox":case"listbox":{const R=b.defaultValue||"";h.setValue(S,{value:R});break}default:continue}const E=document.querySelector(`[data-element-id="${S}"]`);if(E){if(!Bl.has(E)){Je(`_bindResetFormAction - element not allowed: ${S}`);continue}}else continue;E.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((y=this.linkService.eventBus)==null||y.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:p,name:"ResetForm"}})),!1}}}Mi=new WeakSet,Pa=function(){this.container.setAttribute("data-internal-link","")},RN=function(t,n,s=null){t.href=this.linkService.getAnchorUrl(""),n.description&&(t.title=n.description),t.onclick=()=>{var o;return(o=this.downloadManager)==null||o.openOrDownloadData(n.content,n.filename,s),!1},D(this,Mi,Pa).call(this)},NN=function(t,n){t.href=this.linkService.getAnchorUrl(""),t.onclick=()=>(this.linkService.executeSetOCGState(n),!1),D(this,Mi,Pa).call(this)};class OB extends Vt{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class $l extends Vt{render(){return this.container}showElementAndHideCanvas(e){var t;this.data.hasOwnCanvas&&(((t=e.previousSibling)==null?void 0:t.nodeName)==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return ci.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,n,s,o){n.includes("mouse")?e.addEventListener(n,l=>{var c;(c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:o(l),shift:l.shiftKey,modifier:this._getKeyModifier(l)}})}):e.addEventListener(n,l=>{var c;if(n==="blur"){if(!t.focused||!l.relatedTarget)return;t.focused=!1}else if(n==="focus"){if(t.focused)return;t.focused=!0}o&&((c=this.linkService.eventBus)==null||c.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:s,value:o(l)}}))})}_setEventListeners(e,t,n,s){var o,l,c;for(const[d,h]of n)(h==="Action"||(o=this.data.actions)!=null&&o[h])&&((h==="Focus"||h==="Blur")&&(t||(t={focused:!1})),this._setEventListener(e,t,d,h,s),h==="Focus"&&!((l=this.data.actions)!=null&&l.Blur)?this._setEventListener(e,t,"blur","Blur",null):h==="Blur"&&!((c=this.data.actions)!=null&&c.Focus)&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":Ee.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:n}=this.data.defaultAppearanceData,s=this.data.defaultAppearanceData.fontSize||LB,o=e.style;let l;const c=2,d=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-c),p=Math.round(h/(cb*s))||1,y=h/p;l=Math.min(s,d(y/cb))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-c);l=Math.min(s,d(h/cb))}o.fontSize=`calc(${l}px * var(--scale-factor))`,o.color=Ee.makeHexColor(n[0],n[1],n[2]),this.data.textAlignment!==null&&(o.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class UB extends $l{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,n,s){const o=this.annotationStorage;for(const l of this._getElementsByName(e.name,e.id))l.domElement&&(l.domElement[t]=n),o.setValue(l.id,{[s]:n})}render(){var s,o;const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let n=null;if(this.renderForms){const l=e.getValue(t,{value:this.data.fieldValue});let c=l.value||"";const d=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;d&&c.length>d&&(c=c.slice(0,d));let h=l.formattedValue||((s=this.data.textContent)==null?void 0:s.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const p={userValue:c,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(n=document.createElement("textarea"),n.textContent=h??c,this.data.doNotScroll&&(n.style.overflowY="hidden")):(n=document.createElement("input"),n.type="text",n.setAttribute("value",h??c),this.data.doNotScroll&&(n.style.overflowX="hidden")),this.data.hasOwnCanvas&&(n.hidden=!0),Bl.add(n),n.setAttribute("data-element-id",t),n.disabled=this.data.readOnly,n.name=this.data.fieldName,n.tabIndex=wp,this._setRequired(n,this.data.required),d&&(n.maxLength=d),n.addEventListener("input",b=>{e.setValue(t,{value:b.target.value}),this.setPropertyOnSiblings(n,"value",b.target.value,"value"),p.formattedValue=null}),n.addEventListener("resetform",b=>{const S=this.data.defaultFieldValue??"";n.value=p.userValue=S,p.formattedValue=null});let y=b=>{const{formattedValue:S}=p;S!=null&&(b.target.value=S),b.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){n.addEventListener("focus",S=>{var R;if(p.focused)return;const{target:E}=S;p.userValue&&(E.value=p.userValue),p.lastCommittedValue=E.value,p.commitKey=1,(R=this.data.actions)!=null&&R.Focus||(p.focused=!0)}),n.addEventListener("updatefromsandbox",S=>{this.showElementAndHideCanvas(S.target);const E={value(R){p.userValue=R.detail.value??"",e.setValue(t,{value:p.userValue.toString()}),R.target.value=p.userValue},formattedValue(R){const{formattedValue:A}=R.detail;p.formattedValue=A,A!=null&&R.target!==document.activeElement&&(R.target.value=A),e.setValue(t,{formattedValue:A})},selRange(R){R.target.setSelectionRange(...R.detail.selRange)},charLimit:R=>{var I;const{charLimit:A}=R.detail,{target:C}=R;if(A===0){C.removeAttribute("maxLength");return}C.setAttribute("maxLength",A);let k=p.userValue;!k||k.length<=A||(k=k.slice(0,A),C.value=p.userValue=k,e.setValue(t,{value:k}),(I=this.linkService.eventBus)==null||I.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:k,willCommit:!0,commitKey:1,selStart:C.selectionStart,selEnd:C.selectionEnd}}))}};this._dispatchEventFromSandbox(E,S)}),n.addEventListener("keydown",S=>{var A;p.commitKey=1;let E=-1;if(S.key==="Escape"?E=0:S.key==="Enter"&&!this.data.multiLine?E=2:S.key==="Tab"&&(p.commitKey=3),E===-1)return;const{value:R}=S.target;p.lastCommittedValue!==R&&(p.lastCommittedValue=R,p.userValue=R,(A=this.linkService.eventBus)==null||A.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:R,willCommit:!0,commitKey:E,selStart:S.target.selectionStart,selEnd:S.target.selectionEnd}}))});const b=y;y=null,n.addEventListener("blur",S=>{var R,A;if(!p.focused||!S.relatedTarget)return;(R=this.data.actions)!=null&&R.Blur||(p.focused=!1);const{value:E}=S.target;p.userValue=E,p.lastCommittedValue!==E&&((A=this.linkService.eventBus)==null||A.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:p.commitKey,selStart:S.target.selectionStart,selEnd:S.target.selectionEnd}})),b(S)}),(o=this.data.actions)!=null&&o.Keystroke&&n.addEventListener("beforeinput",S=>{var U;p.lastCommittedValue=null;const{data:E,target:R}=S,{value:A,selectionStart:C,selectionEnd:k}=R;let I=C,O=k;switch(S.inputType){case"deleteWordBackward":{const P=A.substring(0,C).match(/\w*[^\w]*$/);P&&(I-=P[0].length);break}case"deleteWordForward":{const P=A.substring(C).match(/^[^\w]*\w*/);P&&(O+=P[0].length);break}case"deleteContentBackward":C===k&&(I-=1);break;case"deleteContentForward":C===k&&(O+=1);break}S.preventDefault(),(U=this.linkService.eventBus)==null||U.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:A,change:E||"",willCommit:!1,selStart:I,selEnd:O}})}),this._setEventListeners(n,p,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],S=>S.target.value)}if(y&&n.addEventListener("blur",y),this.data.comb){const S=(this.data.rect[2]-this.data.rect[0])/d;n.classList.add("comb"),n.style.letterSpacing=`calc(${S}px * var(--scale-factor) - 1ch)`}}else n=document.createElement("div"),n.textContent=this.data.fieldValue,n.style.verticalAlign="middle",n.style.display="table-cell",this.data.hasOwnCanvas&&(n.hidden=!0);return this._setTextStyle(n),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class FB extends $l{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class HB extends $l{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,n=t.id;let s=e.getValue(n,{value:t.exportValue===t.fieldValue}).value;typeof s=="string"&&(s=s!=="Off",e.setValue(n,{value:s})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const o=document.createElement("input");return Bl.add(o),o.setAttribute("data-element-id",n),o.disabled=t.readOnly,this._setRequired(o,this.data.required),o.type="checkbox",o.name=t.fieldName,s&&o.setAttribute("checked",!0),o.setAttribute("exportValue",t.exportValue),o.tabIndex=wp,o.addEventListener("change",l=>{const{name:c,checked:d}=l.target;for(const h of this._getElementsByName(c,n)){const p=d&&h.exportValue===t.exportValue;h.domElement&&(h.domElement.checked=p),e.setValue(h.id,{value:p})}e.setValue(n,{value:d})}),o.addEventListener("resetform",l=>{const c=t.defaultFieldValue||"Off";l.target.checked=c===t.exportValue}),this.enableScripting&&this.hasJSActions&&(o.addEventListener("updatefromsandbox",l=>{const c={value(d){d.target.checked=d.detail.value!=="Off",e.setValue(n,{value:d.target.checked})}};this._dispatchEventFromSandbox(c,l)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],l=>l.target.checked)),this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class kN extends $l{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,n=t.id;let s=e.getValue(n,{value:t.fieldValue===t.buttonValue}).value;if(typeof s=="string"&&(s=s!==t.buttonValue,e.setValue(n,{value:s})),s)for(const l of this._getElementsByName(t.fieldName,n))e.setValue(l.id,{value:!1});const o=document.createElement("input");if(Bl.add(o),o.setAttribute("data-element-id",n),o.disabled=t.readOnly,this._setRequired(o,this.data.required),o.type="radio",o.name=t.fieldName,s&&o.setAttribute("checked",!0),o.tabIndex=wp,o.addEventListener("change",l=>{const{name:c,checked:d}=l.target;for(const h of this._getElementsByName(c,n))e.setValue(h.id,{value:!1});e.setValue(n,{value:d})}),o.addEventListener("resetform",l=>{const c=t.defaultFieldValue;l.target.checked=c!=null&&c===t.buttonValue}),this.enableScripting&&this.hasJSActions){const l=t.buttonValue;o.addEventListener("updatefromsandbox",c=>{const d={value:h=>{const p=l===h.detail.value;for(const y of this._getElementsByName(h.target.name)){const b=p&&y.id===n;y.domElement&&(y.domElement.checked=b),e.setValue(y.id,{value:b})}}};this._dispatchEventFromSandbox(d,c)}),this._setEventListeners(o,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)}return this._setBackgroundColor(o),this._setDefaultPropertiesFromJS(o),this.container.append(o),this.container}}class BB extends CN{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",n=>{this._dispatchEventFromSandbox({},n)})),e}}class jB extends $l{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,n=e.getValue(t,{value:this.data.fieldValue}),s=document.createElement("select");Bl.add(s),s.setAttribute("data-element-id",t),s.disabled=this.data.readOnly,this._setRequired(s,this.data.required),s.name=this.data.fieldName,s.tabIndex=wp;let o=this.data.combo&&this.data.options.length>0;this.data.combo||(s.size=this.data.options.length,this.data.multiSelect&&(s.multiple=!0)),s.addEventListener("resetform",p=>{const y=this.data.defaultFieldValue;for(const b of s.options)b.selected=b.value===y});for(const p of this.data.options){const y=document.createElement("option");y.textContent=p.displayValue,y.value=p.exportValue,n.value.includes(p.exportValue)&&(y.setAttribute("selected",!0),o=!1),s.append(y)}let l=null;if(o){const p=document.createElement("option");p.value=" ",p.setAttribute("hidden",!0),p.setAttribute("selected",!0),s.prepend(p),l=()=>{p.remove(),s.removeEventListener("input",l),l=null},s.addEventListener("input",l)}const c=p=>{const y=p?"value":"textContent",{options:b,multiple:S}=s;return S?Array.prototype.filter.call(b,E=>E.selected).map(E=>E[y]):b.selectedIndex===-1?null:b[b.selectedIndex][y]};let d=c(!1);const h=p=>{const y=p.target.options;return Array.prototype.map.call(y,b=>({displayValue:b.textContent,exportValue:b.value}))};return this.enableScripting&&this.hasJSActions?(s.addEventListener("updatefromsandbox",p=>{const y={value(b){l==null||l();const S=b.detail.value,E=new Set(Array.isArray(S)?S:[S]);for(const R of s.options)R.selected=E.has(R.value);e.setValue(t,{value:c(!0)}),d=c(!1)},multipleSelection(b){s.multiple=!0},remove(b){const S=s.options,E=b.detail.remove;S[E].selected=!1,s.remove(E),S.length>0&&Array.prototype.findIndex.call(S,A=>A.selected)===-1&&(S[0].selected=!0),e.setValue(t,{value:c(!0),items:h(b)}),d=c(!1)},clear(b){for(;s.length!==0;)s.remove(0);e.setValue(t,{value:null,items:[]}),d=c(!1)},insert(b){const{index:S,displayValue:E,exportValue:R}=b.detail.insert,A=s.children[S],C=document.createElement("option");C.textContent=E,C.value=R,A?A.before(C):s.append(C),e.setValue(t,{value:c(!0),items:h(b)}),d=c(!1)},items(b){const{items:S}=b.detail;for(;s.length!==0;)s.remove(0);for(const E of S){const{displayValue:R,exportValue:A}=E,C=document.createElement("option");C.textContent=R,C.value=A,s.append(C)}s.options.length>0&&(s.options[0].selected=!0),e.setValue(t,{value:c(!0),items:h(b)}),d=c(!1)},indices(b){const S=new Set(b.detail.indices);for(const E of b.target.options)E.selected=S.has(E.index);e.setValue(t,{value:c(!0)}),d=c(!1)},editable(b){b.target.disabled=!b.detail.editable}};this._dispatchEventFromSandbox(y,p)}),s.addEventListener("input",p=>{var S;const y=c(!0),b=c(!1);e.setValue(t,{value:y}),p.preventDefault(),(S=this.linkService.eventBus)==null||S.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:d,change:b,changeEx:y,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(s,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],p=>p.target.value)):s.addEventListener("input",function(p){e.setValue(t,{value:c(!0)})}),this.data.combo&&this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class T_ extends Vt{constructor(e){const{data:t,elements:n}=e;super(e,{isRenderable:Vt._hasPopupData(t)}),this.elements=n,this.popup=null}render(){this.container.classList.add("popupAnnotation");const e=this.popup=new qB({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),t=[];for(const n of this.elements)n.popup=e,t.push(n.data.id),n.addHighlightArea();return this.container.setAttribute("aria-controls",t.map(n=>`${IR}${n}`).join(",")),this.container}}var Mu,a0,l0,Du,vl,Ut,Fr,yl,Rf,Nf,Lu,Hr,ps,Br,kf,jr,If,bl,_l,St,mg,C_,IN,MN,DN,LN,gg,vg,R_;class qB{constructor({container:e,color:t,elements:n,titleObj:s,modificationDate:o,contentsObj:l,richText:c,parent:d,rect:h,parentRect:p,open:y}){L(this,St);L(this,Mu,D(this,St,DN).bind(this));L(this,a0,D(this,St,R_).bind(this));L(this,l0,D(this,St,vg).bind(this));L(this,Du,D(this,St,gg).bind(this));L(this,vl,null);L(this,Ut,null);L(this,Fr,null);L(this,yl,null);L(this,Rf,null);L(this,Nf,null);L(this,Lu,null);L(this,Hr,!1);L(this,ps,null);L(this,Br,null);L(this,kf,null);L(this,jr,null);L(this,If,null);L(this,bl,null);L(this,_l,!1);var b;N(this,Ut,e),N(this,If,s),N(this,Fr,l),N(this,jr,c),N(this,Nf,d),N(this,vl,t),N(this,kf,h),N(this,Lu,p),N(this,Rf,n),N(this,yl,OR.toDateObject(o)),this.trigger=n.flatMap(S=>S.getElementsToTriggerPopup());for(const S of this.trigger)S.addEventListener("click",g(this,Du)),S.addEventListener("mouseenter",g(this,l0)),S.addEventListener("mouseleave",g(this,a0)),S.classList.add("popupTriggerArea");for(const S of n)(b=S.container)==null||b.addEventListener("keydown",g(this,Mu));g(this,Ut).hidden=!0,y&&D(this,St,gg).call(this)}render(){if(g(this,ps))return;const e=N(this,ps,document.createElement("div"));if(e.className="popup",g(this,vl)){const o=e.style.outlineColor=Ee.makeHexColor(...g(this,vl));CSS.supports("background-color","color-mix(in srgb, red 30%, white)")?e.style.backgroundColor=`color-mix(in srgb, ${o} 30%, white)`:e.style.backgroundColor=Ee.makeHexColor(...g(this,vl).map(c=>Math.floor(.7*(255-c)+c)))}const t=document.createElement("span");t.className="header";const n=document.createElement("h1");if(t.append(n),{dir:n.dir,str:n.textContent}=g(this,If),e.append(t),g(this,yl)){const o=document.createElement("span");o.classList.add("popupDate"),o.setAttribute("data-l10n-id","pdfjs-annotation-date-string"),o.setAttribute("data-l10n-args",JSON.stringify({date:g(this,yl).toLocaleDateString(),time:g(this,yl).toLocaleTimeString()})),t.append(o)}const s=g(this,St,mg);if(s)TN.render({xfaHtml:s,intent:"richText",div:e}),e.lastChild.classList.add("richText","popupContent");else{const o=this._formatContents(g(this,Fr));e.append(o)}g(this,Ut).append(e)}_formatContents({str:e,dir:t}){const n=document.createElement("p");n.classList.add("popupContent"),n.dir=t;const s=e.split(/(?:\r\n?|\n)/);for(let o=0,l=s.length;o<l;++o){const c=s[o];n.append(document.createTextNode(c)),o<l-1&&n.append(document.createElement("br"))}return n}updateEdited({rect:e,popupContent:t}){var n;g(this,bl)||N(this,bl,{contentsObj:g(this,Fr),richText:g(this,jr)}),e&&N(this,Br,null),t&&(N(this,jr,D(this,St,MN).call(this,t)),N(this,Fr,null)),(n=g(this,ps))==null||n.remove(),N(this,ps,null)}resetEdited(){var e;g(this,bl)&&({contentsObj:_i(this,Fr)._,richText:_i(this,jr)._}=g(this,bl),N(this,bl,null),(e=g(this,ps))==null||e.remove(),N(this,ps,null),N(this,Br,null))}forceHide(){N(this,_l,this.isVisible),g(this,_l)&&(g(this,Ut).hidden=!0)}maybeShow(){g(this,_l)&&(g(this,ps)||D(this,St,vg).call(this),N(this,_l,!1),g(this,Ut).hidden=!1)}get isVisible(){return g(this,Ut).hidden===!1}}Mu=new WeakMap,a0=new WeakMap,l0=new WeakMap,Du=new WeakMap,vl=new WeakMap,Ut=new WeakMap,Fr=new WeakMap,yl=new WeakMap,Rf=new WeakMap,Nf=new WeakMap,Lu=new WeakMap,Hr=new WeakMap,ps=new WeakMap,Br=new WeakMap,kf=new WeakMap,jr=new WeakMap,If=new WeakMap,bl=new WeakMap,_l=new WeakMap,St=new WeakSet,mg=function(){const e=g(this,jr),t=g(this,Fr);return e!=null&&e.str&&(!(t!=null&&t.str)||t.str===e.str)&&g(this,jr).html||null},C_=function(){var e,t,n;return((n=(t=(e=g(this,St,mg))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.fontSize)||0},IN=function(){var e,t,n;return((n=(t=(e=g(this,St,mg))==null?void 0:e.attributes)==null?void 0:t.style)==null?void 0:n.color)||null},MN=function(e){const t=[],n={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},s={style:{color:g(this,St,IN),fontSize:g(this,St,C_)?`calc(${g(this,St,C_)}px * var(--scale-factor))`:""}};for(const o of e.split(`
`))t.push({name:"span",value:o,attributes:s});return n},DN=function(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&g(this,Hr))&&D(this,St,gg).call(this)},LN=function(){if(g(this,Br)!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:n,pageX:s,pageY:o}}}=g(this,Nf);let l=!!g(this,Lu),c=l?g(this,Lu):g(this,kf);for(const E of g(this,Rf))if(!c||Ee.intersect(E.data.rect,c)!==null){c=E.data.rect,l=!0;break}const d=Ee.normalizeRect([c[0],e[3]-c[1]+e[1],c[2],e[3]-c[3]+e[1]]),p=l?c[2]-c[0]+5:0,y=d[0]+p,b=d[1];N(this,Br,[100*(y-s)/t,100*(b-o)/n]);const{style:S}=g(this,Ut);S.left=`${g(this,Br)[0]}%`,S.top=`${g(this,Br)[1]}%`},gg=function(){N(this,Hr,!g(this,Hr)),g(this,Hr)?(D(this,St,vg).call(this),g(this,Ut).addEventListener("click",g(this,Du)),g(this,Ut).addEventListener("keydown",g(this,Mu))):(D(this,St,R_).call(this),g(this,Ut).removeEventListener("click",g(this,Du)),g(this,Ut).removeEventListener("keydown",g(this,Mu)))},vg=function(){g(this,ps)||this.render(),this.isVisible?g(this,Hr)&&g(this,Ut).classList.add("focused"):(D(this,St,LN).call(this),g(this,Ut).hidden=!1,g(this,Ut).style.zIndex=parseInt(g(this,Ut).style.zIndex)+1e3)},R_=function(){g(this,Ut).classList.remove("focused"),!(g(this,Hr)||!this.isVisible)&&(g(this,Ut).hidden=!0,g(this,Ut).style.zIndex=parseInt(g(this,Ut).style.zIndex)-1e3)};class PN extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=it.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const n=document.createElement("span");n.textContent=t,e.append(n)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}get _isEditable(){return this.data.hasOwnCanvas}}var Mf;class GB extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,Mf,null)}render(){this.container.classList.add("lineAnnotation");const t=this.data,{width:n,height:s}=Qr(t.rect),o=this.svgFactory.create(n,s,!0),l=N(this,Mf,this.svgFactory.createElement("svg:line"));return l.setAttribute("x1",t.rect[2]-t.lineCoordinates[0]),l.setAttribute("y1",t.rect[3]-t.lineCoordinates[1]),l.setAttribute("x2",t.rect[2]-t.lineCoordinates[2]),l.setAttribute("y2",t.rect[3]-t.lineCoordinates[3]),l.setAttribute("stroke-width",t.borderStyle.width||1),l.setAttribute("stroke","transparent"),l.setAttribute("fill","transparent"),o.append(l),this.container.append(o),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return g(this,Mf)}addHighlightArea(){this.container.classList.add("highlightArea")}}Mf=new WeakMap;var Df;class VB extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,Df,null)}render(){this.container.classList.add("squareAnnotation");const t=this.data,{width:n,height:s}=Qr(t.rect),o=this.svgFactory.create(n,s,!0),l=t.borderStyle.width,c=N(this,Df,this.svgFactory.createElement("svg:rect"));return c.setAttribute("x",l/2),c.setAttribute("y",l/2),c.setAttribute("width",n-l),c.setAttribute("height",s-l),c.setAttribute("stroke-width",l||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),o.append(c),this.container.append(o),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return g(this,Df)}addHighlightArea(){this.container.classList.add("highlightArea")}}Df=new WeakMap;var Lf;class zB extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,Lf,null)}render(){this.container.classList.add("circleAnnotation");const t=this.data,{width:n,height:s}=Qr(t.rect),o=this.svgFactory.create(n,s,!0),l=t.borderStyle.width,c=N(this,Lf,this.svgFactory.createElement("svg:ellipse"));return c.setAttribute("cx",n/2),c.setAttribute("cy",s/2),c.setAttribute("rx",n/2-l/2),c.setAttribute("ry",s/2-l/2),c.setAttribute("stroke-width",l||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),o.append(c),this.container.append(o),!t.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return g(this,Lf)}addHighlightArea(){this.container.classList.add("highlightArea")}}Lf=new WeakMap;var Pf;class ON extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,Pf,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,vertices:n,borderStyle:s,popupRef:o}}=this;if(!n)return this.container;const{width:l,height:c}=Qr(t),d=this.svgFactory.create(l,c,!0);let h=[];for(let y=0,b=n.length;y<b;y+=2){const S=n[y]-t[0],E=t[3]-n[y+1];h.push(`${S},${E}`)}h=h.join(" ");const p=N(this,Pf,this.svgFactory.createElement(this.svgElementName));return p.setAttribute("points",h),p.setAttribute("stroke-width",s.width||1),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),d.append(p),this.container.append(d),!o&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return g(this,Pf)}addHighlightArea(){this.container.classList.add("highlightArea")}}Pf=new WeakMap;class $B extends ON{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class YB extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Of;class UN extends Vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0});L(this,Of,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=it.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:t,inkLists:n,borderStyle:s,popupRef:o}}=this,{width:l,height:c}=Qr(t),d=this.svgFactory.create(l,c,!0);for(const h of n){let p=[];for(let b=0,S=h.length;b<S;b+=2){const E=h[b]-t[0],R=t[3]-h[b+1];p.push(`${E},${R}`)}p=p.join(" ");const y=this.svgFactory.createElement(this.svgElementName);g(this,Of).push(y),y.setAttribute("points",p),y.setAttribute("stroke-width",s.width||1),y.setAttribute("stroke","transparent"),y.setAttribute("fill","transparent"),!o&&this.hasPopupData&&this._createPopup(),d.append(y)}return this.container.append(d),this.container}getElementsToTriggerPopup(){return g(this,Of)}addHighlightArea(){this.container.classList.add("highlightArea")}}Of=new WeakMap;class JB extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this.container}}class KB extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),this.container}}class WB extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),this.container}}class XB extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),this.container}}class FN extends Vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("stampAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Uf,Ff,N_;class QB extends Vt{constructor(t){var s;super(t,{isRenderable:!0});L(this,Ff);L(this,Uf,null);const{file:n}=this.data;this.filename=n.filename,this.content=n.content,(s=this.linkService.eventBus)==null||s.dispatch("fileattachmentannotation",{source:this,...n})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:t,data:n}=this;let s;n.hasAppearance||n.fillAlpha===0?s=document.createElement("div"):(s=document.createElement("img"),s.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(n.name)?"paperclip":"pushpin"}.svg`,n.fillAlpha&&n.fillAlpha<1&&(s.style=`filter: opacity(${Math.round(n.fillAlpha*100)}%);`)),s.addEventListener("dblclick",D(this,Ff,N_).bind(this)),N(this,Uf,s);const{isMac:o}=ci.platform;return t.addEventListener("keydown",l=>{l.key==="Enter"&&(o?l.metaKey:l.ctrlKey)&&D(this,Ff,N_).call(this)}),!n.popupRef&&this.hasPopupData?this._createPopup():s.classList.add("popupTriggerArea"),t.append(s),t}getElementsToTriggerPopup(){return g(this,Uf)}addHighlightArea(){this.container.classList.add("highlightArea")}}Uf=new WeakMap,Ff=new WeakSet,N_=function(){var t;(t=this.downloadManager)==null||t.openOrDownloadData(this.content,this.filename)};var Hf,wl,Pu,jl,HN,k_;class ZB{constructor({div:e,accessibilityManager:t,annotationCanvasMap:n,annotationEditorUIManager:s,page:o,viewport:l}){L(this,jl);L(this,Hf,null);L(this,wl,null);L(this,Pu,new Map);this.div=e,N(this,Hf,t),N(this,wl,n),this.page=o,this.viewport=l,this.zIndex=0,this._annotationEditorUIManager=s}async render(e){var l;const{annotations:t}=e,n=this.div;Fl(n,this.viewport);const s=new Map,o={data:null,layer:n,linkService:e.linkService,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new ww,annotationStorage:e.annotationStorage||new Tw,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const c of t){if(c.noHTML)continue;const d=c.annotationType===nn.POPUP;if(d){const y=s.get(c.id);if(!y)continue;o.elements=y}else{const{width:y,height:b}=Qr(c.rect);if(y<=0||b<=0)continue}o.data=c;const h=PB.create(o);if(!h.isRenderable)continue;if(!d&&c.popupRef){const y=s.get(c.popupRef);y?y.push(h):s.set(c.popupRef,[h])}const p=h.render();c.hidden&&(p.style.visibility="hidden"),D(this,jl,HN).call(this,p,c.id),h.annotationEditorType>0&&(g(this,Pu).set(h.data.id,h),(l=this._annotationEditorUIManager)==null||l.renderAnnotationElement(h))}D(this,jl,k_).call(this)}update({viewport:e}){const t=this.div;this.viewport=e,Fl(t,{rotation:e.rotation}),D(this,jl,k_).call(this),t.hidden=!1}getEditableAnnotations(){return Array.from(g(this,Pu).values())}getEditableAnnotation(e){return g(this,Pu).get(e)}}Hf=new WeakMap,wl=new WeakMap,Pu=new WeakMap,jl=new WeakSet,HN=function(e,t){var s;const n=e.firstChild||e;n.id=`${IR}${t}`,this.div.append(e),(s=g(this,Hf))==null||s.moveElementInDOM(this.div,e,n,!1)},k_=function(){if(!g(this,wl))return;const e=this.div;for(const[t,n]of g(this,wl)){const s=e.querySelector(`[data-annotation-id="${t}"]`);if(!s)continue;n.className="annotationContent";const{firstChild:o}=s;o?o.nodeName==="CANVAS"?o.replaceWith(n):o.classList.contains("annotationContent")?o.after(n):o.before(n):s.append(n)}g(this,wl).clear()};const tg=/\r\n?|\n/g;var Bf,jf,qf,Gf,Vf,ms,Ci,zf,Ri,Ou,Zt,BN,jN,qN,yg,eo,bg,_g,GN,M_,VN;const Rt=class Rt extends vt{constructor(t){super({...t,name:"freeTextEditor"});L(this,Zt);L(this,Bf,this.editorDivBlur.bind(this));L(this,jf,this.editorDivFocus.bind(this));L(this,qf,this.editorDivInput.bind(this));L(this,Gf,this.editorDivKeydown.bind(this));L(this,Vf,this.editorDivPaste.bind(this));L(this,ms);L(this,Ci,"");L(this,zf,`${this.id}-editor`);L(this,Ri);L(this,Ou,null);N(this,ms,t.color||Rt._defaultColor||vt._defaultLineColor),N(this,Ri,t.fontSize||Rt._defaultFontSize)}static get _keyboardManager(){const t=Rt.prototype,n=l=>l.isEmpty(),s=Hl.TRANSLATE_SMALL,o=Hl.TRANSLATE_BIG;return st(this,"_keyboardManager",new bp([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],t.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],t.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],t._translateEmpty,{args:[-s,0],checker:n}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t._translateEmpty,{args:[-o,0],checker:n}],[["ArrowRight","mac+ArrowRight"],t._translateEmpty,{args:[s,0],checker:n}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t._translateEmpty,{args:[o,0],checker:n}],[["ArrowUp","mac+ArrowUp"],t._translateEmpty,{args:[0,-s],checker:n}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t._translateEmpty,{args:[0,-o],checker:n}],[["ArrowDown","mac+ArrowDown"],t._translateEmpty,{args:[0,s],checker:n}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t._translateEmpty,{args:[0,o],checker:n}]]))}static initialize(t,n){vt.initialize(t,n,{strings:["pdfjs-free-text-default-content"]});const s=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(s.getPropertyValue("--freetext-padding"))}static updateDefaultParams(t,n){switch(t){case Fe.FREETEXT_SIZE:Rt._defaultFontSize=n;break;case Fe.FREETEXT_COLOR:Rt._defaultColor=n;break}}updateParams(t,n){switch(t){case Fe.FREETEXT_SIZE:D(this,Zt,BN).call(this,n);break;case Fe.FREETEXT_COLOR:D(this,Zt,jN).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Fe.FREETEXT_SIZE,Rt._defaultFontSize],[Fe.FREETEXT_COLOR,Rt._defaultColor||vt._defaultLineColor]]}get propertiesToUpdate(){return[[Fe.FREETEXT_SIZE,g(this,Ri)],[Fe.FREETEXT_COLOR,g(this,ms)]]}_translateEmpty(t,n){this._uiManager.translateSelectedEditors(t,n,!0)}getInitialTranslation(){const t=this.parentScale;return[-Rt._internalPadding*t,-(Rt._internalPadding+g(this,Ri))*t]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(this.isInEditMode())return;this.parent.setEditingState(!1),this.parent.updateToolbar(it.FREETEXT),super.enableEditMode(),this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant");const t=this._uiManager._signal;this.editorDiv.addEventListener("keydown",g(this,Gf),{signal:t}),this.editorDiv.addEventListener("focus",g(this,jf),{signal:t}),this.editorDiv.addEventListener("blur",g(this,Bf),{signal:t}),this.editorDiv.addEventListener("input",g(this,qf),{signal:t}),this.editorDiv.addEventListener("paste",g(this,Vf),{signal:t})}disableEditMode(){this.isInEditMode()&&(this.parent.setEditingState(!0),super.disableEditMode(),this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",g(this,zf)),this._isDraggable=!0,this.editorDiv.removeEventListener("keydown",g(this,Gf)),this.editorDiv.removeEventListener("focus",g(this,jf)),this.editorDiv.removeEventListener("blur",g(this,Bf)),this.editorDiv.removeEventListener("input",g(this,qf)),this.editorDiv.removeEventListener("paste",g(this,Vf)),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),t.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(){var t;this.width||(this.enableEditMode(),this.editorDiv.focus(),(t=this._initialOptions)!=null&&t.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const t=g(this,Ci),n=N(this,Ci,D(this,Zt,qN).call(this).trimEnd());if(t===n)return;const s=o=>{if(N(this,Ci,o),!o){this.remove();return}D(this,Zt,_g).call(this),this._uiManager.rebuild(this),D(this,Zt,yg).call(this)};this.addCommands({cmd:()=>{s(n)},undo:()=>{s(t)},mustExec:!1}),D(this,Zt,yg).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}dblclick(t){this.enterInEditMode()}keydown(t){t.target===this.div&&t.key==="Enter"&&(this.enterInEditMode(),t.preventDefault())}editorDivKeydown(t){Rt._keyboardManager.exec(this,t)}editorDivFocus(t){this.isEditing=!0}editorDivBlur(t){this.isEditing=!1}editorDivInput(t){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}render(){if(this.div)return this.div;let t,n;this.width&&(t=this.x,n=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",g(this,zf)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text"),this.enableEditing(),vt._l10nPromise.get("pdfjs-free-text-default-content").then(o=>{var l;return(l=this.editorDiv)==null?void 0:l.setAttribute("default-content",o)}),this.editorDiv.contentEditable=!0;const{style:s}=this.editorDiv;if(s.fontSize=`calc(${g(this,Ri)}px * var(--scale-factor))`,s.color=g(this,ms),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),jg(this,this.div,["dblclick","keydown"]),this.width){const[o,l]=this.parentDimensions;if(this.annotationElementId){const{position:c}=g(this,Ou);let[d,h]=this.getInitialTranslation();[d,h]=this.pageTranslationToScreen(d,h);const[p,y]=this.pageDimensions,[b,S]=this.pageTranslation;let E,R;switch(this.rotation){case 0:E=t+(c[0]-b)/p,R=n+this.height-(c[1]-S)/y;break;case 90:E=t+(c[0]-b)/p,R=n-(c[1]-S)/y,[d,h]=[h,-d];break;case 180:E=t-this.width+(c[0]-b)/p,R=n-(c[1]-S)/y,[d,h]=[-d,-h];break;case 270:E=t+(c[0]-b-this.height*y)/p,R=n+(c[1]-S-this.width*p)/y,[d,h]=[-h,d];break}this.setAt(E*o,R*l,d,h)}else this.setAt(t*o,n*l,this.width*o,this.height*l);D(this,Zt,_g).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(t){var E,R,A;const n=t.clipboardData||window.clipboardData,{types:s}=n;if(s.length===1&&s[0]==="text/plain")return;t.preventDefault();const o=D(E=Rt,eo,M_).call(E,n.getData("text")||"").replaceAll(tg,`
`);if(!o)return;const l=window.getSelection();if(!l.rangeCount)return;this.editorDiv.normalize(),l.deleteFromDocument();const c=l.getRangeAt(0);if(!o.includes(`
`)){c.insertNode(document.createTextNode(o)),this.editorDiv.normalize(),l.collapseToStart();return}const{startContainer:d,startOffset:h}=c,p=[],y=[];if(d.nodeType===Node.TEXT_NODE){const C=d.parentElement;if(y.push(d.nodeValue.slice(h).replaceAll(tg,"")),C!==this.editorDiv){let k=p;for(const I of this.editorDiv.childNodes){if(I===C){k=y;continue}k.push(D(R=Rt,eo,bg).call(R,I))}}p.push(d.nodeValue.slice(0,h).replaceAll(tg,""))}else if(d===this.editorDiv){let C=p,k=0;for(const I of this.editorDiv.childNodes)k++===h&&(C=y),C.push(D(A=Rt,eo,bg).call(A,I))}N(this,Ci,`${p.join(`
`)}${o}${y.join(`
`)}`),D(this,Zt,_g).call(this);const b=new Range;let S=p.reduce((C,k)=>C+k.length,0);for(const{firstChild:C}of this.editorDiv.childNodes)if(C.nodeType===Node.TEXT_NODE){const k=C.nodeValue.length;if(S<=k){b.setStart(C,S),b.setEnd(C,S);break}S-=k}l.removeAllRanges(),l.addRange(b)}get contentDiv(){return this.editorDiv}static deserialize(t,n,s){var c;let o=null;if(t instanceof PN){const{data:{defaultAppearanceData:{fontSize:d,fontColor:h},rect:p,rotation:y,id:b},textContent:S,textPosition:E,parent:{page:{pageNumber:R}}}=t;if(!S||S.length===0)return null;o=t={annotationType:it.FREETEXT,color:Array.from(h),fontSize:d,value:S.join(`
`),position:E,pageIndex:R-1,rect:p.slice(0),rotation:y,id:b,deleted:!1}}const l=super.deserialize(t,n,s);return N(l,Ri,t.fontSize),N(l,ms,Ee.makeHexColor(...t.color)),N(l,Ci,D(c=Rt,eo,M_).call(c,t.value)),l.annotationElementId=t.id||null,N(l,Ou,o),l}serialize(t=!1){if(this.isEmpty())return null;if(this.deleted)return{pageIndex:this.pageIndex,id:this.annotationElementId,deleted:!0};const n=Rt._internalPadding*this.parentScale,s=this.getRect(n,n),o=vt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:g(this,ms)),l={annotationType:it.FREETEXT,color:o,fontSize:g(this,Ri),value:D(this,Zt,GN).call(this),pageIndex:this.pageIndex,rect:s,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return t?l:this.annotationElementId&&!D(this,Zt,VN).call(this,l)?null:(l.id=this.annotationElementId,l)}renderAnnotationElement(t){const n=super.renderAnnotationElement(t);if(this.deleted)return n;const{style:s}=n;s.fontSize=`calc(${g(this,Ri)}px * var(--scale-factor))`,s.color=g(this,ms),n.replaceChildren();for(const l of g(this,Ci).split(`
`)){const c=document.createElement("div");c.append(l?document.createTextNode(l):document.createElement("br")),n.append(c)}const o=Rt._internalPadding*this.parentScale;return t.updateEdited({rect:this.getRect(o,o),popupContent:g(this,Ci)}),n}resetAnnotationElement(t){super.resetAnnotationElement(t),t.resetEdited()}};Bf=new WeakMap,jf=new WeakMap,qf=new WeakMap,Gf=new WeakMap,Vf=new WeakMap,ms=new WeakMap,Ci=new WeakMap,zf=new WeakMap,Ri=new WeakMap,Ou=new WeakMap,Zt=new WeakSet,BN=function(t){const n=o=>{this.editorDiv.style.fontSize=`calc(${o}px * var(--scale-factor))`,this.translate(0,-(o-g(this,Ri))*this.parentScale),N(this,Ri,o),D(this,Zt,yg).call(this)},s=g(this,Ri);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},jN=function(t){const n=o=>{N(this,ms,this.editorDiv.style.color=o)},s=g(this,ms);this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},qN=function(){var n;const t=[];this.editorDiv.normalize();for(const s of this.editorDiv.childNodes)t.push(D(n=Rt,eo,bg).call(n,s));return t.join(`
`)},yg=function(){const[t,n]=this.parentDimensions;let s;if(this.isAttachedToDOM)s=this.div.getBoundingClientRect();else{const{currentLayer:o,div:l}=this,c=l.style.display,d=l.classList.contains("hidden");l.classList.remove("hidden"),l.style.display="hidden",o.div.append(this.div),s=l.getBoundingClientRect(),l.remove(),l.style.display=c,l.classList.toggle("hidden",d)}this.rotation%180===this.parentRotation%180?(this.width=s.width/t,this.height=s.height/n):(this.width=s.height/t,this.height=s.width/n),this.fixAndSetPosition()},eo=new WeakSet,bg=function(t){return(t.nodeType===Node.TEXT_NODE?t.nodeValue:t.innerText).replaceAll(tg,"")},_g=function(){if(this.editorDiv.replaceChildren(),!!g(this,Ci))for(const t of g(this,Ci).split(`
`)){const n=document.createElement("div");n.append(t?document.createTextNode(t):document.createElement("br")),this.editorDiv.append(n)}},GN=function(){return g(this,Ci).replaceAll(""," ")},M_=function(t){return t.replaceAll(" ","")},VN=function(t){const{value:n,fontSize:s,color:o,pageIndex:l}=g(this,Ou);return this._hasBeenMoved||t.value!==n||t.fontSize!==s||t.color.some((c,d)=>c!==o[d])||t.pageIndex!==l},L(Rt,eo),qe(Rt,"_freeTextDefaultContent",""),qe(Rt,"_internalPadding",0),qe(Rt,"_defaultColor",null),qe(Rt,"_defaultFontSize",10),qe(Rt,"_type","freetext"),qe(Rt,"_editorType",it.FREETEXT);let I_=Rt;var $f,Xo,gs,Wn,zN,wg,$N,YN,L_;class D_{constructor(e,t=0,n=0,s=!0){L(this,Wn);L(this,$f);L(this,Xo,[]);L(this,gs,[]);let o=1/0,l=-1/0,c=1/0,d=-1/0;const h=10**-4;for(const{x:A,y:C,width:k,height:I}of e){const O=Math.floor((A-t)/h)*h,U=Math.ceil((A+k+t)/h)*h,P=Math.floor((C-t)/h)*h,B=Math.ceil((C+I+t)/h)*h,Q=[O,P,B,!0],K=[U,P,B,!1];g(this,Xo).push(Q,K),o=Math.min(o,O),l=Math.max(l,U),c=Math.min(c,P),d=Math.max(d,B)}const p=l-o+2*n,y=d-c+2*n,b=o-n,S=c-n,E=g(this,Xo).at(s?-1:-2),R=[E[0],E[2]];for(const A of g(this,Xo)){const[C,k,I]=A;A[0]=(C-b)/p,A[1]=(k-S)/y,A[2]=(I-S)/y}N(this,$f,{x:b,y:S,width:p,height:y,lastPoint:R})}getOutlines(){g(this,Xo).sort((t,n)=>t[0]-n[0]||t[1]-n[1]||t[2]-n[2]);const e=[];for(const t of g(this,Xo))t[3]?(e.push(...D(this,Wn,L_).call(this,t)),D(this,Wn,$N).call(this,t)):(D(this,Wn,YN).call(this,t),e.push(...D(this,Wn,L_).call(this,t)));return D(this,Wn,zN).call(this,e)}}$f=new WeakMap,Xo=new WeakMap,gs=new WeakMap,Wn=new WeakSet,zN=function(e){const t=[],n=new Set;for(const l of e){const[c,d,h]=l;t.push([c,d,l],[c,h,l])}t.sort((l,c)=>l[1]-c[1]||l[0]-c[0]);for(let l=0,c=t.length;l<c;l+=2){const d=t[l][2],h=t[l+1][2];d.push(h),h.push(d),n.add(d),n.add(h)}const s=[];let o;for(;n.size>0;){const l=n.values().next().value;let[c,d,h,p,y]=l;n.delete(l);let b=c,S=d;for(o=[c,h],s.push(o);;){let E;if(n.has(p))E=p;else if(n.has(y))E=y;else break;n.delete(E),[c,d,h,p,y]=E,b!==c&&(o.push(b,S,c,S===d?d:h),b=c),S=S===d?h:d}o.push(b,S)}return new ej(s,g(this,$f))},wg=function(e){const t=g(this,gs);let n=0,s=t.length-1;for(;n<=s;){const o=n+s>>1,l=t[o][0];if(l===e)return o;l<e?n=o+1:s=o-1}return s+1},$N=function([,e,t]){const n=D(this,Wn,wg).call(this,e);g(this,gs).splice(n,0,[e,t])},YN=function([,e,t]){const n=D(this,Wn,wg).call(this,e);for(let s=n;s<g(this,gs).length;s++){const[o,l]=g(this,gs)[s];if(o!==e)break;if(o===e&&l===t){g(this,gs).splice(s,1);return}}for(let s=n-1;s>=0;s--){const[o,l]=g(this,gs)[s];if(o!==e)break;if(o===e&&l===t){g(this,gs).splice(s,1);return}}},L_=function(e){const[t,n,s]=e,o=[[t,n,s]],l=D(this,Wn,wg).call(this,s);for(let c=0;c<l;c++){const[d,h]=g(this,gs)[c];for(let p=0,y=o.length;p<y;p++){const[,b,S]=o[p];if(!(h<=b||S<=d)){if(b>=d){if(S>h)o[p][1]=h;else{if(y===1)return[];o.splice(p,1),p--,y--}continue}o[p][2]=d,S>h&&o.push([t,h,S])}}}return o};class JN{toSVGPath(){throw new Error("Abstract method `toSVGPath` must be implemented.")}get box(){throw new Error("Abstract getter `box` must be implemented.")}serialize(e,t){throw new Error("Abstract method `serialize` must be implemented.")}get free(){return this instanceof O_}}var Yf,Uu;class ej extends JN{constructor(t,n){super();L(this,Yf);L(this,Uu);N(this,Uu,t),N(this,Yf,n)}toSVGPath(){const t=[];for(const n of g(this,Uu)){let[s,o]=n;t.push(`M${s} ${o}`);for(let l=2;l<n.length;l+=2){const c=n[l],d=n[l+1];c===s?(t.push(`V${d}`),o=d):d===o&&(t.push(`H${c}`),s=c)}t.push("Z")}return t.join(" ")}serialize([t,n,s,o],l){const c=[],d=s-t,h=o-n;for(const p of g(this,Uu)){const y=new Array(p.length);for(let b=0;b<p.length;b+=2)y[b]=t+p[b]*d,y[b+1]=o-p[b+1]*h;c.push(y)}return c}get box(){return g(this,Yf)}}Yf=new WeakMap,Uu=new WeakMap;var js,qr,Fu,Hu,qs,nt,xl,Sl,Jf,Kf,Bu,ju,Qo,Wf,c0,u0,Xf,P_;const Er=class Er{constructor({x:e,y:t},n,s,o,l,c=0){L(this,Xf);L(this,js);L(this,qr,[]);L(this,Fu);L(this,Hu);L(this,qs,[]);L(this,nt,new Float64Array(18));L(this,xl);L(this,Sl);L(this,Jf);L(this,Kf);L(this,Bu);L(this,ju);L(this,Qo,[]);N(this,js,n),N(this,ju,o*s),N(this,Hu,l),g(this,nt).set([NaN,NaN,NaN,NaN,e,t],6),N(this,Fu,c),N(this,Kf,g(Er,Wf)*s),N(this,Jf,g(Er,u0)*s),N(this,Bu,s),g(this,Qo).push(e,t)}get free(){return!0}isEmpty(){return isNaN(g(this,nt)[8])}add({x:e,y:t}){var K;N(this,xl,e),N(this,Sl,t);const[n,s,o,l]=g(this,js);let[c,d,h,p]=g(this,nt).subarray(8,12);const y=e-h,b=t-p,S=Math.hypot(y,b);if(S<g(this,Jf))return!1;const E=S-g(this,Kf),R=E/S,A=R*y,C=R*b;let k=c,I=d;c=h,d=p,h+=A,p+=C,(K=g(this,Qo))==null||K.push(e,t);const O=-C/E,U=A/E,P=O*g(this,ju),B=U*g(this,ju);return g(this,nt).set(g(this,nt).subarray(2,8),0),g(this,nt).set([h+P,p+B],4),g(this,nt).set(g(this,nt).subarray(14,18),12),g(this,nt).set([h-P,p-B],16),isNaN(g(this,nt)[6])?(g(this,qs).length===0&&(g(this,nt).set([c+P,d+B],2),g(this,qs).push(NaN,NaN,NaN,NaN,(c+P-n)/o,(d+B-s)/l),g(this,nt).set([c-P,d-B],14),g(this,qr).push(NaN,NaN,NaN,NaN,(c-P-n)/o,(d-B-s)/l)),g(this,nt).set([k,I,c,d,h,p],6),!this.isEmpty()):(g(this,nt).set([k,I,c,d,h,p],6),Math.abs(Math.atan2(I-d,k-c)-Math.atan2(C,A))<Math.PI/2?([c,d,h,p]=g(this,nt).subarray(2,6),g(this,qs).push(NaN,NaN,NaN,NaN,((c+h)/2-n)/o,((d+p)/2-s)/l),[c,d,k,I]=g(this,nt).subarray(14,18),g(this,qr).push(NaN,NaN,NaN,NaN,((k+c)/2-n)/o,((I+d)/2-s)/l),!0):([k,I,c,d,h,p]=g(this,nt).subarray(0,6),g(this,qs).push(((k+5*c)/6-n)/o,((I+5*d)/6-s)/l,((5*c+h)/6-n)/o,((5*d+p)/6-s)/l,((c+h)/2-n)/o,((d+p)/2-s)/l),[h,p,c,d,k,I]=g(this,nt).subarray(12,18),g(this,qr).push(((k+5*c)/6-n)/o,((I+5*d)/6-s)/l,((5*c+h)/6-n)/o,((5*d+p)/6-s)/l,((c+h)/2-n)/o,((d+p)/2-s)/l),!0))}toSVGPath(){if(this.isEmpty())return"";const e=g(this,qs),t=g(this,qr),n=g(this,nt).subarray(4,6),s=g(this,nt).subarray(16,18),[o,l,c,d]=g(this,js),[h,p,y,b]=D(this,Xf,P_).call(this);if(isNaN(g(this,nt)[6])&&!this.isEmpty())return`M${(g(this,nt)[2]-o)/c} ${(g(this,nt)[3]-l)/d} L${(g(this,nt)[4]-o)/c} ${(g(this,nt)[5]-l)/d} L${h} ${p} L${y} ${b} L${(g(this,nt)[16]-o)/c} ${(g(this,nt)[17]-l)/d} L${(g(this,nt)[14]-o)/c} ${(g(this,nt)[15]-l)/d} Z`;const S=[];S.push(`M${e[4]} ${e[5]}`);for(let E=6;E<e.length;E+=6)isNaN(e[E])?S.push(`L${e[E+4]} ${e[E+5]}`):S.push(`C${e[E]} ${e[E+1]} ${e[E+2]} ${e[E+3]} ${e[E+4]} ${e[E+5]}`);S.push(`L${(n[0]-o)/c} ${(n[1]-l)/d} L${h} ${p} L${y} ${b} L${(s[0]-o)/c} ${(s[1]-l)/d}`);for(let E=t.length-6;E>=6;E-=6)isNaN(t[E])?S.push(`L${t[E+4]} ${t[E+5]}`):S.push(`C${t[E]} ${t[E+1]} ${t[E+2]} ${t[E+3]} ${t[E+4]} ${t[E+5]}`);return S.push(`L${t[4]} ${t[5]} Z`),S.join(" ")}getOutlines(){var C;const e=g(this,qs),t=g(this,qr),n=g(this,nt),s=n.subarray(4,6),o=n.subarray(16,18),[l,c,d,h]=g(this,js),p=new Float64Array((((C=g(this,Qo))==null?void 0:C.length)??0)+2);for(let k=0,I=p.length-2;k<I;k+=2)p[k]=(g(this,Qo)[k]-l)/d,p[k+1]=(g(this,Qo)[k+1]-c)/h;p[p.length-2]=(g(this,xl)-l)/d,p[p.length-1]=(g(this,Sl)-c)/h;const[y,b,S,E]=D(this,Xf,P_).call(this);if(isNaN(n[6])&&!this.isEmpty()){const k=new Float64Array(36);return k.set([NaN,NaN,NaN,NaN,(n[2]-l)/d,(n[3]-c)/h,NaN,NaN,NaN,NaN,(n[4]-l)/d,(n[5]-c)/h,NaN,NaN,NaN,NaN,y,b,NaN,NaN,NaN,NaN,S,E,NaN,NaN,NaN,NaN,(n[16]-l)/d,(n[17]-c)/h,NaN,NaN,NaN,NaN,(n[14]-l)/d,(n[15]-c)/h],0),new O_(k,p,g(this,js),g(this,Bu),g(this,Fu),g(this,Hu))}const R=new Float64Array(g(this,qs).length+24+g(this,qr).length);let A=e.length;for(let k=0;k<A;k+=2){if(isNaN(e[k])){R[k]=R[k+1]=NaN;continue}R[k]=e[k],R[k+1]=e[k+1]}R.set([NaN,NaN,NaN,NaN,(s[0]-l)/d,(s[1]-c)/h,NaN,NaN,NaN,NaN,y,b,NaN,NaN,NaN,NaN,S,E,NaN,NaN,NaN,NaN,(o[0]-l)/d,(o[1]-c)/h],A),A+=24;for(let k=t.length-6;k>=6;k-=6)for(let I=0;I<6;I+=2){if(isNaN(t[k+I])){R[A]=R[A+1]=NaN,A+=2;continue}R[A]=t[k+I],R[A+1]=t[k+I+1],A+=2}return R.set([NaN,NaN,NaN,NaN,t[4],t[5]],A),new O_(R,p,g(this,js),g(this,Bu),g(this,Fu),g(this,Hu))}};js=new WeakMap,qr=new WeakMap,Fu=new WeakMap,Hu=new WeakMap,qs=new WeakMap,nt=new WeakMap,xl=new WeakMap,Sl=new WeakMap,Jf=new WeakMap,Kf=new WeakMap,Bu=new WeakMap,ju=new WeakMap,Qo=new WeakMap,Wf=new WeakMap,c0=new WeakMap,u0=new WeakMap,Xf=new WeakSet,P_=function(){const e=g(this,nt).subarray(4,6),t=g(this,nt).subarray(16,18),[n,s,o,l]=g(this,js);return[(g(this,xl)+(e[0]-t[0])/2-n)/o,(g(this,Sl)+(e[1]-t[1])/2-s)/l,(g(this,xl)+(t[0]-e[0])/2-n)/o,(g(this,Sl)+(t[1]-e[1])/2-s)/l]},L(Er,Wf,8),L(Er,c0,2),L(Er,u0,g(Er,Wf)+g(Er,c0));let Vg=Er;var qu,El,Gr,Qf,Ni,Zf,Gt,ui,mh,gh,KN;class O_ extends JN{constructor(t,n,s,o,l,c){super();L(this,ui);L(this,qu);L(this,El,null);L(this,Gr);L(this,Qf);L(this,Ni);L(this,Zf);L(this,Gt);N(this,Gt,t),N(this,Ni,n),N(this,qu,s),N(this,Zf,o),N(this,Gr,l),N(this,Qf,c),D(this,ui,KN).call(this,c);const{x:d,y:h,width:p,height:y}=g(this,El);for(let b=0,S=t.length;b<S;b+=2)t[b]=(t[b]-d)/p,t[b+1]=(t[b+1]-h)/y;for(let b=0,S=n.length;b<S;b+=2)n[b]=(n[b]-d)/p,n[b+1]=(n[b+1]-h)/y}toSVGPath(){const t=[`M${g(this,Gt)[4]} ${g(this,Gt)[5]}`];for(let n=6,s=g(this,Gt).length;n<s;n+=6){if(isNaN(g(this,Gt)[n])){t.push(`L${g(this,Gt)[n+4]} ${g(this,Gt)[n+5]}`);continue}t.push(`C${g(this,Gt)[n]} ${g(this,Gt)[n+1]} ${g(this,Gt)[n+2]} ${g(this,Gt)[n+3]} ${g(this,Gt)[n+4]} ${g(this,Gt)[n+5]}`)}return t.push("Z"),t.join(" ")}serialize([t,n,s,o],l){const c=s-t,d=o-n;let h,p;switch(l){case 0:h=D(this,ui,mh).call(this,g(this,Gt),t,o,c,-d),p=D(this,ui,mh).call(this,g(this,Ni),t,o,c,-d);break;case 90:h=D(this,ui,gh).call(this,g(this,Gt),t,n,c,d),p=D(this,ui,gh).call(this,g(this,Ni),t,n,c,d);break;case 180:h=D(this,ui,mh).call(this,g(this,Gt),s,n,-c,d),p=D(this,ui,mh).call(this,g(this,Ni),s,n,-c,d);break;case 270:h=D(this,ui,gh).call(this,g(this,Gt),s,o,-c,-d),p=D(this,ui,gh).call(this,g(this,Ni),s,o,-c,-d);break}return{outline:Array.from(h),points:[Array.from(p)]}}get box(){return g(this,El)}getNewOutline(t,n){const{x:s,y:o,width:l,height:c}=g(this,El),[d,h,p,y]=g(this,qu),b=l*p,S=c*y,E=s*p+d,R=o*y+h,A=new Vg({x:g(this,Ni)[0]*b+E,y:g(this,Ni)[1]*S+R},g(this,qu),g(this,Zf),t,g(this,Qf),n??g(this,Gr));for(let C=2;C<g(this,Ni).length;C+=2)A.add({x:g(this,Ni)[C]*b+E,y:g(this,Ni)[C+1]*S+R});return A.getOutlines()}}qu=new WeakMap,El=new WeakMap,Gr=new WeakMap,Qf=new WeakMap,Ni=new WeakMap,Zf=new WeakMap,Gt=new WeakMap,ui=new WeakSet,mh=function(t,n,s,o,l){const c=new Float64Array(t.length);for(let d=0,h=t.length;d<h;d+=2)c[d]=n+t[d]*o,c[d+1]=s+t[d+1]*l;return c},gh=function(t,n,s,o,l){const c=new Float64Array(t.length);for(let d=0,h=t.length;d<h;d+=2)c[d]=n+t[d+1]*o,c[d+1]=s+t[d]*l;return c},KN=function(t){const n=g(this,Gt);let s=n[4],o=n[5],l=s,c=o,d=s,h=o,p=s,y=o;const b=t?Math.max:Math.min;for(let C=6,k=n.length;C<k;C+=6){if(isNaN(n[C]))l=Math.min(l,n[C+4]),c=Math.min(c,n[C+5]),d=Math.max(d,n[C+4]),h=Math.max(h,n[C+5]),y<n[C+5]?(p=n[C+4],y=n[C+5]):y===n[C+5]&&(p=b(p,n[C+4]));else{const I=Ee.bezierBoundingBox(s,o,...n.slice(C,C+6));l=Math.min(l,I[0]),c=Math.min(c,I[1]),d=Math.max(d,I[2]),h=Math.max(h,I[3]),y<I[3]?(p=I[2],y=I[3]):y===I[3]&&(p=b(p,I[2]))}s=n[C+4],o=n[C+5]}const S=l-g(this,Gr),E=c-g(this,Gr),R=d-l+2*g(this,Gr),A=h-c+2*g(this,Gr);N(this,El,{x:S,y:E,width:R,height:A,lastPoint:[p,y]})};var ep,tp,vs,Al,Gu,on,np,Vu,ip,sp,ys,zu,Tt,U_,F_,WN,Oa,XN,Po;const Ar=class Ar{constructor({editor:e=null,uiManager:t=null}){L(this,Tt);L(this,ep,D(this,Tt,WN).bind(this));L(this,tp,D(this,Tt,XN).bind(this));L(this,vs,null);L(this,Al,null);L(this,Gu);L(this,on,null);L(this,np,!1);L(this,Vu,!1);L(this,ip,null);L(this,sp);L(this,ys,null);L(this,zu);var n;e?(N(this,Vu,!1),N(this,zu,Fe.HIGHLIGHT_COLOR),N(this,ip,e)):(N(this,Vu,!0),N(this,zu,Fe.HIGHLIGHT_DEFAULT_COLOR)),N(this,ys,(e==null?void 0:e._uiManager)||t),N(this,sp,g(this,ys)._eventBus),N(this,Gu,(e==null?void 0:e.color)||((n=g(this,ys))==null?void 0:n.highlightColors.values().next().value)||"#FFFF98")}static get _keyboardManager(){return st(this,"_keyboardManager",new bp([[["Escape","mac+Escape"],Ar.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],Ar.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],Ar.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],Ar.prototype._moveToPrevious],[["Home","mac+Home"],Ar.prototype._moveToBeginning],[["End","mac+End"],Ar.prototype._moveToEnd]]))}renderButton(){const e=N(this,vs,document.createElement("button"));e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.setAttribute("aria-haspopup",!0);const t=g(this,ys)._signal;e.addEventListener("click",D(this,Tt,Oa).bind(this),{signal:t}),e.addEventListener("keydown",g(this,ep),{signal:t});const n=N(this,Al,document.createElement("span"));return n.className="swatch",n.setAttribute("aria-hidden",!0),n.style.backgroundColor=g(this,Gu),e.append(n),e}renderMainDropdown(){const e=N(this,on,D(this,Tt,U_).call(this));return e.setAttribute("aria-orientation","horizontal"),e.setAttribute("aria-labelledby","highlightColorPickerLabel"),e}_colorSelectFromKeyboard(e){if(e.target===g(this,vs)){D(this,Tt,Oa).call(this,e);return}const t=e.target.getAttribute("data-color");t&&D(this,Tt,F_).call(this,t,e)}_moveToNext(e){var t,n;if(!g(this,Tt,Po)){D(this,Tt,Oa).call(this,e);return}if(e.target===g(this,vs)){(t=g(this,on).firstChild)==null||t.focus();return}(n=e.target.nextSibling)==null||n.focus()}_moveToPrevious(e){var t,n;if(e.target===((t=g(this,on))==null?void 0:t.firstChild)||e.target===g(this,vs)){g(this,Tt,Po)&&this._hideDropdownFromKeyboard();return}g(this,Tt,Po)||D(this,Tt,Oa).call(this,e),(n=e.target.previousSibling)==null||n.focus()}_moveToBeginning(e){var t;if(!g(this,Tt,Po)){D(this,Tt,Oa).call(this,e);return}(t=g(this,on).firstChild)==null||t.focus()}_moveToEnd(e){var t;if(!g(this,Tt,Po)){D(this,Tt,Oa).call(this,e);return}(t=g(this,on).lastChild)==null||t.focus()}hideDropdown(){var e;(e=g(this,on))==null||e.classList.add("hidden"),window.removeEventListener("pointerdown",g(this,tp))}_hideDropdownFromKeyboard(){var e;if(!g(this,Vu)){if(!g(this,Tt,Po)){(e=g(this,ip))==null||e.unselect();return}this.hideDropdown(),g(this,vs).focus({preventScroll:!0,focusVisible:g(this,np)})}}updateColor(e){if(g(this,Al)&&(g(this,Al).style.backgroundColor=e),!g(this,on))return;const t=g(this,ys).highlightColors.values();for(const n of g(this,on).children)n.setAttribute("aria-selected",t.next().value===e)}destroy(){var e,t;(e=g(this,vs))==null||e.remove(),N(this,vs,null),N(this,Al,null),(t=g(this,on))==null||t.remove(),N(this,on,null)}};ep=new WeakMap,tp=new WeakMap,vs=new WeakMap,Al=new WeakMap,Gu=new WeakMap,on=new WeakMap,np=new WeakMap,Vu=new WeakMap,ip=new WeakMap,sp=new WeakMap,ys=new WeakMap,zu=new WeakMap,Tt=new WeakSet,U_=function(){const e=document.createElement("div"),t=g(this,ys)._signal;e.addEventListener("contextmenu",di,{signal:t}),e.className="dropdown",e.role="listbox",e.setAttribute("aria-multiselectable",!1),e.setAttribute("aria-orientation","vertical"),e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown");for(const[n,s]of g(this,ys).highlightColors){const o=document.createElement("button");o.tabIndex="0",o.role="option",o.setAttribute("data-color",s),o.title=n,o.setAttribute("data-l10n-id",`pdfjs-editor-colorpicker-${n}`);const l=document.createElement("span");o.append(l),l.className="swatch",l.style.backgroundColor=s,o.setAttribute("aria-selected",s===g(this,Gu)),o.addEventListener("click",D(this,Tt,F_).bind(this,s),{signal:t}),e.append(o)}return e.addEventListener("keydown",g(this,ep),{signal:t}),e},F_=function(e,t){t.stopPropagation(),g(this,sp).dispatch("switchannotationeditorparams",{source:this,type:g(this,zu),value:e})},WN=function(e){Ar._keyboardManager.exec(this,e)},Oa=function(e){if(g(this,Tt,Po)){this.hideDropdown();return}if(N(this,np,e.detail===0),window.addEventListener("pointerdown",g(this,tp),{signal:g(this,ys)._signal}),g(this,on)){g(this,on).classList.remove("hidden");return}const t=N(this,on,D(this,Tt,U_).call(this));g(this,vs).append(t)},XN=function(e){var t;(t=g(this,on))!=null&&t.contains(e.target)||this.hideDropdown()},Po=function(){return g(this,on)&&!g(this,on).classList.contains("hidden")};let zg=Ar;var $u,rp,Zo,Tl,Yu,Ki,op,ap,Cl,bs,zn,ki,d0,Ju,Rl,an,Ku,Gs,lp,Qe,H_,B_,QN,ZN,ek,j_,vh,Zi,Jc,tk,xg,yh,nk,ik,sk,rk;const ht=class ht extends vt{constructor(t){super({...t,name:"highlightEditor"});L(this,Qe);L(this,$u,null);L(this,rp,0);L(this,Zo);L(this,Tl,null);L(this,Yu,null);L(this,Ki,null);L(this,op,null);L(this,ap,0);L(this,Cl,null);L(this,bs,null);L(this,zn,null);L(this,ki,!1);L(this,d0,D(this,Qe,tk).bind(this));L(this,Ju,null);L(this,Rl);L(this,an,null);L(this,Ku,"");L(this,Gs);L(this,lp,"");this.color=t.color||ht._defaultColor,N(this,Gs,t.thickness||ht._defaultThickness),N(this,Rl,t.opacity||ht._defaultOpacity),N(this,Zo,t.boxes||null),N(this,lp,t.methodOfCreation||""),N(this,Ku,t.text||""),this._isDraggable=!1,t.highlightId>-1?(N(this,ki,!0),D(this,Qe,B_).call(this,t),D(this,Qe,vh).call(this)):(N(this,$u,t.anchorNode),N(this,rp,t.anchorOffset),N(this,op,t.focusNode),N(this,ap,t.focusOffset),D(this,Qe,H_).call(this),D(this,Qe,vh).call(this),this.rotate(this.rotation))}static get _keyboardManager(){const t=ht.prototype;return st(this,"_keyboardManager",new bp([[["ArrowLeft","mac+ArrowLeft"],t._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],t._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],t._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],t._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:g(this,ki)?"free_highlight":"highlight",color:this._uiManager.highlightColorNames.get(this.color),thickness:g(this,Gs),methodOfCreation:g(this,lp)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.highlightColorNames.get(this.color)}}static computeTelemetryFinalData(t){return{numberOfColors:t.get("color").size}}static initialize(t,n){var s;vt.initialize(t,n),ht._defaultColor||(ht._defaultColor=((s=n.highlightColors)==null?void 0:s.values().next().value)||"#fff066")}static updateDefaultParams(t,n){switch(t){case Fe.HIGHLIGHT_DEFAULT_COLOR:ht._defaultColor=n;break;case Fe.HIGHLIGHT_THICKNESS:ht._defaultThickness=n;break}}translateInPage(t,n){}get toolbarPosition(){return g(this,Ju)}updateParams(t,n){switch(t){case Fe.HIGHLIGHT_COLOR:D(this,Qe,QN).call(this,n);break;case Fe.HIGHLIGHT_THICKNESS:D(this,Qe,ZN).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Fe.HIGHLIGHT_DEFAULT_COLOR,ht._defaultColor],[Fe.HIGHLIGHT_THICKNESS,ht._defaultThickness]]}get propertiesToUpdate(){return[[Fe.HIGHLIGHT_COLOR,this.color||ht._defaultColor],[Fe.HIGHLIGHT_THICKNESS,g(this,Gs)||ht._defaultThickness],[Fe.HIGHLIGHT_FREE,g(this,ki)]]}async addEditToolbar(){const t=await super.addEditToolbar();return t?(this._uiManager.highlightColors&&(N(this,Yu,new zg({editor:this})),t.addColorPicker(g(this,Yu))),t):null}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(D(this,Qe,yh).call(this))}getBaseTranslation(){return[0,0]}getRect(t,n){return super.getRect(t,n,D(this,Qe,yh).call(this))}onceAdded(){this.parent.addUndoableEditor(this),this.div.focus()}remove(){D(this,Qe,j_).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(D(this,Qe,vh).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(t){var s;let n=!1;this.parent&&!t?D(this,Qe,j_).call(this):t&&(D(this,Qe,vh).call(this,t),n=!this.parent&&((s=this.div)==null?void 0:s.classList.contains("selectedEditor"))),super.setParent(t),this.show(this._isVisible),n&&this.select()}rotate(t){var o,l,c;const{drawLayer:n}=this.parent;let s;g(this,ki)?(t=(t-this.rotation+360)%360,s=D(o=ht,Zi,Jc).call(o,g(this,bs).box,t)):s=D(l=ht,Zi,Jc).call(l,this,t),n.rotate(g(this,zn),t),n.rotate(g(this,an),t),n.updateBox(g(this,zn),s),n.updateBox(g(this,an),D(c=ht,Zi,Jc).call(c,g(this,Ki).box,t))}render(){if(this.div)return this.div;const t=super.render();g(this,Ku)&&(t.setAttribute("aria-label",g(this,Ku)),t.setAttribute("role","mark")),g(this,ki)?t.classList.add("free"):this.div.addEventListener("keydown",g(this,d0),{signal:this._uiManager._signal});const n=N(this,Cl,document.createElement("div"));t.append(n),n.setAttribute("aria-hidden","true"),n.className="internal",n.style.clipPath=g(this,Tl);const[s,o]=this.parentDimensions;return this.setDims(this.width*s,this.height*o),jg(this,g(this,Cl),["pointerover","pointerleave"]),this.enableEditing(),t}pointerover(){this.parent.drawLayer.addClass(g(this,an),"hovered")}pointerleave(){this.parent.drawLayer.removeClass(g(this,an),"hovered")}_moveCaret(t){switch(this.parent.unselect(this),t){case 0:case 2:D(this,Qe,xg).call(this,!0);break;case 1:case 3:D(this,Qe,xg).call(this,!1);break}}select(){var t,n;super.select(),g(this,an)&&((t=this.parent)==null||t.drawLayer.removeClass(g(this,an),"hovered"),(n=this.parent)==null||n.drawLayer.addClass(g(this,an),"selected"))}unselect(){var t;super.unselect(),g(this,an)&&((t=this.parent)==null||t.drawLayer.removeClass(g(this,an),"selected"),g(this,ki)||D(this,Qe,xg).call(this,!1))}get _mustFixPosition(){return!g(this,ki)}show(t=this._isVisible){super.show(t),this.parent&&(this.parent.drawLayer.show(g(this,zn),t),this.parent.drawLayer.show(g(this,an),t))}static startHighlighting(t,n,{target:s,x:o,y:l}){const{x:c,y:d,width:h,height:p}=s.getBoundingClientRect(),y=A=>{D(this,Zi,sk).call(this,t,A)},b=t._signal,S={capture:!0,passive:!1,signal:b},E=A=>{A.preventDefault(),A.stopPropagation()},R=A=>{s.removeEventListener("pointermove",y),window.removeEventListener("blur",R),window.removeEventListener("pointerup",R),window.removeEventListener("pointerdown",E,S),window.removeEventListener("contextmenu",di),D(this,Zi,rk).call(this,t,A)};window.addEventListener("blur",R,{signal:b}),window.addEventListener("pointerup",R,{signal:b}),window.addEventListener("pointerdown",E,S),window.addEventListener("contextmenu",di,{signal:b}),s.addEventListener("pointermove",y,{signal:b}),this._freeHighlight=new Vg({x:o,y:l},[c,d,h,p],t.scale,this._defaultThickness/2,n,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=t.drawLayer.highlight(this._freeHighlight,this._defaultColor,this._defaultOpacity,!0)}static deserialize(t,n,s){var R;const o=super.deserialize(t,n,s),{rect:[l,c,d,h],color:p,quadPoints:y}=t;o.color=Ee.makeHexColor(...p),N(o,Rl,t.opacity);const[b,S]=o.pageDimensions;o.width=(d-l)/b,o.height=(h-c)/S;const E=N(o,Zo,[]);for(let A=0;A<y.length;A+=8)E.push({x:(y[4]-d)/b,y:(h-(1-y[A+5]))/S,width:(y[A+2]-y[A])/b,height:(y[A+5]-y[A+1])/S});return D(R=o,Qe,H_).call(R),o}serialize(t=!1){if(this.isEmpty()||t)return null;const n=this.getRect(0,0),s=vt._colorManager.convert(this.color);return{annotationType:it.HIGHLIGHT,color:s,opacity:g(this,Rl),thickness:g(this,Gs),quadPoints:D(this,Qe,nk).call(this),outlines:D(this,Qe,ik).call(this,n),pageIndex:this.pageIndex,rect:n,rotation:D(this,Qe,yh).call(this),structTreeParentId:this._structTreeParentId}}static canCreateNewEmptyEditor(){return!1}};$u=new WeakMap,rp=new WeakMap,Zo=new WeakMap,Tl=new WeakMap,Yu=new WeakMap,Ki=new WeakMap,op=new WeakMap,ap=new WeakMap,Cl=new WeakMap,bs=new WeakMap,zn=new WeakMap,ki=new WeakMap,d0=new WeakMap,Ju=new WeakMap,Rl=new WeakMap,an=new WeakMap,Ku=new WeakMap,Gs=new WeakMap,lp=new WeakMap,Qe=new WeakSet,H_=function(){const t=new D_(g(this,Zo),.001);N(this,bs,t.getOutlines()),{x:this.x,y:this.y,width:this.width,height:this.height}=g(this,bs).box;const n=new D_(g(this,Zo),.0025,.001,this._uiManager.direction==="ltr");N(this,Ki,n.getOutlines());const{lastPoint:s}=g(this,Ki).box;N(this,Ju,[(s[0]-this.x)/this.width,(s[1]-this.y)/this.height])},B_=function({highlightOutlines:t,highlightId:n,clipPathId:s}){var y,b;if(N(this,bs,t),N(this,Ki,t.getNewOutline(g(this,Gs)/2+1.5,.0025)),n>=0)N(this,zn,n),N(this,Tl,s),this.parent.drawLayer.finalizeLine(n,t),N(this,an,this.parent.drawLayer.highlightOutline(g(this,Ki)));else if(this.parent){const S=this.parent.viewport.rotation;this.parent.drawLayer.updateLine(g(this,zn),t),this.parent.drawLayer.updateBox(g(this,zn),D(y=ht,Zi,Jc).call(y,g(this,bs).box,(S-this.rotation+360)%360)),this.parent.drawLayer.updateLine(g(this,an),g(this,Ki)),this.parent.drawLayer.updateBox(g(this,an),D(b=ht,Zi,Jc).call(b,g(this,Ki).box,S))}const{x:l,y:c,width:d,height:h}=t.box;switch(this.rotation){case 0:this.x=l,this.y=c,this.width=d,this.height=h;break;case 90:{const[S,E]=this.parentDimensions;this.x=c,this.y=1-l,this.width=d*E/S,this.height=h*S/E;break}case 180:this.x=1-l,this.y=1-c,this.width=d,this.height=h;break;case 270:{const[S,E]=this.parentDimensions;this.x=1-c,this.y=l,this.width=d*E/S,this.height=h*S/E;break}}const{lastPoint:p}=g(this,Ki).box;N(this,Ju,[(p[0]-l)/d,(p[1]-c)/h])},QN=function(t){const n=o=>{var l,c;this.color=o,(l=this.parent)==null||l.drawLayer.changeColor(g(this,zn),o),(c=g(this,Yu))==null||c.updateColor(o)},s=this.color;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.highlightColorNames.get(t)},!0)},ZN=function(t){const n=g(this,Gs),s=o=>{N(this,Gs,o),D(this,Qe,ek).call(this,o)};this.addCommands({cmd:s.bind(this,t),undo:s.bind(this,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:t},!0)},ek=function(t){if(!g(this,ki))return;D(this,Qe,B_).call(this,{highlightOutlines:g(this,bs).getNewOutline(t/2)}),this.fixAndSetPosition();const[n,s]=this.parentDimensions;this.setDims(this.width*n,this.height*s)},j_=function(){g(this,zn)===null||!this.parent||(this.parent.drawLayer.remove(g(this,zn)),N(this,zn,null),this.parent.drawLayer.remove(g(this,an)),N(this,an,null))},vh=function(t=this.parent){g(this,zn)===null&&({id:_i(this,zn)._,clipPathId:_i(this,Tl)._}=t.drawLayer.highlight(g(this,bs),this.color,g(this,Rl)),N(this,an,t.drawLayer.highlightOutline(g(this,Ki))),g(this,Cl)&&(g(this,Cl).style.clipPath=g(this,Tl)))},Zi=new WeakSet,Jc=function({x:t,y:n,width:s,height:o},l){switch(l){case 90:return{x:1-n-o,y:t,width:o,height:s};case 180:return{x:1-t-s,y:1-n-o,width:s,height:o};case 270:return{x:n,y:1-t-s,width:o,height:s}}return{x:t,y:n,width:s,height:o}},tk=function(t){ht._keyboardManager.exec(this,t)},xg=function(t){if(!g(this,$u))return;const n=window.getSelection();t?n.setPosition(g(this,$u),g(this,rp)):n.setPosition(g(this,op),g(this,ap))},yh=function(){return g(this,ki)?this.rotation:0},nk=function(){if(g(this,ki))return null;const[t,n]=this.pageDimensions,s=g(this,Zo),o=new Float32Array(s.length*8);let l=0;for(const{x:c,y:d,width:h,height:p}of s){const y=c*t,b=(1-d-p)*n;o[l]=o[l+4]=y,o[l+1]=o[l+3]=b,o[l+2]=o[l+6]=y+h*t,o[l+5]=o[l+7]=b+p*n,l+=8}return o},ik=function(t){return g(this,bs).serialize(t,D(this,Qe,yh).call(this))},sk=function(t,n){this._freeHighlight.add(n)&&t.drawLayer.updatePath(this._freeHighlightId,this._freeHighlight)},rk=function(t,n){this._freeHighlight.isEmpty()?t.drawLayer.removeFreeHighlight(this._freeHighlightId):t.createAndAddNewEditor(n,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},L(ht,Zi),qe(ht,"_defaultColor",null),qe(ht,"_defaultOpacity",1),qe(ht,"_defaultThickness",12),qe(ht,"_l10nPromise"),qe(ht,"_type","highlight"),qe(ht,"_editorType",it.HIGHLIGHT),qe(ht,"_freeHighlightId",-1),qe(ht,"_freeHighlight",null),qe(ht,"_freeHighlightClipId","");let $g=ht;var Nl,kl,cp,up,dp,Il,Vs,Vr,Wi,Ml,Dl,zr,Ll,Pl,ea,ve,ok,ak,lk,ck,G_,uk,V_,dk,hk,fk,pk,mk,Ua,z_,Sg,Eg,Kc,$_,Ag,io,gk,Y_,vk,yk,J_,Tg,bh;const Dt=class Dt extends vt{constructor(t){super({...t,name:"inkEditor"});L(this,ve);L(this,Nl,0);L(this,kl,0);L(this,cp,this.canvasPointermove.bind(this));L(this,up,this.canvasPointerleave.bind(this));L(this,dp,this.canvasPointerup.bind(this));L(this,Il,this.canvasPointerdown.bind(this));L(this,Vs,null);L(this,Vr,new Path2D);L(this,Wi,!1);L(this,Ml,!1);L(this,Dl,!1);L(this,zr,null);L(this,Ll,0);L(this,Pl,0);L(this,ea,null);this.color=t.color||null,this.thickness=t.thickness||null,this.opacity=t.opacity||null,this.paths=[],this.bezierPath2D=[],this.allRawPaths=[],this.currentPath=[],this.scaleFactor=1,this.translationX=this.translationY=0,this.x=0,this.y=0,this._willKeepAspectRatio=!0}static initialize(t,n){vt.initialize(t,n)}static updateDefaultParams(t,n){switch(t){case Fe.INK_THICKNESS:Dt._defaultThickness=n;break;case Fe.INK_COLOR:Dt._defaultColor=n;break;case Fe.INK_OPACITY:Dt._defaultOpacity=n/100;break}}updateParams(t,n){switch(t){case Fe.INK_THICKNESS:D(this,ve,ok).call(this,n);break;case Fe.INK_COLOR:D(this,ve,ak).call(this,n);break;case Fe.INK_OPACITY:D(this,ve,lk).call(this,n);break}}static get defaultPropertiesToUpdate(){return[[Fe.INK_THICKNESS,Dt._defaultThickness],[Fe.INK_COLOR,Dt._defaultColor||vt._defaultLineColor],[Fe.INK_OPACITY,Math.round(Dt._defaultOpacity*100)]]}get propertiesToUpdate(){return[[Fe.INK_THICKNESS,this.thickness||Dt._defaultThickness],[Fe.INK_COLOR,this.color||Dt._defaultColor||vt._defaultLineColor],[Fe.INK_OPACITY,Math.round(100*(this.opacity??Dt._defaultOpacity))]]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.canvas||(D(this,ve,Sg).call(this),D(this,ve,Eg).call(this)),this.isAttachedToDOM||(this.parent.add(this),D(this,ve,Kc).call(this)),D(this,ve,bh).call(this)))}remove(){var t;this.canvas!==null&&(this.isEmpty()||this.commit(),this.canvas.width=this.canvas.height=0,this.canvas.remove(),this.canvas=null,g(this,Vs)&&(clearTimeout(g(this,Vs)),N(this,Vs,null)),(t=g(this,zr))==null||t.disconnect(),N(this,zr,null),super.remove())}setParent(t){!this.parent&&t?this._uiManager.removeShouldRescale(this):this.parent&&t===null&&this._uiManager.addShouldRescale(this),super.setParent(t)}onScaleChanging(){const[t,n]=this.parentDimensions,s=this.width*t,o=this.height*n;this.setDimensions(s,o)}enableEditMode(){g(this,Wi)||this.canvas===null||(super.enableEditMode(),this._isDraggable=!1,this.canvas.addEventListener("pointerdown",g(this,Il),{signal:this._uiManager._signal}))}disableEditMode(){!this.isInEditMode()||this.canvas===null||(super.disableEditMode(),this._isDraggable=!this.isEmpty(),this.div.classList.remove("editing"),this.canvas.removeEventListener("pointerdown",g(this,Il)))}onceAdded(){this._isDraggable=!this.isEmpty()}isEmpty(){return this.paths.length===0||this.paths.length===1&&this.paths[0].length===0}commit(){g(this,Wi)||(super.commit(),this.isEditing=!1,this.disableEditMode(),this.setInForeground(),N(this,Wi,!0),this.div.classList.add("disabled"),D(this,ve,bh).call(this,!0),this.select(),this.parent.addInkEditorIfNeeded(!0),this.moveInDOM(),this.div.focus({preventScroll:!0}))}focusin(t){this._focusEventsAllowed&&(super.focusin(t),this.enableEditMode())}canvasPointerdown(t){t.button!==0||!this.isInEditMode()||g(this,Wi)||(this.setInForeground(),t.preventDefault(),this.div.contains(document.activeElement)||this.div.focus({preventScroll:!0}),D(this,ve,uk).call(this,t.offsetX,t.offsetY))}canvasPointermove(t){t.preventDefault(),D(this,ve,V_).call(this,t.offsetX,t.offsetY)}canvasPointerup(t){t.preventDefault(),D(this,ve,z_).call(this,t)}canvasPointerleave(t){D(this,ve,z_).call(this,t)}get isResizable(){return!this.isEmpty()&&g(this,Wi)}render(){if(this.div)return this.div;let t,n;this.width&&(t=this.x,n=this.y),super.render(),this.div.setAttribute("data-l10n-id","pdfjs-ink");const[s,o,l,c]=D(this,ve,ck).call(this);if(this.setAt(s,o,0,0),this.setDims(l,c),D(this,ve,Sg).call(this),this.width){const[d,h]=this.parentDimensions;this.setAspectRatio(this.width*d,this.height*h),this.setAt(t*d,n*h,this.width*d,this.height*h),N(this,Dl,!0),D(this,ve,Kc).call(this),this.setDims(this.width*d,this.height*h),D(this,ve,Ua).call(this),this.div.classList.add("disabled")}else this.div.classList.add("editing"),this.enableEditMode();return D(this,ve,Eg).call(this),this.div}setDimensions(t,n){const s=Math.round(t),o=Math.round(n);if(g(this,Ll)===s&&g(this,Pl)===o)return;N(this,Ll,s),N(this,Pl,o),this.canvas.style.visibility="hidden";const[l,c]=this.parentDimensions;this.width=t/l,this.height=n/c,this.fixAndSetPosition(),g(this,Wi)&&D(this,ve,$_).call(this,t,n),D(this,ve,Kc).call(this),D(this,ve,Ua).call(this),this.canvas.style.visibility="visible",this.fixDims()}static deserialize(t,n,s){var A,C,k;if(t instanceof UN)return null;const o=super.deserialize(t,n,s);o.thickness=t.thickness,o.color=Ee.makeHexColor(...t.color),o.opacity=t.opacity;const[l,c]=o.pageDimensions,d=o.width*l,h=o.height*c,p=o.parentScale,y=t.thickness/2;N(o,Wi,!0),N(o,Ll,Math.round(d)),N(o,Pl,Math.round(h));const{paths:b,rect:S,rotation:E}=t;for(let{bezier:I}of b){I=D(A=Dt,io,vk).call(A,I,S,E);const O=[];o.paths.push(O);let U=p*(I[0]-y),P=p*(I[1]-y);for(let Q=2,K=I.length;Q<K;Q+=6){const le=p*(I[Q]-y),de=p*(I[Q+1]-y),G=p*(I[Q+2]-y),fe=p*(I[Q+3]-y),ce=p*(I[Q+4]-y),pe=p*(I[Q+5]-y);O.push([[U,P],[le,de],[G,fe],[ce,pe]]),U=ce,P=pe}const B=D(this,io,gk).call(this,O);o.bezierPath2D.push(B)}const R=D(C=o,ve,J_).call(C);return N(o,kl,Math.max(vt.MIN_SIZE,R[2]-R[0])),N(o,Nl,Math.max(vt.MIN_SIZE,R[3]-R[1])),D(k=o,ve,$_).call(k,d,h),o}serialize(){if(this.isEmpty())return null;const t=this.getRect(0,0),n=vt._colorManager.convert(this.ctx.strokeStyle);return{annotationType:it.INK,color:n,thickness:this.thickness,opacity:this.opacity,paths:D(this,ve,yk).call(this,this.scaleFactor/this.parentScale,this.translationX,this.translationY,t),pageIndex:this.pageIndex,rect:t,rotation:this.rotation,structTreeParentId:this._structTreeParentId}}};Nl=new WeakMap,kl=new WeakMap,cp=new WeakMap,up=new WeakMap,dp=new WeakMap,Il=new WeakMap,Vs=new WeakMap,Vr=new WeakMap,Wi=new WeakMap,Ml=new WeakMap,Dl=new WeakMap,zr=new WeakMap,Ll=new WeakMap,Pl=new WeakMap,ea=new WeakMap,ve=new WeakSet,ok=function(t){const n=o=>{this.thickness=o,D(this,ve,bh).call(this)},s=this.thickness;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0})},ak=function(t){const n=o=>{this.color=o,D(this,ve,Ua).call(this)},s=this.color;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.INK_COLOR,overwriteIfSameType:!0,keepUndo:!0})},lk=function(t){const n=o=>{this.opacity=o,D(this,ve,Ua).call(this)};t/=100;const s=this.opacity;this.addCommands({cmd:n.bind(this,t),undo:n.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Fe.INK_OPACITY,overwriteIfSameType:!0,keepUndo:!0})},ck=function(){const{parentRotation:t,parentDimensions:[n,s]}=this;switch(t){case 90:return[0,s,s,n];case 180:return[n,s,n,s];case 270:return[n,0,s,n];default:return[0,0,n,s]}},G_=function(){const{ctx:t,color:n,opacity:s,thickness:o,parentScale:l,scaleFactor:c}=this;t.lineWidth=o*l/c,t.lineCap="round",t.lineJoin="round",t.miterLimit=10,t.strokeStyle=`${n}${EH(s)}`},uk=function(t,n){const s=this._uiManager._signal;this.canvas.addEventListener("contextmenu",di,{signal:s}),this.canvas.addEventListener("pointerleave",g(this,up),{signal:s}),this.canvas.addEventListener("pointermove",g(this,cp),{signal:s}),this.canvas.addEventListener("pointerup",g(this,dp),{signal:s}),this.canvas.removeEventListener("pointerdown",g(this,Il)),this.isEditing=!0,g(this,Dl)||(N(this,Dl,!0),D(this,ve,Kc).call(this),this.thickness||(this.thickness=Dt._defaultThickness),this.color||(this.color=Dt._defaultColor||vt._defaultLineColor),this.opacity??(this.opacity=Dt._defaultOpacity)),this.currentPath.push([t,n]),N(this,Ml,!1),D(this,ve,G_).call(this),N(this,ea,()=>{D(this,ve,fk).call(this),g(this,ea)&&window.requestAnimationFrame(g(this,ea))}),window.requestAnimationFrame(g(this,ea))},V_=function(t,n){const[s,o]=this.currentPath.at(-1);if(this.currentPath.length>1&&t===s&&n===o)return;const l=this.currentPath;let c=g(this,Vr);if(l.push([t,n]),N(this,Ml,!0),l.length<=2){c.moveTo(...l[0]),c.lineTo(t,n);return}l.length===3&&(N(this,Vr,c=new Path2D),c.moveTo(...l[0])),D(this,ve,pk).call(this,c,...l.at(-3),...l.at(-2),t,n)},dk=function(){if(this.currentPath.length===0)return;const t=this.currentPath.at(-1);g(this,Vr).lineTo(...t)},hk=function(t,n){N(this,ea,null),t=Math.min(Math.max(t,0),this.canvas.width),n=Math.min(Math.max(n,0),this.canvas.height),D(this,ve,V_).call(this,t,n),D(this,ve,dk).call(this);let s;if(this.currentPath.length!==1)s=D(this,ve,mk).call(this);else{const h=[t,n];s=[[h,h.slice(),h.slice(),h]]}const o=g(this,Vr),l=this.currentPath;this.currentPath=[],N(this,Vr,new Path2D);const c=()=>{this.allRawPaths.push(l),this.paths.push(s),this.bezierPath2D.push(o),this._uiManager.rebuild(this)},d=()=>{this.allRawPaths.pop(),this.paths.pop(),this.bezierPath2D.pop(),this.paths.length===0?this.remove():(this.canvas||(D(this,ve,Sg).call(this),D(this,ve,Eg).call(this)),D(this,ve,bh).call(this))};this.addCommands({cmd:c,undo:d,mustExec:!0})},fk=function(){if(!g(this,Ml))return;N(this,Ml,!1);const t=Math.ceil(this.thickness*this.parentScale),n=this.currentPath.slice(-3),s=n.map(c=>c[0]),o=n.map(c=>c[1]);Math.min(...s)-t,Math.max(...s)+t,Math.min(...o)-t,Math.max(...o)+t;const{ctx:l}=this;l.save(),l.clearRect(0,0,this.canvas.width,this.canvas.height);for(const c of this.bezierPath2D)l.stroke(c);l.stroke(g(this,Vr)),l.restore()},pk=function(t,n,s,o,l,c,d){const h=(n+o)/2,p=(s+l)/2,y=(o+c)/2,b=(l+d)/2;t.bezierCurveTo(h+2*(o-h)/3,p+2*(l-p)/3,y+2*(o-y)/3,b+2*(l-b)/3,y,b)},mk=function(){const t=this.currentPath;if(t.length<=2)return[[t[0],t[0],t.at(-1),t.at(-1)]];const n=[];let s,[o,l]=t[0];for(s=1;s<t.length-2;s++){const[S,E]=t[s],[R,A]=t[s+1],C=(S+R)/2,k=(E+A)/2,I=[o+2*(S-o)/3,l+2*(E-l)/3],O=[C+2*(S-C)/3,k+2*(E-k)/3];n.push([[o,l],I,O,[C,k]]),[o,l]=[C,k]}const[c,d]=t[s],[h,p]=t[s+1],y=[o+2*(c-o)/3,l+2*(d-l)/3],b=[h+2*(c-h)/3,p+2*(d-p)/3];return n.push([[o,l],y,b,[h,p]]),n},Ua=function(){if(this.isEmpty()){D(this,ve,Ag).call(this);return}D(this,ve,G_).call(this);const{canvas:t,ctx:n}=this;n.setTransform(1,0,0,1,0,0),n.clearRect(0,0,t.width,t.height),D(this,ve,Ag).call(this);for(const s of this.bezierPath2D)n.stroke(s)},z_=function(t){this.canvas.removeEventListener("pointerleave",g(this,up)),this.canvas.removeEventListener("pointermove",g(this,cp)),this.canvas.removeEventListener("pointerup",g(this,dp)),this.canvas.addEventListener("pointerdown",g(this,Il),{signal:this._uiManager._signal}),g(this,Vs)&&clearTimeout(g(this,Vs)),N(this,Vs,setTimeout(()=>{N(this,Vs,null),this.canvas.removeEventListener("contextmenu",di)},10)),D(this,ve,hk).call(this,t.offsetX,t.offsetY),this.addToAnnotationStorage(),this.setInBackground()},Sg=function(){this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=0,this.canvas.className="inkEditorCanvas",this.canvas.setAttribute("data-l10n-id","pdfjs-ink-canvas"),this.div.append(this.canvas),this.ctx=this.canvas.getContext("2d")},Eg=function(){N(this,zr,new ResizeObserver(t=>{const n=t[0].contentRect;n.width&&n.height&&this.setDimensions(n.width,n.height)})),g(this,zr).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var t;(t=g(this,zr))==null||t.disconnect(),N(this,zr,null)},{once:!0})},Kc=function(){if(!g(this,Dl))return;const[t,n]=this.parentDimensions;this.canvas.width=Math.ceil(this.width*t),this.canvas.height=Math.ceil(this.height*n),D(this,ve,Ag).call(this)},$_=function(t,n){const s=D(this,ve,Tg).call(this),o=(t-s)/g(this,kl),l=(n-s)/g(this,Nl);this.scaleFactor=Math.min(o,l)},Ag=function(){const t=D(this,ve,Tg).call(this)/2;this.ctx.setTransform(this.scaleFactor,0,0,this.scaleFactor,this.translationX*this.scaleFactor+t,this.translationY*this.scaleFactor+t)},io=new WeakSet,gk=function(t){const n=new Path2D;for(let s=0,o=t.length;s<o;s++){const[l,c,d,h]=t[s];s===0&&n.moveTo(...l),n.bezierCurveTo(c[0],c[1],d[0],d[1],h[0],h[1])}return n},Y_=function(t,n,s){const[o,l,c,d]=n;switch(s){case 0:for(let h=0,p=t.length;h<p;h+=2)t[h]+=o,t[h+1]=d-t[h+1];break;case 90:for(let h=0,p=t.length;h<p;h+=2){const y=t[h];t[h]=t[h+1]+o,t[h+1]=y+l}break;case 180:for(let h=0,p=t.length;h<p;h+=2)t[h]=c-t[h],t[h+1]+=l;break;case 270:for(let h=0,p=t.length;h<p;h+=2){const y=t[h];t[h]=c-t[h+1],t[h+1]=d-y}break;default:throw new Error("Invalid rotation")}return t},vk=function(t,n,s){const[o,l,c,d]=n;switch(s){case 0:for(let h=0,p=t.length;h<p;h+=2)t[h]-=o,t[h+1]=d-t[h+1];break;case 90:for(let h=0,p=t.length;h<p;h+=2){const y=t[h];t[h]=t[h+1]-l,t[h+1]=y-o}break;case 180:for(let h=0,p=t.length;h<p;h+=2)t[h]=c-t[h],t[h+1]-=l;break;case 270:for(let h=0,p=t.length;h<p;h+=2){const y=t[h];t[h]=d-t[h+1],t[h+1]=c-y}break;default:throw new Error("Invalid rotation")}return t},yk=function(t,n,s,o){var p,y;const l=[],c=this.thickness/2,d=t*n+c,h=t*s+c;for(const b of this.paths){const S=[],E=[];for(let R=0,A=b.length;R<A;R++){const[C,k,I,O]=b[R];if(C[0]===O[0]&&C[1]===O[1]&&A===1){const fe=t*C[0]+d,ce=t*C[1]+h;S.push(fe,ce),E.push(fe,ce);break}const U=t*C[0]+d,P=t*C[1]+h,B=t*k[0]+d,Q=t*k[1]+h,K=t*I[0]+d,le=t*I[1]+h,de=t*O[0]+d,G=t*O[1]+h;R===0&&(S.push(U,P),E.push(U,P)),S.push(B,Q,K,le,de,G),E.push(B,Q),R===A-1&&E.push(de,G)}l.push({bezier:D(p=Dt,io,Y_).call(p,S,o,this.rotation),points:D(y=Dt,io,Y_).call(y,E,o,this.rotation)})}return l},J_=function(){let t=1/0,n=-1/0,s=1/0,o=-1/0;for(const l of this.paths)for(const[c,d,h,p]of l){const y=Ee.bezierBoundingBox(...c,...d,...h,...p);t=Math.min(t,y[0]),s=Math.min(s,y[1]),n=Math.max(n,y[2]),o=Math.max(o,y[3])}return[t,s,n,o]},Tg=function(){return g(this,Wi)?Math.ceil(this.thickness*this.parentScale):0},bh=function(t=!1){if(this.isEmpty())return;if(!g(this,Wi)){D(this,ve,Ua).call(this);return}const n=D(this,ve,J_).call(this),s=D(this,ve,Tg).call(this);N(this,kl,Math.max(vt.MIN_SIZE,n[2]-n[0])),N(this,Nl,Math.max(vt.MIN_SIZE,n[3]-n[1]));const o=Math.ceil(s+g(this,kl)*this.scaleFactor),l=Math.ceil(s+g(this,Nl)*this.scaleFactor),[c,d]=this.parentDimensions;this.width=o/c,this.height=l/d,this.setAspectRatio(o,l);const h=this.translationX,p=this.translationY;this.translationX=-n[0],this.translationY=-n[1],D(this,ve,Kc).call(this),D(this,ve,Ua).call(this),N(this,Ll,o),N(this,Pl,l),this.setDims(o,l);const y=t?s/this.scaleFactor/2:0;this.translate(h-this.translationX-y,p-this.translationY-y)},L(Dt,io),qe(Dt,"_defaultColor",null),qe(Dt,"_defaultOpacity",1),qe(Dt,"_defaultThickness",1),qe(Dt,"_type","ink"),qe(Dt,"_editorType",it.INK);let q_=Dt;var Nn,kn,ta,$r,na,Wu,zs,Yr,$s,_s,hp,lt,_h,wh,Cg,W_,bk,_k,X_,Rg,wk;const Th=class Th extends vt{constructor(t){super({...t,name:"stampEditor"});L(this,lt);L(this,Nn,null);L(this,kn,null);L(this,ta,null);L(this,$r,null);L(this,na,null);L(this,Wu,"");L(this,zs,null);L(this,Yr,null);L(this,$s,null);L(this,_s,!1);L(this,hp,!1);N(this,$r,t.bitmapUrl),N(this,na,t.bitmapFile)}static initialize(t,n){vt.initialize(t,n)}static get supportedTypes(){return st(this,"supportedTypes",["apng","avif","bmp","gif","jpeg","png","svg+xml","webp","x-icon"].map(n=>`image/${n}`))}static get supportedTypesStr(){return st(this,"supportedTypesStr",this.supportedTypes.join(","))}static isHandlingMimeForPasting(t){return this.supportedTypes.includes(t)}static paste(t,n){n.pasteEditor(it.STAMP,{bitmapFile:t.getAsFile()})}remove(){var t,n;g(this,kn)&&(N(this,Nn,null),this._uiManager.imageManager.deleteId(g(this,kn)),(t=g(this,zs))==null||t.remove(),N(this,zs,null),(n=g(this,Yr))==null||n.disconnect(),N(this,Yr,null),g(this,$s)&&(clearTimeout(g(this,$s)),N(this,$s,null))),super.remove()}rebuild(){if(!this.parent){g(this,kn)&&D(this,lt,Cg).call(this);return}super.rebuild(),this.div!==null&&(g(this,kn)&&g(this,zs)===null&&D(this,lt,Cg).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(){this._isDraggable=!0,this.div.focus()}isEmpty(){return!(g(this,ta)||g(this,Nn)||g(this,$r)||g(this,na)||g(this,kn))}get isResizable(){return!0}render(){if(this.div)return this.div;let t,n;if(this.width&&(t=this.x,n=this.y),super.render(),this.div.hidden=!0,this.addAltTextButton(),g(this,Nn)?D(this,lt,W_).call(this):D(this,lt,Cg).call(this),this.width){const[s,o]=this.parentDimensions;this.setAt(t*s,n*o,this.width*s,this.height*o)}return this.div}getImageForAltText(){return g(this,zs)}static deserialize(t,n,s){if(t instanceof FN)return null;const o=super.deserialize(t,n,s),{rect:l,bitmapUrl:c,bitmapId:d,isSvg:h,accessibilityData:p}=t;d&&s.imageManager.isValidId(d)?N(o,kn,d):N(o,$r,c),N(o,_s,h);const[y,b]=o.pageDimensions;return o.width=(l[2]-l[0])/y,o.height=(l[3]-l[1])/b,p&&(o.altTextData=p),o}serialize(t=!1,n=null){if(this.isEmpty())return null;const s={annotationType:it.STAMP,bitmapId:g(this,kn),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:g(this,_s),structTreeParentId:this._structTreeParentId};if(t)return s.bitmapUrl=D(this,lt,Rg).call(this,!0),s.accessibilityData=this.altTextData,s;const{decorative:o,altText:l}=this.altTextData;if(!o&&l&&(s.accessibilityData={type:"Figure",alt:l}),n===null)return s;n.stamps||(n.stamps=new Map);const c=g(this,_s)?(s.rect[2]-s.rect[0])*(s.rect[3]-s.rect[1]):null;if(!n.stamps.has(g(this,kn)))n.stamps.set(g(this,kn),{area:c,serialized:s}),s.bitmap=D(this,lt,Rg).call(this,!1);else if(g(this,_s)){const d=n.stamps.get(g(this,kn));c>d.area&&(d.area=c,d.serialized.bitmap.close(),d.serialized.bitmap=D(this,lt,Rg).call(this,!1))}return s}};Nn=new WeakMap,kn=new WeakMap,ta=new WeakMap,$r=new WeakMap,na=new WeakMap,Wu=new WeakMap,zs=new WeakMap,Yr=new WeakMap,$s=new WeakMap,_s=new WeakMap,hp=new WeakMap,lt=new WeakSet,_h=function(t,n=!1){if(!t){this.remove();return}N(this,Nn,t.bitmap),n||(N(this,kn,t.id),N(this,_s,t.isSvg)),t.file&&N(this,Wu,t.file.name),D(this,lt,W_).call(this)},wh=function(){N(this,ta,null),this._uiManager.enableWaiting(!1),g(this,zs)&&this.div.focus()},Cg=function(){if(g(this,kn)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(g(this,kn)).then(s=>D(this,lt,_h).call(this,s,!0)).finally(()=>D(this,lt,wh).call(this));return}if(g(this,$r)){const s=g(this,$r);N(this,$r,null),this._uiManager.enableWaiting(!0),N(this,ta,this._uiManager.imageManager.getFromUrl(s).then(o=>D(this,lt,_h).call(this,o)).finally(()=>D(this,lt,wh).call(this)));return}if(g(this,na)){const s=g(this,na);N(this,na,null),this._uiManager.enableWaiting(!0),N(this,ta,this._uiManager.imageManager.getFromFile(s).then(o=>D(this,lt,_h).call(this,o)).finally(()=>D(this,lt,wh).call(this)));return}const t=document.createElement("input");t.type="file",t.accept=Th.supportedTypesStr;const n=this._uiManager._signal;N(this,ta,new Promise(s=>{t.addEventListener("change",async()=>{if(!t.files||t.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const o=await this._uiManager.imageManager.getFromFile(t.files[0]);D(this,lt,_h).call(this,o)}s()},{signal:n}),t.addEventListener("cancel",()=>{this.remove(),s()},{signal:n})}).finally(()=>D(this,lt,wh).call(this))),t.click()},W_=function(){const{div:t}=this;let{width:n,height:s}=g(this,Nn);const[o,l]=this.pageDimensions,c=.75;if(this.width)n=this.width*o,s=this.height*l;else if(n>c*o||s>c*l){const y=Math.min(c*o/n,c*l/s);n*=y,s*=y}const[d,h]=this.parentDimensions;this.setDims(n*d/o,s*h/l),this._uiManager.enableWaiting(!1);const p=N(this,zs,document.createElement("canvas"));t.append(p),t.hidden=!1,D(this,lt,X_).call(this,n,s),D(this,lt,wk).call(this),g(this,hp)||(this.parent.addUndoableEditor(this),N(this,hp,!0)),this._reportTelemetry({action:"inserted_image"}),g(this,Wu)&&p.setAttribute("aria-label",g(this,Wu))},bk=function(t,n){var c;const[s,o]=this.parentDimensions;this.width=t/s,this.height=n/o,this.setDims(t,n),(c=this._initialOptions)!=null&&c.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,g(this,$s)!==null&&clearTimeout(g(this,$s)),N(this,$s,setTimeout(()=>{N(this,$s,null),D(this,lt,X_).call(this,t,n)},200))},_k=function(t,n){const{width:s,height:o}=g(this,Nn);let l=s,c=o,d=g(this,Nn);for(;l>2*t||c>2*n;){const h=l,p=c;l>2*t&&(l=l>=16384?Math.floor(l/2)-1:Math.ceil(l/2)),c>2*n&&(c=c>=16384?Math.floor(c/2)-1:Math.ceil(c/2));const y=new OffscreenCanvas(l,c);y.getContext("2d").drawImage(d,0,0,h,p,0,0,l,c),d=y.transferToImageBitmap()}return d},X_=function(t,n){t=Math.ceil(t),n=Math.ceil(n);const s=g(this,zs);if(!s||s.width===t&&s.height===n)return;s.width=t,s.height=n;const o=g(this,_s)?g(this,Nn):D(this,lt,_k).call(this,t,n);if(this._uiManager.hasMLManager&&!this.hasAltText()){const d=new OffscreenCanvas(t,n).getContext("2d");d.drawImage(o,0,0,o.width,o.height,0,0,t,n),this._uiManager.mlGuess({service:"image-to-text",request:{data:d.getImageData(0,0,t,n).data,width:t,height:n,channels:4}}).then(h=>{const p=(h==null?void 0:h.output)||"";this.parent&&p&&!this.hasAltText()&&(this.altTextData={altText:p,decorative:!1})})}const l=s.getContext("2d");l.filter=this._uiManager.hcmFilter,l.drawImage(o,0,0,o.width,o.height,0,0,t,n)},Rg=function(t){if(t){if(g(this,_s)){const o=this._uiManager.imageManager.getSvgUrl(g(this,kn));if(o)return o}const n=document.createElement("canvas");return{width:n.width,height:n.height}=g(this,Nn),n.getContext("2d").drawImage(g(this,Nn),0,0),n.toDataURL()}if(g(this,_s)){const[n,s]=this.pageDimensions,o=Math.round(this.width*n*oa.PDF_TO_CSS_UNITS),l=Math.round(this.height*s*oa.PDF_TO_CSS_UNITS),c=new OffscreenCanvas(o,l);return c.getContext("2d").drawImage(g(this,Nn),0,0,g(this,Nn).width,g(this,Nn).height,0,0,o,l),c.transferToImageBitmap()}return structuredClone(g(this,Nn))},wk=function(){this._uiManager._signal&&(N(this,Yr,new ResizeObserver(t=>{const n=t[0].contentRect;n.width&&n.height&&D(this,lt,bk).call(this,n.width,n.height)})),g(this,Yr).observe(this.div),this._uiManager._signal.addEventListener("abort",()=>{var t;(t=g(this,Yr))==null||t.disconnect(),N(this,Yr,null)},{once:!0}))},qe(Th,"_type","stamp"),qe(Th,"_editorType",it.STAMP);let K_=Th;var Ol,Xu,Ys,Ul,Jr,Kr,Wr,Ii,ia,Qu,Zu,$n,Ne,sa,In,xk,Z_,ew,tw,Ng;const rs=class rs{constructor({uiManager:e,pageIndex:t,div:n,accessibilityManager:s,annotationLayer:o,drawLayer:l,textLayer:c,viewport:d,l10n:h}){L(this,In);L(this,Ol);L(this,Xu,!1);L(this,Ys,null);L(this,Ul,null);L(this,Jr,null);L(this,Kr,null);L(this,Wr,null);L(this,Ii,new Map);L(this,ia,!1);L(this,Qu,!1);L(this,Zu,!1);L(this,$n,null);L(this,Ne);const p=[...g(rs,sa).values()];if(!rs._initialized){rs._initialized=!0;for(const y of p)y.initialize(h,e)}e.registerEditorTypes(p),N(this,Ne,e),this.pageIndex=t,this.div=n,N(this,Ol,s),N(this,Ys,o),this.viewport=d,N(this,$n,c),this.drawLayer=l,g(this,Ne).addLayer(this)}get isEmpty(){return g(this,Ii).size===0}get isInvisible(){return this.isEmpty&&g(this,Ne).getMode()===it.NONE}updateToolbar(e){g(this,Ne).updateToolbar(e)}updateMode(e=g(this,Ne).getMode()){switch(D(this,In,Ng).call(this),e){case it.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case it.INK:this.addInkEditorIfNeeded(!1),this.disableTextSelection(),this.togglePointerEvents(!0),this.disableClick();break;case it.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;for(const n of g(rs,sa).values())t.toggle(`${n._type}Editing`,e===n._editorType);this.div.hidden=!1}hasTextLayer(e){var t;return e===((t=g(this,$n))==null?void 0:t.div)}addInkEditorIfNeeded(e){if(g(this,Ne).getMode()!==it.INK)return;if(!e){for(const n of g(this,Ii).values())if(n.isEmpty()){n.setInBackground();return}}this.createAndAddNewEditor({offsetX:0,offsetY:0},!1).setInBackground()}setEditingState(e){g(this,Ne).setEditingState(e)}addCommands(e){g(this,Ne).addCommands(e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){var t;(t=g(this,Ys))==null||t.div.classList.toggle("disabled",!e)}enable(){this.div.tabIndex=0,this.togglePointerEvents(!0);const e=new Set;for(const n of g(this,Ii).values())n.enableEditing(),n.show(!0),n.annotationElementId&&(g(this,Ne).removeChangedExistingAnnotation(n),e.add(n.annotationElementId));if(!g(this,Ys))return;const t=g(this,Ys).getEditableAnnotations();for(const n of t){if(n.hide(),g(this,Ne).isDeletedAnnotationElement(n.data.id)||e.has(n.data.id))continue;const s=this.deserialize(n);s&&(this.addOrRebuild(s),s.enableEditing())}}disable(){var s;N(this,Zu,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1);const e=new Map,t=new Map;for(const o of g(this,Ii).values())if(o.disableEditing(),!!o.annotationElementId){if(o.serialize()!==null){e.set(o.annotationElementId,o);continue}else t.set(o.annotationElementId,o);(s=this.getEditableAnnotation(o.annotationElementId))==null||s.show(),o.remove()}if(g(this,Ys)){const o=g(this,Ys).getEditableAnnotations();for(const l of o){const{id:c}=l.data;if(g(this,Ne).isDeletedAnnotationElement(c))continue;let d=t.get(c);if(d){d.resetAnnotationElement(l),d.show(!1),l.show();continue}d=e.get(c),d&&(g(this,Ne).addChangedExistingAnnotation(d),d.renderAnnotationElement(l),d.show(!1)),l.show()}}D(this,In,Ng).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:n}=this.div;for(const o of g(rs,sa).values())n.remove(`${o._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),N(this,Zu,!1)}getEditableAnnotation(e){var t;return((t=g(this,Ys))==null?void 0:t.getEditableAnnotation(e))||null}setActiveEditor(e){g(this,Ne).getActive()!==e&&g(this,Ne).setActiveEditor(e)}enableTextSelection(){var e;this.div.tabIndex=-1,(e=g(this,$n))!=null&&e.div&&!g(this,Kr)&&(N(this,Kr,D(this,In,xk).bind(this)),g(this,$n).div.addEventListener("pointerdown",g(this,Kr),{signal:g(this,Ne)._signal}),g(this,$n).div.classList.add("highlighting"))}disableTextSelection(){var e;this.div.tabIndex=0,(e=g(this,$n))!=null&&e.div&&g(this,Kr)&&(g(this,$n).div.removeEventListener("pointerdown",g(this,Kr)),N(this,Kr,null),g(this,$n).div.classList.remove("highlighting"))}enableClick(){if(g(this,Jr))return;const e=g(this,Ne)._signal;N(this,Jr,this.pointerdown.bind(this)),N(this,Ul,this.pointerup.bind(this)),this.div.addEventListener("pointerdown",g(this,Jr),{signal:e}),this.div.addEventListener("pointerup",g(this,Ul),{signal:e})}disableClick(){g(this,Jr)&&(this.div.removeEventListener("pointerdown",g(this,Jr)),this.div.removeEventListener("pointerup",g(this,Ul)),N(this,Jr,null),N(this,Ul,null))}attach(e){g(this,Ii).set(e.id,e);const{annotationElementId:t}=e;t&&g(this,Ne).isDeletedAnnotationElement(t)&&g(this,Ne).removeDeletedAnnotationElement(e)}detach(e){var t;g(this,Ii).delete(e.id),(t=g(this,Ol))==null||t.removePointerInTextLayer(e.contentDiv),!g(this,Zu)&&e.annotationElementId&&g(this,Ne).addDeletedAnnotationElement(e)}remove(e){this.detach(e),g(this,Ne).removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1,g(this,Qu)||this.addInkEditorIfNeeded(!1)}changeParent(e){var t;e.parent!==this&&(e.parent&&e.annotationElementId&&(g(this,Ne).addDeletedAnnotationElement(e.annotationElementId),vt.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),(t=e.parent)==null||t.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),g(this,Ne).addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(),g(this,Ne).addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){var n;if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!g(this,Wr)&&(e._focusEventsAllowed=!1,N(this,Wr,setTimeout(()=>{N(this,Wr,null),e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:g(this,Ne)._signal}),t.focus())},0))),e._structTreeParentId=(n=g(this,Ol))==null?void 0:n.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||(e.parent=this),e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),n=()=>{e.remove()};this.addCommands({cmd:t,undo:n,mustExec:!1})}getNextId(){return g(this,Ne).getId()}get _signal(){return g(this,Ne)._signal}canCreateNewEmptyEditor(){var e;return(e=g(this,In,Z_))==null?void 0:e.canCreateNewEmptyEditor()}pasteEditor(e,t){g(this,Ne).updateToolbar(e),g(this,Ne).updateMode(e);const{offsetX:n,offsetY:s}=D(this,In,tw).call(this),o=this.getNextId(),l=D(this,In,ew).call(this,{parent:this,id:o,x:n,y:s,uiManager:g(this,Ne),isCentered:!0,...t});l&&this.add(l)}deserialize(e){var t;return((t=g(rs,sa).get(e.annotationType??e.annotationEditorType))==null?void 0:t.deserialize(e,this,g(this,Ne)))||null}createAndAddNewEditor(e,t,n={}){const s=this.getNextId(),o=D(this,In,ew).call(this,{parent:this,id:s,x:e.offsetX,y:e.offsetY,uiManager:g(this,Ne),isCentered:t,...n});return o&&this.add(o),o}addNewEditor(){this.createAndAddNewEditor(D(this,In,tw).call(this),!0)}setSelected(e){g(this,Ne).setSelected(e)}toggleSelected(e){g(this,Ne).toggleSelected(e)}isSelected(e){return g(this,Ne).isSelected(e)}unselect(e){g(this,Ne).unselect(e)}pointerup(e){const{isMac:t}=ci.platform;if(!(e.button!==0||e.ctrlKey&&t)&&e.target===this.div&&g(this,ia)){if(N(this,ia,!1),!g(this,Xu)){N(this,Xu,!0);return}if(g(this,Ne).getMode()===it.STAMP){g(this,Ne).unselectAll();return}this.createAndAddNewEditor(e,!1)}}pointerdown(e){if(g(this,Ne).getMode()===it.HIGHLIGHT&&this.enableTextSelection(),g(this,ia)){N(this,ia,!1);return}const{isMac:t}=ci.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;N(this,ia,!0);const n=g(this,Ne).getActive();N(this,Xu,!n||n.isEmpty())}findNewParent(e,t,n){const s=g(this,Ne).findParent(t,n);return s===null||s===this?!1:(s.changeParent(e),!0)}destroy(){var e,t;((e=g(this,Ne).getActive())==null?void 0:e.parent)===this&&(g(this,Ne).commitOrRemove(),g(this,Ne).setActiveEditor(null)),g(this,Wr)&&(clearTimeout(g(this,Wr)),N(this,Wr,null));for(const n of g(this,Ii).values())(t=g(this,Ol))==null||t.removePointerInTextLayer(n.contentDiv),n.setParent(null),n.isAttachedToDOM=!1,n.div.remove();this.div=null,g(this,Ii).clear(),g(this,Ne).removeLayer(this)}render({viewport:e}){this.viewport=e,Fl(this.div,e);for(const t of g(this,Ne).getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){g(this,Ne).commitOrRemove(),D(this,In,Ng).call(this);const t=this.viewport.rotation,n=e.rotation;if(this.viewport=e,Fl(this.div,{rotation:n}),t!==n)for(const s of g(this,Ii).values())s.rotate(n);this.addInkEditorIfNeeded(!1)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return g(this,Ne).viewParameters.realScale}};Ol=new WeakMap,Xu=new WeakMap,Ys=new WeakMap,Ul=new WeakMap,Jr=new WeakMap,Kr=new WeakMap,Wr=new WeakMap,Ii=new WeakMap,ia=new WeakMap,Qu=new WeakMap,Zu=new WeakMap,$n=new WeakMap,Ne=new WeakMap,sa=new WeakMap,In=new WeakSet,xk=function(e){if(g(this,Ne).unselectAll(),e.target===g(this,$n).div){const{isMac:t}=ci.platform;if(e.button!==0||e.ctrlKey&&t)return;g(this,Ne).showAllEditors("highlight",!0,!0),g(this,$n).div.classList.add("free"),$g.startHighlighting(this,g(this,Ne).direction==="ltr",e),g(this,$n).div.addEventListener("pointerup",()=>{g(this,$n).div.classList.remove("free")},{once:!0,signal:g(this,Ne)._signal}),e.preventDefault()}},Z_=function(){return g(rs,sa).get(g(this,Ne).getMode())},ew=function(e){const t=g(this,In,Z_);return t?new t.prototype.constructor(e):null},tw=function(){const{x:e,y:t,width:n,height:s}=this.div.getBoundingClientRect(),o=Math.max(0,e),l=Math.max(0,t),c=Math.min(window.innerWidth,e+n),d=Math.min(window.innerHeight,t+s),h=(o+c)/2-e,p=(l+d)/2-t,[y,b]=this.viewport.rotation%180===0?[h,p]:[p,h];return{offsetX:y,offsetY:b}},Ng=function(){N(this,Qu,!0);for(const e of g(this,Ii).values())e.isEmpty()&&e.remove();N(this,Qu,!1)},qe(rs,"_initialized",!1),L(rs,sa,new Map([I_,q_,K_,$g].map(e=>[e._editorType,e])));let Q_=rs;var Js,fp,ln,ra,pp,iw,ql,sw,Sk;const En=class En{constructor({pageIndex:e}){L(this,ql);L(this,Js,null);L(this,fp,0);L(this,ln,new Map);L(this,ra,new Map);this.pageIndex=e}setParent(e){if(!g(this,Js)){N(this,Js,e);return}if(g(this,Js)!==e){if(g(this,ln).size>0)for(const t of g(this,ln).values())t.remove(),e.append(t);N(this,Js,e)}}static get _svgFactory(){return st(this,"_svgFactory",new ww)}highlight(e,t,n,s=!1){const o=_i(this,fp)._++,l=D(this,ql,sw).call(this,e.box);l.classList.add("highlight"),e.free&&l.classList.add("free");const c=En._svgFactory.createElement("defs");l.append(c);const d=En._svgFactory.createElement("path");c.append(d);const h=`path_p${this.pageIndex}_${o}`;d.setAttribute("id",h),d.setAttribute("d",e.toSVGPath()),s&&g(this,ra).set(o,d);const p=D(this,ql,Sk).call(this,c,h),y=En._svgFactory.createElement("use");return l.append(y),l.setAttribute("fill",t),l.setAttribute("fill-opacity",n),y.setAttribute("href",`#${h}`),g(this,ln).set(o,l),{id:o,clipPathId:`url(#${p})`}}highlightOutline(e){const t=_i(this,fp)._++,n=D(this,ql,sw).call(this,e.box);n.classList.add("highlightOutline");const s=En._svgFactory.createElement("defs");n.append(s);const o=En._svgFactory.createElement("path");s.append(o);const l=`path_p${this.pageIndex}_${t}`;o.setAttribute("id",l),o.setAttribute("d",e.toSVGPath()),o.setAttribute("vector-effect","non-scaling-stroke");let c;if(e.free){n.classList.add("free");const p=En._svgFactory.createElement("mask");s.append(p),c=`mask_p${this.pageIndex}_${t}`,p.setAttribute("id",c),p.setAttribute("maskUnits","objectBoundingBox");const y=En._svgFactory.createElement("rect");p.append(y),y.setAttribute("width","1"),y.setAttribute("height","1"),y.setAttribute("fill","white");const b=En._svgFactory.createElement("use");p.append(b),b.setAttribute("href",`#${l}`),b.setAttribute("stroke","none"),b.setAttribute("fill","black"),b.setAttribute("fill-rule","nonzero"),b.classList.add("mask")}const d=En._svgFactory.createElement("use");n.append(d),d.setAttribute("href",`#${l}`),c&&d.setAttribute("mask",`url(#${c})`);const h=d.cloneNode();return n.append(h),d.classList.add("mainOutline"),h.classList.add("secondaryOutline"),g(this,ln).set(t,n),t}finalizeLine(e,t){const n=g(this,ra).get(e);g(this,ra).delete(e),this.updateBox(e,t.box),n.setAttribute("d",t.toSVGPath())}updateLine(e,t){g(this,ln).get(e).firstChild.firstChild.setAttribute("d",t.toSVGPath())}removeFreeHighlight(e){this.remove(e),g(this,ra).delete(e)}updatePath(e,t){g(this,ra).get(e).setAttribute("d",t.toSVGPath())}updateBox(e,t){var n;D(n=En,pp,iw).call(n,g(this,ln).get(e),t)}show(e,t){g(this,ln).get(e).classList.toggle("hidden",!t)}rotate(e,t){g(this,ln).get(e).setAttribute("data-main-rotation",t)}changeColor(e,t){g(this,ln).get(e).setAttribute("fill",t)}changeOpacity(e,t){g(this,ln).get(e).setAttribute("fill-opacity",t)}addClass(e,t){g(this,ln).get(e).classList.add(t)}removeClass(e,t){g(this,ln).get(e).classList.remove(t)}remove(e){g(this,Js)!==null&&(g(this,ln).get(e).remove(),g(this,ln).delete(e))}destroy(){N(this,Js,null);for(const e of g(this,ln).values())e.remove();g(this,ln).clear()}};Js=new WeakMap,fp=new WeakMap,ln=new WeakMap,ra=new WeakMap,pp=new WeakSet,iw=function(e,{x:t=0,y:n=0,width:s=1,height:o=1}={}){const{style:l}=e;l.top=`${100*n}%`,l.left=`${100*t}%`,l.width=`${100*s}%`,l.height=`${100*o}%`},ql=new WeakSet,sw=function(e){var n;const t=En._svgFactory.create(1,1,!0);return g(this,Js).append(t),t.setAttribute("aria-hidden",!0),D(n=En,pp,iw).call(n,t,e),t},Sk=function(e,t){const n=En._svgFactory.createElement("clipPath");e.append(n);const s=`clip_${t}`;n.setAttribute("id",s),n.setAttribute("clipPathUnits","objectBoundingBox");const o=En._svgFactory.createElement("use");return n.append(o),o.setAttribute("href",`#${t}`),o.classList.add("clip"),s},L(En,pp);let nw=En;Pe.AbortException;Pe.AnnotationEditorLayer;Pe.AnnotationEditorParamsType;Pe.AnnotationEditorType;Pe.AnnotationEditorUIManager;Pe.AnnotationLayer;Pe.AnnotationMode;Pe.CMapCompressionType;Pe.ColorPicker;Pe.DOMSVGFactory;Pe.DrawLayer;Pe.FeatureTest;var tj=Pe.GlobalWorkerOptions;Pe.ImageKind;Pe.InvalidPDFException;Pe.MissingPDFException;Pe.OPS;Pe.Outliner;Pe.PDFDataRangeTransport;Pe.PDFDateString;Pe.PDFWorker;Pe.PasswordResponses;Pe.PermissionFlag;Pe.PixelsPerInch;Pe.RenderingCancelledException;Pe.TextLayer;Pe.UnexpectedResponseException;Pe.Util;Pe.VerbosityLevel;Pe.XfaLayer;Pe.build;Pe.createValidAbsoluteUrl;Pe.fetchData;var nj=Pe.getDocument;Pe.getFilenameFromUrl;Pe.getPdfFilenameFromUrl;Pe.getXfaPageViewport;Pe.isDataScheme;Pe.isPdfFile;Pe.noContextMenu;Pe.normalizeUnicode;Pe.renderTextLayer;Pe.setLayerDimensions;Pe.shadow;Pe.updateTextLayer;Pe.version;tj.workerSrc="https://unpkg.com/pdfjs-dist@4.4.168/build/pdf.worker.min.mjs";const ij=({job:i,tickets:e,onClose:t,onViewTicket:n})=>{const[s,o]=ee.useState(null),[l,c]=ee.useState([]),[,d]=ee.useState(!0),[h,p]=ee.useState(!1),[,y]=ee.useState(!1),[b,S]=ee.useState(!1),[E,R]=ee.useState({width:0,height:0}),[A,C]=ee.useState(1),[k,I]=ee.useState(1),O=ee.useRef(null),U=ee.useRef(null),P=ee.useRef(null),[B,Q]=ee.useState({x:0,y:0,scale:1}),[K,le]=ee.useState(!1),[de,G]=ee.useState(!1),fe=ee.useRef({x:0,y:0}),ce=ee.useRef({x:0,y:0}),pe=ee.useRef(!1),[z,X]=ee.useState(null),[te,ne]=ee.useState(null),[ue,F]=ee.useState(""),V=ee.useRef(null),se=ee.useRef(null),he=ee.useRef(null),Te=ee.useRef(null),ke=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent),xe=ae=>ae==null?void 0:ae.toLowerCase().split("?")[0].endsWith(".pdf"),ft=(()=>{if(e.length===0)return $e.VALID;const ae=e.map(He=>Ks(He));return ae.includes($e.EXPIRED)?$e.EXPIRED:ae.includes($e.REFRESH_NEEDED)||ae.includes($e.EXTENDABLE)?$e.REFRESH_NEEDED:$e.VALID})(),Ye=(()=>{switch(ft){case $e.EXPIRED:return"bg-rose-600";case $e.REFRESH_NEEDED:return"bg-amber-500";default:return"bg-brand"}})(),As=Ye.replace("bg-","text-");ee.useEffect(()=>{(async()=>{d(!0);try{const He=await at.getJobPrints(i.jobNumber),ut=He.find(Ie=>Ie.isPinned)||He[0]||null;if(o(ut),ut){const Ie=await at.getPrintMarkers(ut.id);c(Ie)}}catch(He){console.error("Failed to load blueprint data",He)}finally{d(!1)}})()},[i.jobNumber]);const gn=ee.useCallback(()=>{!V.current||E.width===0||requestAnimationFrame(()=>{if(!V.current)return;const ae=V.current.getBoundingClientRect(),He=40,ut=ae.width-He*2,Ie=ae.height-He*2,zt=Math.min(ut/E.width,Ie/E.height);Q({x:(ae.width-E.width*zt)/2,y:(ae.height-E.height*zt)/2,scale:zt}),S(!0)})},[E]);ee.useEffect(()=>{if(!V.current)return;const ae=new ResizeObserver(()=>gn());return ae.observe(V.current),()=>ae.disconnect()},[gn]),ee.useEffect(()=>{if(!s)return;if(!xe(s.url)){S(!0);return}let ae=!1;return(async()=>{var ut;p(!0),U.current!==s.id&&S(!1);try{if(P.current&&P.current.cancel(),!O.current||U.current!==s.id){const ye=await nj(s.url).promise;if(ae)return;O.current=ye,U.current=s.id,I(ye.numPages)}const Ie=await O.current.getPage(A);if(ae)return;const zt=ke?2048:4096,Mt=Ie.getViewport({scale:1}),Cs=Math.min(zt/Mt.width,zt/Mt.height,2),hi=Ie.getViewport({scale:Cs}),jn=he.current;if(!jn)return;const qn=jn.getContext("2d",{alpha:!1});qn&&(qn.fillStyle="white",qn.fillRect(0,0,jn.width,jn.height)),jn.height=hi.height,jn.width=hi.width;const er=Ie.render({canvasContext:qn,viewport:hi,canvas:jn});P.current=er,await er.promise,ae||(R({width:jn.width,height:jn.height}),p(!1),S(!0),Ie.cleanup(),(ut=O.current)==null||ut.cleanup())}catch(Ie){Ie.name!=="RenderingCancelledException"&&(console.error("PDF Render Error:",Ie),p(!1),S(!0))}})(),()=>{ae=!0}},[s,A,ke]),ee.useEffect(()=>{E.width>0&&gn()},[E,gn]);const ao=ae=>{K||ae.target.closest(".ui-isolation")||(fe.current={x:ae.clientX,y:ae.clientY},ce.current={x:ae.clientX,y:ae.clientY},pe.current=!1,G(!0),ae.target.setPointerCapture(ae.pointerId))},Yl=ae=>{if(!de)return;const He=Math.abs(ae.clientX-fe.current.x),ut=Math.abs(ae.clientY-fe.current.y);if(!pe.current&&(He>5||ut>5)&&(pe.current=!0),pe.current){const Ie=ae.clientX-ce.current.x,zt=ae.clientY-ce.current.y;Q(Mt=>({...Mt,x:Mt.x+Ie,y:Mt.y+zt})),ce.current={x:ae.clientX,y:ae.clientY}}},Mn=ae=>{G(!1),ae.target.releasePointerCapture(ae.pointerId)},Zs=ae=>{if(ae.preventDefault(),!V.current)return;const He=V.current.getBoundingClientRect(),Ie=Math.exp(-ae.deltaY*.0012),zt=Math.min(Math.max(B.scale*Ie,.005),40),Mt=ae.clientX-He.left,Cs=ae.clientY-He.top,hi=(Mt-B.x)/B.scale,jn=(Cs-B.y)/B.scale,qn=Mt-hi*zt,er=Cs-jn*zt;Q({x:qn,y:er,scale:zt})},Ts=ae=>{if(pe.current||!K||!se.current)return;const He=se.current.getBoundingClientRect(),ut=(ae.clientX-He.left)/He.width*100,Ie=(ae.clientY-He.top)/He.height*100;ut>=0&&ut<=100&&Ie>=0&&Ie<=100&&ne({x:ut,y:Ie})},Bn=async ae=>{var ut;const He=(ut=ae.target.files)==null?void 0:ut[0];if(He){y(!0),S(!1);try{const Ie=await at.uploadJobPrint(i.jobNumber,He);o(Ie),c([]),ne(null),C(1),O.current=null,U.current=null,xe(Ie.url)||R({width:0,height:0})}catch(Ie){alert("Upload failed: "+Ie.message)}finally{y(!1)}}},Jl=async()=>{if(!(!te||!ue||!s))try{const ae=e.find(Ie=>Ie.id===ue),He=ae?ae.ticketNo:"TKT",ut=await at.savePrintMarker({printId:s.id,ticketId:ue,xPercent:te.x,yPercent:te.y,pageNumber:A,label:He});c(Ie=>[...Ie,ut]),ne(null),F("")}catch(ae){alert("Failed to save marker: "+ae.message)}},da=async(ae,He)=>{if(He.stopPropagation(),!!confirm("Delete this pin?"))try{await at.deletePrintMarker(ae),c(ut=>ut.filter(Ie=>Ie.id!==ae)),X(null)}catch(ut){alert("Delete failed: "+ut.message)}},ha=l.filter(ae=>(ae.pageNumber||1)===A);return w.jsxs("div",{className:"fixed inset-0 z-[200] bg-slate-950 flex flex-col animate-in fade-in duration-300",children:[w.jsxs("div",{className:"absolute top-0 left-0 right-0 z-10 p-4 flex items-center justify-between pointer-events-none",children:[w.jsx("div",{className:"flex flex-col gap-1 pointer-events-auto",children:w.jsxs("div",{className:"bg-slate-900/80 backdrop-blur-md px-4 py-2 rounded-2xl border border-white/10 shadow-2xl flex items-center gap-3 transition-all",children:[w.jsx("div",{className:`w-8 h-8 ${Ye} rounded-xl flex items-center justify-center text-slate-900 shadow-lg transition-all duration-500`,children:w.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-white text-xs font-black uppercase tracking-widest",children:(s==null?void 0:s.fileName)||"Blueprint Vault"}),w.jsxs("p",{className:`${As} text-[8px] font-black uppercase tracking-tighter transition-all duration-500`,children:["Job #",i.jobNumber," Markup"]})]})]})}),w.jsxs("div",{className:"flex items-center gap-2 pointer-events-auto",children:[w.jsx("button",{onClick:()=>le(!K),className:`p-3 rounded-2xl border transition-all ${K?`${Ye} text-slate-900 border-white/20 shadow-lg`:"bg-slate-900/80 text-white border-white/10 backdrop-blur-md"}`,title:"Toggle Pin Mode",children:w.jsxs("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),w.jsx("button",{onClick:()=>{var ae;return(ae=Te.current)==null?void 0:ae.click()},className:"p-3 bg-slate-900/80 text-white border border-white/10 backdrop-blur-md rounded-2xl shadow-2xl transition-all active:scale-95",title:"Upload New Version",children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"})})}),w.jsx("button",{onClick:t,className:"p-3 bg-rose-600 text-white rounded-2xl shadow-2xl transition-all active:scale-95",children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M6 18L18 6M6 6l12 12"})})})]})]}),w.jsxs("div",{ref:V,className:"relative flex-1 overflow-hidden bg-slate-950 cursor-grab active:cursor-grabbing touch-none select-none",onPointerDown:ao,onPointerMove:Yl,onPointerUp:Mn,onWheel:Zs,onClick:Ts,children:[!b&&w.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center bg-slate-900/50 backdrop-blur-sm z-20",children:[w.jsx("div",{className:`w-12 h-12 border-4 ${Ye.replace("bg-","border-")} border-t-transparent rounded-full animate-spin mb-4 transition-colors`}),w.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400",children:"Synchronizing Vault Assets..."})]}),w.jsxs("div",{ref:se,className:"absolute origin-top-left transition-transform duration-75 ease-out",style:{transform:`translate(${B.x}px, ${B.y}px) scale(${B.scale})`,width:E.width||"100%",height:E.height||"100%"},children:[s?xe(s.url)?w.jsx("canvas",{ref:he,className:"shadow-2xl bg-white"}):w.jsx("img",{src:s.url,className:"shadow-2xl bg-white max-w-none",onLoad:ae=>{const He=ae.currentTarget;R({width:He.naturalWidth,height:He.naturalHeight})}}):w.jsxs("div",{className:"flex flex-col items-center justify-center h-full w-full text-slate-500",children:[w.jsx("svg",{className:"w-20 h-20 mb-4 opacity-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1",d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),w.jsx("p",{className:"text-sm font-black uppercase tracking-widest",children:"Workspace Offline"})]}),ha.map(ae=>{var zt;const He=e.find(Mt=>Mt.id===ae.ticketId),ut=He?Ks(He):$e.OTHER,Ie=z===ae.id;return w.jsx("div",{className:"absolute z-30 transition-transform ui-isolation",style:{left:`${ae.xPercent}%`,top:`${ae.yPercent}%`,transform:"translate(-50%, -50%)"},onMouseEnter:()=>!ke&&X(ae.id),onMouseLeave:()=>X(null),onClick:Mt=>{Mt.stopPropagation(),ke&&X(z===ae.id?null:ae.id)},children:w.jsxs("div",{className:"relative flex flex-col items-center",children:[w.jsx("div",{className:`w-8 h-8 rounded-full border-4 border-white shadow-2xl flex items-center justify-center transition-all ${KI(ut)} ${Ie?"scale-150 z-50":"scale-100"}`,children:w.jsx("span",{className:"text-[10px] font-black text-white",children:(zt=ae.label)==null?void 0:zt.slice(-2)})}),(Ie||ke&&z===ae.id)&&w.jsxs("div",{className:"absolute bottom-full mb-3 bg-slate-900 border border-white/20 p-4 rounded-2xl shadow-2xl min-w-[220px] animate-in zoom-in-95 duration-200 z-50",children:[w.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-slate-500 mb-1",children:"Asset Node"}),w.jsxs("p",{className:"text-sm font-black text-white mb-2",children:["TKT: ",ae.label]}),w.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:w.jsxs("span",{className:"text-[10px] font-bold text-slate-300 truncate max-w-full",children:["Loc: ",He==null?void 0:He.street]})}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx("button",{onClick:Mt=>{Mt.stopPropagation(),He!=null&&He.documentUrl&&n(He.documentUrl)},className:`flex-1 py-2 ${Ye} text-slate-900 rounded-lg text-[9px] font-black uppercase tracking-widest transition-colors`,children:"View Doc"}),w.jsx("button",{onClick:Mt=>da(ae.id,Mt),className:"p-2 bg-rose-500/10 text-rose-500 rounded-lg hover:bg-rose-500 hover:text-white transition-all",children:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]}),w.jsx("div",{className:"absolute top-full left-1/2 -translate-x-1/2 w-0 h-0 border-l-[8px] border-l-transparent border-r-[8px] border-r-transparent border-t-[8px] border-t-slate-900"})]})]})},ae.id)}),te&&w.jsx("div",{className:"absolute z-40 animate-bounce transition-transform",style:{left:`${te.x}%`,top:`${te.y}%`,transform:"translate(-50%, -50%)"},children:w.jsx("div",{className:`w-10 h-10 rounded-full ${Ye} border-4 border-white shadow-2xl flex items-center justify-center animate-pulse`,children:w.jsx("div",{className:"w-2.5 h-2.5 bg-slate-900 rounded-full"})})})]})]}),w.jsx("div",{className:"absolute bottom-6 left-0 right-0 flex justify-center pointer-events-none px-4",children:w.jsxs("div",{className:"flex flex-col gap-4 items-center w-full max-w-lg",children:[te&&w.jsxs("div",{className:"ui-isolation pointer-events-auto bg-slate-900/95 backdrop-blur-xl border border-white/20 p-6 rounded-[2.5rem] shadow-2xl w-full animate-in slide-in-from-bottom duration-300",children:[w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsx("h4",{className:"text-white font-black uppercase tracking-widest text-xs",children:"Finalize Node Placement"}),w.jsx("button",{onClick:()=>ne(null),className:"text-slate-500 hover:text-white transition-colors",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M6 18L18 6M6 6l12 12"})})})]}),w.jsxs("div",{className:"space-y-4",children:[w.jsxs("select",{className:"w-full bg-slate-800 text-white px-4 py-3 rounded-2xl border border-white/10 text-xs font-bold outline-none focus:ring-4 focus:ring-brand/20",value:ue,onChange:ae=>F(ae.target.value),children:[w.jsx("option",{value:"",children:"Select Compliance Reference..."}),e.filter(ae=>!ae.isArchived).map(ae=>w.jsxs("option",{value:ae.id,children:[ae.ticketNo," - ",ae.street]},ae.id))]}),w.jsx("div",{className:"flex gap-2",children:w.jsx("button",{onClick:Jl,disabled:!ue,className:`flex-1 ${Ye} text-slate-900 py-3 rounded-2xl font-black text-[10px] uppercase tracking-[0.2em] shadow-lg disabled:opacity-50 transition-all hover:scale-[1.02] active:scale-95`,children:"Commit Node Location"})})]})]}),k>1&&w.jsxs("div",{className:"ui-isolation pointer-events-auto flex items-center bg-slate-800/90 backdrop-blur px-4 py-2 rounded-2xl border border-white/10 shadow-2xl gap-4",children:[w.jsx("button",{disabled:A<=1||h,onClick:()=>C(ae=>Math.max(1,ae-1)),className:"p-3 text-white hover:bg-white/10 rounded-xl disabled:opacity-20 transition-all active:scale-90",children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M15 19l-7-7 7-7"})})}),w.jsxs("div",{className:"flex flex-col items-center min-w-[80px]",children:[w.jsx("span",{className:"text-[10px] font-black text-white uppercase tracking-widest",children:"Blueprint Page"}),w.jsxs("span",{className:`text-xs font-black ${As}`,children:[A," / ",k]})]}),w.jsx("button",{disabled:A>=k||h,onClick:()=>C(ae=>Math.min(k,ae+1)),className:"p-3 text-white hover:bg-white/10 rounded-xl disabled:opacity-20 transition-all active:scale-90",children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M9 5l7 7-7 7"})})})]}),w.jsxs("div",{className:"ui-isolation pointer-events-auto bg-slate-900/90 backdrop-blur-xl px-6 py-4 rounded-[2.5rem] border border-white/10 shadow-2xl flex items-center gap-6",children:[w.jsxs("div",{className:"flex items-center gap-2 pr-4 border-r border-white/10",children:[w.jsx("button",{onClick:()=>Q(ae=>({...ae,scale:ae.scale*1.5})),className:"p-2 text-white hover:bg-white/10 rounded-lg transition-colors",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 4v16m8-8H4"})})}),w.jsx("button",{onClick:()=>Q(ae=>({...ae,scale:ae.scale/1.5})),className:"p-2 text-white hover:bg-white/10 rounded-lg transition-colors",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M20 12H4"})})})]}),w.jsxs("button",{onClick:gn,className:"flex flex-col items-center text-slate-400 hover:text-brand transition-colors",children:[w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),w.jsx("span",{className:"text-[8px] font-black uppercase mt-1",children:"Recalibrate"})]}),w.jsx("div",{className:"w-px h-8 bg-white/10 mx-2"}),w.jsxs("div",{className:"flex flex-col items-end",children:[w.jsxs("span",{className:"text-[10px] font-black text-white uppercase tracking-widest",children:[l.length," Pinned"]}),w.jsx("span",{className:"text-[8px] font-bold text-slate-500 uppercase tracking-tighter",children:"Site Mapping"})]})]})]})}),w.jsx("input",{type:"file",ref:Te,className:"hidden",accept:"application/pdf,image/*",onChange:Bn})]})},sj=({tickets:i,isDarkMode:e,activeFilter:t,onFilterClick:n})=>{const s=i.reduce((c,d)=>{const h=Ks(d);return c[h]=(c[h]||0)+1,c},{}),o=i.filter(c=>c.noShowRequested).length,l=[{id:$e.VALID,label:"Sites Valid",value:s[$e.VALID]||0,color:"text-emerald-500",darkBorder:"border-emerald-500/20",activeBg:"bg-emerald-500/10 border-emerald-500"},{id:$e.EXTENDABLE,label:"Refresh",value:s[$e.EXTENDABLE]||0,color:"text-orange-500",description:"Expiring Soon",darkBorder:"border-orange-500/20",activeBg:"bg-orange-500/10 border-orange-500"},{id:$e.REFRESH_NEEDED,label:"Refresh Req",value:s[$e.REFRESH_NEEDED]||0,color:"text-amber-500",description:"Manual Request",darkBorder:"border-amber-500/20",activeBg:"bg-amber-500/10 border-amber-500"},{id:"NO_SHOW",label:"No Shows Req",value:o,color:"text-rose-500",description:"Call Ins Required",darkBorder:"border-rose-500/20",activeBg:"bg-rose-500/10 border-rose-500"},{id:$e.EXPIRED,label:"Expirations",value:s[$e.EXPIRED]||0,color:"text-rose-600",darkBorder:"border-rose-600/20",activeBg:"bg-rose-600/10 border-rose-600"}];return w.jsx("div",{className:"grid grid-cols-2 lg:grid-cols-5 gap-4",children:l.map(c=>{const d=t===c.id;return w.jsxs("button",{onClick:()=>n(d?null:c.id),className:`p-4 rounded-xl border transition-all text-left group relative cursor-pointer
              ${e?`${d?c.activeBg:`bg-[#1e293b] ${c.darkBorder}`} hover:border-white/20`:`${d?c.activeBg:"bg-white border-slate-300"} hover:border-slate-500`} shadow-sm active:scale-[0.98]`,children:[w.jsxs("div",{className:"flex justify-between items-start",children:[w.jsx("p",{className:`text-[9px] font-black uppercase tracking-widest mb-1 transition-colors ${d?c.color:e?"text-slate-400":"text-slate-950"}`,children:c.label}),c.value>0&&w.jsx("div",{className:`w-1.5 h-1.5 rounded-full ${c.color.replace("text","bg")}`})]}),w.jsx("p",{className:`text-2xl font-black tracking-tight ${c.color}`,children:c.value}),c.description&&w.jsx("p",{className:`text-[8px] font-bold uppercase mt-0.5 transition-all ${e?"text-slate-500 opacity-60":"text-slate-900"}`,children:c.description}),d&&w.jsx("div",{className:"absolute bottom-2 right-2",children:w.jsx("svg",{className:`w-3 h-3 ${c.color}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M6 18L18 6M6 6l12 12"})})})]},c.label)})})},rj=({tickets:i,jobs:e,isDarkMode:t,onJobSelect:n,onViewDoc:s})=>{const[o,l]=ee.useState("list"),[c,d]=ee.useState(!1),[h,p]=ee.useState(null),[y,b]=ee.useState(new Set),S=ee.useMemo(()=>{const A={};return i.forEach(C=>{A[C.jobNumber]||(A[C.jobNumber]={active:[],archived:[]}),C.isArchived?A[C.jobNumber].archived.push(C):A[C.jobNumber].active.push(C)}),A},[i]),E=ee.useMemo(()=>{let A=Object.keys(S);if(e.forEach(C=>{A.includes(C.jobNumber)||A.push(C.jobNumber)}),c){const C=new Set(e.filter(k=>k.isComplete).map(k=>k.jobNumber));A=A.filter(k=>!C.has(k))}return A.sort((C,k)=>k.localeCompare(C))},[S,c,e]),R=A=>{const C=new Set(y);C.has(A)?C.delete(A):C.add(A),b(C)};return w.jsxs("div",{className:"space-y-6",children:[w.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-xl font-black uppercase tracking-tight",children:"Project Documentation Review"}),w.jsx("p",{className:`text-[10px] font-bold uppercase tracking-widest mt-1 ${t?"text-slate-500":"text-slate-400"}`,children:"Historical Vault Access"})]}),w.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto justify-between md:justify-end",children:[w.jsxs("div",{className:`flex p-1 rounded-xl ${t?"bg-black/20":"bg-slate-200"}`,children:[w.jsx("button",{onClick:()=>l("thumbnail"),className:`px-4 py-1.5 rounded-lg text-[9px] font-black uppercase tracking-widest transition-all ${o==="thumbnail"?t?"bg-white/10 text-white shadow-lg":"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-400"}`,children:"Grid"}),w.jsx("button",{onClick:()=>l("list"),className:`px-4 py-1.5 rounded-lg text-[9px] font-black uppercase tracking-widest transition-all ${o==="list"?t?"bg-white/10 text-white shadow-lg":"bg-white text-slate-900 shadow-sm":"text-slate-500 hover:text-slate-400"}`,children:"List"})]}),w.jsxs("label",{className:"flex items-center gap-2 cursor-pointer select-none",children:[w.jsx("input",{type:"checkbox",className:"w-4 h-4 rounded-lg text-brand border-slate-300 focus:ring-brand/10",checked:c,onChange:()=>d(!c)}),w.jsx("span",{className:`text-[10px] font-black uppercase tracking-widest whitespace-nowrap ${t?"text-slate-500":"text-slate-700"}`,children:"Hide Completed"})]})]})]}),o==="thumbnail"?w.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:E.map(A=>{const C=e.find(B=>B.jobNumber===A),k=(C==null?void 0:C.isComplete)||!1,I=S[A]||{active:[],archived:[]},O=I.active,U=I.archived,P=h===A;return w.jsxs("div",{className:`p-5 rounded-2xl border transition-all flex flex-col h-full ${t?"bg-[#1e293b] border-white/5":"bg-white border-slate-200 shadow-sm"} ${k?"opacity-50 grayscale-[0.2]":""}`,children:[w.jsxs("div",{className:"flex justify-between items-start mb-4",children:[w.jsxs("div",{children:[w.jsxs("button",{onClick:()=>C&&n(C),className:`text-sm font-black uppercase tracking-tight text-left hover:text-brand transition-colors ${k?t?"text-slate-400":"text-slate-600":t?"text-white":"text-black"}`,title:"Manage Project",children:["Job #",A]}),w.jsx("p",{className:`text-[10px] font-bold uppercase tracking-widest mt-1 truncate max-w-[180px] ${t?"text-slate-400":"text-slate-700"}`,children:(C==null?void 0:C.customer)||"Unknown Client"})]}),k&&w.jsx("div",{className:"bg-emerald-500/10 text-emerald-500 px-2 py-0.5 rounded text-[8px] font-black uppercase",children:"Complete"})]}),w.jsxs("div",{className:"space-y-1.5 border-t border-black/5 pt-4 flex-1",children:[w.jsxs("p",{className:`text-[9px] font-black uppercase tracking-widest mb-2 flex justify-between ${t?"text-slate-400":"text-slate-700"}`,children:[w.jsx("span",{children:"Active Tickets"}),w.jsx("span",{children:O.length})]}),O.map(B=>{const Q=Ks(B);return w.jsxs("div",{className:"flex items-center justify-between text-[10px] font-bold py-1",children:[w.jsx("button",{onClick:()=>B.documentUrl&&(s==null?void 0:s(B.documentUrl)),className:`font-mono truncate max-w-[120px] transition-colors ${B.documentUrl?"hover:text-brand hover:underline cursor-zoom-in text-brand/80":t?"opacity-40 text-slate-500":"text-slate-600"}`,children:B.ticketNo}),w.jsx("span",{className:`px-1.5 py-0.5 rounded-md border uppercase text-[8px] ${gb(Q)}`,children:Q})]},B.id)}),U.length>0&&w.jsxs("div",{className:"mt-4 pt-4 border-t border-black/5",children:[w.jsxs("button",{onClick:()=>p(P?null:A),className:"flex items-center justify-between w-full group",children:[w.jsxs("span",{className:"text-[9px] font-black uppercase tracking-widest text-slate-500 group-hover:text-brand",children:["Archive History (",U.length,")"]}),w.jsx("svg",{className:`w-3 h-3 text-slate-400 transition-transform ${P?"rotate-180":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M19 9l-7 7-7-7"})})]}),P&&w.jsx("div",{className:"mt-2 space-y-1 animate-in slide-in-from-top-2",children:U.map(B=>w.jsxs("div",{className:"flex items-center justify-between text-[10px] font-bold py-1 opacity-40",children:[w.jsx("span",{className:"font-mono",children:B.ticketNo}),w.jsx("span",{className:"text-[8px] uppercase",children:new Date(B.expires).toLocaleDateString()})]},B.id))})]})]})]},A)})}):w.jsx("div",{className:`rounded-2xl border overflow-hidden ${t?"bg-[#1e293b] border-white/5":"bg-white border-slate-200 shadow-sm"}`,children:w.jsxs("table",{className:"w-full text-left",children:[w.jsx("thead",{className:`${t?"bg-black/20":"bg-slate-50"} border-b border-black/5`,children:w.jsxs("tr",{children:[w.jsx("th",{className:"px-6 py-4 text-[9px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Job Reference"}),w.jsx("th",{className:"px-6 py-4 text-[9px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Customer"}),w.jsx("th",{className:"px-6 py-4 text-[9px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Status"}),w.jsx("th",{className:"px-6 py-4 text-[9px] font-black uppercase tracking-[0.2em] text-slate-500 text-right",children:"Tickets"})]})}),w.jsx("tbody",{className:`divide-y ${t?"divide-white/5":"divide-slate-100"}`,children:E.map(A=>{const C=e.find(U=>U.jobNumber===A),k=S[A]||{active:[],archived:[]},I=k.active.length,O=y.has(A);return w.jsxs(ow.Fragment,{children:[w.jsxs("tr",{onClick:()=>R(A),className:`transition-all hover:bg-black/5 cursor-pointer group ${C!=null&&C.isComplete?"opacity-40":""} ${O?t?"bg-white/5":"bg-slate-50":""}`,children:[w.jsx("td",{className:"px-6 py-4",children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:`transition-transform duration-200 ${O?"rotate-90 text-brand":"text-slate-400 opacity-40"}`,children:w.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M9 5l7 7-7 7"})})}),w.jsxs("button",{onClick:U=>{U.stopPropagation(),C&&n(C)},className:`text-xs font-black uppercase hover:text-brand transition-colors ${t?"text-white":"text-black"}`,children:["#",A]})]})}),w.jsx("td",{className:"px-6 py-4 text-xs font-bold",children:(C==null?void 0:C.customer)||"Direct"}),w.jsx("td",{className:"px-6 py-4",children:w.jsx("span",{className:`px-2 py-0.5 rounded text-[8px] font-black uppercase ${C!=null&&C.isComplete?"bg-emerald-500/10 text-emerald-500":"bg-blue-500/10 text-blue-500"}`,children:C!=null&&C.isComplete?"Closed":"Active"})}),w.jsxs("td",{className:"px-6 py-4 text-right text-xs font-black",children:[I," Assets"]})]}),O&&w.jsx("tr",{className:`${t?"bg-black/10":"bg-slate-50/50"}`,children:w.jsx("td",{colSpan:4,className:"px-12 py-4",children:w.jsxs("div",{className:"space-y-3 animate-in fade-in slide-in-from-top-2 duration-300",children:[k.active.length>0?w.jsxs("div",{className:"space-y-1",children:[w.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-slate-400 mb-2",children:"Active Vault Entries"}),k.active.map(U=>{const P=Ks(U);return w.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-black/5 last:border-0",children:[w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsx("button",{onClick:()=>U.documentUrl&&(s==null?void 0:s(U.documentUrl)),className:`text-[10px] font-mono font-bold transition-colors ${U.documentUrl?"hover:text-brand hover:underline cursor-zoom-in text-brand/80":t?"opacity-40 text-slate-500":"text-slate-600"}`,children:U.ticketNo}),w.jsx("span",{className:`text-[10px] font-bold ${t?"text-slate-400":"text-slate-600"}`,children:U.street})]}),w.jsx("span",{className:`px-1.5 py-0.5 rounded-md border uppercase text-[8px] font-black ${gb(P)}`,children:P})]},U.id)})]}):null,k.archived.length>0?w.jsxs("div",{className:"space-y-1 pt-2",children:[w.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest text-slate-500 mb-2 opacity-50",children:"Archived Records"}),k.archived.map(U=>w.jsxs("div",{className:"flex items-center justify-between py-2 border-b border-black/5 last:border-0 opacity-40",children:[w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsx("span",{className:"text-[10px] font-mono font-bold",children:U.ticketNo}),w.jsx("span",{className:"text-[10px] font-bold",children:U.street})]}),w.jsxs("span",{className:"text-[9px] font-black uppercase tracking-tighter",children:["Expired ",new Date(U.expires).toLocaleDateString()]})]},U.id))]}):null,k.active.length===0&&k.archived.length===0&&w.jsx("p",{className:"text-[10px] font-bold text-slate-400 uppercase italic",children:"No tickets associated with this project folder yet."})]})})})]},A)})})]})})]})},oj=({photos:i,jobs:e,tickets:t,initialSearch:n=null,isDarkMode:s,onAddPhoto:o,onDeletePhoto:l})=>{var X,te;const[c,d]=ee.useState(""),[h,p]=ee.useState(n||null),[y,b]=ee.useState("all"),[S,E]=ee.useState(""),[R,A]=ee.useState(!1),[C,k]=ee.useState(new Set),[I,O]=ee.useState(null),[U,P]=ee.useState(!1),[B,Q]=ee.useState([]),K=ee.useRef(null);ee.useEffect(()=>{n&&(p(n),b("all"))},[n]);const le=ee.useMemo(()=>{const ne={};return e.forEach(ue=>{ue.jobNumber&&!ne[ue.jobNumber]&&(ne[ue.jobNumber]=[])}),i.forEach(ue=>{ne[ue.jobNumber]||(ne[ue.jobNumber]=[]),ne[ue.jobNumber].push({...ue,type:"photo"})}),t.forEach(ue=>{ue.documentUrl&&ue.jobNumber&&(ne[ue.jobNumber]||(ne[ue.jobNumber]=[]),ne[ue.jobNumber].push({id:ue.id,jobNumber:ue.jobNumber,dataUrl:ue.documentUrl,timestamp:ue.createdAt,caption:`Ticket Doc: ${ue.ticketNo}`,type:"ticket",ticketNo:ue.ticketNo}))}),ne},[i,e,t]),de=ee.useMemo(()=>Object.keys(le).filter(ne=>ne.toLowerCase().includes(c.toLowerCase())).sort((ne,ue)=>ue.localeCompare(ne)),[le,c]),G=ee.useMemo(()=>{if(!h)return[];let ne=le[h]||[];if(y==="photos")ne=ne.filter(ue=>ue.type==="photo");else if(y==="tickets")ne=ne.filter(ue=>ue.type==="ticket");else return[];return ne.filter(ue=>ue.caption.toLowerCase().includes(S.toLowerCase())).sort((ue,F)=>F.timestamp-ue.timestamp)},[le,h,S,y]),fe=ne=>{const ue=new Set(C);ue.has(ne)?ue.delete(ne):ue.add(ne),k(ue)},ce=async()=>{const ne=Array.from(C).filter(ue=>G.find(F=>F.id===ue&&F.type==="photo"));if(ne.length===0){alert("Ticket documents cannot be deleted from the Media tab. Manage them in the Vault or Job Review sections.");return}if(confirm(`Permanently delete ${ne.length} selected site photos? Ticket documents will be skipped.`)){for(const ue of ne)await l(ue);k(new Set),A(!1)}},pe=async ne=>{if(!h){alert("Select a project folder first.");return}P(!0);const ue=ne.map(F=>({id:Math.random().toString(36).substr(2,9),file:F,previewUrl:URL.createObjectURL(F),progress:0,status:"pending"}));Q(F=>[...F,...ue]);for(const F of ue){Q(V=>V.map(se=>se.id===F.id?{...se,status:"uploading"}:se));try{const V=setInterval(()=>{Q(se=>se.map(he=>he.id===F.id?{...he,progress:Math.min(he.progress+15,90)}:he))},150);await o({jobNumber:h,timestamp:Date.now(),caption:`Site Photo ${new Date().toLocaleDateString()}`},F.file),clearInterval(V),Q(se=>se.map(he=>he.id===F.id?{...he,status:"complete",progress:100}:he))}catch{Q(se=>se.map(he=>he.id===F.id?{...he,status:"error"}:he))}}P(!1),setTimeout(()=>{Q(F=>F.filter(V=>V.status!=="complete"))},4e3)},z=ne=>ne.toLowerCase().endsWith(".pdf");return w.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 animate-in h-[calc(100vh-140px)] -mt-2 overflow-hidden",children:[w.jsxs("aside",{className:`lg:w-72 shrink-0 flex flex-col rounded-3xl border overflow-hidden ${s?"bg-[#1e293b] border-white/5":"bg-white border-slate-200 shadow-sm"}`,children:[w.jsxs("div",{className:"p-4 border-b border-black/5 bg-black/5",children:[w.jsxs("h3",{className:"text-[10px] font-black uppercase tracking-widest text-slate-400 mb-3 flex items-center gap-2",children:[w.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})}),"Job Directory"]}),w.jsxs("div",{className:"relative",children:[w.jsx("input",{type:"text",placeholder:"Search directory...",className:`w-full pl-8 pr-3 py-2 text-[11px] font-bold rounded-xl border outline-none transition-all ${s?"bg-black/20 border-white/5 text-white":"bg-white border-slate-100"}`,value:c,onChange:ne=>d(ne.target.value)}),w.jsx("svg",{className:"w-3.5 h-3.5 text-slate-500 absolute left-2.5 top-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]}),w.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar p-2 space-y-1",children:de.map(ne=>{const ue=le[ne].length,F=h===ne;return w.jsxs("button",{onClick:()=>{p(ne),b("all"),E("")},className:`w-full flex items-center justify-between p-3 rounded-2xl transition-all group ${F?"bg-brand text-slate-900 shadow-lg shadow-brand/10":s?"text-slate-400 hover:bg-white/5":"text-slate-600 hover:bg-slate-50"}`,children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:`w-8 h-8 rounded-xl flex items-center justify-center transition-colors ${F?"bg-white/20":s?"bg-white/5":"bg-slate-100"}`,children:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),w.jsxs("span",{className:"text-[11px] font-black uppercase tracking-tight",children:["#",ne]})]}),w.jsx("span",{className:`text-[9px] font-black px-1.5 py-0.5 rounded-lg ${F?"bg-white/20":"bg-black/5 text-slate-400"}`,children:ue})]},ne)})})]}),w.jsxs("main",{className:"flex-1 flex flex-col min-w-0",children:[w.jsx("div",{className:`mb-4 flex flex-col gap-4 p-4 rounded-3xl border ${s?"bg-[#1e293b] border-white/5":"bg-white border-slate-200 shadow-sm"}`,children:w.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:`w-12 h-12 rounded-2xl flex items-center justify-center ${s?"bg-white/5 text-brand":"bg-brand/10 text-brand"}`,children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),w.jsxs("div",{children:[w.jsx("h2",{className:"text-sm font-black uppercase tracking-widest",children:h?`Job #${h}`:"Asset Vault"}),w.jsxs("div",{className:"flex items-center gap-2 mt-0.5",children:[w.jsx("button",{onClick:()=>{b("all"),E("")},className:`text-[9px] font-black uppercase tracking-tighter hover:text-brand transition-colors ${y==="all"?"text-brand underline underline-offset-4":"text-slate-400"}`,children:"Overview"}),y!=="all"&&w.jsxs(w.Fragment,{children:[w.jsx("span",{className:"text-slate-700 text-[10px]",children:"/"}),w.jsx("span",{className:"text-[9px] font-black uppercase tracking-tighter text-brand",children:y==="photos"?"Site Photos":"Ticket Vault"})]})]})]})]}),h&&y!=="all"&&w.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto animate-in fade-in slide-in-from-right",children:[w.jsxs("div",{className:"relative flex-1 sm:w-48",children:[w.jsx("input",{type:"text",placeholder:"Search folder...",className:`w-full pl-8 pr-3 py-2 text-[11px] font-bold rounded-xl border outline-none transition-all ${s?"bg-black/20 border-white/5 text-white":"bg-slate-50 border-slate-100"}`,value:S,onChange:ne=>E(ne.target.value)}),w.jsx("svg",{className:"w-3.5 h-3.5 text-slate-500 absolute left-2.5 top-2.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]}),w.jsx("button",{onClick:()=>{A(!R),k(new Set)},className:`p-2 rounded-xl border transition-all ${R?"bg-brand border-brand text-slate-900 shadow-lg":s?"bg-white/5 border-white/5 text-slate-400 hover:text-white":"bg-slate-100 border-slate-100 text-slate-600 hover:text-brand"}`,title:"Bulk Selection",children:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"})})}),y==="photos"&&w.jsx("button",{onClick:()=>{var ne;return(ne=K.current)==null?void 0:ne.click()},className:"p-2 rounded-xl bg-brand border border-brand text-slate-900 shadow-lg shadow-brand/20 hover:scale-105 active:scale-95 transition-all",children:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M12 4v16m8-8H4"})})})]})]})}),w.jsx("div",{className:"flex-1 overflow-y-auto no-scrollbar pb-10",children:h?w.jsx("div",{className:"animate-in fade-in duration-500",children:y==="all"?w.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-6 pt-4",children:[w.jsxs("button",{onClick:()=>b("photos"),className:`group p-8 rounded-[2.5rem] border text-left transition-all hover:scale-[1.02] active:scale-[0.98] flex flex-col gap-6 ${s?"bg-white/5 border-white/5 hover:bg-white/10":"bg-white border-slate-200 shadow-xl shadow-slate-200/40"}`,children:[w.jsx("div",{className:"w-16 h-16 rounded-[1.5rem] bg-brand/10 text-brand flex items-center justify-center transition-transform group-hover:scale-110",children:w.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-black uppercase tracking-[0.2em]",children:"Site Photos"}),w.jsxs("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest mt-1",children:[((X=le[h])==null?void 0:X.filter(ne=>ne.type==="photo").length)||0," Registered Assets"]})]})]}),w.jsxs("button",{onClick:()=>b("tickets"),className:`group p-8 rounded-[2.5rem] border text-left transition-all hover:scale-[1.02] active:scale-[0.98] flex flex-col gap-6 ${s?"bg-white/5 border-white/5 hover:bg-white/10":"bg-white border-slate-200 shadow-xl shadow-slate-200/40"}`,children:[w.jsx("div",{className:"w-16 h-16 rounded-[1.5rem] bg-rose-500/10 text-rose-500 flex items-center justify-center transition-transform group-hover:scale-110",children:w.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M7 21h10a2 2 0 002-2V9.414a1 1 0 00-.293-.707l-5.414-5.414A1 1 0 0012.586 3H7a2 2 0 00-2 2v14a2 2 0 002 2z"})})}),w.jsxs("div",{children:[w.jsx("h3",{className:"text-sm font-black uppercase tracking-[0.2em]",children:"Ticket Vault"}),w.jsxs("p",{className:"text-[10px] font-black text-slate-500 uppercase tracking-widest mt-1",children:[((te=le[h])==null?void 0:te.filter(ne=>ne.type==="ticket").length)||0," Compliance PDFs"]})]})]})]}):w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"flex items-center gap-4 mb-6 animate-in slide-in-from-left",children:w.jsxs("button",{onClick:()=>{b("all"),E("")},className:`flex items-center gap-2 px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${s?"bg-white/5 text-slate-400 hover:text-white":"bg-slate-100 text-slate-600 hover:text-brand"}`,children:[w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})}),"Exit Folder"]})}),G.length>0?w.jsx("div",{className:"columns-1 sm:columns-2 lg:columns-3 xl:columns-4 gap-4 space-y-4",children:G.map((ne,ue)=>{const F=C.has(ne.id),V=ne.type==="ticket",se=z(ne.dataUrl);return w.jsxs("div",{onClick:()=>R?fe(ne.id):O(ue),className:`break-inside-avoid relative group rounded-[2rem] border overflow-hidden transition-all duration-500 cursor-pointer ${F?"ring-4 ring-brand border-brand scale-[0.98]":s?"bg-[#1e293b] border-white/5":"bg-white border-slate-100 shadow-sm"}`,children:[w.jsx("div",{className:"relative aspect-auto min-h-[100px] overflow-hidden flex items-center justify-center bg-black/10",children:se?w.jsxs("div",{className:"w-full py-16 flex flex-col items-center justify-center bg-slate-800 text-white gap-3",children:[w.jsxs("svg",{className:"w-12 h-12 text-rose-500",fill:"currentColor",viewBox:"0 0 24 24",children:[w.jsx("path",{d:"M11.363 2c4.155 0 2.637 6 2.637 6s6-1.518 6 2.638v11.362c0 .552-.448 1-1 1H5c-.552 0-1-.448-1-1V3c0-.552.448-1 1-1h6.363zM12 2H5c-1.103 0-2 .897-2 2v16c0 1.103.897 2 2 2h14c1.103 0 2-.897 2-2V9l-7-7z"}),w.jsx("path",{d:"M19 9h-7V2l7 7z"})]}),w.jsx("span",{className:"text-[10px] font-black uppercase tracking-widest opacity-60",children:"PDF Document"})]}):w.jsx("img",{src:ne.dataUrl,className:"w-full h-auto object-cover group-hover:scale-110 transition-transform duration-1000",loading:"lazy"})}),w.jsx("div",{className:`absolute inset-0 bg-black/40 transition-opacity flex items-center justify-center gap-2 ${R?"opacity-100":"opacity-0 group-hover:opacity-100"}`,children:R?w.jsx("div",{className:`w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all ${F?"bg-brand border-brand":"bg-white/20 border-white/40"}`,children:F&&w.jsx("svg",{className:"w-5 h-5 text-slate-900",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})}):w.jsx("div",{className:"p-3 bg-white/10 backdrop-blur-md rounded-2xl border border-white/20 text-white scale-90 group-hover:scale-100 transition-all",children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})}),w.jsx("div",{className:"absolute bottom-3 left-3 right-3 flex justify-between items-end",children:w.jsx("div",{className:`px-3 py-1.5 rounded-xl backdrop-blur-md border border-white/10 text-[9px] font-black text-white uppercase tracking-widest max-w-[80%] truncate ${V?"bg-rose-600/80":"bg-black/60"}`,children:ne.caption})})]},ne.id)})}):w.jsxs("div",{className:"h-full flex flex-col items-center justify-center opacity-30 text-center py-20",children:[w.jsx("div",{className:"w-20 h-20 rounded-[2.5rem] bg-brand/10 text-brand flex items-center justify-center mb-6",children:w.jsx("svg",{className:"w-10 h-10",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"})})}),w.jsx("h3",{className:"text-sm font-black uppercase tracking-widest",children:"Folder Empty"}),w.jsx("p",{className:"text-[10px] font-bold uppercase tracking-tighter mt-1",children:"No assets match your search in this bucket"})]})]})}):w.jsxs("div",{className:"h-full flex flex-col items-center justify-center text-center p-10",children:[w.jsxs("div",{className:"relative mb-12 animate-bounce duration-[2000ms]",children:[w.jsx("div",{className:"w-32 h-32 rounded-[3.5rem] bg-brand/5 border-2 border-dashed border-brand/20 flex items-center justify-center",children:w.jsx("svg",{className:"w-16 h-16 text-brand/20",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),w.jsx("div",{className:"absolute -bottom-4 -right-4 w-12 h-12 bg-brand rounded-full flex items-center justify-center text-slate-900 shadow-xl border-4 border-[#0f172a]",children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M12 4v16m8-8H4"})})})]}),w.jsx("h2",{className:"text-lg font-black uppercase tracking-[0.2em] text-slate-500",children:"Workspace Selection Required"}),w.jsx("p",{className:"max-w-xs text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-3 leading-relaxed",children:"Select a job directory from the explorer on the left to browse site photos and compliance documentation."})]})})]}),R&&C.size>0&&w.jsx("div",{className:"fixed bottom-28 left-1/2 -translate-x-1/2 z-[100] animate-in slide-in-from-bottom",children:w.jsxs("div",{className:"bg-slate-950/90 backdrop-blur-xl border border-white/10 px-6 py-4 rounded-[2rem] shadow-2xl flex items-center gap-6",children:[w.jsxs("div",{className:"flex flex-col",children:[w.jsxs("span",{className:"text-[10px] font-black text-brand uppercase tracking-widest",children:[C.size," Items Selected"]}),w.jsx("span",{className:"text-[8px] font-bold text-slate-500 uppercase tracking-tighter",children:"Bulk Management"})]}),w.jsx("div",{className:"w-px h-8 bg-white/10"}),w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("button",{onClick:ce,className:"px-4 py-2 bg-rose-500 text-white rounded-xl font-black text-[9px] uppercase tracking-widest hover:bg-rose-600 transition-all flex items-center gap-2",children:[w.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete Selected"]}),w.jsx("button",{onClick:()=>A(!1),className:"px-4 py-2 bg-white/5 text-slate-400 rounded-xl font-black text-[9px] uppercase tracking-widest hover:text-white transition-all",children:"Dismiss"})]})]})}),I!==null&&w.jsxs("div",{className:"fixed inset-0 z-[250] bg-slate-950/98 backdrop-blur-xl flex flex-col animate-in fade-in zoom-in duration-300",children:[w.jsxs("div",{className:"flex justify-between items-center p-6 lg:p-10 shrink-0",children:[w.jsxs("div",{className:"flex flex-col",children:[w.jsxs("h4",{className:"text-white font-black uppercase tracking-widest text-sm",children:["Job #",h," Media Archive"]}),w.jsx("p",{className:"text-brand text-[10px] font-black uppercase tracking-tighter mt-1",children:"Professional Documentation Preview"})]}),w.jsx("button",{onClick:()=>O(null),className:"p-4 bg-white/10 hover:bg-white/20 rounded-full text-white transition-all active:scale-90",children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M6 18L18 6M6 6l12 12"})})})]}),w.jsxs("div",{className:"flex-1 flex flex-col lg:flex-row items-center justify-center p-6 gap-10 overflow-hidden",children:[w.jsx("button",{disabled:I===0,onClick:()=>O(I-1),className:"hidden lg:flex p-6 rounded-full bg-white/5 text-white hover:bg-white/10 disabled:opacity-0 transition-all",children:w.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M15 19l-7-7 7-7"})})}),w.jsxs("div",{className:"relative group max-w-full max-h-full flex items-center justify-center flex-1",children:[w.jsx("div",{className:"w-full max-w-5xl h-full flex items-center justify-center overflow-hidden",children:z(G[I].dataUrl)?w.jsx("iframe",{src:`${G[I].dataUrl}#toolbar=0`,className:"w-full h-full min-h-[60vh] rounded-[2rem] border border-white/10 bg-white"}):w.jsx("img",{src:G[I].dataUrl,className:"max-w-full max-h-[70vh] rounded-[2rem] shadow-2xl border border-white/10 object-contain"})}),w.jsx("div",{className:"absolute -bottom-16 left-1/2 -translate-x-1/2 lg:relative lg:translate-x-0 lg:bottom-0 lg:ml-10 bg-slate-900/50 backdrop-blur-md border border-white/10 p-6 rounded-[2.5rem] w-full lg:w-80 shrink-0 animate-in slide-in-from-right",children:w.jsxs("div",{className:"space-y-4",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("span",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest",children:"Description"}),w.jsx("p",{className:"text-xs font-bold text-white leading-relaxed",children:G[I].caption})]}),w.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[w.jsxs("div",{className:"space-y-1",children:[w.jsx("span",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest",children:"Entry Date"}),w.jsx("p",{className:"text-[10px] font-black text-brand uppercase",children:new Date(G[I].timestamp).toLocaleDateString()})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("span",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest",children:"Category"}),w.jsx("p",{className:`text-[10px] font-black uppercase ${G[I].type==="ticket"?"text-rose-500":"text-emerald-500"}`,children:G[I].type==="ticket"?"Ticket PDF":"Site Photo"})]})]}),w.jsx("div",{className:"pt-4 border-t border-white/5 flex gap-2",children:w.jsx("a",{href:G[I].dataUrl,target:"_blank",rel:"noopener noreferrer",className:"flex-1 py-3 rounded-2xl bg-brand text-slate-900 font-black text-[9px] uppercase tracking-widest text-center hover:scale-105 transition-all",children:"Open Full Asset"})})]})})]}),w.jsx("button",{disabled:I===G.length-1,onClick:()=>O(I+1),className:"hidden lg:flex p-6 rounded-full bg-white/5 text-white hover:bg-white/10 disabled:opacity-0 transition-all",children:w.jsx("svg",{className:"w-8 h-8",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M9 5l7 7-7 7"})})})]}),w.jsx("div",{className:"p-8 hidden lg:flex items-center justify-center gap-2 overflow-x-auto no-scrollbar",children:G.map((ne,ue)=>w.jsx("button",{onClick:()=>O(ue),className:`w-14 h-14 rounded-xl border-2 transition-all shrink-0 overflow-hidden flex items-center justify-center ${I===ue?"border-brand scale-110 shadow-lg":"border-transparent opacity-40 hover:opacity-100"} bg-slate-800`,children:z(ne.dataUrl)?w.jsx("svg",{className:"w-6 h-6 text-rose-500",fill:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{d:"M11.363 2c4.155 0 2.637 6 2.637 6s6-1.518 6 2.638v11.362c0 .552-.448 1-1 1H5c-.552 0-1-.448-1-1V3c0-.552.448-1 1-1h6.363z"})}):w.jsx("img",{src:ne.dataUrl,className:"w-full h-full object-cover"})},ne.id))})]}),B.length>0&&w.jsx("div",{className:"fixed bottom-24 right-6 w-80 z-[200] animate-in slide-in-from-right",children:w.jsxs("div",{className:`${s?"bg-slate-900/95 border-white/10":"bg-white border-slate-200 shadow-2xl"} backdrop-blur-xl border rounded-[2rem] overflow-hidden`,children:[w.jsxs("div",{className:"px-5 py-4 border-b border-black/5 flex items-center justify-between bg-black/5",children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:`w-8 h-8 rounded-xl flex items-center justify-center ${U?"bg-brand text-slate-900":"bg-emerald-500 text-white"}`,children:U?w.jsx("div",{className:"w-4 h-4 border-2 border-slate-900 border-t-transparent rounded-full animate-spin"}):w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})}),w.jsxs("div",{children:[w.jsx("h4",{className:"text-[10px] font-black uppercase tracking-widest",children:U?"Syncing...":"Sync Complete"}),w.jsx("p",{className:"text-[8px] font-bold text-slate-500 uppercase tracking-tighter",children:"Documentation Pipeline"})]})]}),w.jsx("button",{onClick:()=>Q([]),className:"p-2 text-slate-400 hover:text-rose-500 transition-colors",children:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M6 18L18 6M6 6l12 12"})})})]}),w.jsx("div",{className:"max-h-60 overflow-y-auto no-scrollbar p-3 space-y-2",children:B.map(ne=>w.jsxs("div",{className:"flex items-center gap-3 p-2 rounded-2xl bg-black/5 border border-black/5",children:[w.jsx("div",{className:"w-10 h-10 rounded-xl overflow-hidden shrink-0 border border-black/10",children:w.jsx("img",{src:ne.previewUrl,className:"w-full h-full object-cover"})}),w.jsxs("div",{className:"flex-1 min-w-0",children:[w.jsx("p",{className:"text-[9px] font-black uppercase tracking-tight truncate",children:ne.file.name}),w.jsx("div",{className:"w-full h-1 bg-black/10 rounded-full mt-1 overflow-hidden",children:w.jsx("div",{className:`h-full transition-all duration-300 ${ne.status==="error"?"bg-rose-500":"bg-brand"}`,style:{width:`${ne.progress}%`}})})]}),ne.status==="complete"&&w.jsx("svg",{className:"w-4 h-4 text-emerald-500 shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M5 13l4 4L19 7"})})]},ne.id))})]})}),w.jsx("input",{type:"file",multiple:!0,ref:K,className:"hidden",accept:"image/*",onChange:ne=>pe(Array.from(ne.target.files||[]))})]})},aj=({tickets:i,onEditTicket:e,onViewDoc:t})=>{const[n,s]=ee.useState(new Date),[o,l]=ee.useState(new Date().getDate()),c=n.getFullYear(),d=n.getMonth(),h=(A,C)=>new Date(A,C+1,0).getDate(),p=(A,C)=>new Date(A,C,1).getDay(),y=(A,C)=>A.getDate()===C.getDate()&&A.getMonth()===C.getMonth()&&A.getFullYear()===C.getFullYear(),b=ee.useMemo(()=>{const A=[],C=h(c,d),k=p(c,d),I=new Date;for(let O=0;O<k;O++)A.push(null);for(let O=1;O<=C;O++){const U=new Date(c,d,O),P=[];i.forEach(B=>{const Q=new Date(B.workDate),K=new Date(B.expires),le=new Date(K);le.setDate(le.getDate()-3),y(Q,U)&&P.push({ticket:B,type:"start"}),y(K,U)&&P.push({ticket:B,type:"expire"}),y(le,U)&&P.push({ticket:B,type:"refresh"}),y(I,U)&&(B.noShowRequested&&P.push({ticket:B,type:"noShowRequest"}),B.refreshRequested&&P.push({ticket:B,type:"manualRefreshRequest"}))}),A.push({day:O,events:P})}return A},[c,d,i]),S=ee.useMemo(()=>{if(o===null)return[];const A=new Date(c,d,o),C=new Date,k=[];return i.forEach(I=>{const O=new Date(I.workDate),U=new Date(I.expires),P=new Date(U);P.setDate(P.getDate()-3),y(O,A)&&k.push({ticket:I,type:"start"}),y(U,A)&&k.push({ticket:I,type:"expire"}),y(P,A)&&k.push({ticket:I,type:"refresh"}),y(C,A)&&(I.noShowRequested&&k.push({ticket:I,type:"noShowRequest"}),I.refreshRequested&&k.push({ticket:I,type:"manualRefreshRequest"}))}),k},[o,d,c,i]),E=ee.useMemo(()=>i.filter(A=>A.noShowRequested||A.refreshRequested),[i]),R=n.toLocaleString("default",{month:"long"});return w.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[w.jsxs("div",{className:"lg:col-span-3 bg-white rounded-3xl shadow-sm border border-slate-200 overflow-hidden",children:[w.jsxs("div",{className:"p-6 border-b border-slate-100 flex items-center justify-between bg-slate-50/50",children:[w.jsxs("div",{className:"flex items-center gap-4",children:[w.jsxs("h2",{className:"text-xl font-black text-slate-800 uppercase tracking-tight",children:[R," ",c]}),E.length>0&&w.jsxs("span",{className:"flex items-center gap-1.5 px-3 py-1 bg-rose-500 rounded-full text-[9px] font-black text-white uppercase tracking-widest animate-pulse",children:[w.jsx("span",{className:"w-1.5 h-1.5 bg-white rounded-full"}),E.length," Action Items"]})]}),w.jsxs("div",{className:"flex gap-2",children:[w.jsx("button",{onClick:()=>s(new Date(c,d-1,1)),className:"p-2 hover:bg-white rounded-lg transition-colors border border-slate-200 shadow-sm",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M15 19l-7-7 7-7"})})}),w.jsx("button",{onClick:()=>s(new Date(c,d+1,1)),className:"p-2 hover:bg-white rounded-lg transition-colors border border-slate-200 shadow-sm",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M9 5l7 7-7 7"})})})]})]}),w.jsx("div",{className:"grid grid-cols-7 border-b border-slate-100",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(A=>w.jsx("div",{className:"py-3 text-center text-[10px] font-black text-slate-400 uppercase tracking-widest",children:A},A))}),w.jsx("div",{className:"grid grid-cols-7 auto-rows-fr min-h-[500px]",children:b.map((A,C)=>w.jsx("div",{onClick:()=>A&&l(A.day),className:`p-2 border-r border-b border-slate-50 min-h-[100px] cursor-pointer transition-all ${A?"bg-white hover:bg-slate-50/40":"bg-slate-50/20"} ${(A==null?void 0:A.day)===o?"ring-2 ring-inset ring-brand bg-brand/5":""}`,children:A&&w.jsxs("div",{className:"h-full flex flex-col",children:[w.jsx("span",{className:`text-xs font-black w-6 h-6 flex items-center justify-center rounded-full ${A.day===new Date().getDate()&&d===new Date().getMonth()&&c===new Date().getFullYear()?"text-white bg-slate-900":"text-slate-400"}`,children:A.day}),w.jsx("div",{className:"flex flex-wrap gap-1 mt-auto pb-1",children:A.events.map((k,I)=>w.jsx("div",{className:`w-2.5 h-2.5 rounded-full border-2 border-white shadow-sm ${k.type==="start"?"bg-blue-500":k.type==="expire"?"bg-red-600":k.type==="refresh"?"bg-orange-400":k.type==="noShowRequest"?"bg-rose-500 ring-2 ring-rose-500/20":"bg-amber-400 ring-2 ring-amber-500/20"}`,title:`${k.type.toUpperCase()}: ${k.ticket.ticketNo}`},I))})]})},C))})]}),w.jsxs("div",{className:"bg-white rounded-3xl shadow-sm border border-slate-200 p-6 flex flex-col",children:[w.jsxs("h3",{className:"text-sm font-black text-slate-800 uppercase tracking-widest mb-6 border-b border-slate-100 pb-4 flex justify-between items-center",children:[w.jsx("span",{children:"Schedule & Alerts"}),o&&w.jsxs("span",{className:"text-[10px] text-slate-400 font-bold",children:[R.substring(0,3)," ",o]})]}),w.jsxs("div",{className:"space-y-6 flex-1 overflow-y-auto no-scrollbar pr-1",children:[E.length>0&&o===new Date().getDate()&&w.jsxs("div",{className:"space-y-3",children:[w.jsx("p",{className:"text-[9px] font-black text-rose-500 uppercase tracking-[0.2em]",children:"Priority Actions"}),E.map(A=>w.jsxs("div",{onClick:()=>e(A),className:"p-4 bg-rose-50 rounded-2xl border border-rose-100 hover:border-rose-300 hover:shadow-md transition-all cursor-pointer group relative overflow-hidden",children:[w.jsx("div",{className:"absolute top-0 right-0 w-16 h-16 -mr-4 -mt-4 bg-rose-500/5 rounded-full group-hover:bg-rose-500/10 transition-colors"}),w.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[w.jsx("span",{className:`text-[8px] font-black uppercase px-2 py-0.5 rounded-md ${A.noShowRequested?"bg-rose-500 text-white":"bg-amber-500 text-white"}`,children:A.noShowRequested?"No Show Event":"Refresh Manual"}),w.jsx("span",{className:"w-1.5 h-1.5 bg-rose-500 rounded-full animate-ping"})]}),w.jsxs("p",{className:"text-xs font-black text-slate-800 truncate mb-1",children:["#",A.jobNumber,"  ",A.street]}),w.jsxs("button",{onClick:C=>{C.stopPropagation(),A.documentUrl&&(t==null||t(A.documentUrl))},className:`text-[9px] font-mono font-bold uppercase tracking-tighter transition-colors ${A.documentUrl?"text-rose-400 hover:text-brand hover:underline cursor-zoom-in":"text-rose-400 cursor-default"}`,children:["CALL REQUIRED: ",A.ticketNo]})]},A.id))]}),w.jsxs("div",{className:"space-y-4",children:[w.jsx("p",{className:"text-[9px] font-black text-slate-400 uppercase tracking-[0.2em]",children:S.length>0?"Standard Schedule":""}),S.filter(A=>!["noShowRequest","manualRefreshRequest"].includes(A.type)).length>0?S.filter(A=>!["noShowRequest","manualRefreshRequest"].includes(A.type)).map((A,C)=>w.jsxs("div",{onClick:()=>e(A.ticket),className:"p-4 bg-slate-50 rounded-2xl border border-slate-100 hover:border-brand/40 hover:shadow-md transition-all cursor-pointer group",children:[w.jsxs("div",{className:"flex justify-between items-start mb-2",children:[w.jsx("span",{className:`text-[9px] font-black uppercase px-2 py-0.5 rounded-md ${A.type==="start"?"bg-blue-100 text-blue-700":A.type==="expire"?"bg-red-100 text-red-700":"bg-orange-100 text-orange-800"}`,children:A.type==="start"?"Dig Start":A.type==="expire"?"Expires":"Refresh Window"}),w.jsx("div",{className:`w-2.5 h-2.5 rounded-full border border-white shadow-sm ${A.type==="start"?"bg-blue-500":A.type==="expire"?"bg-red-600":"bg-orange-400"}`})]}),w.jsxs("p",{className:"text-xs font-black text-slate-800 truncate mb-1",children:["#",A.ticket.jobNumber,"  ",A.ticket.street]}),w.jsxs("button",{onClick:k=>{k.stopPropagation(),A.ticket.documentUrl&&(t==null||t(A.ticket.documentUrl))},className:`text-[9px] font-mono font-bold transition-colors ${A.ticket.documentUrl?"text-slate-400 hover:text-brand hover:underline cursor-zoom-in":"text-slate-400 cursor-default"}`,children:["TKT: ",A.ticket.ticketNo]})]},C)):o&&E.length===0&&w.jsxs("div",{className:"py-20 flex flex-col items-center opacity-30",children:[w.jsx("svg",{className:"w-10 h-10 text-slate-300 mb-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})}),w.jsx("p",{className:"text-[10px] text-slate-400 font-black uppercase tracking-widest text-center",children:"No Activity Scheduled"})]})]})]})]})]})},lj=[{name:"Safety Orange",hex:"#f59e0b"},{name:"Electric Blue",hex:"#3b82f6"},{name:"Construction Yellow",hex:"#fbbf24"},{name:"Utility Pink",hex:"#ec4899"},{name:"Safety Green",hex:"#10b981"},{name:"Gas Yellow",hex:"#eab308"},{name:"Water Blue",hex:"#0ea5e9"},{name:"Sewer Green",hex:"#65a30d"},{name:"Telecom Orange",hex:"#ea580c"},{name:"Power Red",hex:"#e11d48"}],cj=({users:i=[],sessionUser:e,isDarkMode:t,hasApiKey:n,onDeleteUser:s,onThemeChange:o,onToggleRole:l,onOpenSelectKey:c})=>{const[d,h]=ee.useState(!1),[p,y]=ee.useState(Notification.permission),[b,S]=ee.useState(!1),E=(e==null?void 0:e.role)===Di.ADMIN,R=async()=>{S(!0);try{const C=await Notification.requestPermission();if(y(C),C==="granted"){const k=await navigator.serviceWorker.ready;try{const I=await k.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:"BMuI79vwIgC-aZR9pJOBtg0HU6r_WmLVWZXY97jYxgnyHLDzSe7JbWwFqMALq3OsC7vCbgdyxI_fTyATo_GLvwY"});await at.savePushSubscription(e.id,I),alert("Push notifications enabled successfully.")}catch(I){console.warn("Push subscription failed:",I),alert("Native alerts enabled for this browser session.")}}}catch{alert("Notification setup failed.")}finally{S(!1)}},A=async()=>{if(e){h(!0);try{await at.addUser({id:e.id,name:e.name,username:e.username,role:e.role}),alert("Success: Your local profile is now synchronized with the cloud."),window.location.reload()}catch(C){alert(`Sync Failed: ${C.message}`)}finally{h(!1)}}};return w.jsxs("div",{className:"space-y-8 animate-in",children:[w.jsxs("section",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[E&&w.jsx("div",{className:`p-6 rounded-2xl border ${t?"bg-[#1e293b] border-white/5":"bg-white border-slate-100 shadow-sm"}`,children:w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsxs("div",{children:[w.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-2",children:[w.jsx("svg",{className:"w-4 h-4 text-brand",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"})}),"Desktop Alerts"]}),w.jsx("p",{className:`text-[10px] font-bold uppercase tracking-tighter mt-1 ${t?"text-slate-500":"text-slate-400"}`,children:"Browser Push Notifications"})]}),w.jsx("button",{onClick:R,disabled:p==="granted"||b,className:`px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${p==="granted"?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20":"bg-brand text-slate-900 shadow-lg shadow-brand/20 hover:scale-105 active:scale-95"}`,children:b?"...":p==="granted"?"Enabled":"Enable"})]})}),w.jsx("div",{className:`p-6 rounded-2xl border ${t?"bg-[#1e293b] border-white/5":"bg-white border-slate-100 shadow-sm"}`,children:w.jsxs("div",{className:"flex items-center justify-between mb-4",children:[w.jsxs("div",{children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400 flex items-center gap-2",children:[w.jsx("svg",{className:"w-4 h-4 text-purple-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),"Gemini AI Status"]}),w.jsx("span",{className:`px-2 py-0.5 rounded-full text-[8px] font-black uppercase ${n?"bg-emerald-500/10 text-emerald-500 border border-emerald-500/20":"bg-rose-500/10 text-rose-500 border border-rose-500/20 animate-pulse"}`,children:n?"Connected":"Action Required"})]}),w.jsx("p",{className:`text-[10px] font-bold uppercase tracking-tighter mt-1 ${t?"text-slate-500":"text-slate-400"}`,children:n?"Extraction Engine Ready":"Authentication Needed"})]}),w.jsx("button",{onClick:c,className:`px-4 py-2 border rounded-xl text-[10px] font-black uppercase tracking-widest hover:bg-purple-500 hover:text-white transition-all shadow-lg active:scale-95 ${n?"bg-purple-500/10 text-purple-500 border-purple-500/20":"bg-purple-600 text-white border-purple-700 animate-bounce"}`,children:n?"Switch AI Project":"Handshake AI"})]})})]}),w.jsxs("section",{className:`p-6 rounded-2xl border ${t?"bg-[#1e293b] border-white/5":"bg-white border-slate-100 shadow-sm"}`,children:[w.jsxs("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400 mb-6 flex items-center gap-2",children:[w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M7 21a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"})}),"App Branding & Colors"]}),w.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-5 gap-3",children:lj.map(C=>w.jsxs("button",{onClick:()=>o==null?void 0:o(C.hex),className:"group flex items-center gap-3 p-2 rounded-xl border border-transparent hover:border-brand/20 hover:bg-brand/5 transition-all text-left",children:[w.jsx("div",{className:"w-8 h-8 rounded-lg border-2 border-white/10 shadow-lg shrink-0",style:{backgroundColor:C.hex}}),w.jsxs("div",{className:"overflow-hidden",children:[w.jsx("span",{className:"block text-[9px] font-black uppercase tracking-tight truncate",children:C.name}),w.jsx("span",{className:"block text-[8px] font-mono opacity-40",children:C.hex})]})]},C.hex))})]}),w.jsxs("section",{className:`rounded-2xl border overflow-hidden ${t?"bg-[#1e293b] border-white/5":"bg-white border-slate-100 shadow-sm"}`,children:[w.jsxs("div",{className:"px-6 py-4 border-b border-black/5 flex items-center justify-between",children:[w.jsx("h3",{className:"text-xs font-black uppercase tracking-widest text-slate-400",children:"Authorized Personnel"}),E&&w.jsx("button",{onClick:A,disabled:d,className:"text-[9px] font-black uppercase tracking-widest text-brand bg-brand/10 px-3 py-1.5 rounded-lg hover:bg-brand hover:text-slate-900 transition-all flex items-center gap-2",children:d?"Syncing...":"Sync My Profile"})]}),w.jsx("div",{className:"overflow-x-auto",children:w.jsxs("table",{className:"w-full text-left",children:[w.jsx("thead",{className:`${t?"bg-black/20":"bg-slate-50"} text-[9px] font-black uppercase tracking-[0.2em] text-slate-50`,children:w.jsxs("tr",{children:[w.jsx("th",{className:"px-6 py-3",children:"Full Name"}),w.jsx("th",{className:"px-6 py-3",children:"Email / ID"}),w.jsx("th",{className:"px-6 py-3",children:"Role Status"}),w.jsx("th",{className:"px-6 py-3 text-right",children:"Actions"})]})}),w.jsx("tbody",{className:`divide-y ${t?"divide-white/5":"divide-slate-100"}`,children:i.map(C=>w.jsxs("tr",{className:"text-xs font-bold transition-colors hover:bg-black/5",children:[w.jsx("td",{className:"px-6 py-4",children:C.name}),w.jsx("td",{className:"px-6 py-4 opacity-40 font-mono text-[10px]",children:C.username}),w.jsx("td",{className:"px-6 py-4",children:w.jsx("button",{onClick:()=>E&&(l==null?void 0:l(C)),disabled:!E||C.id===e.id,className:`px-2 py-0.5 rounded text-[8px] font-black uppercase border transition-all ${C.role===Di.ADMIN?"bg-brand/10 border-brand/20 text-brand":"bg-slate-100 border-slate-200 text-slate-500"} ${E&&C.id!==e.id?"hover:scale-105 active:scale-95":"opacity-50 cursor-not-allowed"}`,children:C.role})}),w.jsx("td",{className:"px-6 py-4 text-right",children:E&&C.id!==e.id&&w.jsx("button",{onClick:()=>{confirm(`Remove ${C.name} access?`)&&s(C.id)},className:"p-2 text-rose-500 hover:bg-rose-500/10 rounded-lg transition-colors",children:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]},C.id))})]})})]})]})},uj=["All","Power","Gas","Telecom","City/Village","Private"],dj=({ticket:i,userName:e,onSave:t,onDelete:n,onClose:s,isDarkMode:o})=>{const[l,c]=ee.useState({}),[d,h]=ee.useState(!1),[p,y]=ee.useState(!1),[b,S]=ee.useState(null),[E,R]=ee.useState(!1);ee.useEffect(()=>{let U=!0;return(async()=>{if(!i.noShowRequested){R(!1);return}R(!0);try{const B=await at.getNoShows();if(!U)return;const Q=B.find(K=>K.ticketId===i.id);Q&&S(Q)}catch(B){console.error("Failed to load existing no-show record",B)}finally{U&&R(!1)}})(),()=>{U=!1}},[i.id,i.noShowRequested]);const A=U=>{c(P=>{const B={...P};return U==="All"?P.All!==void 0?{}:{All:""}:(delete B.All,B[U]!==void 0?delete B[U]:B[U]="",B)})},C=(U,P)=>{c(B=>({...B,[U]:P}))},k=Object.keys(l).length>0,I=async U=>{if(U.preventDefault(),!!k){h(!0);try{const P=Object.keys(l),B=P.filter(K=>K!=="All"&&l[K].trim()!=="").map(K=>`${K}: ${l[K].trim()}`).join(", "),Q={id:crypto.randomUUID(),ticketId:i.id,companyId:i.companyId,jobNumber:i.jobNumber,utilities:P,companies:B,author:e,timestamp:Date.now()};await t(Q),s()}catch(P){alert("Error saving no-show record: "+P.message)}finally{h(!1)}}},O=async()=>{if(n&&window.confirm(`Clear the No Show alert for Ticket #${i.ticketNo}? This incident will be resolved and archived.`)){y(!0);try{await n()&&s()}catch(U){alert("Error clearing no-show: "+U.message)}finally{y(!1)}}};return E?w.jsx("div",{className:"fixed inset-0 bg-slate-950/70 backdrop-blur-sm z-[180] flex justify-center items-center p-4",children:w.jsxs("div",{className:`w-full max-w-md p-10 rounded-2xl flex flex-col items-center justify-center ${o?"bg-[#1e293b]":"bg-white"}`,children:[w.jsx("div",{className:"w-8 h-8 border-2 border-rose-500 border-t-transparent rounded-full animate-spin mb-4"}),w.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest opacity-40",children:"Retrieving Log..."})]})}):w.jsx("div",{className:"fixed inset-0 bg-slate-950/70 backdrop-blur-sm z-[180] flex justify-center items-center p-4",children:w.jsxs("div",{className:`w-full max-w-md rounded-2xl shadow-2xl overflow-hidden border animate-in ${o?"bg-[#1e293b] border-white/10":"bg-white border-slate-200"}`,children:[w.jsxs("div",{className:"px-6 py-4 border-b flex justify-between items-center bg-rose-50/50",children:[w.jsxs("div",{className:"flex items-center gap-2",children:[w.jsx("div",{className:"bg-rose-500 p-1.5 rounded-lg shadow-lg shadow-rose-500/20",children:w.jsx("svg",{className:"w-3.5 h-3.5 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),w.jsx("h2",{className:`text-sm font-black uppercase tracking-widest ${o?"text-rose-500":"text-rose-600"}`,children:b?"Manage No Show":"Call No Shows"})]}),w.jsx("button",{onClick:s,className:"p-1 opacity-50 hover:opacity-100 transition-opacity",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M6 18L18 6M6 6l12 12"})})})]}),b?w.jsxs("div",{className:"p-6 space-y-6",children:[w.jsx("div",{className:"space-y-4",children:w.jsxs("div",{className:`p-4 rounded-2xl border space-y-3 ${o?"bg-rose-500/5 border-rose-500/10":"bg-rose-50 border-rose-100"}`,children:[w.jsxs("div",{className:"flex items-center justify-between",children:[w.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest ${o?"text-rose-500":"text-rose-700"}`,children:"Active Incident Log"}),w.jsx("span",{className:`text-[9px] font-bold ${o?"text-slate-400":"text-slate-900"}`,children:new Date(b.timestamp).toLocaleDateString()})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("p",{className:`text-[9px] font-black uppercase tracking-tight ${o?"text-slate-400":"text-slate-900"}`,children:"Reported Utilities"}),w.jsx("div",{className:"flex flex-wrap gap-1.5",children:b.utilities.map(U=>w.jsx("span",{className:"px-2 py-0.5 bg-rose-500 text-white rounded text-[9px] font-black uppercase tracking-tighter shadow-sm",children:U},U))})]}),b.companies&&w.jsxs("div",{className:"space-y-1 pt-1",children:[w.jsx("p",{className:`text-[9px] font-black uppercase tracking-tight ${o?"text-slate-400":"text-slate-900"}`,children:"Contractor Info"}),w.jsxs("p",{className:`text-[11px] font-bold italic ${o?"text-slate-300":"text-slate-900"}`,children:['"',b.companies,'"']})]}),w.jsx("div",{className:`pt-2 border-t flex items-center justify-between ${o?"border-rose-500/10":"border-rose-200"}`,children:w.jsxs("p",{className:`text-[9px] font-bold uppercase ${o?"text-slate-400":"text-slate-950"}`,children:["Logged By: ",w.jsx("span",{className:"font-black text-rose-600",children:b.author})]})})]})}),w.jsxs("div",{className:"space-y-3",children:[w.jsx("button",{type:"button",disabled:p,onClick:O,className:"w-full bg-slate-900 dark:bg-white text-white dark:text-slate-900 py-3.5 rounded-xl font-black text-[10px] uppercase tracking-widest shadow-xl transition-all active:scale-[0.98] hover:bg-emerald-600 hover:text-white dark:hover:bg-emerald-600 flex items-center justify-center gap-2",children:p?w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"w-3 h-3 border-2 border-current border-t-transparent rounded-full animate-spin"}),"Clearing..."]}):"Clear No Show Alert"}),w.jsx("p",{className:`text-[9px] font-bold uppercase tracking-tighter text-center px-4 ${o?"text-slate-400":"text-slate-950"}`,children:"Clicking clear will resolve the status and archive this specific incident log from the vault."})]})]}):w.jsxs("form",{onSubmit:I,className:"p-6 space-y-6",children:[w.jsxs("div",{className:"space-y-4",children:[w.jsx("p",{className:`text-[10px] font-black uppercase tracking-widest mb-2 ${o?"text-slate-400":"text-slate-950"}`,children:"Which utilities are not marked?"}),w.jsx("div",{className:"space-y-2",children:uj.map(U=>{const P=l[U]!==void 0;return w.jsxs("div",{className:"space-y-2",children:[w.jsxs("button",{type:"button",onClick:()=>A(U),className:`w-full flex items-center justify-between px-4 py-3 rounded-xl border text-[10px] font-black uppercase tracking-widest transition-all ${P?"bg-rose-500 border-rose-500 text-white shadow-lg shadow-rose-500/20":o?"bg-white/5 border-white/5 text-slate-400 hover:border-white/10":"bg-slate-50 border-slate-300 text-slate-900 hover:border-slate-400"}`,children:[w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:`w-4 h-4 rounded flex items-center justify-center border ${P?"bg-white border-white":"bg-transparent border-current opacity-30"}`,children:P&&w.jsx("svg",{className:"w-2.5 h-2.5 text-rose-500",fill:"currentColor",viewBox:"0 0 20 20",children:w.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),U]}),P&&U!=="All"&&w.jsx("span",{className:"text-[8px] opacity-70",children:"Define Owner below"})]}),P&&U!=="All"&&w.jsx("div",{className:"px-1 animate-in",children:w.jsx("input",{autoFocus:!0,type:"text",placeholder:`Enter ${U} Company Name...`,className:`w-full px-4 py-2.5 border rounded-xl text-[11px] font-bold outline-none focus:ring-4 focus:ring-rose-500/10 transition-all ${o?"bg-white/5 border-white/10 text-white placeholder:text-slate-600":"bg-slate-50 border-slate-300 text-slate-900 placeholder:text-slate-500"}`,value:l[U],onChange:B=>C(U,B.target.value)})})]},U)})})]}),w.jsxs("div",{className:"pt-2",children:[w.jsx("button",{type:"submit",disabled:d||!k,className:"w-full bg-rose-500 text-white py-3.5 rounded-xl font-black text-[10px] uppercase tracking-widest shadow-xl shadow-rose-500/20 disabled:opacity-50 transition-all active:scale-[0.98]",children:d?"Processing Event...":"Log No Show Event"}),w.jsxs("div",{className:"flex justify-between items-center mt-6 opacity-40",children:[w.jsxs("span",{className:`text-[8px] font-black uppercase tracking-tighter ${o?"text-slate-400":"text-slate-950"}`,children:["ID: ",i.ticketNo]}),w.jsxs("span",{className:`text-[8px] font-black uppercase tracking-tighter ${o?"text-slate-400":"text-slate-950"}`,children:["JOB: ",i.jobNumber]})]})]})]})]})})},hj=()=>{const[i,e]=ee.useState(!1),[t,n]=ee.useState(""),[s,o]=ee.useState(""),[l,c]=ee.useState(""),[d,h]=ee.useState(""),[p,y]=ee.useState(""),[b,S]=ee.useState(!1),[E,R]=ee.useState(!1),A=async()=>{S(!0),h("");try{const{error:k}=await Ve.auth.resend({type:"signup",email:t,options:{emailRedirectTo:window.location.origin}});if(k)throw k;y("Verification email resent! Please check your inbox."),R(!1)}catch(k){h(k.message||"Failed to resend email.")}finally{S(!1)}},C=async k=>{k.preventDefault(),h(""),y(""),R(!1),S(!0);try{if(i){const{data:I,error:O}=await Ve.auth.signUp({email:t,password:s,options:{data:{display_name:l},emailRedirectTo:window.location.origin}});if(O)throw O;I.user&&!I.session?(y("Success! Check your email for a confirmation link."),e(!1)):I.session&&window.location.reload()}else{const{error:I}=await Ve.auth.signInWithPassword({email:t,password:s});if(I)throw(I.message.toLowerCase().includes("confirm")||I.message.toLowerCase().includes("verified"))&&R(!0),I;window.location.reload()}}catch(I){h(I.message||"Authentication failed.")}finally{S(!1)}};return w.jsx("div",{className:"fixed inset-0 bg-[#0f172a] flex items-center justify-center p-4 z-[200]",children:w.jsx("div",{className:"w-full max-w-sm animate-in",children:w.jsxs("div",{className:"bg-white rounded-2xl shadow-2xl overflow-hidden p-8 border border-slate-200",children:[w.jsxs("div",{className:"flex flex-col items-center mb-8 text-center",children:[w.jsx("div",{className:"bg-brand p-3 rounded-xl shadow-lg shadow-brand/20 mb-4",children:w.jsx("svg",{className:"w-6 h-6 text-[#0f172a]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"})})}),w.jsx("h1",{className:"text-xl font-black text-slate-900 tracking-tight uppercase",children:"DigTrack Pro"}),w.jsx("p",{className:"text-[10px] font-black text-slate-400 uppercase tracking-widest mt-1",children:i?"New User Registration":"Site Portal Login"})]}),w.jsxs("form",{onSubmit:C,className:"space-y-4",children:[d&&w.jsxs("div",{className:"p-3 bg-rose-50 text-rose-600 text-[10px] font-black uppercase text-center rounded-xl border border-rose-100 flex flex-col gap-2",children:[w.jsx("span",{children:d}),E&&w.jsx("button",{type:"button",onClick:A,className:"bg-rose-600 text-white py-1.5 rounded-lg text-[9px] hover:bg-rose-700 transition-colors",children:"Resend Verification Link"})]}),p&&w.jsx("div",{className:"p-3 bg-emerald-50 text-emerald-600 text-[10px] font-black uppercase text-center rounded-xl border border-emerald-100",children:p}),i&&w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest ml-1",children:"Full Name"}),w.jsx("input",{required:!0,type:"text",placeholder:"e.g. John Doe",className:"w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold text-slate-900 outline-none focus:ring-4 focus:ring-brand/10 transition-all",value:l,onChange:k=>c(k.target.value)})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest ml-1",children:"Email Address"}),w.jsx("input",{required:!0,type:"email",placeholder:"crew@company.com",className:"w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold text-slate-900 outline-none focus:ring-4 focus:ring-brand/10 transition-all",value:t,onChange:k=>n(k.target.value)})]}),w.jsxs("div",{className:"space-y-1",children:[w.jsx("label",{className:"text-[9px] font-black text-slate-500 uppercase tracking-widest ml-1",children:"Password"}),w.jsx("input",{required:!0,type:"password",placeholder:"",className:"w-full px-4 py-2 bg-slate-50 border border-slate-200 rounded-xl text-xs font-bold text-slate-900 outline-none focus:ring-4 focus:ring-brand/10 transition-all",value:s,onChange:k=>o(k.target.value)})]}),w.jsx("button",{disabled:b,type:"submit",className:"w-full bg-brand text-[#0f172a] py-3.5 rounded-xl font-black text-[10px] uppercase tracking-[0.15em] transition-all shadow-xl shadow-brand/10 disabled:opacity-50 mt-2",children:b?"Processing...":i?"Create Account":"Access Terminal"})]}),w.jsx("div",{className:"mt-8 text-center border-t border-slate-100 pt-6",children:w.jsx("button",{onClick:()=>{e(!i),h(""),y(""),R(!1)},className:"text-[9px] font-black text-slate-400 uppercase tracking-widest hover:text-brand transition-colors",children:i?"Existing User? Sign In":"No Account? Sign Up Here"})})]})})})},fj=["#3b82f6","#10b981","#f59e0b","#ef4444","#8b5cf6","#ec4899","#14b8a6","#f97316"],pj=({onComplete:i,isDarkMode:e=!0})=>{const[t,n]=ee.useState(""),[s,o]=ee.useState("#3b82f6"),[l,c]=ee.useState(!1),[d,h]=ee.useState(""),p=async y=>{if(y.preventDefault(),h(""),!t.trim()){h("Company name is required.");return}c(!0);try{await i(t.trim(),s)}catch(b){h(b.message||"Failed to create company. Please try again.")}finally{c(!1)}};return w.jsx("div",{className:"fixed inset-0 bg-[#0f172a] flex items-center justify-center p-4 z-[200]",children:w.jsx("div",{className:"w-full max-w-sm animate-in",children:w.jsxs("div",{className:`rounded-2xl shadow-2xl overflow-hidden p-8 border ${e?"bg-[#1e293b] border-white/10":"bg-white border-slate-200"}`,children:[w.jsxs("div",{className:"flex flex-col items-center mb-8 text-center",children:[w.jsx("div",{className:"bg-brand p-3 rounded-xl shadow-lg shadow-brand/20 mb-4",children:w.jsx("svg",{className:"w-6 h-6 text-[#0f172a]",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"})})}),w.jsx("h1",{className:`text-xl font-black tracking-tight uppercase ${e?"text-white":"text-slate-900"}`,children:"Company Setup"}),w.jsx("p",{className:"text-[10px] font-black uppercase tracking-widest mt-1 text-slate-400",children:"Create Your Organization"})]}),w.jsxs("form",{onSubmit:p,className:"space-y-5",children:[d&&w.jsx("div",{className:"p-3 bg-rose-50 text-rose-600 text-[10px] font-black uppercase text-center rounded-xl border border-rose-100",children:d}),w.jsxs("div",{children:[w.jsx("label",{className:`block text-[10px] font-black uppercase tracking-widest mb-2 ${e?"text-slate-400":"text-slate-600"}`,children:"Company Name"}),w.jsx("input",{type:"text",value:t,onChange:y=>n(y.target.value),placeholder:"Acme Utilities Inc.",required:!0,className:`w-full px-4 py-3 border rounded-xl text-sm font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${e?"bg-white/5 border-white/10 text-white placeholder-slate-600":"bg-slate-50 border-slate-200 text-slate-900 placeholder-slate-400"}`})]}),w.jsxs("div",{children:[w.jsx("label",{className:`block text-[10px] font-black uppercase tracking-widest mb-2 ${e?"text-slate-400":"text-slate-600"}`,children:"Brand Color"}),w.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[fj.map(y=>w.jsx("button",{type:"button",onClick:()=>o(y),className:"w-8 h-8 rounded-full transition-all hover:scale-110 active:scale-95",style:{backgroundColor:y,outline:s===y?`3px solid ${y}`:"none",outlineOffset:"2px"}},y)),w.jsx("input",{type:"color",value:s,onChange:y=>o(y.target.value),className:"w-8 h-8 rounded-full cursor-pointer border-0 bg-transparent",title:"Custom color"})]}),w.jsxs("div",{className:"mt-3 flex items-center gap-2",children:[w.jsx("div",{className:"w-5 h-5 rounded-full flex-shrink-0",style:{backgroundColor:s}}),w.jsx("span",{className:`text-[10px] font-bold uppercase tracking-widest ${e?"text-slate-400":"text-slate-500"}`,children:s})]})]}),w.jsx("button",{type:"submit",disabled:l,className:"w-full bg-brand text-[#0f172a] py-3 rounded-xl text-[11px] font-black uppercase tracking-widest shadow-lg shadow-brand/20 hover:scale-[1.02] active:scale-[0.98] transition-all disabled:opacity-60 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:l?w.jsxs(w.Fragment,{children:[w.jsx("div",{className:"w-4 h-4 border-2 border-[#0f172a] border-t-transparent rounded-full animate-spin"}),"Creating..."]}):"Create Company & Continue"})]})]})})})},mj=()=>{const[i,e]=ee.useState(null),[t,n]=ee.useState(!1),[s,o]=ee.useState(null),[l,c]=ee.useState("dashboard"),[d,h]=ee.useState(()=>localStorage.getItem("dig_theme_mode")!=="light"),[p,y]=ee.useState([]),[b,S]=ee.useState([]),[E,R]=ee.useState([]),[A,C]=ee.useState([]),[k,I]=ee.useState(!0),[O]=ee.useState(!1),[U,P]=ee.useState(()=>{const oe=gp("API_KEY");return oe.length>20&&oe!=="undefined"}),[B,Q]=ee.useState(null),[K,le]=ee.useState(null),[de,G]=ee.useState(!1),[fe,ce]=ee.useState(!1),[pe,z]=ee.useState(null),[X,te]=ee.useState(null),[ne,ue]=ee.useState(null),[F,V]=ee.useState(null),[se,he]=ee.useState(null),[Te,ke]=ee.useState(""),[xe,ft]=ee.useState(null),[Ye,As]=ee.useState(!1),[gn]=ee.useState({field:"createdAt",order:"desc"}),[ao,Yl]=ee.useState(new Set),Mn=ee.useRef(!1),Zs=(oe,ye=!1)=>{document.documentElement.style.setProperty("--brand-primary",oe);const Ae=parseInt(oe.slice(1,3),16),je=parseInt(oe.slice(3,5),16),Ce=parseInt(oe.slice(5,7),16);document.documentElement.style.setProperty("--brand-ring",`rgba(${Ae}, ${je}, ${Ce}, 0.1)`),document.documentElement.style.setProperty("--brand-shadow",`rgba(${Ae}, ${je}, ${Ce}, 0.25)`),ye&&localStorage.setItem("dig_theme_color",oe)},Ts=oe=>{G(!1),ue(null),ce(!1),V(null),z(null),te(null),he(null),Q(null),oe!=="photos"&&le(null),c(oe)},Bn=async()=>{var oe;if(!Mn.current){if(Mn.current=!0,!AL()){I(!1),Mn.current=!1;return}try{const{data:{session:ye}}=await Ve.auth.getSession();if(!ye){e(null),I(!1),Mn.current=!1;return}const[Ae]=await Promise.all([at.getUsers()]),je=Ae;C(je);const Ce=je.find(en=>en.id===ye.user.id);if(Ce){if(e(Ce),Ce.companyId){const en=await at.getCompany(Ce.companyId);o(en),en!=null&&en.brandColor&&Zs(en.brandColor)}}else e({id:ye.user.id,name:((oe=ye.user.user_metadata)==null?void 0:oe.display_name)||"New User",username:ye.user.email||"",role:Di.CREW,companyId:""}),n(!0);const[Bt,Oe,$t]=await Promise.allSettled([at.getTickets(),at.getJobs(),at.getPhotos()]);y(Bt.status==="fulfilled"?Bt.value:[]),S(Oe.status==="fulfilled"?Oe.value:[]),R($t.status==="fulfilled"?$t.value:[])}catch(ye){console.error("Critical Init Error:",ye)}finally{I(!1),Mn.current=!1}}};ee.useEffect(()=>{Bn();const{data:oe}=Ve.auth.onAuthStateChange(()=>Bn());return()=>oe.subscription.unsubscribe()},[]);const Jl=async oe=>{const ye=b.find(Ce=>Ce.jobNumber===oe.jobNumber);if(ye)return ye;const Ae={id:crypto.randomUUID(),companyId:i.companyId,jobNumber:oe.jobNumber,customer:oe.siteContact||"Auto-Detected Client",address:oe.street,city:oe.city,state:oe.state,county:oe.county,createdAt:Date.now(),isComplete:!1},je=await at.saveJob(Ae);return S(Ce=>[...Ce,je]),je},da=async(oe,ye=!1)=>{if(!(i!=null&&i.companyId)){n(!0);return}try{const Ae={...oe,companyId:i.companyId};await Jl(Ae);const je=ne&&!ye?{...ne,...Ae}:{...Ae,id:crypto.randomUUID(),createdAt:Date.now(),isArchived:!1},Ce=await at.saveTicket(je,ye);y(Bt=>ye?[Ce,...Bt.map($t=>$t.ticketNo===Ce.ticketNo&&$t.jobNumber===Ce.jobNumber&&$t.id!==Ce.id?{...$t,isArchived:!0}:$t)]:Bt.findIndex($t=>$t.id===Ce.id)>-1?Bt.map($t=>$t.id===Ce.id?Ce:$t):[Ce,...Bt])}catch(Ae){alert(Ae.message)}},ha=async()=>{try{await Ve.auth.signOut(),e(null)}catch(oe){console.error("Sign out error:",oe.message)}},ae=async(oe,ye)=>{if(!i)return;const Ae={id:crypto.randomUUID(),name:oe,brandColor:ye,createdAt:Date.now()},je=await at.createCompany(Ae);await at.updateUserCompany(i.id,je.id),o(je),e(Ce=>Ce&&{...Ce,companyId:je.id}),je.brandColor&&Zs(je.brandColor),n(!1),Mn.current=!1,await Bn()},He=async(oe,ye)=>{ye.stopPropagation();const Ae=!oe.isArchived;if(!(Ae&&!confirm(`Archive Ticket #${oe.ticketNo}?`)))try{const je={...oe,isArchived:Ae},Ce=await at.saveTicket(je);y(Bt=>Bt.map(Oe=>Oe.id===Ce.id?Ce:Oe))}catch(je){alert("Archive failed: "+je.message)}},ut=async(oe,ye)=>{if(ye){z(ye);return}const Ae=b.find(Oe=>Oe.jobNumber===oe);if(Ae){z(Ae);return}const je=p.filter(Oe=>Oe.jobNumber===oe&&!Oe.isArchived);if(je.length===0)return;const Ce=je[0],Bt={id:crypto.randomUUID(),companyId:i.companyId,jobNumber:oe,customer:Ce.siteContact||"Client",address:Ce.street,city:Ce.city,state:Ce.state,county:Ce.county,createdAt:Date.now(),isComplete:!1};try{const Oe=await at.saveJob(Bt);S($t=>[...$t,Oe]),z(Oe)}catch(Oe){alert("Job init failed: "+Oe.message)}},Ie=()=>{const oe=!d;h(oe),localStorage.setItem("dig_theme_mode",oe?"dark":"light")},zt=async()=>{var oe;(oe=window.aistudio)!=null&&oe.openSelectKey?(await window.aistudio.openSelectKey(),P(!0)):alert("Missing AI credentials.")},Mt=ee.useMemo(()=>{const oe=new Set(b.filter(ye=>ye.isComplete).map(ye=>ye.jobNumber));return p.filter(ye=>!oe.has(ye.jobNumber)&&(Ye||!ye.isArchived))},[p,b,Ye]),Cs=ee.useMemo(()=>{let oe=Mt.filter(ye=>{const Ae=String(Te||"").toLowerCase().trim();return Ae&&!String(ye.ticketNo||"").toLowerCase().includes(Ae)&&!String(ye.street||"").toLowerCase().includes(Ae)&&!String(ye.jobNumber||"").toLowerCase().includes(Ae)?!1:xe?xe==="NO_SHOW"?!!ye.noShowRequested:Ks(ye)===xe:!0});return oe.sort((ye,Ae)=>{let je=gn.field==="status"?Ks(ye):ye[gn.field],Ce=gn.field==="status"?Ks(Ae):Ae[gn.field];const Bt=gn.order==="asc"?1:-1;return typeof je=="string"?Bt*String(je||"").localeCompare(String(Ce||"")):Bt*((Number(je)||0)-(Number(Ce)||0))}),oe},[Mt,Te,gn,xe]),hi=ee.useMemo(()=>{const oe=new Map;return Cs.forEach(ye=>{const Ae=oe.get(ye.jobNumber)||[];Ae.push(ye),oe.set(ye.jobNumber,Ae)}),oe},[Cs]),jn=oe=>{const ye=new Set(ao);ye.has(oe)?ye.delete(oe):ye.add(oe),Yl(ye)};if(k)return w.jsxs("div",{className:"min-h-screen bg-[#0f172a] flex flex-col items-center justify-center",children:[w.jsx("div",{className:"w-8 h-8 border-2 border-brand border-t-transparent rounded-full animate-spin mb-4"}),w.jsx("p",{className:"text-[9px] font-black uppercase tracking-widest opacity-40",children:"Connecting Vault..."})]});if(!i)return w.jsx(hj,{});if(t)return w.jsx(pj,{onComplete:ae,isDarkMode:d});const qn=i.role===Di.ADMIN,er=[{id:"dashboard",label:"Vault",icon:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M4 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2V6zM14 6a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V6zM4 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2H6a2 2 0 01-2-2v-2zM14 16a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"})})},{id:"jobs",label:"Projects",icon:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M21 13.255A23.931 23.931 0 0112 15c-3.183 0-6.22-.62-9-1.745M16 6V4a2 2 0 00-2-2h-4a2 2 0 00-2 2v2m4 6h.01M5 20h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2-2v10a2 2 0 002 2z"})})},{id:"calendar",label:"Schedule",icon:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{id:"photos",label:"Media",icon:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{id:"team",label:"Team",icon:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"})})}];return w.jsxs("div",{className:`min-h-screen ${d?"bg-[#0f172a] text-slate-100":"bg-slate-50 text-black"} transition-all duration-500 pb-20 sm:pb-0`,children:[w.jsx("header",{className:`${d?"bg-[#1e293b]/95 border-white/5 shadow-2xl shadow-black/20":"bg-white/95 border-slate-200 shadow-sm"} backdrop-blur-xl border-b sticky top-0 z-40 h-16 transition-all duration-500`,children:w.jsxs("div",{className:"max-w-[1400px] mx-auto px-4 h-full flex items-center justify-between gap-4",children:[w.jsxs("div",{className:"flex items-center gap-3 cursor-pointer group shrink-0",onClick:()=>{Ts("dashboard")},children:[w.jsx("div",{className:`p-2.5 rounded-2xl shadow-lg transition-all duration-500 glow-brand ${O?"bg-purple-500 shadow-purple-500/30":"bg-brand shadow-brand/20"} group-hover:scale-110 active:scale-95`,children:w.jsx("svg",{className:`w-5 h-5 text-[#0f172a] ${O?"animate-pulse":""}`,fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),w.jsxs("div",{className:"hidden lg:block",children:[w.jsx("h1",{className:"text-sm font-black uppercase tracking-tight group-hover:text-brand transition-colors",children:(s==null?void 0:s.name)||"DigTrack Pro"}),w.jsx("p",{className:"text-[9px] font-bold text-slate-500 uppercase tracking-widest leading-none",children:"Enterprise Locate Hub"})]})]}),w.jsx("nav",{className:"hidden sm:flex items-center gap-1 bg-black/5 p-1 rounded-2xl border border-black/5 mx-auto",children:er.map(oe=>{const ye=l===oe.id;return w.jsxs("button",{onClick:()=>Ts(oe.id),className:`flex items-center gap-2 px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all relative ${ye?"bg-brand text-slate-900 shadow-lg shadow-brand/10 nav-item-active":d?"text-slate-400 hover:text-white":"text-slate-600 hover:text-brand"}`,children:[oe.icon,w.jsx("span",{className:"hidden md:inline",children:oe.label}),ye&&w.jsx("div",{className:"absolute -bottom-1 left-1/2 -translate-x-1/2 w-1 h-1 bg-slate-900 rounded-full"})]},oe.id)})}),w.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[w.jsx("div",{className:"hidden sm:flex items-center gap-1",children:qn&&w.jsxs(w.Fragment,{children:[w.jsx("button",{onClick:()=>{V(null),ce(!0)},className:`p-2 rounded-xl transition-all ${d?"bg-white/5 text-slate-300":"bg-slate-100 text-slate-900 hover:text-brand"}`,title:"New Job",children:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"})})}),w.jsx("button",{onClick:()=>{ue(null),G(!0)},className:"bg-brand text-[#0f172a] p-2 rounded-xl shadow-lg shadow-brand/20 hover:scale-105 active:scale-95 transition-all",title:"New Ticket",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M12 4v16m8-8H4"})})})]})}),w.jsx("div",{className:"w-px h-6 bg-black/10 mx-1 hidden sm:block"}),w.jsx("button",{onClick:Ie,className:`p-2.5 rounded-xl transition-all ${d?"bg-white/5 text-amber-300":"bg-slate-100 text-slate-900"}`,children:d?w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M12 3v1m0 16v1m9-9h-1M4 12H3m15.364-6.364l-.707.707M6.343 17.657l-.707.707m12.728 0l-.707-.707M6.343 6.343l-.707-.707M12 7a5 5 0 100 10 5 5 0 000-10z"})}):w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"})})}),w.jsx("button",{onClick:ha,className:"p-2.5 text-slate-500 hover:text-rose-500 transition-colors",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})})})]})]})}),w.jsxs("main",{className:"max-w-[1400px] mx-auto px-4 py-8 view-transition",children:[l==="dashboard"&&w.jsxs("div",{className:"space-y-8",children:[w.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[w.jsxs("div",{children:[w.jsx("h2",{className:"text-2xl font-black uppercase tracking-tight",children:"Locate Vault"}),w.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[w.jsx("p",{className:`text-[10px] font-bold uppercase tracking-widest ${d?"text-slate-500":"text-slate-400"}`,children:"Real-time Field Compliance"}),!U&&w.jsx("button",{onClick:zt,className:"bg-brand text-slate-900 text-[9px] font-black uppercase px-3 py-1 rounded-lg shadow-lg shadow-brand/20 animate-pulse hover:scale-105 transition-all",children:" Connect Paid AI Project"})]})]}),w.jsxs("div",{className:"flex flex-col sm:flex-row items-center gap-3 w-full sm:w-auto",children:[w.jsxs("button",{onClick:()=>As(!Ye),className:`flex items-center gap-2 px-4 py-2 rounded-2xl border text-[10px] font-black uppercase tracking-widest transition-all ${Ye?"bg-slate-900 text-white border-slate-900":d?"bg-white/5 border-white/5 text-slate-400 hover:text-white":"bg-white border-slate-200 text-slate-600 hover:border-slate-400"}`,children:[w.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})}),Ye?"History Included":"View History"]}),w.jsxs("div",{className:"relative w-full sm:w-64 group",children:[w.jsx("input",{type:"text",placeholder:"Filter vault...",className:`w-full pl-9 pr-4 py-2 border rounded-2xl text-[11px] font-bold outline-none focus:ring-4 focus:ring-brand/10 transition-all ${d?"bg-white/5 border-white/10 text-white":"bg-white border-slate-300 shadow-sm text-black"}`,value:Te,onChange:oe=>ke(oe.target.value)}),w.jsx("svg",{className:"w-4 h-4 text-slate-500 absolute left-3 top-2.5 group-focus-within:text-brand transition-colors",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})]})]})]}),w.jsx(sj,{tickets:p.filter(oe=>!oe.isArchived),isDarkMode:d,activeFilter:xe,onFilterClick:ft}),w.jsx("div",{className:`${d?"bg-[#1e293b] border-white/5 shadow-2xl shadow-black/40":"bg-white border-slate-200 shadow-xl shadow-slate-200/50"} rounded-[2.5rem] border overflow-hidden`,children:w.jsx("div",{className:"overflow-x-auto no-scrollbar",children:w.jsxs("table",{className:"w-full text-left",children:[w.jsx("thead",{className:`${d?"bg-black/20":"bg-slate-50/80"} border-b border-black/5`,children:w.jsxs("tr",{children:[w.jsx("th",{className:"px-8 py-5 text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Project Details"}),w.jsx("th",{className:"px-8 py-5 text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Tickets"}),w.jsx("th",{className:"px-8 py-5 text-[10px] font-black uppercase tracking-[0.2em] text-slate-500",children:"Location Info"}),w.jsx("th",{className:"px-8 py-5 text-[10px] font-black uppercase tracking-[0.2em] text-center text-slate-500",children:"State"}),w.jsx("th",{className:`px-8 py-5 text-[10px] font-black uppercase tracking-[0.2em] text-right ${d?"text-slate-500":"text-slate-700"}`,children:"Expiry"}),w.jsx("th",{className:`px-8 py-5 text-[10px] font-black uppercase tracking-[0.2em] text-right ${d?"text-slate-500":"text-slate-700"}`,children:"Actions"})]})}),w.jsx("tbody",{className:`divide-y ${d?"divide-white/5":"divide-slate-100"}`,children:Array.from(hi.keys()).map(oe=>{const ye=hi.get(oe),Ae=b.find(Oe=>Oe.jobNumber===oe),je=ao.has(oe),Ce=ye.filter(Oe=>!Oe.isArchived).map(Oe=>Ks(Oe));let Bt=$e.VALID;return Ce.includes($e.EXPIRED)?Bt=$e.EXPIRED:(Ce.includes($e.REFRESH_NEEDED)||Ce.includes($e.EXTENDABLE))&&(Bt=$e.REFRESH_NEEDED),w.jsxs(ow.Fragment,{children:[w.jsxs("tr",{onClick:()=>jn(oe),className:`transition-all cursor-pointer border-l-4 ${je?"border-brand":"border-transparent"} ${d?"hover:bg-white/[0.03]":"hover:bg-slate-50/80"}`,children:[w.jsxs("td",{className:"px-8 py-6 flex items-center gap-4",children:[w.jsx("div",{className:`w-6 h-6 rounded-lg border flex items-center justify-center transition-all ${je?"bg-brand/10 border-brand/20 text-brand rotate-90":"bg-black/5 border-transparent opacity-40"}`,children:w.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M9 5l7 7-7 7"})})}),w.jsxs("button",{onClick:Oe=>{Oe.stopPropagation(),ut(oe,Ae)},className:`text-[13px] font-black hover:text-brand transition-colors text-left ${d?"text-white":"text-black"}`,children:["JOB #",oe]})]}),w.jsx("td",{className:"px-8 py-6",children:w.jsxs("span",{className:`text-[10px] font-black uppercase px-2 py-0.5 rounded-lg ${d?"bg-white/5 text-slate-400":"bg-slate-100 text-slate-600"}`,children:[ye.length," Assets"]})}),w.jsx("td",{className:"px-8 py-6",children:w.jsxs("div",{className:"flex flex-col",children:[w.jsx("span",{className:`text-[11px] font-black uppercase tracking-tight truncate max-w-[200px] ${d?"text-white":"text-black"}`,children:(Ae==null?void 0:Ae.customer)||"Direct Client"}),w.jsx("span",{className:`text-[9px] font-black truncate max-w-[200px] ${d?"opacity-40":"text-slate-900"}`,children:(Ae==null?void 0:Ae.city)||"Field Location"})]})}),w.jsx("td",{className:"px-8 py-6 text-center",children:w.jsx("div",{className:`w-2.5 h-2.5 rounded-full mx-auto ring-4 ${Bt===$e.EXPIRED?"bg-rose-500 ring-rose-500/10":Bt===$e.REFRESH_NEEDED?"bg-amber-500 ring-amber-500/10":"bg-emerald-500 ring-emerald-500/10"}`})}),w.jsx("td",{className:`px-8 py-6 text-right font-black text-[10px] ${d?"opacity-30 text-slate-400":"opacity-60 text-slate-900"}`,children:je?"COLLAPSE":"DETAILS"}),w.jsx("td",{className:"px-8 py-6 text-right",children:qn&&w.jsx("button",{onClick:Oe=>{Oe.stopPropagation(),Ae&&at.deleteJob(Ae.id).then(()=>Bn())},className:"p-2.5 text-slate-400 hover:text-rose-500 opacity-0 group-hover:opacity-100",children:w.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})})]}),je&&ye.map(Oe=>{const $t=Ks(Oe);return w.jsxs("tr",{onClick:()=>qn&&ue(Oe),className:`animate-in transition-all group ${qn?"cursor-pointer":""} ${d?"bg-white/[0.01]":"bg-slate-50/30"} border-l-4 border-slate-500/10 ${Oe.isArchived?"opacity-50 grayscale":""}`,children:[w.jsx("td",{className:"px-8 py-4 pl-16",children:w.jsxs("div",{className:"flex items-center gap-3",children:[w.jsx("div",{className:`w-2 h-2 rounded-full ${Oe.isArchived?"bg-slate-400":"bg-brand"}`}),w.jsx("button",{onClick:en=>{en.stopPropagation(),Oe.documentUrl&&Q(Oe.documentUrl)},className:`text-[11px] font-mono font-bold tracking-tight transition-colors ${Oe.documentUrl?"hover:text-brand hover:underline text-brand":"opacity-40"}`,children:Oe.ticketNo})]})}),w.jsx("td",{className:"px-8 py-4"}),w.jsx("td",{className:"px-8 py-4",children:w.jsxs("div",{className:"flex flex-col",children:[w.jsx("span",{className:`text-[11px] font-bold truncate max-w-[300px] ${d?"text-slate-300":"text-slate-950"}`,children:Oe.street}),w.jsx("span",{className:`text-[9px] font-black uppercase tracking-widest truncate max-w-[300px] ${d?"opacity-40 text-slate-500":"text-slate-950"}`,children:Oe.crossStreet?`at ${Oe.crossStreet}`:"No Cross Street"})]})}),w.jsx("td",{className:"px-8 py-4 text-center",children:w.jsx("span",{className:`inline-flex px-2 py-0.5 rounded-lg text-[8px] font-black uppercase border tracking-widest ${Oe.isArchived?"bg-slate-100 text-slate-500 border-slate-200":gb($t)}`,children:Oe.isArchived?"ARCHIVED":$t})}),w.jsx("td",{className:`px-8 py-4 text-[11px] font-bold text-right ${d?"opacity-60 text-slate-300":"opacity-100 text-slate-900"}`,children:new Date(Oe.expires).toLocaleDateString()}),w.jsxs("td",{className:"px-8 py-4 text-right flex items-center justify-end gap-2",children:[w.jsx("button",{onClick:en=>{en.stopPropagation(),he(Oe)},className:"p-2 rounded-xl transition-all border bg-rose-500/5 text-rose-500 border-rose-500/10 hover:bg-rose-500 hover:text-white",children:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"})})}),w.jsx("button",{onClick:en=>{en.stopPropagation(),He(Oe,en)},className:"p-2 rounded-xl transition-all border bg-slate-100 text-slate-500 hover:text-brand",children:w.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2.5",d:"M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"})})})]})]},Oe.id)})]},oe)})})]})})})]}),l==="calendar"&&w.jsx(aj,{tickets:p,onEditTicket:ue,onViewDoc:Q}),l==="jobs"&&w.jsx(rj,{tickets:p,jobs:b,isAdmin:qn,isDarkMode:d,onJobSelect:oe=>ut(oe.jobNumber,oe),onViewDoc:Q}),l==="photos"&&w.jsx(oj,{photos:E,jobs:b,tickets:p,isDarkMode:d,companyId:i.companyId,onAddPhoto:(oe,ye)=>at.addPhoto({...oe,companyId:i.companyId},ye),onDeletePhoto:oe=>at.deletePhoto(oe),initialSearch:K}),l==="team"&&w.jsx(cj,{users:A,sessionUser:i,isDarkMode:d,hasApiKey:U,onAddUser:async oe=>{await at.addUser({...oe,companyId:i.companyId}),Bn()},onDeleteUser:async oe=>{await at.deleteUser(oe),Bn()},onThemeChange:Zs,onToggleRole:async oe=>{await at.updateUserRole(oe.id,oe.role===Di.ADMIN?Di.CREW:Di.ADMIN),Bn()},onOpenSelectKey:zt}),(de||ne)&&w.jsx(X3,{onSave:da,onClose:()=>{G(!1),ue(null)},initialData:ne,isDarkMode:d,existingTickets:p}),(fe||F)&&w.jsx(Q3,{onSave:async oe=>{const ye=F?{...F,...oe}:{...oe,id:crypto.randomUUID(),companyId:i.companyId,createdAt:Date.now(),isComplete:!1},Ae=await at.saveJob(ye);S(je=>[...je.filter(Ce=>Ce.id!==Ae.id),Ae]),ce(!1),V(null)},onClose:()=>{ce(!1),V(null)},initialData:F||void 0,isDarkMode:d}),pe&&w.jsx(Z3,{job:pe,onClose:()=>z(null),onEdit:()=>{V(pe),ce(!0),z(null)},onDelete:()=>{at.deleteJob(pe.id).then(()=>Bn()),z(null)},onToggleComplete:async()=>{await at.saveJob({...pe,isComplete:!pe.isComplete}),Bn()},onViewMedia:()=>{le(pe.jobNumber),Ts("photos")},onViewMarkup:()=>{te(pe),z(null)},isDarkMode:d}),X&&w.jsx(ij,{job:X,tickets:p.filter(oe=>oe.jobNumber===X.jobNumber),onClose:()=>te(null),onViewTicket:oe=>Q(oe),isDarkMode:d}),se&&w.jsx(dj,{ticket:se,userName:(i==null?void 0:i.name)||"",onSave:async oe=>{await at.addNoShow(oe),Bn()},onDelete:async()=>(await at.deleteNoShow(se.id),Bn(),!0),onClose:()=>he(null),isDarkMode:d}),B&&w.jsxs("div",{className:"fixed inset-0 bg-black/90 z-[300] flex items-center justify-center p-4",children:[w.jsx("button",{onClick:()=>Q(null),className:"absolute top-6 right-6 p-4 bg-white/10 rounded-full text-white hover:bg-rose-500 transition-all z-10",children:w.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:w.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"3",d:"M6 18L18 6M6 6l12 12"})})}),w.jsx("div",{className:"w-full max-w-5xl h-[90vh] rounded-[2rem] bg-slate-900 shadow-2xl overflow-hidden border border-white/5 relative",children:w.jsx("iframe",{src:B,className:"w-full h-full bg-white",title:"Document Preview"})})]})]},l),w.jsx("nav",{className:`sm:hidden fixed bottom-0 left-0 right-0 z-50 px-4 pb-6 pt-3 backdrop-blur-xl border-t flex justify-between items-center ${d?"bg-[#1e293b]/95 border-white/5":"bg-white/95 border-slate-200"}`,children:er.map(oe=>{const ye=l===oe.id;return w.jsxs("button",{onClick:()=>Ts(oe.id),className:`flex flex-col items-center gap-1 transition-all ${ye?"text-brand scale-110":"text-slate-500 opacity-60"}`,children:[w.jsx("div",{className:`p-2 rounded-xl ${ye?"bg-brand/10":""}`,children:oe.icon}),w.jsx("span",{className:"text-[8px] font-black uppercase tracking-widest",children:oe.label})]},oe.id)})})]})};console.log("DigTrack Pro: Bootstrapping...");const mb=document.getElementById("root");if(!mb)console.error("Critical: Root element not found");else try{JI.createRoot(mb).render(w.jsx(ow.StrictMode,{children:w.jsx(mj,{})})),console.log("DigTrack Pro: Application mounted.")}catch(i){console.error("DigTrack Pro: Render crash:",i),mb.innerHTML=`<div style="padding: 40px; color: #e11d48; text-align: center;">
      <h1 style="font-size: 18px; font-weight: 900;">Application Error</h1>
      <p style="font-size: 14px; opacity: 0.7;">${i instanceof Error?i.message:"Unknown startup error"}</p>
      <button onclick="location.reload()" style="margin-top: 20px; padding: 10px 20px; background: #3b82f6; color: white; border-radius: 8px; border: none; font-weight: 800; cursor: pointer;">Retry Load</button>
    </div>`}
